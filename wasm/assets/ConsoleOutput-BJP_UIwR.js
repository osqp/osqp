import{s as H}from"./chunk-DZLz74EQ.js";import{s as te}from"./jotai-BTnrNcC1.js";import{t as re}from"./react-BcIddLXZ.js";import{Dt as se,ft as oe,kr as ae,vt as ne}from"./cells-A69p56PE.js";import{t as V}from"./compiler-runtime-Cr9loedd.js";import{u as q}from"./hotkeys-ClCtr3_I.js";import{t as le}from"./invariant-D5a0EE05.js";import{t as ie}from"./ErrorBoundary-_uEOjNWh.js";import{t as de}from"./jsx-runtime-mwDPpfh_.js";import{t as L}from"./cn-ZXtYmczU.js";import{t as I}from"./button-ZC2axIBq.js";import{rt as ce}from"./dist-MHIqsPCF.js";import{K as ue,L as B,n as me}from"./Output-DWmT-7NV.js";import{t as pe}from"./createLucideIcon-CNVopWor.js";import{t as fe}from"./chevron-right-BV0VfNbL.js";import{u as he}from"./toDate-C3oOx2yr.js";import{r as xe,t as be}from"./name-cell-input-DND1MD7b.js";import{J as ge,M as ve,j as Se,ot as je,q as ye,r as we,tt as Ne,x as Ce}from"./input-BNb8K99m.js";import{t as ke}from"./trash-CRcefzxk.js";import{t as z}from"./tooltip-BHnVWzH0.js";import{M as Pe,T as J}from"./usePress-BO20vkQb.js";import{i as _e}from"./useHotkey-NDxGNWnW.js";import{t as G}from"./strings-DHsDEFo-.js";import{t as Te}from"./copy-icon-CE7wmMnS.js";import{t as De}from"./esm-DtCFmQ1n.js";import{t as ze}from"./esm-B3nKz9z-.js";var Ee=pe("skip-forward",[["path",{d:"M21 4v16",key:"7j8fe9"}],["path",{d:"M6.029 4.285A2 2 0 0 0 3 6v12a2 2 0 0 0 3.029 1.715l9.997-5.998a2 2 0 0 0 .003-3.432z",key:"zs4d6"}]]);function Q(t,e,r){let{isSelected:s}=e,{isPressed:a,buttonProps:n}=Ce({...t,onPress:Pe(e.toggle,t.onPress)},r);return{isPressed:a,isSelected:s,isDisabled:t.isDisabled||!1,buttonProps:J(n,{"aria-pressed":s})}}function He(t,e,r){let s={isSelected:e.selectedKeys.has(t.id),defaultSelected:!1,setSelected(c){e.setSelected(t.id,c)},toggle(){e.toggleKey(t.id)}},{isPressed:a,isSelected:n,isDisabled:i,buttonProps:l}=Q({...t,id:void 0,isDisabled:t.isDisabled||e.isDisabled},s,r);return e.selectionMode==="single"&&(l.role="radio",l["aria-checked"]=s.isSelected,delete l["aria-pressed"]),{isPressed:a,isSelected:n,isDisabled:i,buttonProps:l}}var g=H(re(),1);function Ie(t={}){let{isReadOnly:e}=t,[r,s]=Ne(t.isSelected,t.defaultSelected||!1,t.onChange),[a]=(0,g.useState)(r);function n(l){e||s(l)}function i(){e||s(!r)}return{isSelected:r,defaultSelected:t.defaultSelected??a,setSelected:n,toggle:i}}var Ke=(0,g.createContext)(null),Re=(0,g.createContext)({}),Me=(0,g.forwardRef)(function(t,e){[t,e]=ye(t,e,Re);let r=(0,g.useContext)(Ke),s=Ie(r&&t.id!=null?{isSelected:r.selectedKeys.has(t.id),onChange(p){r.setSelected(t.id,p)}}:t),{buttonProps:a,isPressed:n,isSelected:i,isDisabled:l}=r&&t.id!=null?He({...t,id:t.id},r,e):Q({...t,id:t.id==null?void 0:String(t.id)},s,e),{focusProps:c,isFocused:m,isFocusVisible:v}=Se(t),{hoverProps:y,isHovered:u}=ve(t),d=ge({...t,id:void 0,values:{isHovered:u,isPressed:n,isFocused:m,isSelected:s.isSelected,isFocusVisible:v,isDisabled:l,state:s},defaultClassName:"react-aria-ToggleButton"}),b=je(t,{global:!0});return delete b.id,delete b.onClick,g.createElement("button",{...J(b,d,a,c,y),ref:e,slot:t.slot||void 0,"data-focused":m||void 0,"data-disabled":l||void 0,"data-pressed":n||void 0,"data-selected":i||void 0,"data-hovered":u||void 0,"data-focus-visible":v||void 0},g.createElement(_e.Provider,{value:{isSelected:i}},d.children))}),Le=H(V(),1),o=H(de(),1),Ae=(0,g.memo)(t=>{let e=g.useRef({});return(0,o.jsx)(ze,{minHeight:"200px",maxHeight:"200px",ref:e,theme:"dark",value:t.code,className:"*:outline-hidden [&>.cm-editor]:pr-0 overflow-hidden dark",readOnly:!0,editable:!1,basicSetup:{lineNumbers:!1},extensions:[De.shell(),ce.updateListener.of(r=>{var s;r.docChanged&&((s=e.current.view)==null||s.dispatch({selection:{anchor:r.state.doc.length,head:r.state.doc.length},scrollIntoView:!0}))})]})});Ae.displayName="DebuggerOutput";const Fe=t=>{let e=(0,Le.c)(30),{onSubmit:r,onClear:s}=t,a;e[0]===Symbol.for("react.memo_cache_sentinel")?(a=L("m-0 w-9 h-8 bg-(--slate-2) text-(--slate-11) hover:text-(--blue-11) rounded-none hover:bg-(--sky-3) hover:border-(--blue-8)","first:rounded-l-lg first:border-l border-t border-b hover:border","last:rounded-r-lg last:border-r"),e[0]=a):a=e[0];let n=a,i;e[1]===r?i=e[2]:(i=()=>r("n"),e[1]=r,e[2]=i);let l;e[3]===Symbol.for("react.memo_cache_sentinel")?(l=(0,o.jsx)(Ee,{fontSize:36,className:"w-5 h-5"}),e[3]=l):l=e[3];let c;e[4]===i?c=e[5]:(c=(0,o.jsx)(z,{content:"Next line",children:(0,o.jsx)(I,{variant:"text",size:"icon","data-testid":"debugger-next-button",className:n,onClick:i,children:l})}),e[4]=i,e[5]=c);let m;e[6]===r?m=e[7]:(m=()=>r("c"),e[6]=r,e[7]=m);let v,y;e[8]===Symbol.for("react.memo_cache_sentinel")?(v=L(n,"text-(--grass-11) hover:text-(--grass-11) hover:bg-(--grass-3) hover:border-(--grass-8)"),y=(0,o.jsx)(xe,{fontSize:36,className:"w-5 h-5"}),e[8]=v,e[9]=y):(v=e[8],y=e[9]);let u;e[10]===m?u=e[11]:(u=(0,o.jsx)(z,{content:"Continue execution",children:(0,o.jsx)(I,{variant:"text",size:"icon","data-testid":"debugger-continue-button",onClick:m,className:v,children:y})}),e[10]=m,e[11]=u);let d;e[12]===r?d=e[13]:(d=()=>r("bt"),e[12]=r,e[13]=d);let b;e[14]===Symbol.for("react.memo_cache_sentinel")?(b=(0,o.jsx)(se,{fontSize:36,className:"w-5 h-5"}),e[14]=b):b=e[14];let p;e[15]===d?p=e[16]:(p=(0,o.jsx)(z,{content:"Print stack trace",children:(0,o.jsx)(I,{variant:"text",size:"icon","data-testid":"debugger-stack-button",className:n,onClick:d,children:b})}),e[15]=d,e[16]=p);let f;e[17]===r?f=e[18]:(f=()=>r("help"),e[17]=r,e[18]=f);let S;e[19]===Symbol.for("react.memo_cache_sentinel")?(S=(0,o.jsx)(he,{fontSize:36,className:"w-5 h-5"}),e[19]=S):S=e[19];let h;e[20]===f?h=e[21]:(h=(0,o.jsx)(z,{content:"Help",children:(0,o.jsx)(I,{variant:"text",size:"icon","data-testid":"debugger-help-button",className:n,onClick:f,children:S})}),e[20]=f,e[21]=h);let x;e[22]===s?x=e[23]:(x=s&&(0,o.jsx)(z,{content:"Clear",children:(0,o.jsx)(I,{variant:"text",size:"icon","data-testid":"debugger-clear-button",className:L(n,"text-(--red-11) hover:text-(--red-11) hover:bg-(--red-2) hover:border-(--red-8)"),onClick:s,children:(0,o.jsx)(ke,{fontSize:36,className:"w-5 h-5"})})}),e[22]=s,e[23]=x);let j;return e[24]!==p||e[25]!==h||e[26]!==x||e[27]!==c||e[28]!==u?(j=(0,o.jsxs)("div",{className:"flex",children:[c,u,p,h,x]}),e[24]=p,e[25]=h,e[26]=x,e[27]=c,e[28]=u,e[29]=j):j=e[29],j};function We(t=!0){return{onKeyDown:e=>{if(!t)return;let r=e.currentTarget;if(!(e.key.toLowerCase()==="a"&&(e.ctrlKey||e.metaKey)))return;e.preventDefault(),e.stopPropagation();let s=window.getSelection();if(!s)return;let a=document.createRange();a.selectNodeContents(r),s.removeAllRanges(),s.addRange(a)}}}var Oe=new B;function U(t){try{let e=document.createElement("div");return e.innerHTML=t,(e.textContent||e.innerText||"").split(`
`).map(r=>r.trimEnd()).join(`
`)}catch(e){return q.error("Error parsing HTML content:",e),t}}function Ve(t){if(!t)return"";try{return U(Oe.ansi_to_html(t))}catch(e){return q.error("Error converting ANSI to plain text:",e),t}}var qe=H(V(),1),Be=ae("marimo:console:wrapText",!1,ne);function Je(){let t=(0,qe.c)(3),[e,r]=te(Be),s;return t[0]!==r||t[1]!==e?(s={wrapText:e,setWrapText:r},t[0]=r,t[1]=e,t[2]=s):s=t[2],s}var A=H(V(),1),Ge=new B;const Qe=t=>{let e=(0,A.c)(2),r;return e[0]===t?r=e[1]:(r=(0,o.jsx)(ie,{children:(0,o.jsx)(Ue,{...t})}),e[0]=t,e[1]=r),r};var Ue=t=>{let e=(0,A.c)(48),r=g.useRef(null),{wrapText:s,setWrapText:a}=Je(),{consoleOutputs:n,stale:i,cellName:l,cellId:c,onSubmitDebugger:m,onClear:v,onRefactorWithAI:y,className:u}=t,d=n.length>0,b=We(d),p;if(e[0]===Symbol.for("react.memo_cache_sentinel")?(p=()=>{let w=r.current;if(!w)return;let R=w.scrollHeight-w.clientHeight;R-w.scrollTop<120&&(w.scrollTop=R)},e[0]=p):p=e[0],(0,g.useLayoutEffect)(p),!d&&oe(l))return null;let f,S,h,x,j,N,P,_,C;if(e[1]!==c||e[2]!==u||e[3]!==n||e[4]!==d||e[5]!==v||e[6]!==y||e[7]!==m||e[8]!==b||e[9]!==a||e[10]!==i||e[11]!==s){let w=[...n].reverse(),R=w.some(Ze),Z=w.findIndex($e),M;e[21]===n?M=e[22]:(M=()=>n.filter(et).map(tt).join(`
`),e[21]=n,e[22]=M);let F=M;_="relative group",e[23]!==F||e[24]!==d||e[25]!==a||e[26]!==s?(C=d&&(0,o.jsxs)("div",{className:"absolute top-1 right-5 z-10 opacity-0 group-hover:opacity-100 flex gap-1",children:[(0,o.jsx)(Te,{tooltip:"Copy console output",value:F,className:"h-4 w-4"}),(0,o.jsx)(z,{content:s?"Disable wrap text":"Wrap text",children:(0,o.jsx)("span",{children:(0,o.jsx)(Me,{"aria-label":"Toggle text wrapping",className:"p-1 rounded bg-transparent text-muted-foreground data-hovered:text-foreground data-selected:text-foreground",isSelected:s,onChange:a,children:(0,o.jsx)(ue,{className:"h-4 w-4"})})})})]}),e[23]=F,e[24]=d,e[25]=a,e[26]=s,e[27]=C):C=e[27],f=i?"This console output is stale":void 0,S="console-output-area",h=r,x=b,j=0;let W=i&&"marimo-output-stale",O=d?"p-5":"p-3";e[28]!==u||e[29]!==W||e[30]!==O?(N=L("console-output-area overflow-hidden rounded-b-lg flex flex-col-reverse w-full gap-1 focus:outline-hidden",W,O,u),e[28]=u,e[29]=W,e[30]=O,e[31]=N):N=e[31],P=w.map((k,E)=>{if(k.channel==="pdb")return null;if(k.channel==="stdin"){le(typeof k.data=="string","Expected data to be a string");let $=n.length-E-1;return k.response==null&&Z===E?(0,o.jsx)(Xe,{output:k.data,isPdb:R,onSubmit:ee=>m(ee,$),onClear:v},E):(0,o.jsx)(Ye,{output:k.data,response:k.response},E)}return(0,o.jsx)(g.Fragment,{children:(0,o.jsx)(me,{cellId:c,onRefactorWithAI:y,message:k,wrapText:s})},E)}),e[1]=c,e[2]=u,e[3]=n,e[4]=d,e[5]=v,e[6]=y,e[7]=m,e[8]=b,e[9]=a,e[10]=i,e[11]=s,e[12]=f,e[13]=S,e[14]=h,e[15]=x,e[16]=j,e[17]=N,e[18]=P,e[19]=_,e[20]=C}else f=e[12],S=e[13],h=e[14],x=e[15],j=e[16],N=e[17],P=e[18],_=e[19],C=e[20];let T;e[32]!==c||e[33]!==l?(T=(0,o.jsx)(be,{value:l,cellId:c,className:"bg-(--slate-4) border-(--slate-4) hover:bg-(--slate-5) dark:border-(--sky-5) dark:bg-(--sky-6) dark:text-(--sky-12) text-(--slate-12) rounded-l rounded-br-lg absolute right-0 bottom-0 text-xs px-1.5 py-0.5 font-mono max-w-[75%] whitespace-nowrap overflow-hidden"}),e[32]=c,e[33]=l,e[34]=T):T=e[34];let D;e[35]!==f||e[36]!==T||e[37]!==S||e[38]!==h||e[39]!==x||e[40]!==j||e[41]!==N||e[42]!==P?(D=(0,o.jsxs)("div",{title:f,"data-testid":S,ref:h,...x,tabIndex:j,className:N,children:[P,T]}),e[35]=f,e[36]=T,e[37]=S,e[38]=h,e[39]=x,e[40]=j,e[41]=N,e[42]=P,e[43]=D):D=e[43];let K;return e[44]!==D||e[45]!==_||e[46]!==C?(K=(0,o.jsxs)("div",{className:_,children:[C,D]}),e[44]=D,e[45]=_,e[46]=C,e[47]=K):K=e[47],K},Xe=t=>{let e=(0,A.c)(13),r;e[0]===t.output?r=e[1]:(r=X(t.output),e[0]=t.output,e[1]=r);let s;e[2]===Symbol.for("react.memo_cache_sentinel")?(s=(0,o.jsx)(fe,{className:"w-5 h-5"}),e[2]=s):s=e[2];let a;e[3]===t?a=e[4]:(a=(0,o.jsx)(we,{"data-testid":"console-input","data-stdin-blocking":!0,type:"text",autoComplete:"off",autoFocus:!0,icon:s,className:"m-0 h-8 focus-visible:shadow-xs-solid",placeholder:"stdin",onKeyDownCapture:l=>{l.key==="Enter"&&!l.shiftKey&&(t.onSubmit(l.currentTarget.value),l.preventDefault(),l.stopPropagation()),l.key==="Enter"&&l.metaKey&&(l.preventDefault(),l.stopPropagation())}}),e[3]=t,e[4]=a);let n;e[5]!==t.isPdb||e[6]!==t.onClear||e[7]!==t.onSubmit?(n=t.isPdb&&(0,o.jsx)(Fe,{onSubmit:t.onSubmit,onClear:t.onClear}),e[5]=t.isPdb,e[6]=t.onClear,e[7]=t.onSubmit,e[8]=n):n=e[8];let i;return e[9]!==r||e[10]!==a||e[11]!==n?(i=(0,o.jsxs)("div",{className:"flex gap-2 items-center pt-2",children:[r,a,n]}),e[9]=r,e[10]=a,e[11]=n,e[12]=i):i=e[12],i},Ye=t=>{let e=(0,A.c)(7),r;e[0]===t.output?r=e[1]:(r=X(t.output),e[0]=t.output,e[1]=r);let s;e[2]===t.response?s=e[3]:(s=(0,o.jsx)("span",{className:"text-(--sky-11)",children:t.response}),e[2]=t.response,e[3]=s);let a;return e[4]!==r||e[5]!==s?(a=(0,o.jsxs)("div",{className:"flex gap-2 items-center",children:[r,s]}),e[4]=r,e[5]=s,e[6]=a):a=e[6],a},X=t=>t?(0,o.jsx)("span",{dangerouslySetInnerHTML:{__html:Ge.ansi_to_html(t)}}):null;const Y=t=>t.mimetype.startsWith("application/vnd.marimo")||t.mimetype==="text/html"?U(G.asString(t.data)):Ve(G.asString(t.data));function Ze(t){return typeof t.data=="string"&&t.data.includes("(Pdb)")}function $e(t){return t.channel==="stdin"}function et(t){return t.channel!=="pdb"}function tt(t){return Y(t)}export{Y as n,Qe as t};
