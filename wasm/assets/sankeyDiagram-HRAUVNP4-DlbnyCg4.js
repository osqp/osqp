var z,F,O;import{_,p as ft,q as yt,s as gt,g as pt,b as dt,a as _t,c as R,z as mt,T as xt,y as kt,j as vt}from"./mermaid-D59lkToe.js";import{s as Y}from"./transform-B8bpuzxV.js";import{o as bt}from"./ordinal-DDUp3AbE.js";import{c as wt}from"./colors-bszWmPJw.js";import"./index-D4bXoNM3.js";import"./step-BwsUM5iJ.js";import"./timer-BwIYMJWC.js";import"./init-DLRA0X12.js";const St=wt("4e79a7f28e2ce1575976b7b259a14fedc949af7aa1ff9da79c755fbab0ab");function et(t,i){let s;if(i===void 0)for(const o of t)o!=null&&(s<o||s===void 0&&o>=o)&&(s=o);else{let o=-1;for(let r of t)(r=i(r,++o,t))!=null&&(s<r||s===void 0&&r>=r)&&(s=r)}return s}function it(t,i){let s;if(i===void 0)for(const o of t)o!=null&&(s>o||s===void 0&&o>=o)&&(s=o);else{let o=-1;for(let r of t)(r=i(r,++o,t))!=null&&(s>r||s===void 0&&r>=r)&&(s=r)}return s}function B(t,i){let s=0;if(i===void 0)for(let o of t)(o=+o)&&(s+=o);else{let o=-1;for(let r of t)(r=+i(r,++o,t))&&(s+=r)}return s}function Lt(t){return t.target.depth}function st(t,i){return t.sourceLinks.length?t.depth:i-1}function W(t){return function(){return t}}function rt(t,i){return G(t.source,i.source)||t.index-i.index}function ot(t,i){return G(t.target,i.target)||t.index-i.index}function G(t,i){return t.y0-i.y0}function K(t){return t.value}function At(t){return t.index}function Et(t){return t.nodes}function Mt(t){return t.links}function at(t,i){const s=t.get(i);if(!s)throw new Error("missing: "+i);return s}function ct({nodes:t}){for(const i of t){let s=i.y0,o=s;for(const r of i.sourceLinks)r.y0=s+r.width/2,s+=r.width;for(const r of i.targetLinks)r.y1=o+r.width/2,o+=r.width}}function It(){let t,i,s,o=0,r=0,y=1,k=1,e=24,f=8,c=At,d=st,x=Et,p=Mt,E=6;function v(){const n={nodes:x.apply(null,arguments),links:p.apply(null,arguments)};return function({nodes:l,links:h}){for(const[u,a]of l.entries())a.index=u,a.sourceLinks=[],a.targetLinks=[];const g=new Map(l.map((u,a)=>[c(u,a,l),u]));for(const[u,a]of h.entries()){a.index=u;let{source:b,target:m}=a;typeof b!="object"&&(b=a.source=at(g,b)),typeof m!="object"&&(m=a.target=at(g,m)),b.sourceLinks.push(a),m.targetLinks.push(a)}if(s!=null)for(const{sourceLinks:u,targetLinks:a}of l)u.sort(s),a.sort(s)}(n),function({nodes:l}){for(const h of l)h.value=h.fixedValue===void 0?Math.max(B(h.sourceLinks,K),B(h.targetLinks,K)):h.fixedValue}(n),function({nodes:l}){const h=l.length;let g=new Set(l),u=new Set,a=0;for(;g.size;){for(const b of g){b.depth=a;for(const{target:m}of b.sourceLinks)u.add(m)}if(++a>h)throw new Error("circular link");g=u,u=new Set}}(n),function({nodes:l}){const h=l.length;let g=new Set(l),u=new Set,a=0;for(;g.size;){for(const b of g){b.height=a;for(const{source:m}of b.targetLinks)u.add(m)}if(++a>h)throw new Error("circular link");g=u,u=new Set}}(n),function(l){const h=function({nodes:g}){const u=et(g,m=>m.depth)+1,a=(y-o-e)/(u-1),b=new Array(u);for(const m of g){const S=Math.max(0,Math.min(u-1,Math.floor(d.call(null,m,u))));m.layer=S,m.x0=o+S*a,m.x1=m.x0+e,b[S]?b[S].push(m):b[S]=[m]}if(i)for(const m of b)m.sort(i);return b}(l);t=Math.min(f,(k-r)/(et(h,g=>g.length)-1)),function(g){const u=it(g,a=>(k-r-(a.length-1)*t)/B(a,K));for(const a of g){let b=r;for(const m of a){m.y0=b,m.y1=b+m.value*u,b=m.y1+t;for(const S of m.sourceLinks)S.width=S.value*u}b=(k-b+t)/(a.length+1);for(let m=0;m<a.length;++m){const S=a[m];S.y0+=b*(m+1),S.y1+=b*(m+1)}C(a)}}(h);for(let g=0;g<E;++g){const u=Math.pow(.99,g),a=Math.max(1-u,(g+1)/E);I(h,u,a),T(h,u,a)}}(n),ct(n),n}function T(n,l,h){for(let g=1,u=n.length;g<u;++g){const a=n[g];for(const b of a){let m=0,S=0;for(const{source:A,value:U}of b.targetLinks){let nt=U*(b.layer-A.layer);m+=$(A,b)*nt,S+=nt}if(!(S>0))continue;let D=(m/S-b.y0)*l;b.y0+=D,b.y1+=D,P(b)}i===void 0&&a.sort(G),M(a,h)}}function I(n,l,h){for(let g=n.length-2;g>=0;--g){const u=n[g];for(const a of u){let b=0,m=0;for(const{target:D,value:A}of a.sourceLinks){let U=A*(D.layer-a.layer);b+=N(a,D)*U,m+=U}if(!(m>0))continue;let S=(b/m-a.y0)*l;a.y0+=S,a.y1+=S,P(a)}i===void 0&&u.sort(G),M(u,h)}}function M(n,l){const h=n.length>>1,g=n[h];L(n,g.y0-t,h-1,l),w(n,g.y1+t,h+1,l),L(n,k,n.length-1,l),w(n,r,0,l)}function w(n,l,h,g){for(;h<n.length;++h){const u=n[h],a=(l-u.y0)*g;a>1e-6&&(u.y0+=a,u.y1+=a),l=u.y1+t}}function L(n,l,h,g){for(;h>=0;--h){const u=n[h],a=(u.y1-l)*g;a>1e-6&&(u.y0-=a,u.y1-=a),l=u.y0-t}}function P({sourceLinks:n,targetLinks:l}){if(s===void 0){for(const{source:{sourceLinks:h}}of l)h.sort(ot);for(const{target:{targetLinks:h}}of n)h.sort(rt)}}function C(n){if(s===void 0)for(const{sourceLinks:l,targetLinks:h}of n)l.sort(ot),h.sort(rt)}function $(n,l){let h=n.y0-(n.sourceLinks.length-1)*t/2;for(const{target:g,width:u}of n.sourceLinks){if(g===l)break;h+=u+t}for(const{source:g,width:u}of l.targetLinks){if(g===n)break;h-=u}return h}function N(n,l){let h=l.y0-(l.targetLinks.length-1)*t/2;for(const{source:g,width:u}of l.targetLinks){if(g===n)break;h+=u+t}for(const{target:g,width:u}of n.sourceLinks){if(g===l)break;h-=u}return h}return v.update=function(n){return ct(n),n},v.nodeId=function(n){return arguments.length?(c=typeof n=="function"?n:W(n),v):c},v.nodeAlign=function(n){return arguments.length?(d=typeof n=="function"?n:W(n),v):d},v.nodeSort=function(n){return arguments.length?(i=n,v):i},v.nodeWidth=function(n){return arguments.length?(e=+n,v):e},v.nodePadding=function(n){return arguments.length?(f=t=+n,v):f},v.nodes=function(n){return arguments.length?(x=typeof n=="function"?n:W(n),v):x},v.links=function(n){return arguments.length?(p=typeof n=="function"?n:W(n),v):p},v.linkSort=function(n){return arguments.length?(s=n,v):s},v.size=function(n){return arguments.length?(o=r=0,y=+n[0],k=+n[1],v):[y-o,k-r]},v.extent=function(n){return arguments.length?(o=+n[0][0],y=+n[1][0],r=+n[0][1],k=+n[1][1],v):[[o,r],[y,k]]},v.iterations=function(n){return arguments.length?(E=+n,v):E},v}var Z=Math.PI,H=2*Z,j=1e-6,Tt=H-j;function J(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function lt(){return new J}function ht(t){return function(){return t}}function Pt(t){return t[0]}function Nt(t){return t[1]}J.prototype=lt.prototype={constructor:J,moveTo:function(t,i){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+i)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,i){this._+="L"+(this._x1=+t)+","+(this._y1=+i)},quadraticCurveTo:function(t,i,s,o){this._+="Q"+ +t+","+ +i+","+(this._x1=+s)+","+(this._y1=+o)},bezierCurveTo:function(t,i,s,o,r,y){this._+="C"+ +t+","+ +i+","+ +s+","+ +o+","+(this._x1=+r)+","+(this._y1=+y)},arcTo:function(t,i,s,o,r){t=+t,i=+i,s=+s,o=+o,r=+r;var y=this._x1,k=this._y1,e=s-t,f=o-i,c=y-t,d=k-i,x=c*c+d*d;if(r<0)throw new Error("negative radius: "+r);if(this._x1===null)this._+="M"+(this._x1=t)+","+(this._y1=i);else if(x>j)if(Math.abs(d*e-f*c)>j&&r){var p=s-y,E=o-k,v=e*e+f*f,T=p*p+E*E,I=Math.sqrt(v),M=Math.sqrt(x),w=r*Math.tan((Z-Math.acos((v+x-T)/(2*I*M)))/2),L=w/M,P=w/I;Math.abs(L-1)>j&&(this._+="L"+(t+L*c)+","+(i+L*d)),this._+="A"+r+","+r+",0,0,"+ +(d*p>c*E)+","+(this._x1=t+P*e)+","+(this._y1=i+P*f)}else this._+="L"+(this._x1=t)+","+(this._y1=i)},arc:function(t,i,s,o,r,y){t=+t,i=+i,y=!!y;var k=(s=+s)*Math.cos(o),e=s*Math.sin(o),f=t+k,c=i+e,d=1^y,x=y?o-r:r-o;if(s<0)throw new Error("negative radius: "+s);this._x1===null?this._+="M"+f+","+c:(Math.abs(this._x1-f)>j||Math.abs(this._y1-c)>j)&&(this._+="L"+f+","+c),s&&(x<0&&(x=x%H+H),x>Tt?this._+="A"+s+","+s+",0,1,"+d+","+(t-k)+","+(i-e)+"A"+s+","+s+",0,1,"+d+","+(this._x1=f)+","+(this._y1=c):x>j&&(this._+="A"+s+","+s+",0,"+ +(x>=Z)+","+d+","+(this._x1=t+s*Math.cos(r))+","+(this._y1=i+s*Math.sin(r))))},rect:function(t,i,s,o){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+i)+"h"+ +s+"v"+ +o+"h"+-s+"Z"},toString:function(){return this._}};var Ot=Array.prototype.slice;function Ct(t){return t.source}function Dt(t){return t.target}function $t(t,i,s,o,r){t.moveTo(i,s),t.bezierCurveTo(i=(i+o)/2,s,i,r,o,r)}function jt(){return function(t){var i=Ct,s=Dt,o=Pt,r=Nt,y=null;function k(){var e,f=Ot.call(arguments),c=i.apply(this,f),d=s.apply(this,f);if(y||(y=e=lt()),t(y,+o.apply(this,(f[0]=c,f)),+r.apply(this,f),+o.apply(this,(f[0]=d,f)),+r.apply(this,f)),e)return y=null,e+""||null}return k.source=function(e){return arguments.length?(i=e,k):i},k.target=function(e){return arguments.length?(s=e,k):s},k.x=function(e){return arguments.length?(o=typeof e=="function"?e:ht(+e),k):o},k.y=function(e){return arguments.length?(r=typeof e=="function"?e:ht(+e),k):r},k.context=function(e){return arguments.length?(y=e??null,k):y},k}($t)}function zt(t){return[t.source.x1,t.y0]}function Ft(t){return[t.target.x0,t.y1]}var tt=function(){var t=_(function(e,f,c,d){for(c=c||{},d=e.length;d--;c[e[d]]=f);return c},"o"),i=[1,9],s=[1,10],o=[1,5,10,12],r={trace:_(function(){},"trace"),yy:{},symbols_:{error:2,start:3,SANKEY:4,NEWLINE:5,csv:6,opt_eof:7,record:8,csv_tail:9,EOF:10,"field[source]":11,COMMA:12,"field[target]":13,"field[value]":14,field:15,escaped:16,non_escaped:17,DQUOTE:18,ESCAPED_TEXT:19,NON_ESCAPED_TEXT:20,$accept:0,$end:1},terminals_:{2:"error",4:"SANKEY",5:"NEWLINE",10:"EOF",11:"field[source]",12:"COMMA",13:"field[target]",14:"field[value]",18:"DQUOTE",19:"ESCAPED_TEXT",20:"NON_ESCAPED_TEXT"},productions_:[0,[3,4],[6,2],[9,2],[9,0],[7,1],[7,0],[8,5],[15,1],[15,1],[16,3],[17,1]],performAction:_(function(e,f,c,d,x,p,E){var v=p.length-1;switch(x){case 7:const T=d.findOrCreateNode(p[v-4].trim().replaceAll('""','"')),I=d.findOrCreateNode(p[v-2].trim().replaceAll('""','"')),M=parseFloat(p[v].trim());d.addLink(T,I,M);break;case 8:case 9:case 11:this.$=p[v];break;case 10:this.$=p[v-1]}},"anonymous"),table:[{3:1,4:[1,2]},{1:[3]},{5:[1,3]},{6:4,8:5,15:6,16:7,17:8,18:i,20:s},{1:[2,6],7:11,10:[1,12]},t(s,[2,4],{9:13,5:[1,14]}),{12:[1,15]},t(o,[2,8]),t(o,[2,9]),{19:[1,16]},t(o,[2,11]),{1:[2,1]},{1:[2,5]},t(s,[2,2]),{6:17,8:5,15:6,16:7,17:8,18:i,20:s},{15:18,16:7,17:8,18:i,20:s},{18:[1,19]},t(s,[2,3]),{12:[1,20]},t(o,[2,10]),{15:21,16:7,17:8,18:i,20:s},t([1,5,10],[2,7])],defaultActions:{11:[2,1],12:[2,5]},parseError:_(function(e,f){if(!f.recoverable){var c=new Error(e);throw c.hash=f,c}this.trace(e)},"parseError"),parse:_(function(e){var f=this,c=[0],d=[],x=[null],p=[],E=this.table,v="",T=0,I=0,M=p.slice.call(arguments,1),w=Object.create(this.lexer),L={yy:{}};for(var P in this.yy)Object.prototype.hasOwnProperty.call(this.yy,P)&&(L.yy[P]=this.yy[P]);w.setInput(e,L.yy),L.yy.lexer=w,L.yy.parser=this,w.yylloc===void 0&&(w.yylloc={});var C=w.yylloc;p.push(C);var $=w.options&&w.options.ranges;function N(){var A;return typeof(A=d.pop()||w.lex()||1)!="number"&&(A instanceof Array&&(A=(d=A).pop()),A=f.symbols_[A]||A),A}typeof L.yy.parseError=="function"?this.parseError=L.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError,_(function(A){c.length=c.length-2*A,x.length=x.length-A,p.length=p.length-A},"popStack"),_(N,"lex");for(var n,l,h,g,u,a,b,m,S={};;){if(l=c[c.length-1],this.defaultActions[l]?h=this.defaultActions[l]:(n==null&&(n=N()),h=E[l]&&E[l][n]),h===void 0||!h.length||!h[0]){var D="";for(u in m=[],E[l])this.terminals_[u]&&u>2&&m.push("'"+this.terminals_[u]+"'");D=w.showPosition?"Parse error on line "+(T+1)+`:
`+w.showPosition()+`
Expecting `+m.join(", ")+", got '"+(this.terminals_[n]||n)+"'":"Parse error on line "+(T+1)+": Unexpected "+(n==1?"end of input":"'"+(this.terminals_[n]||n)+"'"),this.parseError(D,{text:w.match,token:this.terminals_[n]||n,line:w.yylineno,loc:C,expected:m})}if(h[0]instanceof Array&&h.length>1)throw new Error("Parse Error: multiple actions possible at state: "+l+", token: "+n);switch(h[0]){case 1:c.push(n),x.push(w.yytext),p.push(w.yylloc),c.push(h[1]),n=null,I=w.yyleng,v=w.yytext,T=w.yylineno,C=w.yylloc;break;case 2:if(a=this.productions_[h[1]][1],S.$=x[x.length-a],S._$={first_line:p[p.length-(a||1)].first_line,last_line:p[p.length-1].last_line,first_column:p[p.length-(a||1)].first_column,last_column:p[p.length-1].last_column},$&&(S._$.range=[p[p.length-(a||1)].range[0],p[p.length-1].range[1]]),(g=this.performAction.apply(S,[v,I,T,L.yy,h[1],x,p].concat(M)))!==void 0)return g;a&&(c=c.slice(0,-1*a*2),x=x.slice(0,-1*a),p=p.slice(0,-1*a)),c.push(this.productions_[h[1]][0]),x.push(S.$),p.push(S._$),b=E[c[c.length-2]][c[c.length-1]],c.push(b);break;case 3:return!0}}return!0},"parse")},y=function(){return{EOF:1,parseError:_(function(e,f){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,f)},"parseError"),setInput:_(function(e,f){return this.yy=f||this.yy||{},this._input=e,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},"setInput"),input:_(function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e,e.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},"input"),unput:_(function(e){var f=e.length,c=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-f),this.offset-=f;var d=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),c.length-1&&(this.yylineno-=c.length-1);var x=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:c?(c.length===d.length?this.yylloc.first_column:0)+d[d.length-c.length].length-c[0].length:this.yylloc.first_column-f},this.options.ranges&&(this.yylloc.range=[x[0],x[0]+this.yyleng-f]),this.yyleng=this.yytext.length,this},"unput"),more:_(function(){return this._more=!0,this},"more"),reject:_(function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+`. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},"reject"),less:_(function(e){this.unput(this.match.slice(e))},"less"),pastInput:_(function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},"pastInput"),upcomingInput:_(function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},"upcomingInput"),showPosition:_(function(){var e=this.pastInput(),f=new Array(e.length+1).join("-");return e+this.upcomingInput()+`
`+f+"^"},"showPosition"),test_match:_(function(e,f){var c,d,x;if(this.options.backtrack_lexer&&(x={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(x.yylloc.range=this.yylloc.range.slice(0))),(d=e[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=d.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:d?d[d.length-1].length-d[d.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],c=this.performAction.call(this,this.yy,this,f,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),c)return c;if(this._backtrack){for(var p in x)this[p]=x[p];return!1}return!1},"test_match"),next:_(function(){if(this.done)return this.EOF;var e,f,c,d;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var x=this._currentRules(),p=0;p<x.length;p++)if((c=this._input.match(this.rules[x[p]]))&&(!f||c[0].length>f[0].length)){if(f=c,d=p,this.options.backtrack_lexer){if((e=this.test_match(c,x[p]))!==!1)return e;if(this._backtrack){f=!1;continue}return!1}if(!this.options.flex)break}return f?(e=this.test_match(f,x[d]))!==!1&&e:this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},"next"),lex:_(function(){var e=this.next();return e||this.lex()},"lex"),begin:_(function(e){this.conditionStack.push(e)},"begin"),popState:_(function(){return this.conditionStack.length-1>0?this.conditionStack.pop():this.conditionStack[0]},"popState"),_currentRules:_(function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},"_currentRules"),topState:_(function(e){return(e=this.conditionStack.length-1-Math.abs(e||0))>=0?this.conditionStack[e]:"INITIAL"},"topState"),pushState:_(function(e){this.begin(e)},"pushState"),stateStackSize:_(function(){return this.conditionStack.length},"stateStackSize"),options:{"case-insensitive":!0},performAction:_(function(e,f,c,d){switch(c){case 0:case 1:return this.pushState("csv"),4;case 2:return 10;case 3:return 5;case 4:return 12;case 5:return this.pushState("escaped_text"),18;case 6:return 20;case 7:return this.popState("escaped_text"),18;case 8:return 19}},"anonymous"),rules:[/^(?:sankey-beta\b)/i,/^(?:sankey\b)/i,/^(?:$)/i,/^(?:((\u000D\u000A)|(\u000A)))/i,/^(?:(\u002C))/i,/^(?:(\u0022))/i,/^(?:([\u0020-\u0021\u0023-\u002B\u002D-\u007E])*)/i,/^(?:(\u0022)(?!(\u0022)))/i,/^(?:(([\u0020-\u0021\u0023-\u002B\u002D-\u007E])|(\u002C)|(\u000D)|(\u000A)|(\u0022)(\u0022))*)/i],conditions:{csv:{rules:[2,3,4,5,6,7,8],inclusive:!1},escaped_text:{rules:[7,8],inclusive:!1},INITIAL:{rules:[0,1,2,3,4,5,6,7,8],inclusive:!0}}}}();function k(){this.yy={}}return r.lexer=y,_(k,"Parser"),k.prototype=r,r.Parser=k,new k}();tt.parser=tt;var q=tt,V=[],X=[],Q=new Map,Ut=_(()=>{V=[],X=[],Q=new Map,kt()},"clear"),Wt=(z=class{constructor(i,s,o=0){this.source=i,this.target=s,this.value=o}},_(z,"SankeyLink"),z),Gt=_((t,i,s)=>{V.push(new Wt(t,i,s))},"addLink"),qt=(F=class{constructor(i){this.ID=i}},_(F,"SankeyNode"),F),Vt=_(t=>{t=vt.sanitizeText(t,R());let i=Q.get(t);return i===void 0&&(i=new qt(t),Q.set(t,i),X.push(i)),i},"findOrCreateNode"),Xt=_(()=>X,"getNodes"),Qt=_(()=>V,"getLinks"),Rt=_(()=>({nodes:X.map(t=>({id:t.ID})),links:V.map(t=>({source:t.source.ID,target:t.target.ID,value:t.value}))}),"getGraph"),Yt={nodesMap:Q,getConfig:_(()=>R().sankey,"getConfig"),getNodes:Xt,getLinks:Qt,getGraph:Rt,addLink:Gt,findOrCreateNode:Vt,getAccTitle:_t,setAccTitle:dt,getAccDescription:pt,setAccDescription:gt,getDiagramTitle:yt,setDiagramTitle:ft,clear:Ut},ut=(O=class{static next(i){return new O(i+ ++O.count)}constructor(i){this.id=i,this.href=`#${i}`}toString(){return"url("+this.href+")"}},_(O,"Uid"),O.count=0,O),Bt={left:function(t){return t.depth},right:function(t,i){return i-1-t.height},center:function(t){return t.targetLinks.length?t.depth:t.sourceLinks.length?it(t.sourceLinks,Lt)-1:0},justify:st},Kt=_(function(t,i,s,o){const{securityLevel:r,sankey:y}=R(),k=mt.sankey;let e;r==="sandbox"&&(e=Y("#i"+i));const f=Y(r==="sandbox"?e.nodes()[0].contentDocument.body:"body"),c=r==="sandbox"?f.select(`[id="${i}"]`):Y(`[id="${i}"]`),d=(y==null?void 0:y.width)??k.width,x=(y==null?void 0:y.height)??k.width,p=(y==null?void 0:y.useMaxWidth)??k.useMaxWidth,E=(y==null?void 0:y.nodeAlignment)??k.nodeAlignment,v=(y==null?void 0:y.prefix)??k.prefix,T=(y==null?void 0:y.suffix)??k.suffix,I=(y==null?void 0:y.showValues)??k.showValues,M=o.db.getGraph(),w=Bt[E];It().nodeId(n=>n.id).nodeWidth(10).nodePadding(10+(I?15:0)).nodeAlign(w).extent([[0,0],[d,x]])(M);const L=bt(St);c.append("g").attr("class","nodes").selectAll(".node").data(M.nodes).join("g").attr("class","node").attr("id",n=>(n.uid=ut.next("node-")).id).attr("transform",function(n){return"translate("+n.x0+","+n.y0+")"}).attr("x",n=>n.x0).attr("y",n=>n.y0).append("rect").attr("height",n=>n.y1-n.y0).attr("width",n=>n.x1-n.x0).attr("fill",n=>L(n.id));const P=_(({id:n,value:l})=>I?`${n}
${v}${Math.round(100*l)/100}${T}`:n,"getText");c.append("g").attr("class","node-labels").attr("font-size",14).selectAll("text").data(M.nodes).join("text").attr("x",n=>n.x0<d/2?n.x1+6:n.x0-6).attr("y",n=>(n.y1+n.y0)/2).attr("dy",(I?"0":"0.35")+"em").attr("text-anchor",n=>n.x0<d/2?"start":"end").text(P);const C=c.append("g").attr("class","links").attr("fill","none").attr("stroke-opacity",.5).selectAll(".link").data(M.links).join("g").attr("class","link").style("mix-blend-mode","multiply"),$=(y==null?void 0:y.linkColor)??"gradient";if($==="gradient"){const n=C.append("linearGradient").attr("id",l=>(l.uid=ut.next("linearGradient-")).id).attr("gradientUnits","userSpaceOnUse").attr("x1",l=>l.source.x1).attr("x2",l=>l.target.x0);n.append("stop").attr("offset","0%").attr("stop-color",l=>L(l.source.id)),n.append("stop").attr("offset","100%").attr("stop-color",l=>L(l.target.id))}let N;switch($){case"gradient":N=_(n=>n.uid,"coloring");break;case"source":N=_(n=>L(n.source.id),"coloring");break;case"target":N=_(n=>L(n.target.id),"coloring");break;default:N=$}C.append("path").attr("d",jt().source(zt).target(Ft)).attr("stroke",N).attr("stroke-width",n=>Math.max(1,n.width)),xt(void 0,c,0,p)},"draw"),Zt={draw:Kt},Ht=_(t=>t.replaceAll(/^[^\S\n\r]+|[^\S\n\r]+$/g,"").replaceAll(/([\n\r])+/g,`
`).trim(),"prepareTextForParsing"),Jt=_(t=>`.label {
      font-family: ${t.fontFamily};
    }`,"getStyles"),tn=q.parse.bind(q);q.parse=t=>tn(Ht(t));var nn={styles:Jt,parser:q,db:Yt,renderer:Zt};export{nn as diagram};
