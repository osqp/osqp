import{s as y}from"./chunk-DZLz74EQ.js";import{c as K}from"./jotai-BTnrNcC1.js";import{t as R}from"./react-BcIddLXZ.js";import{Ct as U,Qt as O,St as V,Xt as W,w as X}from"./cells-A69p56PE.js";import{t as M}from"./compiler-runtime-Cr9loedd.js";import{o as Y}from"./utils-DEDX0RLo.js";import{t as Z}from"./jsx-runtime-mwDPpfh_.js";import{t as g}from"./cn-ZXtYmczU.js";import{r as L,t as I}from"./button-ZC2axIBq.js";import{r as ee}from"./requests-BACZP_uj.js";import{t as te}from"./useLifecycle-DogGOXPh.js";import{n as ae}from"./useTheme-Biy2QI0v.js";import{t as se}from"./createLucideIcon-CNVopWor.js";import{h as re}from"./select-5fcaZwou.js";import{t as ne}from"./chevron-right-BV0VfNbL.js";import{n as le,t as oe}from"./spinner-CuquyDWA.js";import{t as Q}from"./tooltip-BHnVWzH0.js";import{t as ce}from"./context-CcLKJeA2.js";import{r as ie}from"./numbers-CTSqyVyD.js";import{t as me}from"./copy-icon-CE7wmMnS.js";import{t as de}from"./lazy-oPCv0nK8.js";import{t as pe}from"./add-missing-import-Bc1Nj8aC.js";import{o as ue}from"./focus-BaSDCTOl.js";import{t as xe}from"./useInstallPackage-I3kefbOO.js";var q=se("square-plus",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]),x=y(M(),1),l=y(Z(),1);const he=o=>{let e=(0,x.c)(4),{isExpanded:a}=o,s=a&&"rotate-90",t;e[0]===s?t=e[1]:(t=g("h-3 w-3 transition-transform",s),e[0]=s,e[1]=t);let r;return e[2]===t?r=e[3]:(r=(0,l.jsx)(ne,{className:t}),e[2]=t,e[3]=r),r},fe=o=>{let e=(0,x.c)(2),{children:a}=o,s;return e[0]===a?s=e[1]:(s=(0,l.jsx)("div",{className:"flex gap-1.5 items-center font-bold px-2 py-1.5 text-muted-foreground bg-(--slate-2) text-sm",children:a}),e[0]=a,e[1]=s),s},ge=o=>{let e=(0,x.c)(5),{content:a,className:s}=o,t;e[0]===s?t=e[1]:(t=g("text-sm text-muted-foreground py-1",s),e[0]=s,e[1]=t);let r;return e[2]!==a||e[3]!==t?(r=(0,l.jsx)("div",{className:t,children:a}),e[2]=a,e[3]=t,e[4]=r):r=e[4],r},ye=o=>{let e=(0,x.c)(6),{error:a,className:s}=o,t;e[0]===s?t=e[1]:(t=g("text-sm bg-red-50 dark:bg-red-900 text-red-600 dark:text-red-50 flex items-center gap-2 p-2 h-8",s),e[0]=s,e[1]=t);let r;e[2]===Symbol.for("react.memo_cache_sentinel")?(r=(0,l.jsx)(re,{className:"h-4 w-4 mt-0.5"}),e[2]=r):r=e[2];let n;return e[3]!==a.message||e[4]!==t?(n=(0,l.jsxs)("div",{className:t,children:[r,a.message]}),e[3]=a.message,e[4]=t,e[5]=n):n=e[5],n},be=o=>{let e=(0,x.c)(6),{message:a,className:s}=o,t;e[0]===s?t=e[1]:(t=g("text-sm bg-blue-50 dark:bg-(--accent) text-blue-500 dark:text-blue-50 flex items-center gap-2 p-2 h-8",s),e[0]=s,e[1]=t);let r;e[2]===Symbol.for("react.memo_cache_sentinel")?(r=(0,l.jsx)(le,{className:"h-4 w-4 animate-spin"}),e[2]=r):r=e[2];let n;return e[3]!==a||e[4]!==t?(n=(0,l.jsxs)("div",{className:t,children:[r,a]}),e[3]=a,e[4]=t,e[5]=n):n=e[5],n},$=o=>{let e=(0,x.c)(5),{children:a,className:s}=o,t;e[0]===s?t=e[1]:(t=g("flex flex-col gap-2 relative",s),e[0]=s,e[1]=t);let r;return e[2]!==a||e[3]!==t?(r=(0,l.jsx)("div",{className:t,children:a}),e[2]=a,e[3]=t,e[4]=r):r=e[4],r},_e=o=>{let e=(0,x.c)(6),{columnName:a,dataType:s}=o,t=V[s],r=`w-4 h-4 p-0.5 rounded-sm stroke-card-foreground ${U(s)}`,n;e[0]!==t||e[1]!==r?(n=(0,l.jsx)(t,{className:r}),e[0]=t,e[1]=r,e[2]=n):n=e[2];let c;return e[3]!==a||e[4]!==n?(c=(0,l.jsxs)("div",{className:"flex flex-row items-center gap-1.5",children:[n,a]}),e[3]=a,e[4]=n,e[5]=c):c=e[5],c};var je=y(M(),1),Ne=y(R(),1);const ke=o=>{let e=(0,je.c)(13),{packages:a,showMaxPackages:s,className:t,onInstall:r}=o,{handleInstallPackages:n}=xe();if(!a||a.length===0)return null;let c;e[0]!==n||e[1]!==r||e[2]!==a?(c=()=>{n(a,r)},e[0]=n,e[1]=r,e[2]=a,e[3]=c):c=e[3];let i;e[4]===t?i=e[5]:(i=g("ml-2",t),e[4]=t,e[5]=i);let d;e[6]!==a||e[7]!==s?(d=s?a.slice(0,s).join(", "):a.join(", "),e[6]=a,e[7]=s,e[8]=d):d=e[8];let p;return e[9]!==c||e[10]!==i||e[11]!==d?(p=(0,l.jsxs)(I,{variant:"outline",size:"xs",onClick:c,className:i,children:["Install"," ",d]}),e[9]=c,e[10]=i,e[11]=d,e[12]=p):p=e[12],p};var E=y(M(),1);const ve=o=>{let e=(0,E.c)(53),{table:a,column:s,preview:t,onAddColumnChart:r,sqlTableContext:n}=o,{theme:c}=ae(),{previewDatasetColumn:i}=ee(),{locale:d}=ce(),p;e[0]!==s.name||e[1]!==i||e[2]!==n||e[3]!==a.name||e[4]!==a.source||e[5]!==a.source_type?(p=()=>{i({source:a.source,tableName:a.name,columnName:s.name,sourceType:a.source_type,fullyQualifiedTableName:n?`${n.database}.${n.schema}.${a.name}`:a.name})},e[0]=s.name,e[1]=i,e[2]=n,e[3]=a.name,e[4]=a.source,e[5]=a.source_type,e[6]=p):p=e[6];let u=p,b;if(e[7]!==t||e[8]!==u||e[9]!==a.source_type?(b=()=>{t||a.source_type==="connection"||a.source_type==="catalog"||u()},e[7]=t,e[8]=u,e[9]=a.source_type,e[10]=b):b=e[10],te(b),a.source_type==="connection"){let m=s.name,H=s.external_type,h;e[11]!==s.name||e[12]!==r||e[13]!==n||e[14]!==a?(h=L.stopPropagation(()=>{r(O({table:a,columnName:s.name,sqlTableContext:n}))}),e[11]=s.name,e[12]=r,e[13]=n,e[14]=a,e[15]=h):h=e[15];let T;e[16]===Symbol.for("react.memo_cache_sentinel")?(T=(0,l.jsx)(q,{className:"h-3 w-3 mr-1"}),e[16]=T):T=e[16];let f;e[17]===h?f=e[18]:(f=(0,l.jsxs)(I,{variant:"outline",size:"xs",onClick:h,children:[T," Add SQL cell"]}),e[17]=h,e[18]=f);let z;return e[19]!==s.external_type||e[20]!==s.name||e[21]!==f?(z=(0,l.jsxs)("span",{className:"text-xs text-muted-foreground gap-2 flex items-center justify-between pl-7",children:[m," (",H,")",f]}),e[19]=s.external_type,e[20]=s.name,e[21]=f,e[22]=z):z=e[22],z}if(a.source_type==="catalog"){let m;return e[23]!==s.external_type||e[24]!==s.name?(m=(0,l.jsxs)("span",{className:"text-xs text-muted-foreground gap-2 flex items-center justify-between pl-7",children:[s.name," (",s.external_type,")"]}),e[23]=s.external_type,e[24]=s.name,e[25]=m):m=e[25],m}if(!t){let m;return e[26]===Symbol.for("react.memo_cache_sentinel")?(m=(0,l.jsx)("span",{className:"text-xs text-muted-foreground",children:"Loading..."}),e[26]=m):m=e[26],m}let _;e[27]!==t.error||e[28]!==t.missing_packages||e[29]!==u?(_=t.error&&J({error:t.error,missingPackages:t.missing_packages,refetchPreview:u}),e[27]=t.error,e[28]=t.missing_packages,e[29]=u,e[30]=_):_=e[30];let j=_,N;e[31]!==s.type||e[32]!==d||e[33]!==t.stats?(N=t.stats&&B({stats:t.stats,dataType:s.type,locale:d}),e[31]=s.type,e[32]=d,e[33]=t.stats,e[34]=N):N=e[34];let k=N,v;e[35]!==t.chart_spec||e[36]!==c?(v=t.chart_spec&&F(t.chart_spec,c),e[35]=t.chart_spec,e[36]=c,e[37]=v):v=e[37];let w=v,C;e[38]!==t.chart_code||e[39]!==a.source_type?(C=t.chart_code&&a.source_type==="local"&&(0,l.jsx)(G,{chartCode:t.chart_code}),e[38]=t.chart_code,e[39]=a.source_type,e[40]=C):C=e[40];let A=C,S;e[41]!==s.name||e[42]!==r||e[43]!==n||e[44]!==a?(S=a.source_type==="duckdb"&&(0,l.jsx)(Q,{content:"Add SQL cell",delayDuration:400,children:(0,l.jsx)(I,{variant:"outline",size:"icon",className:"z-10 bg-background absolute right-1 -top-1",onClick:L.stopPropagation(()=>{r(O({table:a,columnName:s.name,sqlTableContext:n}))}),children:(0,l.jsx)(q,{className:"h-3 w-3"})})}),e[41]=s.name,e[42]=r,e[43]=n,e[44]=a,e[45]=S):S=e[45];let D=S;if(!j&&!k&&!w){let m;return e[46]===Symbol.for("react.memo_cache_sentinel")?(m=(0,l.jsx)("span",{className:"text-xs text-muted-foreground",children:"No data"}),e[46]=m):m=e[46],m}let P;return e[47]!==A||e[48]!==D||e[49]!==w||e[50]!==j||e[51]!==k?(P=(0,l.jsxs)($,{children:[j,A,D,w,k]}),e[47]=A,e[48]=D,e[49]=w,e[50]=j,e[51]=k,e[52]=P):P=e[52],P};function J({error:o,missingPackages:e,refetchPreview:a}){return(0,l.jsxs)("div",{className:"text-xs text-muted-foreground p-2 border border-border rounded flex items-center justify-between",children:[(0,l.jsx)("span",{children:o}),e&&(0,l.jsx)(ke,{packages:e,showMaxPackages:1,className:"w-32",onInstall:a})]})}function B({stats:o,dataType:e,locale:a}){return(0,l.jsx)("div",{className:"gap-x-16 gap-y-1 grid grid-cols-2-fit border rounded p-2 empty:hidden",children:Object.entries(o).map(([s,t])=>t==null?null:(0,l.jsxs)("div",{className:"flex items-center gap-1 group",children:[(0,l.jsx)("span",{className:"text-xs min-w-[60px] capitalize",children:W(s,e)}),(0,l.jsx)("span",{className:"text-xs font-bold text-muted-foreground tracking-wide",children:ie(t,a)}),(0,l.jsx)(me,{className:"h-3 w-3 invisible group-hover:visible",value:String(t)})]},s))})}var we=(0,l.jsx)("div",{className:"flex justify-center",children:(0,l.jsx)(oe,{className:"size-4"})});function F(o,e){return(0,l.jsx)(Ne.Suspense,{fallback:we,children:(0,l.jsx)(de,{spec:(a=>({...a,background:"transparent",config:{...a.config,background:"transparent"}}))(JSON.parse(o)),options:{theme:e==="dark"?"dark":"vox",height:100,width:"container",actions:!1,renderer:"canvas"}})})}const G=o=>{let e=(0,E.c)(10),{chartCode:a}=o,s=K(Y),t=ue(),{createNewCell:r}=X(),n;e[0]!==s||e[1]!==r||e[2]!==t?(n=u=>{u.includes("alt")&&pe({autoInstantiate:s,createNewCell:r,fromCellId:t}),r({code:u,before:!1,cellId:t??"__end__"})},e[0]=s,e[1]=r,e[2]=t,e[3]=n):n=e[3];let c=n,i;e[4]!==a||e[5]!==c?(i=L.stopPropagation(()=>c(a)),e[4]=a,e[5]=c,e[6]=i):i=e[6];let d;e[7]===Symbol.for("react.memo_cache_sentinel")?(d=(0,l.jsx)(q,{className:"h-3 w-3"}),e[7]=d):d=e[7];let p;return e[8]===i?p=e[9]:(p=(0,l.jsx)(Q,{content:"Add chart to notebook",delayDuration:400,children:(0,l.jsx)(I,{variant:"outline",size:"icon",className:"z-10 bg-background absolute right-1 -top-0.5",onClick:i,children:d})}),e[8]=i,e[9]=p),p};export{B as a,fe as c,be as d,he as f,J as i,ge as l,ve as n,_e as o,q as p,F as r,$ as s,G as t,ye as u};
