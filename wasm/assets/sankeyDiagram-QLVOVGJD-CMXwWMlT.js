var z,F,P;import{_,p as pt,q as dt,s as _t,g as mt,b as xt,a as kt,c as R,z as vt,S as bt,y as wt,j as St}from"./mermaid-Da56-Xo5.js";import{s as Y}from"./transform-Cyp0GDF-.js";import{o as Et}from"./ordinal-DDUp3AbE.js";import{c as At}from"./colors-bszWmPJw.js";import"./index-aRpq2G87.js";import"./step-BwsUM5iJ.js";import"./timer-DFzT7np-.js";import"./init-DLRA0X12.js";const Lt=At("4e79a7f28e2ce1575976b7b259a14fedc949af7aa1ff9da79c755fbab0ab");function it(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}var B,st;function rt(t,e){var i,l,o=t.length,r=-1;if(e==null){for(;++r<o;)if((i=t[r])!=null&&i>=i)for(l=i;++r<o;)(i=t[r])!=null&&i>l&&(l=i)}else for(;++r<o;)if((i=e(t[r],r,t))!=null&&i>=i)for(l=i;++r<o;)(i=e(t[r],r,t))!=null&&i>l&&(l=i);return l}function ot(t,e){var i,l,o=t.length,r=-1;if(e==null){for(;++r<o;)if((i=t[r])!=null&&i>=i)for(l=i;++r<o;)(i=t[r])!=null&&l>i&&(l=i)}else for(;++r<o;)if((i=e(t[r],r,t))!=null&&i>=i)for(l=i;++r<o;)(i=e(t[r],r,t))!=null&&l>i&&(l=i);return l}function K(t,e){var i,l=t.length,o=-1,r=0;if(e==null)for(;++o<l;)(i=+t[o])&&(r+=i);else for(;++o<l;)(i=+e(t[o],o,t))&&(r+=i);return r}function Mt(t){return t.target.depth}function at(t,e){return t.sourceLinks.length?t.depth:e-1}function W(t){return function(){return t}}function ct(t,e){return G(t.source,e.source)||t.index-e.index}function lt(t,e){return G(t.target,e.target)||t.index-e.index}function G(t,e){return t.y0-e.y0}function Z(t){return t.value}function It(t){return t.index}function Tt(t){return t.nodes}function Nt(t){return t.links}function ht(t,e){const i=t.get(e);if(!i)throw new Error("missing: "+e);return i}function ut({nodes:t}){for(const e of t){let i=e.y0,l=i;for(const o of e.sourceLinks)o.y0=i+o.width/2,i+=o.width;for(const o of e.targetLinks)o.y1=l+o.width/2,l+=o.width}}function Ot(){let t,e,i,l=0,o=0,r=1,k=1,s=24,y=8,c=It,d=at,x=Tt,p=Nt,L=6;function v(){const n={nodes:x.apply(null,arguments),links:p.apply(null,arguments)};return function({nodes:h,links:u}){for(const[f,a]of h.entries())a.index=f,a.sourceLinks=[],a.targetLinks=[];const g=new Map(h.map((f,a)=>[c(f,a,h),f]));for(const[f,a]of u.entries()){a.index=f;let{source:b,target:m}=a;typeof b!="object"&&(b=a.source=ht(g,b)),typeof m!="object"&&(m=a.target=ht(g,m)),b.sourceLinks.push(a),m.targetLinks.push(a)}if(i!=null)for(const{sourceLinks:f,targetLinks:a}of h)f.sort(i),a.sort(i)}(n),function({nodes:h}){for(const u of h)u.value=u.fixedValue===void 0?Math.max(K(u.sourceLinks,Z),K(u.targetLinks,Z)):u.fixedValue}(n),function({nodes:h}){const u=h.length;let g=new Set(h),f=new Set,a=0;for(;g.size;){for(const b of g){b.depth=a;for(const{target:m}of b.sourceLinks)f.add(m)}if(++a>u)throw new Error("circular link");g=f,f=new Set}}(n),function({nodes:h}){const u=h.length;let g=new Set(h),f=new Set,a=0;for(;g.size;){for(const b of g){b.height=a;for(const{source:m}of b.targetLinks)f.add(m)}if(++a>u)throw new Error("circular link");g=f,f=new Set}}(n),function(h){const u=function({nodes:g}){const f=rt(g,m=>m.depth)+1,a=(r-l-s)/(f-1),b=new Array(f);for(const m of g){const S=Math.max(0,Math.min(f-1,Math.floor(d.call(null,m,f))));m.layer=S,m.x0=l+S*a,m.x1=m.x0+s,b[S]?b[S].push(m):b[S]=[m]}if(e)for(const m of b)m.sort(e);return b}(h);t=Math.min(y,(k-o)/(rt(u,g=>g.length)-1)),function(g){const f=ot(g,a=>(k-o-(a.length-1)*t)/K(a,Z));for(const a of g){let b=o;for(const m of a){m.y0=b,m.y1=b+m.value*f,b=m.y1+t;for(const S of m.sourceLinks)S.width=S.value*f}b=(k-b+t)/(a.length+1);for(let m=0;m<a.length;++m){const S=a[m];S.y0+=b*(m+1),S.y1+=b*(m+1)}C(a)}}(u);for(let g=0;g<L;++g){const f=Math.pow(.99,g),a=Math.max(1-f,(g+1)/L);I(u,f,a),T(u,f,a)}}(n),ut(n),n}function T(n,h,u){for(let g=1,f=n.length;g<f;++g){const a=n[g];for(const b of a){let m=0,S=0;for(const{source:A,value:U}of b.targetLinks){let et=U*(b.layer-A.layer);m+=$(A,b)*et,S+=et}if(!(S>0))continue;let D=(m/S-b.y0)*h;b.y0+=D,b.y1+=D,N(b)}e===void 0&&a.sort(G),M(a,u)}}function I(n,h,u){for(let g=n.length-2;g>=0;--g){const f=n[g];for(const a of f){let b=0,m=0;for(const{target:D,value:A}of a.sourceLinks){let U=A*(D.layer-a.layer);b+=O(a,D)*U,m+=U}if(!(m>0))continue;let S=(b/m-a.y0)*h;a.y0+=S,a.y1+=S,N(a)}e===void 0&&f.sort(G),M(f,u)}}function M(n,h){const u=n.length>>1,g=n[u];E(n,g.y0-t,u-1,h),w(n,g.y1+t,u+1,h),E(n,k,n.length-1,h),w(n,o,0,h)}function w(n,h,u,g){for(;u<n.length;++u){const f=n[u],a=(h-f.y0)*g;a>1e-6&&(f.y0+=a,f.y1+=a),h=f.y1+t}}function E(n,h,u,g){for(;u>=0;--u){const f=n[u],a=(f.y1-h)*g;a>1e-6&&(f.y0-=a,f.y1-=a),h=f.y0-t}}function N({sourceLinks:n,targetLinks:h}){if(i===void 0){for(const{source:{sourceLinks:u}}of h)u.sort(lt);for(const{target:{targetLinks:u}}of n)u.sort(ct)}}function C(n){if(i===void 0)for(const{sourceLinks:h,targetLinks:u}of n)h.sort(lt),u.sort(ct)}function $(n,h){let u=n.y0-(n.sourceLinks.length-1)*t/2;for(const{target:g,width:f}of n.sourceLinks){if(g===h)break;u+=f+t}for(const{source:g,width:f}of h.targetLinks){if(g===n)break;u-=f}return u}function O(n,h){let u=h.y0-(h.targetLinks.length-1)*t/2;for(const{source:g,width:f}of h.targetLinks){if(g===n)break;u+=f+t}for(const{target:g,width:f}of n.sourceLinks){if(g===h)break;u-=f}return u}return v.update=function(n){return ut(n),n},v.nodeId=function(n){return arguments.length?(c=typeof n=="function"?n:W(n),v):c},v.nodeAlign=function(n){return arguments.length?(d=typeof n=="function"?n:W(n),v):d},v.nodeSort=function(n){return arguments.length?(e=n,v):e},v.nodeWidth=function(n){return arguments.length?(s=+n,v):s},v.nodePadding=function(n){return arguments.length?(y=t=+n,v):y},v.nodes=function(n){return arguments.length?(x=typeof n=="function"?n:W(n),v):x},v.links=function(n){return arguments.length?(p=typeof n=="function"?n:W(n),v):p},v.linkSort=function(n){return arguments.length?(i=n,v):i},v.size=function(n){return arguments.length?(l=o=0,r=+n[0],k=+n[1],v):[r-l,k-o]},v.extent=function(n){return arguments.length?(l=+n[0][0],r=+n[1][0],o=+n[0][1],k=+n[1][1],v):[[l,o],[r,k]]},v.iterations=function(n){return arguments.length?(L=+n,v):L},v}(B=it).length===1&&(st=B,B=function(t,e){return it(st(t),e)});var H=Math.PI,J=2*H,j=1e-6,Pt=J-j;function tt(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function ft(){return new tt}function yt(t){return function(){return t}}function Ct(t){return t[0]}function Dt(t){return t[1]}tt.prototype=ft.prototype={constructor:tt,moveTo:function(t,e){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,e){this._+="L"+(this._x1=+t)+","+(this._y1=+e)},quadraticCurveTo:function(t,e,i,l){this._+="Q"+ +t+","+ +e+","+(this._x1=+i)+","+(this._y1=+l)},bezierCurveTo:function(t,e,i,l,o,r){this._+="C"+ +t+","+ +e+","+ +i+","+ +l+","+(this._x1=+o)+","+(this._y1=+r)},arcTo:function(t,e,i,l,o){t=+t,e=+e,i=+i,l=+l,o=+o;var r=this._x1,k=this._y1,s=i-t,y=l-e,c=r-t,d=k-e,x=c*c+d*d;if(o<0)throw new Error("negative radius: "+o);if(this._x1===null)this._+="M"+(this._x1=t)+","+(this._y1=e);else if(x>j)if(Math.abs(d*s-y*c)>j&&o){var p=i-r,L=l-k,v=s*s+y*y,T=p*p+L*L,I=Math.sqrt(v),M=Math.sqrt(x),w=o*Math.tan((H-Math.acos((v+x-T)/(2*I*M)))/2),E=w/M,N=w/I;Math.abs(E-1)>j&&(this._+="L"+(t+E*c)+","+(e+E*d)),this._+="A"+o+","+o+",0,0,"+ +(d*p>c*L)+","+(this._x1=t+N*s)+","+(this._y1=e+N*y)}else this._+="L"+(this._x1=t)+","+(this._y1=e)},arc:function(t,e,i,l,o,r){t=+t,e=+e,r=!!r;var k=(i=+i)*Math.cos(l),s=i*Math.sin(l),y=t+k,c=e+s,d=1^r,x=r?l-o:o-l;if(i<0)throw new Error("negative radius: "+i);this._x1===null?this._+="M"+y+","+c:(Math.abs(this._x1-y)>j||Math.abs(this._y1-c)>j)&&(this._+="L"+y+","+c),i&&(x<0&&(x=x%J+J),x>Pt?this._+="A"+i+","+i+",0,1,"+d+","+(t-k)+","+(e-s)+"A"+i+","+i+",0,1,"+d+","+(this._x1=y)+","+(this._y1=c):x>j&&(this._+="A"+i+","+i+",0,"+ +(x>=H)+","+d+","+(this._x1=t+i*Math.cos(o))+","+(this._y1=e+i*Math.sin(o))))},rect:function(t,e,i,l){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)+"h"+ +i+"v"+ +l+"h"+-i+"Z"},toString:function(){return this._}};var $t=Array.prototype.slice;function jt(t){return t.source}function zt(t){return t.target}function Ft(t,e,i,l,o){t.moveTo(e,i),t.bezierCurveTo(e=(e+l)/2,i,e,o,l,o)}function Ut(){return function(t){var e=jt,i=zt,l=Ct,o=Dt,r=null;function k(){var s,y=$t.call(arguments),c=e.apply(this,y),d=i.apply(this,y);if(r||(r=s=ft()),t(r,+l.apply(this,(y[0]=c,y)),+o.apply(this,y),+l.apply(this,(y[0]=d,y)),+o.apply(this,y)),s)return r=null,s+""||null}return k.source=function(s){return arguments.length?(e=s,k):e},k.target=function(s){return arguments.length?(i=s,k):i},k.x=function(s){return arguments.length?(l=typeof s=="function"?s:yt(+s),k):l},k.y=function(s){return arguments.length?(o=typeof s=="function"?s:yt(+s),k):o},k.context=function(s){return arguments.length?(r=s??null,k):r},k}(Ft)}function Wt(t){return[t.source.x1,t.y0]}function Gt(t){return[t.target.x0,t.y1]}var nt=function(){var t=_(function(s,y,c,d){for(c=c||{},d=s.length;d--;c[s[d]]=y);return c},"o"),e=[1,9],i=[1,10],l=[1,5,10,12],o={trace:_(function(){},"trace"),yy:{},symbols_:{error:2,start:3,SANKEY:4,NEWLINE:5,csv:6,opt_eof:7,record:8,csv_tail:9,EOF:10,"field[source]":11,COMMA:12,"field[target]":13,"field[value]":14,field:15,escaped:16,non_escaped:17,DQUOTE:18,ESCAPED_TEXT:19,NON_ESCAPED_TEXT:20,$accept:0,$end:1},terminals_:{2:"error",4:"SANKEY",5:"NEWLINE",10:"EOF",11:"field[source]",12:"COMMA",13:"field[target]",14:"field[value]",18:"DQUOTE",19:"ESCAPED_TEXT",20:"NON_ESCAPED_TEXT"},productions_:[0,[3,4],[6,2],[9,2],[9,0],[7,1],[7,0],[8,5],[15,1],[15,1],[16,3],[17,1]],performAction:_(function(s,y,c,d,x,p,L){var v=p.length-1;switch(x){case 7:const T=d.findOrCreateNode(p[v-4].trim().replaceAll('""','"')),I=d.findOrCreateNode(p[v-2].trim().replaceAll('""','"')),M=parseFloat(p[v].trim());d.addLink(T,I,M);break;case 8:case 9:case 11:this.$=p[v];break;case 10:this.$=p[v-1]}},"anonymous"),table:[{3:1,4:[1,2]},{1:[3]},{5:[1,3]},{6:4,8:5,15:6,16:7,17:8,18:e,20:i},{1:[2,6],7:11,10:[1,12]},t(i,[2,4],{9:13,5:[1,14]}),{12:[1,15]},t(l,[2,8]),t(l,[2,9]),{19:[1,16]},t(l,[2,11]),{1:[2,1]},{1:[2,5]},t(i,[2,2]),{6:17,8:5,15:6,16:7,17:8,18:e,20:i},{15:18,16:7,17:8,18:e,20:i},{18:[1,19]},t(i,[2,3]),{12:[1,20]},t(l,[2,10]),{15:21,16:7,17:8,18:e,20:i},t([1,5,10],[2,7])],defaultActions:{11:[2,1],12:[2,5]},parseError:_(function(s,y){if(!y.recoverable){var c=new Error(s);throw c.hash=y,c}this.trace(s)},"parseError"),parse:_(function(s){var y=this,c=[0],d=[],x=[null],p=[],L=this.table,v="",T=0,I=0,M=p.slice.call(arguments,1),w=Object.create(this.lexer),E={yy:{}};for(var N in this.yy)Object.prototype.hasOwnProperty.call(this.yy,N)&&(E.yy[N]=this.yy[N]);w.setInput(s,E.yy),E.yy.lexer=w,E.yy.parser=this,w.yylloc===void 0&&(w.yylloc={});var C=w.yylloc;p.push(C);var $=w.options&&w.options.ranges;function O(){var A;return typeof(A=d.pop()||w.lex()||1)!="number"&&(A instanceof Array&&(A=(d=A).pop()),A=y.symbols_[A]||A),A}typeof E.yy.parseError=="function"?this.parseError=E.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError,_(function(A){c.length=c.length-2*A,x.length=x.length-A,p.length=p.length-A},"popStack"),_(O,"lex");for(var n,h,u,g,f,a,b,m,S={};;){if(h=c[c.length-1],this.defaultActions[h]?u=this.defaultActions[h]:(n==null&&(n=O()),u=L[h]&&L[h][n]),u===void 0||!u.length||!u[0]){var D="";for(f in m=[],L[h])this.terminals_[f]&&f>2&&m.push("'"+this.terminals_[f]+"'");D=w.showPosition?"Parse error on line "+(T+1)+`:
`+w.showPosition()+`
Expecting `+m.join(", ")+", got '"+(this.terminals_[n]||n)+"'":"Parse error on line "+(T+1)+": Unexpected "+(n==1?"end of input":"'"+(this.terminals_[n]||n)+"'"),this.parseError(D,{text:w.match,token:this.terminals_[n]||n,line:w.yylineno,loc:C,expected:m})}if(u[0]instanceof Array&&u.length>1)throw new Error("Parse Error: multiple actions possible at state: "+h+", token: "+n);switch(u[0]){case 1:c.push(n),x.push(w.yytext),p.push(w.yylloc),c.push(u[1]),n=null,I=w.yyleng,v=w.yytext,T=w.yylineno,C=w.yylloc;break;case 2:if(a=this.productions_[u[1]][1],S.$=x[x.length-a],S._$={first_line:p[p.length-(a||1)].first_line,last_line:p[p.length-1].last_line,first_column:p[p.length-(a||1)].first_column,last_column:p[p.length-1].last_column},$&&(S._$.range=[p[p.length-(a||1)].range[0],p[p.length-1].range[1]]),(g=this.performAction.apply(S,[v,I,T,E.yy,u[1],x,p].concat(M)))!==void 0)return g;a&&(c=c.slice(0,-1*a*2),x=x.slice(0,-1*a),p=p.slice(0,-1*a)),c.push(this.productions_[u[1]][0]),x.push(S.$),p.push(S._$),b=L[c[c.length-2]][c[c.length-1]],c.push(b);break;case 3:return!0}}return!0},"parse")},r=function(){return{EOF:1,parseError:_(function(s,y){if(!this.yy.parser)throw new Error(s);this.yy.parser.parseError(s,y)},"parseError"),setInput:_(function(s,y){return this.yy=y||this.yy||{},this._input=s,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},"setInput"),input:_(function(){var s=this._input[0];return this.yytext+=s,this.yyleng++,this.offset++,this.match+=s,this.matched+=s,s.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),s},"input"),unput:_(function(s){var y=s.length,c=s.split(/(?:\r\n?|\n)/g);this._input=s+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-y),this.offset-=y;var d=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),c.length-1&&(this.yylineno-=c.length-1);var x=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:c?(c.length===d.length?this.yylloc.first_column:0)+d[d.length-c.length].length-c[0].length:this.yylloc.first_column-y},this.options.ranges&&(this.yylloc.range=[x[0],x[0]+this.yyleng-y]),this.yyleng=this.yytext.length,this},"unput"),more:_(function(){return this._more=!0,this},"more"),reject:_(function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+`. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},"reject"),less:_(function(s){this.unput(this.match.slice(s))},"less"),pastInput:_(function(){var s=this.matched.substr(0,this.matched.length-this.match.length);return(s.length>20?"...":"")+s.substr(-20).replace(/\n/g,"")},"pastInput"),upcomingInput:_(function(){var s=this.match;return s.length<20&&(s+=this._input.substr(0,20-s.length)),(s.substr(0,20)+(s.length>20?"...":"")).replace(/\n/g,"")},"upcomingInput"),showPosition:_(function(){var s=this.pastInput(),y=new Array(s.length+1).join("-");return s+this.upcomingInput()+`
`+y+"^"},"showPosition"),test_match:_(function(s,y){var c,d,x;if(this.options.backtrack_lexer&&(x={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(x.yylloc.range=this.yylloc.range.slice(0))),(d=s[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=d.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:d?d[d.length-1].length-d[d.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+s[0].length},this.yytext+=s[0],this.match+=s[0],this.matches=s,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(s[0].length),this.matched+=s[0],c=this.performAction.call(this,this.yy,this,y,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),c)return c;if(this._backtrack){for(var p in x)this[p]=x[p];return!1}return!1},"test_match"),next:_(function(){if(this.done)return this.EOF;var s,y,c,d;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var x=this._currentRules(),p=0;p<x.length;p++)if((c=this._input.match(this.rules[x[p]]))&&(!y||c[0].length>y[0].length)){if(y=c,d=p,this.options.backtrack_lexer){if((s=this.test_match(c,x[p]))!==!1)return s;if(this._backtrack){y=!1;continue}return!1}if(!this.options.flex)break}return y?(s=this.test_match(y,x[d]))!==!1&&s:this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},"next"),lex:_(function(){var s=this.next();return s||this.lex()},"lex"),begin:_(function(s){this.conditionStack.push(s)},"begin"),popState:_(function(){return this.conditionStack.length-1>0?this.conditionStack.pop():this.conditionStack[0]},"popState"),_currentRules:_(function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},"_currentRules"),topState:_(function(s){return(s=this.conditionStack.length-1-Math.abs(s||0))>=0?this.conditionStack[s]:"INITIAL"},"topState"),pushState:_(function(s){this.begin(s)},"pushState"),stateStackSize:_(function(){return this.conditionStack.length},"stateStackSize"),options:{"case-insensitive":!0},performAction:_(function(s,y,c,d){switch(c){case 0:return this.pushState("csv"),4;case 1:return 10;case 2:return 5;case 3:return 12;case 4:return this.pushState("escaped_text"),18;case 5:return 20;case 6:return this.popState("escaped_text"),18;case 7:return 19}},"anonymous"),rules:[/^(?:sankey-beta\b)/i,/^(?:$)/i,/^(?:((\u000D\u000A)|(\u000A)))/i,/^(?:(\u002C))/i,/^(?:(\u0022))/i,/^(?:([\u0020-\u0021\u0023-\u002B\u002D-\u007E])*)/i,/^(?:(\u0022)(?!(\u0022)))/i,/^(?:(([\u0020-\u0021\u0023-\u002B\u002D-\u007E])|(\u002C)|(\u000D)|(\u000A)|(\u0022)(\u0022))*)/i],conditions:{csv:{rules:[1,2,3,4,5,6,7],inclusive:!1},escaped_text:{rules:[6,7],inclusive:!1},INITIAL:{rules:[0,1,2,3,4,5,6,7],inclusive:!0}}}}();function k(){this.yy={}}return o.lexer=r,_(k,"Parser"),k.prototype=o,o.Parser=k,new k}();nt.parser=nt;var q=nt,V=[],X=[],Q=new Map,qt=_(()=>{V=[],X=[],Q=new Map,wt()},"clear"),Vt=(z=class{constructor(e,i,l=0){this.source=e,this.target=i,this.value=l}},_(z,"SankeyLink"),z),Xt=_((t,e,i)=>{V.push(new Vt(t,e,i))},"addLink"),Qt=(F=class{constructor(e){this.ID=e}},_(F,"SankeyNode"),F),Rt=_(t=>{t=St.sanitizeText(t,R());let e=Q.get(t);return e===void 0&&(e=new Qt(t),Q.set(t,e),X.push(e)),e},"findOrCreateNode"),Yt=_(()=>X,"getNodes"),Bt=_(()=>V,"getLinks"),Kt=_(()=>({nodes:X.map(t=>({id:t.ID})),links:V.map(t=>({source:t.source.ID,target:t.target.ID,value:t.value}))}),"getGraph"),Zt={nodesMap:Q,getConfig:_(()=>R().sankey,"getConfig"),getNodes:Yt,getLinks:Bt,getGraph:Kt,addLink:Xt,findOrCreateNode:Rt,getAccTitle:kt,setAccTitle:xt,getAccDescription:mt,setAccDescription:_t,getDiagramTitle:dt,setDiagramTitle:pt,clear:qt},gt=(P=class{static next(e){return new P(e+ ++P.count)}constructor(e){this.id=e,this.href=`#${e}`}toString(){return"url("+this.href+")"}},_(P,"Uid"),P.count=0,P),Ht={left:function(t){return t.depth},right:function(t,e){return e-1-t.height},center:function(t){return t.targetLinks.length?t.depth:t.sourceLinks.length?ot(t.sourceLinks,Mt)-1:0},justify:at},Jt=_(function(t,e,i,l){const{securityLevel:o,sankey:r}=R(),k=vt.sankey;let s;o==="sandbox"&&(s=Y("#i"+e));const y=Y(o==="sandbox"?s.nodes()[0].contentDocument.body:"body"),c=o==="sandbox"?y.select(`[id="${e}"]`):Y(`[id="${e}"]`),d=(r==null?void 0:r.width)??k.width,x=(r==null?void 0:r.height)??k.width,p=(r==null?void 0:r.useMaxWidth)??k.useMaxWidth,L=(r==null?void 0:r.nodeAlignment)??k.nodeAlignment,v=(r==null?void 0:r.prefix)??k.prefix,T=(r==null?void 0:r.suffix)??k.suffix,I=(r==null?void 0:r.showValues)??k.showValues,M=l.db.getGraph(),w=Ht[L];Ot().nodeId(n=>n.id).nodeWidth(10).nodePadding(10+(I?15:0)).nodeAlign(w).extent([[0,0],[d,x]])(M);const E=Et(Lt);c.append("g").attr("class","nodes").selectAll(".node").data(M.nodes).join("g").attr("class","node").attr("id",n=>(n.uid=gt.next("node-")).id).attr("transform",function(n){return"translate("+n.x0+","+n.y0+")"}).attr("x",n=>n.x0).attr("y",n=>n.y0).append("rect").attr("height",n=>n.y1-n.y0).attr("width",n=>n.x1-n.x0).attr("fill",n=>E(n.id));const N=_(({id:n,value:h})=>I?`${n}
${v}${Math.round(100*h)/100}${T}`:n,"getText");c.append("g").attr("class","node-labels").attr("font-size",14).selectAll("text").data(M.nodes).join("text").attr("x",n=>n.x0<d/2?n.x1+6:n.x0-6).attr("y",n=>(n.y1+n.y0)/2).attr("dy",(I?"0":"0.35")+"em").attr("text-anchor",n=>n.x0<d/2?"start":"end").text(N);const C=c.append("g").attr("class","links").attr("fill","none").attr("stroke-opacity",.5).selectAll(".link").data(M.links).join("g").attr("class","link").style("mix-blend-mode","multiply"),$=(r==null?void 0:r.linkColor)??"gradient";if($==="gradient"){const n=C.append("linearGradient").attr("id",h=>(h.uid=gt.next("linearGradient-")).id).attr("gradientUnits","userSpaceOnUse").attr("x1",h=>h.source.x1).attr("x2",h=>h.target.x0);n.append("stop").attr("offset","0%").attr("stop-color",h=>E(h.source.id)),n.append("stop").attr("offset","100%").attr("stop-color",h=>E(h.target.id))}let O;switch($){case"gradient":O=_(n=>n.uid,"coloring");break;case"source":O=_(n=>E(n.source.id),"coloring");break;case"target":O=_(n=>E(n.target.id),"coloring");break;default:O=$}C.append("path").attr("d",Ut().source(Wt).target(Gt)).attr("stroke",O).attr("stroke-width",n=>Math.max(1,n.width)),bt(void 0,c,0,p)},"draw"),tn={draw:Jt},nn=_(t=>t.replaceAll(/^[^\S\n\r]+|[^\S\n\r]+$/g,"").replaceAll(/([\n\r])+/g,`
`).trim(),"prepareTextForParsing"),en=_(t=>`.label {
      font-family: ${t.fontFamily};
    }`,"getStyles"),sn=q.parse.bind(q);q.parse=t=>sn(nn(t));var rn={styles:en,parser:q,db:Zt,renderer:tn};export{rn as diagram};
