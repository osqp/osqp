import{d as x}from"./jotai-BTnrNcC1.js";import{u as E}from"./hotkeys-ClCtr3_I.js";import{r as v}from"./config-C6qInAhC.js";import{t as A}from"./strings-DHsDEFo-.js";function W(){try{return window.__MARIMO_MOUNT_CONFIG__.version}catch{return E.warn("Failed to get version from mount config"),null}}const _=x(W()||"latest"),H=x(!0),M=x(null);var L={"Content-Type":"application/json"},k=/\{[^{}]+\}/g,G=class extends Request{constructor(r,t){for(let e in super(r,t),t)e in this||(this[e]=t[e])}};function F(r){let{baseUrl:t="",fetch:e=globalThis.fetch,querySerializer:n,bodySerializer:o,headers:s,...a}={...r};t.endsWith("/")&&(t=t.substring(0,t.length-1)),s=z(L,s);let l=[];async function c(u,i){let{fetch:y=e,headers:I,params:j={},parseAs:R="json",querySerializer:b,bodySerializer:O=o??B,...N}=i||{},g=typeof n=="function"?n:P(n);b&&(g=typeof b=="function"?b:P({...typeof n=="object"?n:{},...b}));let d={redirect:"follow",...a,...N,headers:z(s,I,j.header)};d.body&&(d.body=O(d.body)),d.body instanceof FormData&&d.headers.delete("Content-Type");let m=new G(K(u,{baseUrl:t,params:j,querySerializer:g}),d),q={baseUrl:t,fetch:y,parseAs:R,querySerializer:g,bodySerializer:O};for(let p of l)if(p&&typeof p=="object"&&typeof p.onRequest=="function"){m.schemaPath=u,m.params=j;let h=await p.onRequest(m,q);if(h){if(!(h instanceof Request))throw Error("Middleware must return new Request() when modifying the request");m=h}}let f=await y(m);for(let p=l.length-1;p>=0;p--){let h=l[p];if(h&&typeof h=="object"&&typeof h.onResponse=="function"){let T=await h.onResponse(f,q);if(T){if(!(T instanceof Response))throw Error("Middleware must return new Response() when modifying the response");f=T}}}if(f.status===204||f.headers.get("Content-Length")==="0")return f.ok?{data:{},response:f}:{error:{},response:f};if(f.ok)return R==="stream"?{data:f.body,response:f}:{data:await f[R](),response:f};let $=await f.text();try{$=JSON.parse($)}catch{}return{error:$,response:f}}return{async GET(u,i){return c(u,{...i,method:"GET"})},async PUT(u,i){return c(u,{...i,method:"PUT"})},async POST(u,i){return c(u,{...i,method:"POST"})},async DELETE(u,i){return c(u,{...i,method:"DELETE"})},async OPTIONS(u,i){return c(u,{...i,method:"OPTIONS"})},async HEAD(u,i){return c(u,{...i,method:"HEAD"})},async PATCH(u,i){return c(u,{...i,method:"PATCH"})},async TRACE(u,i){return c(u,{...i,method:"TRACE"})},use(...u){for(let i of u)if(i){if(typeof i!="object"||!("onRequest"in i||"onResponse"in i))throw Error("Middleware must be an object with one of `onRequest()` or `onResponse()`");l.push(i)}},eject(...u){for(let i of u){let y=l.indexOf(i);y!==-1&&l.splice(y,1)}}}}function w(r,t,e){if(t==null)return"";if(typeof t=="object")throw Error("Deeply-nested arrays/objects aren\u2019t supported. Provide your own `querySerializer()` to handle these.");return`${r}=${(e==null?void 0:e.allowReserved)===!0?t:encodeURIComponent(t)}`}function C(r,t,e){if(!t||typeof t!="object")return"";let n=[],o={simple:",",label:".",matrix:";"}[e.style]||"&";if(e.style!=="deepObject"&&e.explode===!1){for(let l in t)n.push(l,e.allowReserved===!0?t[l]:encodeURIComponent(t[l]));let a=n.join(",");switch(e.style){case"form":return`${r}=${a}`;case"label":return`.${a}`;case"matrix":return`;${r}=${a}`;default:return a}}for(let a in t){let l=e.style==="deepObject"?`${r}[${a}]`:a;n.push(w(l,t[a],e))}let s=n.join(o);return e.style==="label"||e.style==="matrix"?`${o}${s}`:s}function U(r,t,e){if(!Array.isArray(t))return"";if(e.explode===!1){let s={form:",",spaceDelimited:"%20",pipeDelimited:"|"}[e.style]||",",a=(e.allowReserved===!0?t:t.map(l=>encodeURIComponent(l))).join(s);switch(e.style){case"simple":return a;case"label":return`.${a}`;case"matrix":return`;${r}=${a}`;default:return`${r}=${a}`}}let n={simple:",",label:".",matrix:";"}[e.style]||"&",o=[];for(let s of t)e.style==="simple"||e.style==="label"?o.push(e.allowReserved===!0?s:encodeURIComponent(s)):o.push(w(r,s,e));return e.style==="label"||e.style==="matrix"?`${n}${o.join(n)}`:o.join(n)}function P(r){return function(t){let e=[];if(t&&typeof t=="object")for(let n in t){let o=t[n];if(o!=null){if(Array.isArray(o)){e.push(U(n,o,{style:"form",explode:!0,...r==null?void 0:r.array,allowReserved:(r==null?void 0:r.allowReserved)||!1}));continue}if(typeof o=="object"){e.push(C(n,o,{style:"deepObject",explode:!0,...r==null?void 0:r.object,allowReserved:(r==null?void 0:r.allowReserved)||!1}));continue}e.push(w(n,o,r))}}return e.join("&")}}function J(r,t){let e=r;for(let n of r.match(k)??[]){let o=n.substring(1,n.length-1),s=!1,a="simple";if(o.endsWith("*")&&(s=!0,o=o.substring(0,o.length-1)),o.startsWith(".")?(a="label",o=o.substring(1)):o.startsWith(";")&&(a="matrix",o=o.substring(1)),!t||t[o]===void 0||t[o]===null)continue;let l=t[o];if(Array.isArray(l)){e=e.replace(n,U(o,l,{style:a,explode:s}));continue}if(typeof l=="object"){e=e.replace(n,C(o,l,{style:a,explode:s}));continue}if(a==="matrix"){e=e.replace(n,`;${w(o,l)}`);continue}e=e.replace(n,a==="label"?`.${l}`:l)}return e}function B(r){return JSON.stringify(r)}function K(r,t){var o;let e=`${t.baseUrl}${r}`;(o=t.params)!=null&&o.path&&(e=J(e,t.params.path));let n=t.querySerializer(t.params.query??{});return n.startsWith("?")&&(n=n.substring(1)),n&&(e+=`?${n}`),e}function z(...r){let t=new Headers;for(let e of r){if(!e||typeof e!="object")continue;let n=e instanceof Headers?e.entries():Object.entries(e);for(let[o,s]of n)if(s===null)t.delete(o);else if(Array.isArray(s))for(let a of s)t.append(o,a);else s!==void 0&&t.set(o,s)}return t}function Q(r){return F(r)}function D(){let r=v().httpURL;return r.search="",r.hash="",r.toString()}const S={post(r,t,e={}){let n=`${A.withTrailingSlash(e.baseUrl??D())}api${r}`;return fetch(n,{method:"POST",headers:{"Content-Type":"application/json",...S.headers(),...e.headers},body:JSON.stringify(t),signal:e.signal}).then(async o=>{var a;let s=(a=o.headers.get("Content-Type"))==null?void 0:a.startsWith("application/json");if(!o.ok){let l=s?await o.json():await o.text();throw Error(o.statusText,{cause:l})}return s?o.json():o.text()}).catch(o=>{throw E.error(`Error requesting ${n}`,o),o})},get(r,t={}){let e=`${A.withTrailingSlash(t.baseUrl??D())}api${r}`;return fetch(e,{method:"GET",headers:{...S.headers(),...t.headers}}).then(n=>{var o;if(!n.ok)throw Error(n.statusText);return(o=n.headers.get("Content-Type"))!=null&&o.startsWith("application/json")?n.json():null}).catch(n=>{throw E.error(`Error requesting ${e}`,n),n})},headers(){return v().headers()},handleResponse:r=>r.error?Promise.reject(r.error):Promise.resolve(r.data),handleResponseReturnNull:r=>r.error?Promise.reject(r.error):Promise.resolve(null)};function V(r){let t=Q({baseUrl:r.httpURL.toString()});return t.use({onRequest:e=>{let n=r.headers();for(let[o,s]of Object.entries(n))e.headers.set(o,s);return e}}),t}export{H as a,M as i,V as n,_ as r,S as t};
