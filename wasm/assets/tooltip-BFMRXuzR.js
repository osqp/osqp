var ue=Object.defineProperty;var ce=(t,e,n)=>e in t?ue(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var A=(t,e,n)=>ce(t,typeof e!="symbol"?e+"":e,n);var at,lt,ot,ut,ct;import{C as de,w as he}from"./_Uint8Array-D5Z9rM2X.js";import{a as fe,u as ye}from"./hotkeys-ClCtr3_I.js";import{St as yt,a as pe,c as ge,gt as me,o as ve,wt as be}from"./vega-loader.browser-D2m26-DP.js";var xe="[object Number]";function we(t){return typeof t=="number"||de(t)&&he(t)==xe}var Ie=we;const pt=Uint8Array.of(65,82,82,79,87,49),$={V1:0,V2:1,V3:2,V4:3,V5:4},S={NONE:0,Schema:1,DictionaryBatch:2,RecordBatch:3,Tensor:4,SparseTensor:5},l={Dictionary:-1,NONE:0,Null:1,Int:2,Float:3,Binary:4,Utf8:5,Bool:6,Decimal:7,Date:8,Time:9,Timestamp:10,Interval:11,List:12,Struct:13,Union:14,FixedSizeBinary:15,FixedSizeList:16,Map:17,Duration:18,LargeBinary:19,LargeUtf8:20,LargeList:21,RunEndEncoded:22,BinaryView:23,Utf8View:24,ListView:25,LargeListView:26},gt={HALF:0,SINGLE:1,DOUBLE:2},z={DAY:0,MILLISECOND:1},m={SECOND:0,MILLISECOND:1,MICROSECOND:2,NANOSECOND:3},C={YEAR_MONTH:0,DAY_TIME:1,MONTH_DAY_NANO:2},W={Sparse:0,Dense:1},mt=Uint8Array,vt=Uint16Array,bt=Uint32Array,xt=BigUint64Array,wt=Int8Array,Le=Int16Array,x=Int32Array,L=BigInt64Array,Ae=Float32Array,k=Float64Array;function Ne(t,e){let n=Math.log2(t)-3;return(e?[wt,Le,x,L]:[mt,vt,bt,xt])[n]}Object.getPrototypeOf(Int8Array);function X(t,e){let n=0,r=t.length;if(r<=2147483648)do{let i=n+r>>>1;t[i]<=e?n=i+1:r=i}while(n<r);else do{let i=Math.trunc((n+r)/2);t[i]<=e?n=i+1:r=i}while(n<r);return n}function J(t,e,n){if(e(t))return t;throw Error(n(t))}function w(t,e,n){return e=Array.isArray(e)?e:Object.values(e),J(t,r=>e.includes(r),n??(()=>`${t} must be one of ${e}`))}function It(t,e){for(let[n,r]of Object.entries(t))if(r===e)return n;return"<Unknown>"}const G=t=>`Unsupported data type: "${It(l,t)}" (id ${t})`,Lt=(t,e,n=!0,r=null)=>({name:t,type:e,nullable:n,metadata:r});function At(t){return Object.hasOwn(t,"name")&&Nt(t.type)}function Nt(t){return typeof(t==null?void 0:t.typeId)=="number"}function B(t,e="",n=!0){return At(t)?t:Lt(e,J(t,Nt,()=>"Data type expected."),n)}const Ee=(t,e,n=!1,r=-1)=>({typeId:l.Dictionary,id:r,dictionary:t,indices:e||Dt(),ordered:n}),Et=(t=32,e=!0)=>({typeId:l.Int,bitWidth:w(t,[8,16,32,64]),signed:e,values:Ne(t,e)}),Dt=()=>Et(32),De=(t=2)=>({typeId:l.Float,precision:w(t,gt),values:[vt,Ae,k][t]}),Se=()=>({typeId:l.Binary,offsets:x}),Be=()=>({typeId:l.Utf8,offsets:x}),Oe=(t,e,n=128)=>({typeId:l.Decimal,precision:t,scale:e,bitWidth:w(n,[128,256]),values:xt}),Te=t=>({typeId:l.Date,unit:w(t,z),values:t===z.DAY?x:L}),Me=(t=m.MILLISECOND,e=32)=>({typeId:l.Time,unit:w(t,m),bitWidth:w(e,[32,64]),values:e===32?x:L}),Ce=(t=m.MILLISECOND,e=null)=>({typeId:l.Timestamp,unit:w(t,m),timezone:e,values:L}),Ue=(t=C.MONTH_DAY_NANO)=>({typeId:l.Interval,unit:w(t,C),values:t===C.MONTH_DAY_NANO?void 0:x}),Ve=t=>({typeId:l.List,children:[B(t)],offsets:x}),Fe=t=>({typeId:l.Struct,children:Array.isArray(t)&&At(t[0])?t:Object.entries(t).map(([e,n])=>Lt(e,n))}),Re=(t,e,n,r)=>(n??(n=e.map((i,s)=>s)),{typeId:l.Union,mode:w(t,W),typeIds:n,typeMap:n.reduce((i,s,a)=>(i[s]=a,i),{}),children:e.map((i,s)=>B(i,`_${s}`)),typeIdForValue:r,offsets:x}),$e=t=>({typeId:l.FixedSizeBinary,stride:t}),ze=(t,e)=>({typeId:l.FixedSizeList,stride:e,children:[B(t)]}),ke=(t,e)=>({typeId:l.Map,keysSorted:t,children:[e],offsets:x}),je=(t=m.MILLISECOND)=>({typeId:l.Duration,unit:w(t,m),values:L}),Ye=()=>({typeId:l.LargeBinary,offsets:L}),_e=()=>({typeId:l.LargeUtf8,offsets:L}),He=t=>({typeId:l.LargeList,children:[B(t)],offsets:L}),Pe=(t,e)=>({typeId:l.RunEndEncoded,children:[J(B(t,"run_ends"),n=>n.type.typeId===l.Int,()=>"Run-ends must have an integer type."),B(e,"values")]}),We=t=>({typeId:l.ListView,children:[B(t,"value")],offsets:x}),Xe=t=>({typeId:l.LargeListView,children:[B(t,"value")],offsets:L});var j=new k(2).buffer;new L(j),new bt(j),new x(j),new mt(j);function O(t){if(t>2**53-1||t<-(2**53-1))throw Error(`BigInt exceeds integer number representation: ${t}`);return Number(t)}function Z(t,e){return Number(t/e)+Number(t%e)/Number(e)}var U=t=>BigInt.asUintN(64,t);function Je(t,e){let n=e<<1,r;return BigInt.asIntN(64,t[n+1])<0?(r=U(~t[n])|U(~t[n+1])<<64n,r=-(r+1n)):r=t[n]|t[n+1]<<64n,r}function Ge(t,e){let n=e<<2,r;return BigInt.asIntN(64,t[n+3])<0?(r=U(~t[n])|U(~t[n+1])<<64n|U(~t[n+2])<<128n|U(~t[n+3])<<192n,r=-(r+1n)):r=t[n]|t[n+1]<<64n|t[n+2]<<128n|t[n+3]<<192n,r}var Ze=new TextDecoder("utf-8");new TextEncoder;function Y(t){return Ze.decode(t)}function St(t,e){return(t[e>>3]&1<<e%8)!=0}function N(t,e){let n=e+h(t,e),r=n-h(t,n),i=v(t,r);return(s,a,o=null)=>{if(s<i){let u=v(t,r+s);if(u)return a(t,n+u)}return o}}function M(t,e){return e}function F(t,e){return!!qe(t,e)}function qe(t,e){return q(t,e)<<24>>24}function q(t,e){return t[e]}function v(t,e){return Ke(t,e)<<16>>16}function Ke(t,e){return t[e]|t[e+1]<<8}function h(t,e){return t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24}function Bt(t,e){return h(t,e)>>>0}function b(t,e){return O(BigInt.asIntN(64,BigInt(Bt(t,e))+(BigInt(Bt(t,e+4))<<32n)))}function _(t,e){let n=e+h(t,e),r=h(t,n);return n+=4,Y(t.subarray(n,n+r))}function T(t,e,n,r){if(!e)return[];let i=e+h(t,e);return Array.from({length:h(t,i)},(s,a)=>r(t,i+4+a*n))}const K=Symbol("rowIndex");function Q(t,e){class n{constructor(s){this[K]=s}toJSON(){return Tt(t,e,this[K])}}let r=n.prototype;for(let i=0;i<t.length;++i){if(Object.hasOwn(r,t[i]))continue;let s=e[i];Object.defineProperty(r,t[i],{get(){return s.at(this[K])},enumerable:!0})}return i=>new n(i)}function Ot(t,e){return n=>Tt(t,e,n)}function Tt(t,e,n){let r={};for(let i=0;i<t.length;++i)r[t[i]]=e[i].at(n);return r}function Qe(t){return t instanceof P}var H=(at=class{constructor({length:t,nullCount:e,type:n,validity:r,values:i,offsets:s,sizes:a,children:o}){this.length=t,this.nullCount=e,this.type=n,this.validity=r,this.values=i,this.offsets=s,this.sizes=a,this.children=o,(!e||!this.validity)&&(this.at=u=>this.value(u))}get[Symbol.toStringTag](){return"Batch"}at(t){return this.isValid(t)?this.value(t):null}isValid(t){return St(this.validity,t)}value(t){return this.values[t]}slice(t,e){let n=e-t,r=Array(n);for(let i=0;i<n;++i)r[i]=this.at(t+i);return r}*[Symbol.iterator](){for(let t=0;t<this.length;++t)yield this.at(t)}},A(at,"ArrayType",null),at),P=class extends H{constructor(t){super(t);let{length:e,values:n}=this;this.values=n.subarray(0,e)}slice(t,e){return this.nullCount?super.slice(t,e):this.values.subarray(t,e)}[Symbol.iterator](){return this.nullCount?super[Symbol.iterator]():this.values[Symbol.iterator]()}},tt=(lt=class extends H{},A(lt,"ArrayType",k),lt),f=(ot=class extends H{},A(ot,"ArrayType",Array),ot),tn=class extends f{value(t){return null}},V=class extends tt{value(t){return O(this.values[t])}},en=class extends tt{value(t){let e=this.values[t],n=(e&31744)>>10,r=(e&1023)/1024,i=(-1)**((e&32768)>>15);switch(n){case 31:return i*(r?NaN:1/0);case 0:return i*(r?6103515625e-14*r:0)}return i*2**(n-15)*(1+r)}},nn=class extends f{value(t){return St(this.values,t)}},Mt=class extends H{constructor(t){super(t);let{bitWidth:e,scale:n}=this.type;this.decimal=e===128?Je:Ge,this.scale=10n**BigInt(n)}},rn=(ut=class extends Mt{value(t){return Z(this.decimal(this.values,t),this.scale)}},A(ut,"ArrayType",k),ut),sn=(ct=class extends Mt{value(t){return this.decimal(this.values,t)}},A(ct,"ArrayType",Array),ct),Ct=class extends f{constructor(t){super(t),this.source=t}value(t){return new Date(this.source.value(t))}},an=class extends tt{value(t){return 864e5*this.values[t]}};const ln=V;var on=class extends V{value(t){return super.value(t)*1e3}};const un=V;var cn=class extends V{value(t){return Z(this.values[t],1000n)}},dn=class extends V{value(t){return Z(this.values[t],1000000n)}},hn=class extends f{value(t){return this.values.subarray(t<<1,t+1<<1)}},fn=class extends f{value(t){let e=this.values,n=t<<4;return Float64Array.of(h(e,n),h(e,n+4),b(e,n+8))}},Ut=({values:t,offsets:e},n)=>t.subarray(e[n],e[n+1]),Vt=({values:t,offsets:e},n)=>t.subarray(O(e[n]),O(e[n+1])),yn=class extends f{value(t){return Ut(this,t)}},pn=class extends f{value(t){return Vt(this,t)}},gn=class extends f{value(t){return Y(Ut(this,t))}},mn=class extends f{value(t){return Y(Vt(this,t))}},vn=class extends f{value(t){let e=this.offsets;return this.children[0].slice(e[t],e[t+1])}},bn=class extends f{value(t){let e=this.offsets;return this.children[0].slice(O(e[t]),O(e[t+1]))}},xn=class extends f{value(t){let e=this.offsets[t],n=e+this.sizes[t];return this.children[0].slice(e,n)}},wn=class extends f{value(t){let e=this.offsets[t],n=e+this.sizes[t];return this.children[0].slice(O(e),O(n))}},Ft=class extends f{constructor(t){super(t),this.stride=this.type.stride}},In=class extends Ft{value(t){let{stride:e,values:n}=this;return n.subarray(t*e,(t+1)*e)}},Ln=class extends Ft{value(t){let{children:e,stride:n}=this;return e[0].slice(t*n,(t+1)*n)}};function Rt({children:t,offsets:e},n){let[r,i]=t[0].children,s=e[n],a=e[n+1],o=[];for(let u=s;u<a;++u)o.push([r.at(u),i.at(u)]);return o}var An=class extends f{value(t){return Rt(this,t)}},Nn=class extends f{value(t){return new Map(Rt(this,t))}},$t=class extends f{constructor({typeIds:t,...e}){super(e),this.typeIds=t,this.typeMap=this.type.typeMap}value(t,e=t){let{typeIds:n,children:r,typeMap:i}=this;return r[i[n[t]]].at(e)}},En=class extends $t{value(t){return super.value(t,this.offsets[t])}},zt=class extends f{constructor(t,e=Ot){super(t),this.names=this.type.children.map(n=>n.name),this.factory=e(this.names,this.children)}value(t){return this.factory(t)}},Dn=class extends zt{constructor(t){super(t,Q)}},Sn=class extends f{value(t){let[{values:e},n]=this.children;return n.at(X(e,t))}},Bn=class extends f{setDictionary(t){return this.dictionary=t,this.cache=t.cache(),this}value(t){return this.cache[this.key(t)]}key(t){return this.values[t]}},kt=class extends f{constructor({data:t,...e}){super(e),this.data=t}view(t){let{values:e,data:n}=this,r=t<<4,i=r+4,s=e,a=h(s,r);return a>12&&(i=h(s,r+12),s=n[h(s,r+8)]),s.subarray(i,i+a)}},On=class extends kt{value(t){return this.view(t)}},Tn=class extends kt{value(t){return Y(this.view(t))}};function jt(t){let e=[];return{add(n){return e.push(n),this},clear:()=>e=[],done:()=>new Mn(e,t)}}var Mn=class{constructor(t,e=(n=>(n=t[0])==null?void 0:n.type)()){this.type=e,this.length=t.reduce((s,a)=>s+a.length,0),this.nullCount=t.reduce((s,a)=>s+a.nullCount,0),this.data=t;let r=t.length,i=new Int32Array(r+1);if(r===1){let[s]=t;i[1]=s.length,this.at=a=>s.at(a)}else for(let s=0,a=0;s<r;++s)i[s+1]=a+=t[s].length;this.offsets=i}get[Symbol.toStringTag](){return"Column"}[Symbol.iterator](){let t=this.data;return t.length===1?t[0][Symbol.iterator]():Cn(t)}at(t){var i;let{data:e,offsets:n}=this,r=X(n,t)-1;return(i=e[r])==null?void 0:i.at(t-n[r])}get(t){return this.at(t)}toArray(){let{length:t,nullCount:e,data:n}=this,r=!e&&Qe(n[0]),i=n.length;if(r&&i===1)return n[0].values;let s=new(!i||e>0?Array:n[0].constructor.ArrayType??n[0].values.constructor)(t);return r?Un(s,n):Vn(s,n)}cache(){return this._cache??(this._cache=this.toArray())}};function*Cn(t){for(let e=0;e<t.length;++e){let n=t[e][Symbol.iterator]();for(let r=n.next();!r.done;r=n.next())yield r.value}}function Un(t,e){for(let n=0,r=0;n<e.length;++n){let{values:i}=e[n];t.set(i,r),r+=i.length}return t}function Vn(t,e){let n=-1;for(let r=0;r<e.length;++r){let i=e[r];for(let s=0;s<i.length;++s)t[++n]=i.at(s)}return t}var Fn=class le{constructor(e,n,r=!1){let i=e.fields.map(a=>a.name);this.schema=e,this.names=i,this.children=n,this.factory=r?Q:Ot;let s=[];this.getFactory=a=>s[a]??(s[a]=this.factory(i,n.map(o=>o.data[a])))}get[Symbol.toStringTag](){return"Table"}get numCols(){return this.names.length}get numRows(){var e;return((e=this.children[0])==null?void 0:e.length)??0}getChildAt(e){return this.children[e]}getChild(e){let n=this.names.findIndex(r=>r===e);return n>-1?this.children[n]:void 0}selectAt(e,n=[]){let{children:r,factory:i,schema:s}=this,{fields:a}=s;return new le({...s,fields:e.map((o,u)=>Rn(a[o],n[u]))},e.map(o=>r[o]),i===Q)}select(e,n){let r=this.names,i=e.map(s=>r.indexOf(s));return this.selectAt(i,n)}toColumns(){let{children:e,names:n}=this,r={};return n.forEach((i,s)=>{var a;return r[i]=((a=e[s])==null?void 0:a.toArray())??[]}),r}toArray(){var a;let{children:e,getFactory:n,numRows:r}=this,i=((a=e[0])==null?void 0:a.data)??[],s=Array(r);for(let o=0,u=-1;o<i.length;++o){let d=n(o);for(let c=0;c<i[o].length;++c)s[++u]=d(c)}return s}*[Symbol.iterator](){var i;let{children:e,getFactory:n}=this,r=((i=e[0])==null?void 0:i.data)??[];for(let s=0;s<r.length;++s){let a=n(s);for(let o=0;o<r[s].length;++o)yield a(o)}}at(e){let{children:n,getFactory:r,numRows:i}=this;if(e<0||e>=i)return null;let[{offsets:s}]=n,a=X(s,e)-1;return r(a)(e-s[a])}get(e){return this.at(e)}};function Rn(t,e){return e!=null&&e!==t.name?{...t,name:e}:t}function $n(t,e={}){let{typeId:n,bitWidth:r,precision:i,unit:s}=t,{useBigInt:a,useDate:o,useDecimalBigInt:u,useMap:d,useProxy:c}=e;switch(n){case l.Null:return tn;case l.Bool:return nn;case l.Int:case l.Time:case l.Duration:return a||r<64?P:V;case l.Float:return i?P:en;case l.Date:return Yt(s===z.DAY?an:ln,o&&Ct);case l.Timestamp:return Yt(s===m.SECOND?on:s===m.MILLISECOND?un:s===m.MICROSECOND?cn:dn,o&&Ct);case l.Decimal:return u?sn:rn;case l.Interval:return s===C.DAY_TIME?hn:s===C.YEAR_MONTH?P:fn;case l.FixedSizeBinary:return In;case l.Utf8:return gn;case l.LargeUtf8:return mn;case l.Binary:return yn;case l.LargeBinary:return pn;case l.BinaryView:return On;case l.Utf8View:return Tn;case l.List:return vn;case l.LargeList:return bn;case l.Map:return d?Nn:An;case l.ListView:return xn;case l.LargeListView:return wn;case l.FixedSizeList:return Ln;case l.Struct:return c?Dn:zt;case l.RunEndEncoded:return Sn;case l.Dictionary:return Bn;case l.Union:return t.mode?En:$t}throw Error(G(n))}function Yt(t,e){return e?class extends e{constructor(n){super(new t(n))}}:t}function zn(t,e){return{offset:b(t,e),metadataLength:h(t,e+8),bodyLength:b(t,e+16)}}function _t(t,e){return T(t,e,24,zn)}function Ht(t,e,n){let r=N(t,e);if(r(10,M,0))throw Error("Record batch compression not implemented");let i=n<$.V4?8:0;return{length:r(4,b,0),nodes:T(t,r(6,M),16,(s,a)=>({length:b(s,a),nullCount:b(s,a+8)})),regions:T(t,r(8,M),16+i,(s,a)=>({offset:b(s,a+i),length:b(s,a+i+8)})),variadic:T(t,r(12,M),8,b)}}function kn(t,e,n){let r=N(t,e);return{id:r(4,b,0),data:r(6,(i,s)=>Ht(i,s,n)),isDelta:r(8,F,!1)}}function Pt(t,e,n,r){w(n,l,G);let i=N(t,e);switch(n){case l.Binary:return Se();case l.Utf8:return Be();case l.LargeBinary:return Ye();case l.LargeUtf8:return _e();case l.List:return Ve(r[0]);case l.ListView:return We(r[0]);case l.LargeList:return He(r[0]);case l.LargeListView:return Xe(r[0]);case l.Struct:return Fe(r);case l.RunEndEncoded:return Pe(r[0],r[1]);case l.Int:return Et(i(4,h,0),i(6,F,!1));case l.Float:return De(i(4,v,gt.HALF));case l.Decimal:return Oe(i(4,h,0),i(6,h,0),i(8,h,128));case l.Date:return Te(i(4,v,z.MILLISECOND));case l.Time:return Me(i(4,v,m.MILLISECOND),i(6,h,32));case l.Timestamp:return Ce(i(4,v,m.SECOND),i(6,_));case l.Interval:return Ue(i(4,v,C.YEAR_MONTH));case l.Duration:return je(i(4,v,m.MILLISECOND));case l.FixedSizeBinary:return $e(i(4,h,0));case l.FixedSizeList:return ze(r[0],i(4,h,0));case l.Map:return ke(i(4,F,!1),r[0]);case l.Union:return Re(i(4,v,W.Sparse),r,T(t,i(6,M),4,h))}return{typeId:n}}function et(t,e){let n=T(t,e,4,(r,i)=>{let s=N(r,i);return[s(4,_),s(6,_)]});return n.length?new Map(n):null}function Wt(t,e,n){let r=N(t,e);return{version:n,endianness:r(4,v,0),fields:r(6,jn,[]),metadata:r(8,et)}}function jn(t,e){return T(t,e,4,Xt)}function Xt(t,e){let n=N(t,e),r=n(8,q,l.NONE),i=n(10,M,0),s=n(12,_n),a=Pt(t,i,r,n(14,(o,u)=>Yn(o,u)));return s&&(s.dictionary=a,a=s),{name:n(4,_),type:a,nullable:n(6,F,!1),metadata:n(16,et)}}function Yn(t,e){let n=T(t,e,4,Xt);return n.length?n:null}function _n(t,e){if(!e)return null;let n=N(t,e);return Ee(null,n(6,Hn,Dt()),n(8,F,!1),n(4,b,0))}function Hn(t,e){return Pt(t,e,l.Int)}var Pn=(t,e)=>`Expected to read ${t} metadata bytes, but only read ${e}.`,Wn=(t,e)=>`Expected to read ${t} bytes for message body, but only read ${e}.`,Xn=t=>`Unsupported message type: ${t} (${It(S,t)})`;function nt(t,e){let n=h(t,e)||0;if(e+=4,n===-1&&(n=h(t,e)||0,e+=4),n===0)return null;let r=t.subarray(e,e+=n);if(r.byteLength<n)throw Error(Pn(n,r.byteLength));let i=N(r,0),s=i(4,v,$.V1),a=i(6,q,S.NONE),o=i(8,M,0),u=i(10,b,0),d;if(o){let c=a===S.Schema?Wt:a===S.DictionaryBatch?kn:a===S.RecordBatch?Ht:null;if(!c)throw Error(Xn(a));if(d=c(r,o,s),u>0){let g=t.subarray(e,e+=u);if(g.byteLength<u)throw Error(Wn(u,g.byteLength));d.body=g}}return{version:s,type:a,index:e,content:d}}function Jn(t){let e=t instanceof ArrayBuffer?new Uint8Array(t):t;return e instanceof Uint8Array&&Gn(e)?qn(e):Zn(e)}function Gn(t){if(!t||t.length<4)return!1;for(let e=0;e<6;++e)if(pt[e]!==t[e])return!1;return!0}function Zn(t){let e=[t].flat(),n,r=[],i=[];for(let s of e){if(!(s instanceof Uint8Array))throw Error("IPC data batch was not a Uint8Array.");let a=0;for(;;){let o=nt(s,a);if(o===null)break;if(a=o.index,o.content)switch(o.type){case S.Schema:n||(n=o.content);break;case S.RecordBatch:r.push(o.content);break;case S.DictionaryBatch:i.push(o.content);break}}}return{schema:n,dictionaries:i,records:r,metadata:null}}function qn(t){let e=t.byteLength-(pt.length+4),n=N(t,e-h(t,e)),r=n(4,v,$.V1),i=n(8,_t,[]),s=n(10,_t,[]);return{schema:n(6,(a,o)=>Wt(a,o,r)),dictionaries:i.map(({offset:a})=>nt(t,a).content),records:s.map(({offset:a})=>nt(t,a).content),metadata:n(12,et)}}function rt(t,e){return Kn(Jn(t),e)}function Kn(t,e={}){let{schema:n={fields:[]},dictionaries:r,records:i}=t,{version:s,fields:a}=n,o=new Map,u=tr(e,s,o),d=new Map;Qn(n,y=>{let p=y.type;p.typeId===l.Dictionary&&d.set(p.id,p.dictionary)});let c=new Map;for(let y of r){let{id:p,data:E,isDelta:D,body:oe}=y,dt=d.get(p),ht=it(dt,u({...E,body:oe}));if(c.has(p)){let ft=c.get(p);D||ft.clear(),ft.add(ht)}else{if(D)throw Error("Delta update can not be first dictionary batch.");c.set(p,jt(dt).add(ht))}}c.forEach((y,p)=>o.set(p,y.done()));let g=a.map(y=>jt(y.type));for(let y of i){let p=u(y);a.forEach((E,D)=>g[D].add(it(E.type,p)))}return new Fn(n,g.map(y=>y.done()),e.useProxy)}function Qn(t,e){t.fields.forEach(function n(r){var i,s,a;e(r),(s=(i=r.type.dictionary)==null?void 0:i.children)==null||s.forEach(n),(a=r.type.children)==null||a.forEach(n)})}function tr(t,e,n){let r={version:e,options:t,dictionary:i=>n.get(i)};return i=>{let{length:s,nodes:a,regions:o,variadic:u,body:d}=i,c=-1,g=-1,y=-1;return{...r,length:s,node:()=>a[++c],buffer:p=>{let{length:E,offset:D}=o[++g];return p?new p(d.buffer,d.byteOffset+D,E/p.BYTES_PER_ELEMENT):d.subarray(D,D+E)},variadic:()=>u[++y],visit(p){return p.map(E=>it(E.type,this))}}}}function it(t,e){let{typeId:n}=t,{length:r,options:i,node:s,buffer:a,variadic:o,version:u}=e,d=$n(t,i);if(n===l.Null)return new d({length:r,nullCount:r,type:t});let c={...s(),type:t};switch(n){case l.Bool:case l.Int:case l.Time:case l.Duration:case l.Float:case l.Decimal:case l.Date:case l.Timestamp:case l.Interval:case l.FixedSizeBinary:return new d({...c,validity:a(),values:a(t.values)});case l.Utf8:case l.LargeUtf8:case l.Binary:case l.LargeBinary:return new d({...c,validity:a(),offsets:a(t.offsets),values:a()});case l.BinaryView:case l.Utf8View:return new d({...c,validity:a(),values:a(),data:Array.from({length:o()},()=>a())});case l.List:case l.LargeList:case l.Map:return new d({...c,validity:a(),offsets:a(t.offsets),children:e.visit(t.children)});case l.ListView:case l.LargeListView:return new d({...c,validity:a(),offsets:a(t.offsets),sizes:a(t.offsets),children:e.visit(t.children)});case l.FixedSizeList:case l.Struct:return new d({...c,validity:a(),children:e.visit(t.children)});case l.RunEndEncoded:return new d({...c,children:e.visit(t.children)});case l.Dictionary:{let{id:g,indices:y}=t;return new d({...c,validity:a(),values:a(y.values)}).setDictionary(e.dictionary(g))}case l.Union:return u<$.V5&&a(),new d({...c,typeIds:a(wt),offsets:t.mode===W.Sparse?null:a(t.offsets),children:e.visit(t.children)});default:throw Error(G(n))}}new Uint16Array(new Uint8Array([1,0]).buffer)[0];function R(t,e){let n=new Map;return(...r)=>{let i=e(...r);if(n.has(i))return n.get(i);let s=t(...r).finally(()=>{n.delete(i)});return n.set(i,s),s}}function st(t,e){return ve(t,e)}function er(){return pe()}const I=ge;function Jt(){let t=nr(er()),e=n=>JSON.stringify(n);return{load:R(t.load.bind(t),e),sanitize:R(t.sanitize.bind(t),e),http:R(t.http.bind(t),e),file:R(t.file.bind(t),e)}}function nr(t){return{...t,async load(e,n){return e.endsWith(".arrow")?rt(await Gt(e),{useProxy:!1}).toArray():t.load(e,n)}}}const Gt=R(t=>fetch(t).then(e=>e.arrayBuffer()),t=>t);var Zt=I.integer,qt=I.number,rr=I.date,ir=I.boolean,Kt=()=>(I.integer=t=>{if(t==="")return"";if(t==="-inf"||t==="inf")return t;function e(r){let i=Zt(r);return Number.isNaN(i)?r:i}let n=Number.parseInt(t,10);if(Ie(n)){if(!(Math.abs(n)>2**53-1))return e(t);try{return BigInt(t)}catch{return e(t)}}else return""},I.number=t=>{if(t==="-inf"||t==="inf")return t;let e=qt(t);return Number.isNaN(e)?t:e},()=>{I.integer=Zt,I.number=qt}),Qt=()=>(I.date=t=>{if(t==="")return"";if(t==null)return null;if(!/^\d{4}-\d{2}-\d{2}(T[\d.:]+(Z|[+-]\d{2}:?\d{2})?)?$/.test(t))return t;try{let e=new Date(t);return Number.isNaN(e.getTime())?t:e}catch{return ye.warn(`Failed to parse date: ${t}`),t}},()=>{I.date=rr});I.boolean=t=>t==="True"?!0:t==="False"?!1:ir(t);const te=Jt();async function sr(t,e,n={}){let{handleBigIntAndNumberLike:r=!1,replacePeriod:i=!1}=n;if(t.endsWith(".arrow")||(e==null?void 0:e.type)==="arrow")return rt(await Gt(t),{useProxy:!0,useDate:!0,useBigInt:r}).toArray();let s=[Qt];r&&s.push(Kt);let a=[];try{let o=await te.load(t);if(!e){if(typeof o=="string")try{JSON.parse(o),e={type:"json"}}catch{e={type:"csv",parse:"auto"}}typeof o=="object"&&(e={type:"json"})}let u=(e==null?void 0:e.type)==="csv";u&&typeof o=="string"&&(o=lr(o)),u&&typeof o=="string"&&i&&(o=or(o));let d=(e==null?void 0:e.parse)||"auto";return typeof d=="object"&&(d=fe.mapValues(d,c=>c==="time"?"string":c==="datetime"?"date":c)),a=s.map(c=>c()),u?st(o,{...e,parse:d}):st(o,e)}finally{a.forEach(o=>o())}}function ar(t,e=!0){let n=[Qt];e&&n.push(Kt);let r=n.map(s=>s()),i=st(t,{type:"csv",parse:"auto"});return r.forEach(s=>s()),i}function lr(t){return t!=null&&t.includes(",")?ee(t,e=>{let n=new Set;return e.map(r=>{let i=cr(r,n);return n.add(i),i})}):t}function or(t){return t!=null&&t.includes(".")?ee(t,e=>e.map(n=>n.replaceAll(".","\u2024"))):t}function ee(t,e){let n=t.split(`
`);return n[0]=e(n[0].split(",")).join(","),n.join(`
`)}var ur="\u200B";function cr(t,e){let n=t,r=1;for(;e.has(n);)n=`${t}${ur.repeat(r)}`,r++;return n}var dr={version:"1.1.0"};function hr(t,e,n,r){if(me(t))return`[${t.map(i=>e(be(i)?i:ne(i,n))).join(", ")}]`;if(yt(t)){let i="",{title:s,image:a,...o}=t;s&&(i+=`<h2>${e(s)}</h2>`),a&&(i+=`<img src="${new URL(e(a),r||location.href).href}">`);let u=Object.keys(o);if(u.length>0){i+="<table>";for(let d of u){let c=o[d];c!==void 0&&(yt(c)&&(c=ne(c,n)),i+=`<tr><td class="key">${e(d)}</td><td class="value">${e(c)}</td></tr>`)}i+="</table>"}return i||"{}"}return e(t)}function fr(t){let e=[];return function(n,r){return typeof r!="object"||!r?r:(e.length=e.indexOf(this)+1,e.length>t?"[Object]":e.indexOf(r)>=0?"[Circular]":(e.push(r),r))}}function ne(t,e){return JSON.stringify(t,fr(e))}var yr=`#vg-tooltip-element {
  visibility: hidden;
  padding: 8px;
  position: fixed;
  z-index: 1000;
  font-family: sans-serif;
  font-size: 11px;
  border-radius: 3px;
  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
  white-space: pre-line;
}
#vg-tooltip-element.visible {
  visibility: visible;
}
#vg-tooltip-element h2 {
  margin-top: 0;
  margin-bottom: 10px;
  font-size: 13px;
}
#vg-tooltip-element table {
  border-spacing: 0;
}
#vg-tooltip-element table tr {
  border: none;
}
#vg-tooltip-element table tr td {
  overflow: hidden;
  text-overflow: ellipsis;
  padding-top: 2px;
  padding-bottom: 2px;
  vertical-align: text-top;
}
#vg-tooltip-element table tr td.key {
  color: #808080;
  max-width: 150px;
  text-align: right;
  padding-right: 4px;
}
#vg-tooltip-element table tr td.value {
  display: block;
  max-width: 300px;
  max-height: 7em;
  text-align: left;
}
#vg-tooltip-element {
  /* The default theme is the light theme. */
  background-color: rgba(255, 255, 255, 0.95);
  border: 1px solid #d9d9d9;
  color: black;
}
#vg-tooltip-element.dark-theme {
  background-color: rgba(32, 32, 32, 0.9);
  border: 1px solid #f5f5f5;
  color: white;
}
#vg-tooltip-element.dark-theme td.key {
  color: #bfbfbf;
}
`,re="vg-tooltip-element",pr={offsetX:10,offsetY:10,id:re,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:gr,maxDepth:2,formatTooltip:hr,baseURL:"",anchor:"cursor",position:["top","bottom","left","right","top-left","top-right","bottom-left","bottom-right"]};function gr(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;")}function mr(t){if(!/^[A-Za-z]+[-:.\w]*$/.test(t))throw Error("Invalid HTML ID");return yr.toString().replaceAll(re,t)}function ie(t,e,{offsetX:n,offsetY:r}){let i=se({x1:t.clientX,x2:t.clientX,y1:t.clientY,y2:t.clientY},e,n,r);for(let s of["bottom-right","bottom-left","top-right","top-left"])if(ae(i[s],e))return i[s];return i["top-left"]}function vr(t,e,n,r,i){let{position:s,offsetX:a,offsetY:o}=i,u=t._el.getBoundingClientRect(),d=t._origin,c=se(br(u,d,n),r,a,o),g=Array.isArray(s)?s:[s];for(let y of g)if(ae(c[y],r)&&!xr(e,c[y],r))return c[y];return ie(e,r,i)}function br(t,e,n){let r=n.isVoronoi?n.datum.bounds:n.bounds,i=t.left+e[0]+r.x1,s=t.top+e[1]+r.y1,a=n;for(;a.mark.group;)a=a.mark.group,i+=a.x??0,s+=a.y??0;let o=r.x2-r.x1,u=r.y2-r.y1;return{x1:i,x2:i+o,y1:s,y2:s+u}}function se(t,e,n,r){let i=(t.x1+t.x2)/2,s=(t.y1+t.y2)/2,a=t.x1-e.width-n,o=i-e.width/2,u=t.x2+n,d=t.y1-e.height-r,c=s-e.height/2,g=t.y2+r;return{top:{x:o,y:d},bottom:{x:o,y:g},left:{x:a,y:c},right:{x:u,y:c},"top-left":{x:a,y:d},"top-right":{x:u,y:d},"bottom-left":{x:a,y:g},"bottom-right":{x:u,y:g}}}function ae(t,e){return t.x>=0&&t.y>=0&&t.x+e.width<=window.innerWidth&&t.y+e.height<=window.innerHeight}function xr(t,e,n){return t.clientX>=e.x&&t.clientX<=e.x+n.width&&t.clientY>=e.y&&t.clientY<=e.y+n.height}var wr=class{constructor(t){A(this,"call");A(this,"options");A(this,"el");this.options={...pr,...t};let e=this.options.id;if(this.el=null,this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){let n=document.createElement("style");n.setAttribute("id",this.options.styleId),n.innerHTML=mr(e);let r=document.head;r.childNodes.length>0?r.insertBefore(n,r.childNodes[0]):r.appendChild(n)}}tooltipHandler(t,e,n,r){if(this.el=document.getElementById(this.options.id),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",this.options.id),this.el.classList.add("vg-tooltip"),(document.fullscreenElement??document.body).appendChild(this.el)),r==null||r===""){this.el.classList.remove("visible",`${this.options.theme}-theme`);return}this.el.innerHTML=this.options.formatTooltip(r,this.options.sanitize,this.options.maxDepth,this.options.baseURL),this.el.classList.add("visible",`${this.options.theme}-theme`);let{x:i,y:s}=this.options.anchor==="mark"?vr(t,e,n,this.el.getBoundingClientRect(),this.options):ie(e,this.el.getBoundingClientRect(),this.options);this.el.style.top=`${s}px`,this.el.style.left=`${i}px`}};dr.version;const Ir=new wr;export{Jt as a,te as i,ar as n,rt as o,sr as r,Ir as t};
