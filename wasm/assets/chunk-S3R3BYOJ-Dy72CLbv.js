var g;import{s as Z}from"./chunk-DZLz74EQ.js";import{t as M}from"./memoize-D2QB0zzX.js";import{t as tt}from"./merge-DrdmtLTL.js";import{u as et}from"./src--EmJf_Ct.js";import{_ as rt,a as it,c as nt,d as at,f as ot,g as st,h as lt,i as ct,l as ht,m as ut,n as ft,o as dt,p as gt,r as xt,s as pt,t as yt,u as mt,v as vt}from"./step-aJ-oEw6-.js";import{n as s,r as p}from"./src-CWnjMQt8.js";import{F as _t,f as $t,m,r as E,s as b}from"./chunk-ABZYJK2D-eZsthrBr.js";import{t as Mt}from"./dist-D2dAPhhG.js";var N=class{constructor(e,t){this._context=e,this._x=t}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._x?this._context.bezierCurveTo(this._x0=(this._x0+e)/2,this._y0,this._x0,t,e,t):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+t)/2,e,this._y0,e,t);break}this._x0=e,this._y0=t}};function P(e){return new N(e,!0)}function D(e){return new N(e,!1)}var bt=Z(Mt(),1),wt="\u200B",St={curveBasis:rt,curveBasisClosed:st,curveBasisOpen:lt,curveBumpX:P,curveBumpY:D,curveBundle:ut,curveCardinalClosed:ot,curveCardinalOpen:at,curveCardinal:gt,curveCatmullRomClosed:ht,curveCatmullRomOpen:nt,curveCatmullRom:mt,curveLinear:vt,curveLinearClosed:pt,curveMonotoneX:it,curveMonotoneY:dt,curveNatural:ct,curveStep:xt,curveStepAfter:yt,curveStepBefore:ft},Ct=/\s*(?:(\w+)(?=:):|(\w+))\s*(?:(\w+)|((?:(?!}%{2}).|\r?\n)*))?\s*(?:}%{2})?/gi,It=s(function(e,t){let r=H(e,/(?:init\b)|(?:initialize\b)/),i={};if(Array.isArray(r)){let o=r.map(c=>c.args);_t(o),i=E(i,[...o])}else i=r.args;if(!i)return;let a=$t(e,t),n="config";return i[n]!==void 0&&(a==="flowchart-v2"&&(a="flowchart"),i[a]=i[n],delete i[n]),i},"detectInit"),H=s(function(e,t=null){var r,i;try{let a=RegExp(`[%]{2}(?![{]${Ct.source})(?=[}][%]{2}).*
`,"ig");e=e.trim().replace(a,"").replace(/'/gm,'"'),p.debug(`Detecting diagram directive${t===null?"":" type:"+t} based on the text:${e}`);let n,o=[];for(;(n=m.exec(e))!==null;)if(n.index===m.lastIndex&&m.lastIndex++,n&&!t||t&&((r=n[1])==null?void 0:r.match(t))||t&&((i=n[2])==null?void 0:i.match(t))){let c=n[1]?n[1]:n[2],l=n[3]?n[3].trim():n[4]?JSON.parse(n[4].trim()):null;o.push({type:c,args:l})}return o.length===0?{type:e,args:null}:o.length===1?o[0]:o}catch(a){return p.error(`ERROR: ${a.message} - Unable to parse directive type: '${t}' based on the text: '${e}'`),{type:void 0,args:null}}},"detectDirective"),Tt=s(function(e){return e.replace(m,"")},"removeDirectives"),Bt=s(function(e,t){for(let[r,i]of t.entries())if(i.match(e))return r;return-1},"isSubstringInArray");function w(e,t){if(!e)return t;let r=`curve${e.charAt(0).toUpperCase()+e.slice(1)}`;return St[r]??t}s(w,"interpolateToCurve");function L(e,t){let r=e.trim();if(r)return t.securityLevel==="loose"?r:(0,bt.sanitizeUrl)(r)}s(L,"formatUrl");var Wt=s((e,...t)=>{let r=e.split("."),i=r.length-1,a=r[i],n=window;for(let o=0;o<i;o++)if(n=n[r[o]],!n){p.error(`Function name: ${e} not found in window`);return}n[a](...t)},"runFunc");function S(e,t){return!e||!t?0:Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2)}s(S,"distance");function R(e){let t,r=0;e.forEach(a=>{r+=S(a,t),t=a});let i=r/2;return C(e,i)}s(R,"traverseEdge");function O(e){return e.length===1?e[0]:R(e)}s(O,"calcLabelPosition");var j=s((e,t=2)=>{let r=10**t;return Math.round(e*r)/r},"roundNumber"),C=s((e,t)=>{let r,i=t;for(let a of e){if(r){let n=S(a,r);if(n===0)return r;if(n<i)i-=n;else{let o=i/n;if(o<=0)return r;if(o>=1)return{x:a.x,y:a.y};if(o>0&&o<1)return{x:j((1-o)*r.x+o*a.x,5),y:j((1-o)*r.y+o*a.y,5)}}}r=a}throw Error("Could not find a suitable point for the given distance")},"calculatePoint"),Ft=s((e,t,r)=>{p.info(`our points ${JSON.stringify(t)}`),t[0]!==r&&(t=t.reverse());let i=C(t,25),a=e?10:5,n=Math.atan2(t[0].y-i.y,t[0].x-i.x),o={x:0,y:0};return o.x=Math.sin(n)*a+(t[0].x+i.x)/2,o.y=-Math.cos(n)*a+(t[0].y+i.y)/2,o},"calcCardinalityPosition");function k(e,t,r){let i=structuredClone(r);p.info("our points",i),t!=="start_left"&&t!=="start_right"&&i.reverse();let a=25+e,n=C(i,a),o=10+e*.5,c=Math.atan2(i[0].y-n.y,i[0].x-n.x),l={x:0,y:0};return t==="start_left"?(l.x=Math.sin(c+Math.PI)*o+(i[0].x+n.x)/2,l.y=-Math.cos(c+Math.PI)*o+(i[0].y+n.y)/2):t==="end_right"?(l.x=Math.sin(c-Math.PI)*o+(i[0].x+n.x)/2-5,l.y=-Math.cos(c-Math.PI)*o+(i[0].y+n.y)/2-5):t==="end_left"?(l.x=Math.sin(c)*o+(i[0].x+n.x)/2-5,l.y=-Math.cos(c)*o+(i[0].y+n.y)/2-5):(l.x=Math.sin(c)*o+(i[0].x+n.x)/2,l.y=-Math.cos(c)*o+(i[0].y+n.y)/2),l}s(k,"calcTerminalLabelPosition");function I(e){let t="",r="";for(let i of e)i!==void 0&&(i.startsWith("color:")||i.startsWith("text-align:")?r=r+i+";":t=t+i+";");return{style:t,labelStyle:r}}s(I,"getStylesFromArray");var U=0,G=s(()=>(U++,"id-"+Math.random().toString(36).substr(2,12)+"-"+U),"generateId");function J(e){let t="";for(let r=0;r<e;r++)t+="0123456789abcdef".charAt(Math.floor(Math.random()*16));return t}s(J,"makeRandomHex");var X=s(e=>J(e.length),"random"),zt=s(function(){return{x:0,y:0,fill:void 0,anchor:"start",style:"#666",width:100,height:100,textMargin:0,rx:0,ry:0,valign:void 0,text:""}},"getTextObj"),At=s(function(e,t){let r=t.text.replace(b.lineBreakRegex," "),[,i]=v(t.fontSize),a=e.append("text");a.attr("x",t.x),a.attr("y",t.y),a.style("text-anchor",t.anchor),a.style("font-family",t.fontFamily),a.style("font-size",i),a.style("font-weight",t.fontWeight),a.attr("fill",t.fill),t.class!==void 0&&a.attr("class",t.class);let n=a.append("tspan");return n.attr("x",t.x+t.textMargin*2),n.attr("fill",t.fill),n.text(r),a},"drawSimpleText"),Y=M((e,t,r)=>{if(!e||(r=Object.assign({fontSize:12,fontWeight:400,fontFamily:"Arial",joinWith:"<br/>"},r),b.lineBreakRegex.test(e)))return e;let i=e.split(" ").filter(Boolean),a=[],n="";return i.forEach((o,c)=>{let l=d(`${o} `,r),h=d(n,r);if(l>t){let{hyphenatedStrings:u,remainingWord:x}=Et(o,t,"-",r);a.push(n,...u),n=x}else h+l>=t?(a.push(n),n=o):n=[n,o].filter(Boolean).join(" ");c+1===i.length&&a.push(n)}),a.filter(o=>o!=="").join(r.joinWith)},(e,t,r)=>`${e}${t}${r.fontSize}${r.fontWeight}${r.fontFamily}${r.joinWith}`),Et=M((e,t,r="-",i)=>{i=Object.assign({fontSize:12,fontWeight:400,fontFamily:"Arial",margin:0},i);let a=[...e],n=[],o="";return a.forEach((c,l)=>{let h=`${o}${c}`;if(d(h,i)>=t){let u=l+1,x=a.length===u,_=`${h}${r}`;n.push(x?h:_),o=""}else o=h}),{hyphenatedStrings:n,remainingWord:o}},(e,t,r="-",i)=>`${e}${t}${r}${i.fontSize}${i.fontWeight}${i.fontFamily}`);function T(e,t){return B(e,t).height}s(T,"calculateTextHeight");function d(e,t){return B(e,t).width}s(d,"calculateTextWidth");var B=M((e,t)=>{let{fontSize:r=12,fontFamily:i="Arial",fontWeight:a=400}=t;if(!e)return{width:0,height:0};let[,n]=v(r),o=["sans-serif",i],c=e.split(b.lineBreakRegex),l=[],h=et("body");if(!h.remove)return{width:0,height:0,lineHeight:0};let u=h.append("svg");for(let _ of o){let $=0,f={width:0,height:0,lineHeight:0};for(let V of c){let z=zt();z.text=V||"\u200B";let A=At(u,z).style("font-size",n).style("font-weight",a).style("font-family",_),y=(A._groups||A)[0][0].getBBox();if(y.width===0&&y.height===0)throw Error("svg element not in render tree");f.width=Math.round(Math.max(f.width,y.width)),$=Math.round(y.height),f.height+=$,f.lineHeight=Math.round(Math.max(f.lineHeight,$))}l.push(f)}u.remove();let x=isNaN(l[1].height)||isNaN(l[1].width)||isNaN(l[1].lineHeight)||l[0].height>l[1].height&&l[0].width>l[1].width&&l[0].lineHeight>l[1].lineHeight?0:1;return l[x]},(e,t)=>`${e}${t.fontSize}${t.fontWeight}${t.fontFamily}`),Nt=(g=class{constructor(t=!1,r){this.count=0,this.count=r?r.length:0,this.next=t?()=>this.count++:()=>Date.now()}},s(g,"InitIDGenerator"),g),W,Pt=s(function(e){return W||(W=document.createElement("div")),e=escape(e).replace(/%26/g,"&").replace(/%23/g,"#").replace(/%3B/g,";"),W.innerHTML=e,unescape(W.textContent)},"entityDecode");function q(e){return"str"in e}s(q,"isDetailedError");var Dt=s((e,t,r,i)=>{var n;if(!i)return;let a=(n=e.node())==null?void 0:n.getBBox();a&&e.append("text").text(i).attr("text-anchor","middle").attr("x",a.x+a.width/2).attr("y",-r).attr("class",t)},"insertTitle"),v=s(e=>{if(typeof e=="number")return[e,e+"px"];let t=parseInt(e??"",10);return Number.isNaN(t)?[void 0,void 0]:e===String(t)?[t,e+"px"]:[t,e]},"parseFontSize");function F(e,t){return tt({},e,t)}s(F,"cleanAndMerge");var Ht={assignWithDepth:E,wrapLabel:Y,calculateTextHeight:T,calculateTextWidth:d,calculateTextDimensions:B,cleanAndMerge:F,detectInit:It,detectDirective:H,isSubstringInArray:Bt,interpolateToCurve:w,calcLabelPosition:O,calcCardinalityPosition:Ft,calcTerminalLabelPosition:k,formatUrl:L,getStylesFromArray:I,generateId:G,random:X,runFunc:Wt,entityDecode:Pt,insertTitle:Dt,isLabelCoordinateInPath:Q,parseFontSize:v,InitIDGenerator:Nt},Lt=s(function(e){let t=e;return t=t.replace(/style.*:\S*#.*;/g,function(r){return r.substring(0,r.length-1)}),t=t.replace(/classDef.*:\S*#.*;/g,function(r){return r.substring(0,r.length-1)}),t=t.replace(/#\w+;/g,function(r){let i=r.substring(1,r.length-1);return/^\+?\d+$/.test(i)?"\uFB02\xB0\xB0"+i+"\xB6\xDF":"\uFB02\xB0"+i+"\xB6\xDF"}),t},"encodeEntities"),Rt=s(function(e){return e.replace(/ﬂ°°/g,"&#").replace(/ﬂ°/g,"&").replace(/¶ß/g,";")},"decodeEntities"),Ot=s((e,t,{counter:r=0,prefix:i,suffix:a},n)=>n||`${i?`${i}_`:""}${e}_${t}_${r}${a?`_${a}`:""}`,"getEdgeId");function K(e){return e??null}s(K,"handleUndefinedAttr");function Q(e,t){let r=Math.round(e.x),i=Math.round(e.y),a=t.replace(/(\d+\.\d+)/g,n=>Math.round(parseFloat(n)).toString());return a.includes(r.toString())||a.includes(i.toString())}s(Q,"isLabelCoordinateInPath");export{Y as _,Rt as a,Ot as c,w as d,q as f,Ht as g,Tt as h,F as i,I as l,X as m,T as n,Lt as o,v as p,d as r,G as s,wt as t,K as u,P as v,D as y};
