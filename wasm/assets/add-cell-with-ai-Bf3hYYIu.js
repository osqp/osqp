var zn=Object.defineProperty;var Un=(t,e,a)=>e in t?zn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var P=(t,e,a)=>Un(t,typeof e!="symbol"?e+"":e,a);import{s as ct,t as Vn}from"./chunk-DZLz74EQ.js";import{c as Bn,i as Wn,n as Pr,s as qn,u as Zr}from"./jotai-BTnrNcC1.js";import{t as Kn}from"./react-BcIddLXZ.js";import{At as Jn,Bt as Yn,Cr as Hn,Dr as Gn,Fr as $r,Ht as Qn,Ir as Xn,Ut as Lr,Yn as ei,bt as ti,cn as Dr,d as ai,fr as ri,i as si,kr as ni,lr as ii,tt as Ra,ut as oi,vn as li,vt as di,w as Fr,y as at}from"./cells-A69p56PE.js";import{A as k,D as ui,E as ae,F as I,G as zr,H as re,I as le,L as Rt,N as ke,O as Ma,P as _t,R as H,S as ci,T as Ur,U as pi,V as de,Y as Vr,b as Xt,j as bt,k as mi,w as Ce,x as ea,z as m}from"./zod-U2NFpcFA.js";import{t as ja}from"./compiler-runtime-Cr9loedd.js";import{o as hi,u as ue}from"./hotkeys-ClCtr3_I.js";import{a as fi}from"./config-C6qInAhC.js";import{t as gi}from"./jsx-runtime-mwDPpfh_.js";import{t as Br}from"./cn-ZXtYmczU.js";import{t as $e}from"./button-ZC2axIBq.js";import{Gt as ta,Jt as yi,Kt as aa,Rt as vi,Vt as Wr,bt as ra,ot as _i,rt as qr,st as Kr,tt as Pa,yt as bi,zt as xi}from"./dist-MHIqsPCF.js";import{G as Jr,R as wi,X as ki}from"./Output-DWmT-7NV.js";import{t as Ci}from"./createReducer-CeLhipaI.js";import{r as Ti,t as Ii}from"./requests-BACZP_uj.js";import{h as Ei,n as Si,o as Ai,r as Oi}from"./dist-8_YHxBVW.js";import{i as Ni}from"./dist-C14Sk-Bd.js";import{t as Yr}from"./use-toast-midBZAtS.js";import{i as Ri}from"./useLifecycle-DogGOXPh.js";import{n as Mi}from"./useTheme-Biy2QI0v.js";import{t as Hr}from"./createLucideIcon-CNVopWor.js";import{t as ji}from"./ai-model-dropdown-CvhbTHha.js";import{h as Pi}from"./select-5fcaZwou.js";import{a as Zi}from"./download-ByFIcaoi.js";import{a as Gr,c as $i,p as Li,r as Di,t as Fi}from"./dropdown-menu-uN_XMhZm.js";import{n as zi}from"./spinner-CuquyDWA.js";import{a as xt,c as Ui,i as wt,o as Mt,r as Vi,s as jt}from"./MarimoErrorOutput-BATnwNYX.js";import{r as Bi}from"./name-cell-input-DND1MD7b.js";import{n as Wi}from"./ConsoleOutput-BJP_UIwR.js";import{a as qi}from"./state-JZFfOGr9.js";import{t as Ki}from"./tooltip-BHnVWzH0.js";import{t as Ji}from"./shim-Cc3VMan6.js";import{n as Yi}from"./useEvent-CRDKqG3C.js";import{i as Hi}from"./error-banner-DoSAS3iD.js";import{n as Gi}from"./useRunCells-BLpH_l8E.js";import{n as Pt}from"./renderShortcut-DJmsjON-.js";import{i as Za}from"./cell-link-D75IV6D1.js";import{r as Qi,t as Xi}from"./esm-B3nKz9z-.js";import{t as eo}from"./blob-ISoY06EG.js";import{t as to}from"./useDeleteCell-CEsjHDdl.js";import{n as ao}from"./add-missing-import-Bc1Nj8aC.js";import{n as ro}from"./icons-DaFojEUL.js";var so=Hr("at-sign",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]]),no=Hr("send-horizontal",[["path",{d:"M3.714 3.048a.498.498 0 0 0-.683.627l2.843 7.627a2 2 0 0 1 0 1.396l-2.842 7.627a.498.498 0 0 0 .682.627l18-8.5a.5.5 0 0 0 0-.904z",key:"117uat"}],["path",{d:"M6 12h16",key:"s4cdu5"}]]),Qr="vercel.ai.error",io=Symbol.for(Qr),Xr,oo=class Mn extends Error{constructor({name:e,message:a,cause:r}){super(a),this[Xr]=!0,this.name=e,this.cause=r}static isInstance(e){return Mn.hasMarker(e,Qr)}static hasMarker(e,a){let r=Symbol.for(a);return typeof e=="object"&&!!e&&r in e&&typeof e[r]=="boolean"&&e[r]===!0}};Xr=io;var rt=oo;function es(t){return t==null?"unknown error":typeof t=="string"?t:t instanceof Error?t.message:JSON.stringify(t)}var ts="AI_InvalidArgumentError",as=`vercel.ai.error.${ts}`,lo=Symbol.for(as),rs,uo=class extends rt{constructor({message:t,cause:e,argument:a}){super({name:ts,message:t,cause:e}),this[rs]=!0,this.argument=a}static isInstance(t){return rt.hasMarker(t,as)}};rs=lo;var ss="AI_JSONParseError",ns=`vercel.ai.error.${ss}`,co=Symbol.for(ns),is,os=class extends rt{constructor({text:t,cause:e}){super({name:ss,message:`JSON parsing failed: Text: ${t}.
Error message: ${es(e)}`,cause:e}),this[is]=!0,this.text=t}static isInstance(t){return rt.hasMarker(t,ns)}};is=co;var ls="AI_TypeValidationError",ds=`vercel.ai.error.${ls}`,po=Symbol.for(ds),us,mo=class Ar extends rt{constructor({value:e,cause:a}){super({name:ls,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${es(a)}`,cause:a}),this[us]=!0,this.value=e}static isInstance(e){return rt.hasMarker(e,ds)}static wrap({value:e,cause:a}){return Ar.isInstance(a)&&a.value===e?a:new Ar({value:e,cause:a})}};us=po;var sa=mo,cs=class extends Error{constructor(t,e){super(t),this.name="ParseError",this.type=e.type,this.field=e.field,this.value=e.value,this.line=e.line}};function $a(t){}function ho(t){if(typeof t=="function")throw TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");let{onEvent:e=$a,onError:a=$a,onRetry:r=$a,onComment:s}=t,n="",o=!0,i,l="",d="";function u(f){let c=o?f.replace(/^\xEF\xBB\xBF/,""):f,[h,_]=fo(`${n}${c}`);for(let w of h)p(w);n=_,o=!1}function p(f){if(f===""){v();return}if(f.startsWith(":")){s&&s(f.slice(f.startsWith(": ")?2:1));return}let c=f.indexOf(":");if(c!==-1){let h=f.slice(0,c),_=f[c+1]===" "?2:1;g(h,f.slice(c+_),f);return}g(f,"",f)}function g(f,c,h){switch(f){case"event":d=c;break;case"data":l=`${l}${c}
`;break;case"id":i=c.includes("\0")?void 0:c;break;case"retry":/^\d+$/.test(c)?r(parseInt(c,10)):a(new cs(`Invalid \`retry\` value: "${c}"`,{type:"invalid-retry",value:c,line:h}));break;default:a(new cs(`Unknown field "${f.length>20?`${f.slice(0,20)}\u2026`:f}"`,{type:"unknown-field",field:f,value:c,line:h}));break}}function v(){l.length>0&&e({id:i,event:d||void 0,data:l.endsWith(`
`)?l.slice(0,-1):l}),i=void 0,l="",d=""}function b(f={}){n&&f.consume&&p(n),o=!0,i=void 0,l="",d="",n=""}return{feed:u,reset:b}}function fo(t){let e=[],a="",r=0;for(;r<t.length;){let s=t.indexOf("\r",r),n=t.indexOf(`
`,r),o=-1;if(s!==-1&&n!==-1?o=Math.min(s,n):s===-1?n!==-1&&(o=n):o=s===t.length-1?-1:s,o===-1){a=t.slice(r);break}else{let i=t.slice(r,o);e.push(i),r=o+1,t[r-1]==="\r"&&t[r]===`
`&&r++}}return[e,a]}var go=class extends TransformStream{constructor({onError:t,onRetry:e,onComment:a}={}){let r;super({start(s){r=ho({onEvent:n=>{s.enqueue(n)},onError(n){t==="terminate"?s.error(n):typeof t=="function"&&t(n)},onRetry:e,onComment:a})},transform(s){r.feed(s)}})}},U;(function(t){t.assertEqual=s=>{};function e(s){}t.assertIs=e;function a(s){throw Error()}t.assertNever=a,t.arrayToEnum=s=>{let n={};for(let o of s)n[o]=o;return n},t.getValidEnumValues=s=>{let n=t.objectKeys(s).filter(i=>typeof s[s[i]]!="number"),o={};for(let i of n)o[i]=s[i];return t.objectValues(o)},t.objectValues=s=>t.objectKeys(s).map(function(n){return s[n]}),t.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{let n=[];for(let o in s)Object.prototype.hasOwnProperty.call(s,o)&&n.push(o);return n},t.find=(s,n)=>{for(let o of s)if(n(o))return o},t.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function r(s,n=" | "){return s.map(o=>typeof o=="string"?`'${o}'`:o).join(n)}t.joinValues=r,t.jsonStringifyReplacer=(s,n)=>typeof n=="bigint"?n.toString():n})(U||(U={}));var yo;(function(t){t.mergeShapes=(e,a)=>({...e,...a})})(yo||(yo={}));const T=U.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),st=t=>{switch(typeof t){case"undefined":return T.undefined;case"string":return T.string;case"number":return Number.isNaN(t)?T.nan:T.number;case"boolean":return T.boolean;case"function":return T.function;case"bigint":return T.bigint;case"symbol":return T.symbol;case"object":return Array.isArray(t)?T.array:t===null?T.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?T.promise:typeof Map<"u"&&t instanceof Map?T.map:typeof Set<"u"&&t instanceof Set?T.set:typeof Date<"u"&&t instanceof Date?T.date:T.object;default:return T.unknown}},y=U.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);var Le=class jn extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};let a=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,a):this.__proto__=a,this.name="ZodError",this.issues=e}format(e){let a=e||function(n){return n.message},r={_errors:[]},s=n=>{for(let o of n.issues)if(o.code==="invalid_union")o.unionErrors.map(s);else if(o.code==="invalid_return_type")s(o.returnTypeError);else if(o.code==="invalid_arguments")s(o.argumentsError);else if(o.path.length===0)r._errors.push(a(o));else{let i=r,l=0;for(;l<o.path.length;){let d=o.path[l];l===o.path.length-1?(i[d]=i[d]||{_errors:[]},i[d]._errors.push(a(o))):i[d]=i[d]||{_errors:[]},i=i[d],l++}}};return s(this),r}static assert(e){if(!(e instanceof jn))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,U.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=a=>a.message){let a={},r=[];for(let s of this.issues)if(s.path.length>0){let n=s.path[0];a[n]=a[n]||[],a[n].push(e(s))}else r.push(e(s));return{formErrors:r,fieldErrors:a}}get formErrors(){return this.flatten()}};Le.create=t=>new Le(t);var Zt=(t,e)=>{let a;switch(t.code){case y.invalid_type:a=t.received===T.undefined?"Required":`Expected ${t.expected}, received ${t.received}`;break;case y.invalid_literal:a=`Invalid literal value, expected ${JSON.stringify(t.expected,U.jsonStringifyReplacer)}`;break;case y.unrecognized_keys:a=`Unrecognized key(s) in object: ${U.joinValues(t.keys,", ")}`;break;case y.invalid_union:a="Invalid input";break;case y.invalid_union_discriminator:a=`Invalid discriminator value. Expected ${U.joinValues(t.options)}`;break;case y.invalid_enum_value:a=`Invalid enum value. Expected ${U.joinValues(t.options)}, received '${t.received}'`;break;case y.invalid_arguments:a="Invalid function arguments";break;case y.invalid_return_type:a="Invalid function return type";break;case y.invalid_date:a="Invalid date";break;case y.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(a=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(a=`${a} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?a=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?a=`Invalid input: must end with "${t.validation.endsWith}"`:U.assertNever(t.validation):a=t.validation==="regex"?"Invalid":`Invalid ${t.validation}`;break;case y.too_small:a=t.type==="array"?`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"||t.type==="bigint"?`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:"Invalid input";break;case y.too_big:a=t.type==="array"?`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:"Invalid input";break;case y.custom:a="Invalid input";break;case y.invalid_intersection_types:a="Intersection results could not be merged";break;case y.not_multiple_of:a=`Number must be a multiple of ${t.multipleOf}`;break;case y.not_finite:a="Number must be finite";break;default:a=e.defaultError,U.assertNever(t)}return{message:a}},vo=Zt;function La(){return vo}const Da=t=>{let{data:e,path:a,errorMaps:r,issueData:s}=t,n=[...a,...s.path||[]],o={...s,path:n};if(s.message!==void 0)return{...s,path:n,message:s.message};let i="",l=r.filter(d=>!!d).slice().reverse();for(let d of l)i=d(o,{data:e,defaultError:i}).message;return{...s,path:n,message:i}};function C(t,e){let a=La(),r=Da({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,a,a===Zt?void 0:Zt].filter(s=>!!s)});t.common.issues.push(r)}var be=class Pn{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,a){let r=[];for(let s of a){if(s.status==="aborted")return N;s.status==="dirty"&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,a){let r=[];for(let s of a){let n=await s.key,o=await s.value;r.push({key:n,value:o})}return Pn.mergeObjectSync(e,r)}static mergeObjectSync(e,a){let r={};for(let s of a){let{key:n,value:o}=s;if(n.status==="aborted"||o.status==="aborted")return N;n.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),n.value!=="__proto__"&&(o.value!==void 0||s.alwaysSet)&&(r[n.value]=o.value)}return{status:e.value,value:r}}};const N=Object.freeze({status:"aborted"}),Fa=t=>({status:"dirty",value:t}),ye=t=>({status:"valid",value:t}),ps=t=>t.status==="aborted",ms=t=>t.status==="dirty",kt=t=>t.status==="valid",na=t=>typeof Promise<"u"&&t instanceof Promise;var E;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(E||(E={}));var De=class{constructor(t,e,a,r){this._cachedPath=[],this.parent=t,this.data=e,this._path=a,this._key=r}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},hs=(t,e)=>{if(kt(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){return this._error||(this._error=new Le(t.common.issues)),this._error}}};function j(t){if(!t)return{};let{errorMap:e,invalid_type_error:a,required_error:r,description:s}=t;if(e&&(a||r))throw Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(n,o)=>{let{message:i}=t;return n.code==="invalid_enum_value"?{message:i??o.defaultError}:o.data===void 0?{message:i??r??o.defaultError}:n.code==="invalid_type"?{message:i??a??o.defaultError}:{message:o.defaultError}},description:s}}var Z=class{get description(){return this._def.description}_getType(t){return st(t.data)}_getOrReturnCtx(t,e){return e||{common:t.parent.common,data:t.data,parsedType:st(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new be,ctx:{common:t.parent.common,data:t.data,parsedType:st(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){let e=this._parse(t);if(na(e))throw Error("Synchronous parse encountered promise.");return e}_parseAsync(t){let e=this._parse(t);return Promise.resolve(e)}parse(t,e){let a=this.safeParse(t,e);if(a.success)return a.data;throw a.error}safeParse(t,e){let a={common:{issues:[],async:(e==null?void 0:e.async)??!1,contextualErrorMap:e==null?void 0:e.errorMap},path:(e==null?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:st(t)};return hs(a,this._parseSync({data:t,path:a.path,parent:a}))}"~validate"(t){var a,r;let e={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:st(t)};if(!this["~standard"].async)try{let s=this._parseSync({data:t,path:[],parent:e});return kt(s)?{value:s.value}:{issues:e.common.issues}}catch(s){(r=(a=s==null?void 0:s.message)==null?void 0:a.toLowerCase())!=null&&r.includes("encountered")&&(this["~standard"].async=!0),e.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:e}).then(s=>kt(s)?{value:s.value}:{issues:e.common.issues})}async parseAsync(t,e){let a=await this.safeParseAsync(t,e);if(a.success)return a.data;throw a.error}async safeParseAsync(t,e){let a={common:{issues:[],contextualErrorMap:e==null?void 0:e.errorMap,async:!0},path:(e==null?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:st(t)},r=this._parse({data:t,path:a.path,parent:a});return hs(a,await(na(r)?r:Promise.resolve(r)))}refine(t,e){let a=r=>typeof e=="string"||e===void 0?{message:e}:typeof e=="function"?e(r):e;return this._refinement((r,s)=>{let n=t(r),o=()=>s.addIssue({code:y.custom,...a(r)});return typeof Promise<"u"&&n instanceof Promise?n.then(i=>i?!0:(o(),!1)):n?!0:(o(),!1)})}refinement(t,e){return this._refinement((a,r)=>t(a)?!0:(r.addIssue(typeof e=="function"?e(a,r):e),!1))}_refinement(t){return new Ke({schema:this,typeName:x.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return Je.create(this,this._def)}nullable(){return mt.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Tt.create(this)}promise(){return $t.create(this,this._def)}or(t){return da.create([this,t],this._def)}and(t){return ua.create(this,t,this._def)}transform(t){return new Ke({...j(this._def),schema:this,typeName:x.ZodEffects,effect:{type:"transform",transform:t}})}default(t){let e=typeof t=="function"?t:()=>t;return new fa({...j(this._def),innerType:this,defaultValue:e,typeName:x.ZodDefault})}brand(){return new _s({typeName:x.ZodBranded,type:this,...j(this._def)})}catch(t){let e=typeof t=="function"?t:()=>t;return new ga({...j(this._def),innerType:this,catchValue:e,typeName:x.ZodCatch})}describe(t){let e=this.constructor;return new e({...this._def,description:t})}pipe(t){return bs.create(this,t)}readonly(){return ya.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},_o=/^c[^\s-]{8,}$/i,bo=/^[0-9a-z]+$/,xo=/^[0-9A-HJKMNP-TV-Z]{26}$/i,wo=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,ko=/^[a-z0-9_-]{21}$/i,Co=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,To=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Io=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Eo="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",fs,So=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Ao=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Oo=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,No=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Ro=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Mo=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,gs="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",jo=RegExp(`^${gs}$`);function ys(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision??(e=`${e}(\\.\\d+)?`);let a=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${a}`}function Po(t){return RegExp(`^${ys(t)}$`)}function Zo(t){let e=`${gs}T${ys(t)}`,a=[];return a.push(t.local?"Z?":"Z"),t.offset&&a.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${a.join("|")})`,RegExp(`^${e}$`)}function $o(t,e){return!!((e==="v4"||!e)&&So.test(t)||(e==="v6"||!e)&&Oo.test(t))}function Lo(t,e){if(!Co.test(t))return!1;try{let[a]=t.split(".");if(!a)return!1;let r=a.replace(/-/g,"+").replace(/_/g,"/").padEnd(a.length+(4-a.length%4)%4,"="),s=JSON.parse(atob(r));return!(typeof s!="object"||!s||"typ"in s&&(s==null?void 0:s.typ)!=="JWT"||!s.alg||e&&s.alg!==e)}catch{return!1}}function Do(t,e){return!!((e==="v4"||!e)&&Ao.test(t)||(e==="v6"||!e)&&No.test(t))}var ia=class Yt extends Z{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==T.string){let s=this._getOrReturnCtx(e);return C(s,{code:y.invalid_type,expected:T.string,received:s.parsedType}),N}let a=new be,r;for(let s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(r=this._getOrReturnCtx(e,r),C(r,{code:y.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),a.dirty());else if(s.kind==="max")e.data.length>s.value&&(r=this._getOrReturnCtx(e,r),C(r,{code:y.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),a.dirty());else if(s.kind==="length"){let n=e.data.length>s.value,o=e.data.length<s.value;(n||o)&&(r=this._getOrReturnCtx(e,r),n?C(r,{code:y.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):o&&C(r,{code:y.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),a.dirty())}else if(s.kind==="email")Io.test(e.data)||(r=this._getOrReturnCtx(e,r),C(r,{validation:"email",code:y.invalid_string,message:s.message}),a.dirty());else if(s.kind==="emoji")fs||(fs=new RegExp(Eo,"u")),fs.test(e.data)||(r=this._getOrReturnCtx(e,r),C(r,{validation:"emoji",code:y.invalid_string,message:s.message}),a.dirty());else if(s.kind==="uuid")wo.test(e.data)||(r=this._getOrReturnCtx(e,r),C(r,{validation:"uuid",code:y.invalid_string,message:s.message}),a.dirty());else if(s.kind==="nanoid")ko.test(e.data)||(r=this._getOrReturnCtx(e,r),C(r,{validation:"nanoid",code:y.invalid_string,message:s.message}),a.dirty());else if(s.kind==="cuid")_o.test(e.data)||(r=this._getOrReturnCtx(e,r),C(r,{validation:"cuid",code:y.invalid_string,message:s.message}),a.dirty());else if(s.kind==="cuid2")bo.test(e.data)||(r=this._getOrReturnCtx(e,r),C(r,{validation:"cuid2",code:y.invalid_string,message:s.message}),a.dirty());else if(s.kind==="ulid")xo.test(e.data)||(r=this._getOrReturnCtx(e,r),C(r,{validation:"ulid",code:y.invalid_string,message:s.message}),a.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{r=this._getOrReturnCtx(e,r),C(r,{validation:"url",code:y.invalid_string,message:s.message}),a.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),C(r,{validation:"regex",code:y.invalid_string,message:s.message}),a.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(r=this._getOrReturnCtx(e,r),C(r,{code:y.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),a.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(r=this._getOrReturnCtx(e,r),C(r,{code:y.invalid_string,validation:{startsWith:s.value},message:s.message}),a.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(r=this._getOrReturnCtx(e,r),C(r,{code:y.invalid_string,validation:{endsWith:s.value},message:s.message}),a.dirty()):s.kind==="datetime"?Zo(s).test(e.data)||(r=this._getOrReturnCtx(e,r),C(r,{code:y.invalid_string,validation:"datetime",message:s.message}),a.dirty()):s.kind==="date"?jo.test(e.data)||(r=this._getOrReturnCtx(e,r),C(r,{code:y.invalid_string,validation:"date",message:s.message}),a.dirty()):s.kind==="time"?Po(s).test(e.data)||(r=this._getOrReturnCtx(e,r),C(r,{code:y.invalid_string,validation:"time",message:s.message}),a.dirty()):s.kind==="duration"?To.test(e.data)||(r=this._getOrReturnCtx(e,r),C(r,{validation:"duration",code:y.invalid_string,message:s.message}),a.dirty()):s.kind==="ip"?$o(e.data,s.version)||(r=this._getOrReturnCtx(e,r),C(r,{validation:"ip",code:y.invalid_string,message:s.message}),a.dirty()):s.kind==="jwt"?Lo(e.data,s.alg)||(r=this._getOrReturnCtx(e,r),C(r,{validation:"jwt",code:y.invalid_string,message:s.message}),a.dirty()):s.kind==="cidr"?Do(e.data,s.version)||(r=this._getOrReturnCtx(e,r),C(r,{validation:"cidr",code:y.invalid_string,message:s.message}),a.dirty()):s.kind==="base64"?Ro.test(e.data)||(r=this._getOrReturnCtx(e,r),C(r,{validation:"base64",code:y.invalid_string,message:s.message}),a.dirty()):s.kind==="base64url"?Mo.test(e.data)||(r=this._getOrReturnCtx(e,r),C(r,{validation:"base64url",code:y.invalid_string,message:s.message}),a.dirty()):U.assertNever(s);return{status:a.value,value:e.data}}_regex(e,a,r){return this.refinement(s=>e.test(s),{validation:a,code:y.invalid_string,...E.errToObj(r)})}_addCheck(e){return new Yt({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...E.errToObj(e)})}url(e){return this._addCheck({kind:"url",...E.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...E.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...E.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...E.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...E.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...E.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...E.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...E.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...E.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...E.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...E.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...E.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:(e==null?void 0:e.precision)===void 0?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...E.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:(e==null?void 0:e.precision)===void 0?null:e==null?void 0:e.precision,...E.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...E.errToObj(e)})}regex(e,a){return this._addCheck({kind:"regex",regex:e,...E.errToObj(a)})}includes(e,a){return this._addCheck({kind:"includes",value:e,position:a==null?void 0:a.position,...E.errToObj(a==null?void 0:a.message)})}startsWith(e,a){return this._addCheck({kind:"startsWith",value:e,...E.errToObj(a)})}endsWith(e,a){return this._addCheck({kind:"endsWith",value:e,...E.errToObj(a)})}min(e,a){return this._addCheck({kind:"min",value:e,...E.errToObj(a)})}max(e,a){return this._addCheck({kind:"max",value:e,...E.errToObj(a)})}length(e,a){return this._addCheck({kind:"length",value:e,...E.errToObj(a)})}nonempty(e){return this.min(1,E.errToObj(e))}trim(){return new Yt({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Yt({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Yt({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e}get maxLength(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e}};ia.create=t=>new ia({checks:[],typeName:x.ZodString,coerce:(t==null?void 0:t.coerce)??!1,...j(t)});function Fo(t,e){let a=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,s=a>r?a:r;return Number.parseInt(t.toFixed(s).replace(".",""))%Number.parseInt(e.toFixed(s).replace(".",""))/10**s}var za=class Or extends Z{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==T.number){let s=this._getOrReturnCtx(e);return C(s,{code:y.invalid_type,expected:T.number,received:s.parsedType}),N}let a,r=new be;for(let s of this._def.checks)s.kind==="int"?U.isInteger(e.data)||(a=this._getOrReturnCtx(e,a),C(a,{code:y.invalid_type,expected:"integer",received:"float",message:s.message}),r.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(a=this._getOrReturnCtx(e,a),C(a,{code:y.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(a=this._getOrReturnCtx(e,a),C(a,{code:y.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty()):s.kind==="multipleOf"?Fo(e.data,s.value)!==0&&(a=this._getOrReturnCtx(e,a),C(a,{code:y.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(a=this._getOrReturnCtx(e,a),C(a,{code:y.not_finite,message:s.message}),r.dirty()):U.assertNever(s);return{status:r.value,value:e.data}}gte(e,a){return this.setLimit("min",e,!0,E.toString(a))}gt(e,a){return this.setLimit("min",e,!1,E.toString(a))}lte(e,a){return this.setLimit("max",e,!0,E.toString(a))}lt(e,a){return this.setLimit("max",e,!1,E.toString(a))}setLimit(e,a,r,s){return new Or({...this._def,checks:[...this._def.checks,{kind:e,value:a,inclusive:r,message:E.toString(s)}]})}_addCheck(e){return new Or({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:E.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:E.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:E.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:E.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:E.toString(e)})}multipleOf(e,a){return this._addCheck({kind:"multipleOf",value:e,message:E.toString(a)})}finite(e){return this._addCheck({kind:"finite",message:E.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:-(2**53-1),message:E.toString(e)})._addCheck({kind:"max",inclusive:!0,value:2**53-1,message:E.toString(e)})}get minValue(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e}get maxValue(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&U.isInteger(e.value))}get isFinite(){let e=null,a=null;for(let r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(a===null||r.value>a)&&(a=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(a)&&Number.isFinite(e)}};za.create=t=>new za({checks:[],typeName:x.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...j(t)});var Ua=class Nr extends Z{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==T.bigint)return this._getInvalidInput(e);let a,r=new be;for(let s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(a=this._getOrReturnCtx(e,a),C(a,{code:y.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),r.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(a=this._getOrReturnCtx(e,a),C(a,{code:y.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),r.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(a=this._getOrReturnCtx(e,a),C(a,{code:y.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):U.assertNever(s);return{status:r.value,value:e.data}}_getInvalidInput(e){let a=this._getOrReturnCtx(e);return C(a,{code:y.invalid_type,expected:T.bigint,received:a.parsedType}),N}gte(e,a){return this.setLimit("min",e,!0,E.toString(a))}gt(e,a){return this.setLimit("min",e,!1,E.toString(a))}lte(e,a){return this.setLimit("max",e,!0,E.toString(a))}lt(e,a){return this.setLimit("max",e,!1,E.toString(a))}setLimit(e,a,r,s){return new Nr({...this._def,checks:[...this._def.checks,{kind:e,value:a,inclusive:r,message:E.toString(s)}]})}_addCheck(e){return new Nr({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:E.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:E.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:E.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:E.toString(e)})}multipleOf(e,a){return this._addCheck({kind:"multipleOf",value:e,message:E.toString(a)})}get minValue(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e}get maxValue(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e}};Ua.create=t=>new Ua({checks:[],typeName:x.ZodBigInt,coerce:(t==null?void 0:t.coerce)??!1,...j(t)});var Va=class extends Z{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==T.boolean){let e=this._getOrReturnCtx(t);return C(e,{code:y.invalid_type,expected:T.boolean,received:e.parsedType}),N}return ye(t.data)}};Va.create=t=>new Va({typeName:x.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...j(t)});var Ba=class Zn extends Z{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==T.date){let s=this._getOrReturnCtx(e);return C(s,{code:y.invalid_type,expected:T.date,received:s.parsedType}),N}if(Number.isNaN(e.data.getTime()))return C(this._getOrReturnCtx(e),{code:y.invalid_date}),N;let a=new be,r;for(let s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(r=this._getOrReturnCtx(e,r),C(r,{code:y.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),a.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(r=this._getOrReturnCtx(e,r),C(r,{code:y.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),a.dirty()):U.assertNever(s);return{status:a.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Zn({...this._def,checks:[...this._def.checks,e]})}min(e,a){return this._addCheck({kind:"min",value:e.getTime(),message:E.toString(a)})}max(e,a){return this._addCheck({kind:"max",value:e.getTime(),message:E.toString(a)})}get minDate(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e==null?null:new Date(e)}get maxDate(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e==null?null:new Date(e)}};Ba.create=t=>new Ba({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:x.ZodDate,...j(t)});var Wa=class extends Z{_parse(t){if(this._getType(t)!==T.symbol){let e=this._getOrReturnCtx(t);return C(e,{code:y.invalid_type,expected:T.symbol,received:e.parsedType}),N}return ye(t.data)}};Wa.create=t=>new Wa({typeName:x.ZodSymbol,...j(t)});var oa=class extends Z{_parse(t){if(this._getType(t)!==T.undefined){let e=this._getOrReturnCtx(t);return C(e,{code:y.invalid_type,expected:T.undefined,received:e.parsedType}),N}return ye(t.data)}};oa.create=t=>new oa({typeName:x.ZodUndefined,...j(t)});var la=class extends Z{_parse(t){if(this._getType(t)!==T.null){let e=this._getOrReturnCtx(t);return C(e,{code:y.invalid_type,expected:T.null,received:e.parsedType}),N}return ye(t.data)}};la.create=t=>new la({typeName:x.ZodNull,...j(t)});var qa=class extends Z{constructor(){super(...arguments),this._any=!0}_parse(t){return ye(t.data)}};qa.create=t=>new qa({typeName:x.ZodAny,...j(t)});var Ct=class extends Z{constructor(){super(...arguments),this._unknown=!0}_parse(t){return ye(t.data)}};Ct.create=t=>new Ct({typeName:x.ZodUnknown,...j(t)});var nt=class extends Z{_parse(t){let e=this._getOrReturnCtx(t);return C(e,{code:y.invalid_type,expected:T.never,received:e.parsedType}),N}};nt.create=t=>new nt({typeName:x.ZodNever,...j(t)});var Ka=class extends Z{_parse(t){if(this._getType(t)!==T.undefined){let e=this._getOrReturnCtx(t);return C(e,{code:y.invalid_type,expected:T.void,received:e.parsedType}),N}return ye(t.data)}};Ka.create=t=>new Ka({typeName:x.ZodVoid,...j(t)});var Tt=class Oa extends Z{_parse(e){let{ctx:a,status:r}=this._processInputParams(e),s=this._def;if(a.parsedType!==T.array)return C(a,{code:y.invalid_type,expected:T.array,received:a.parsedType}),N;if(s.exactLength!==null){let o=a.data.length>s.exactLength.value,i=a.data.length<s.exactLength.value;(o||i)&&(C(a,{code:o?y.too_big:y.too_small,minimum:i?s.exactLength.value:void 0,maximum:o?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(s.minLength!==null&&a.data.length<s.minLength.value&&(C(a,{code:y.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),s.maxLength!==null&&a.data.length>s.maxLength.value&&(C(a,{code:y.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),a.common.async)return Promise.all([...a.data].map((o,i)=>s.type._parseAsync(new De(a,o,a.path,i)))).then(o=>be.mergeArray(r,o));let n=[...a.data].map((o,i)=>s.type._parseSync(new De(a,o,a.path,i)));return be.mergeArray(r,n)}get element(){return this._def.type}min(e,a){return new Oa({...this._def,minLength:{value:e,message:E.toString(a)}})}max(e,a){return new Oa({...this._def,maxLength:{value:e,message:E.toString(a)}})}length(e,a){return new Oa({...this._def,exactLength:{value:e,message:E.toString(a)}})}nonempty(e){return this.min(1,e)}};Tt.create=(t,e)=>new Tt({type:t,minLength:null,maxLength:null,exactLength:null,typeName:x.ZodArray,...j(e)});function It(t){if(t instanceof Ae){let e={};for(let a in t.shape){let r=t.shape[a];e[a]=Je.create(It(r))}return new Ae({...t._def,shape:()=>e})}else return t instanceof Tt?new Tt({...t._def,type:It(t.element)}):t instanceof Je?Je.create(It(t.unwrap())):t instanceof mt?mt.create(It(t.unwrap())):t instanceof pt?pt.create(t.items.map(e=>It(e))):t}var Ae=class Me extends Z{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape();return this._cached={shape:e,keys:U.objectKeys(e)},this._cached}_parse(e){if(this._getType(e)!==T.object){let l=this._getOrReturnCtx(e);return C(l,{code:y.invalid_type,expected:T.object,received:l.parsedType}),N}let{status:a,ctx:r}=this._processInputParams(e),{shape:s,keys:n}=this._getCached(),o=[];if(!(this._def.catchall instanceof nt&&this._def.unknownKeys==="strip"))for(let l in r.data)n.includes(l)||o.push(l);let i=[];for(let l of n){let d=s[l],u=r.data[l];i.push({key:{status:"valid",value:l},value:d._parse(new De(r,u,r.path,l)),alwaysSet:l in r.data})}if(this._def.catchall instanceof nt){let l=this._def.unknownKeys;if(l==="passthrough")for(let d of o)i.push({key:{status:"valid",value:d},value:{status:"valid",value:r.data[d]}});else if(l==="strict")o.length>0&&(C(r,{code:y.unrecognized_keys,keys:o}),a.dirty());else if(l!=="strip")throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let l=this._def.catchall;for(let d of o){let u=r.data[d];i.push({key:{status:"valid",value:d},value:l._parse(new De(r,u,r.path,d)),alwaysSet:d in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let l=[];for(let d of i){let u=await d.key,p=await d.value;l.push({key:u,value:p,alwaysSet:d.alwaysSet})}return l}).then(l=>be.mergeObjectSync(a,l)):be.mergeObjectSync(a,i)}get shape(){return this._def.shape()}strict(e){return E.errToObj,new Me({...this._def,unknownKeys:"strict",...e===void 0?{}:{errorMap:(a,r)=>{var n,o;let s=((o=(n=this._def).errorMap)==null?void 0:o.call(n,a,r).message)??r.defaultError;return a.code==="unrecognized_keys"?{message:E.errToObj(e).message??s}:{message:s}}}})}strip(){return new Me({...this._def,unknownKeys:"strip"})}passthrough(){return new Me({...this._def,unknownKeys:"passthrough"})}extend(e){return new Me({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Me({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:x.ZodObject})}setKey(e,a){return this.augment({[e]:a})}catchall(e){return new Me({...this._def,catchall:e})}pick(e){let a={};for(let r of U.objectKeys(e))e[r]&&this.shape[r]&&(a[r]=this.shape[r]);return new Me({...this._def,shape:()=>a})}omit(e){let a={};for(let r of U.objectKeys(this.shape))e[r]||(a[r]=this.shape[r]);return new Me({...this._def,shape:()=>a})}deepPartial(){return It(this)}partial(e){let a={};for(let r of U.objectKeys(this.shape)){let s=this.shape[r];e&&!e[r]?a[r]=s:a[r]=s.optional()}return new Me({...this._def,shape:()=>a})}required(e){let a={};for(let r of U.objectKeys(this.shape))if(e&&!e[r])a[r]=this.shape[r];else{let s=this.shape[r];for(;s instanceof Je;)s=s._def.innerType;a[r]=s}return new Me({...this._def,shape:()=>a})}keyof(){return vs(U.objectKeys(this.shape))}};Ae.create=(t,e)=>new Ae({shape:()=>t,unknownKeys:"strip",catchall:nt.create(),typeName:x.ZodObject,...j(e)}),Ae.strictCreate=(t,e)=>new Ae({shape:()=>t,unknownKeys:"strict",catchall:nt.create(),typeName:x.ZodObject,...j(e)}),Ae.lazycreate=(t,e)=>new Ae({shape:t,unknownKeys:"strip",catchall:nt.create(),typeName:x.ZodObject,...j(e)});var da=class extends Z{_parse(t){let{ctx:e}=this._processInputParams(t),a=this._def.options;function r(s){for(let o of s)if(o.result.status==="valid")return o.result;for(let o of s)if(o.result.status==="dirty")return e.common.issues.push(...o.ctx.common.issues),o.result;let n=s.map(o=>new Le(o.ctx.common.issues));return C(e,{code:y.invalid_union,unionErrors:n}),N}if(e.common.async)return Promise.all(a.map(async s=>{let n={...e,common:{...e.common,issues:[]},parent:null};return{result:await s._parseAsync({data:e.data,path:e.path,parent:n}),ctx:n}})).then(r);{let s,n=[];for(let i of a){let l={...e,common:{...e.common,issues:[]},parent:null},d=i._parseSync({data:e.data,path:e.path,parent:l});if(d.status==="valid")return d;d.status==="dirty"&&!s&&(s={result:d,ctx:l}),l.common.issues.length&&n.push(l.common.issues)}if(s)return e.common.issues.push(...s.ctx.common.issues),s.result;let o=n.map(i=>new Le(i));return C(e,{code:y.invalid_union,unionErrors:o}),N}}get options(){return this._def.options}};da.create=(t,e)=>new da({options:t,typeName:x.ZodUnion,...j(e)});var it=t=>t instanceof ca?it(t.schema):t instanceof Ke?it(t.innerType()):t instanceof pa?[t.value]:t instanceof ma?t.options:t instanceof ha?U.objectValues(t.enum):t instanceof fa?it(t._def.innerType):t instanceof oa?[void 0]:t instanceof la?[null]:t instanceof Je?[void 0,...it(t.unwrap())]:t instanceof mt?[null,...it(t.unwrap())]:t instanceof _s||t instanceof ya?it(t.unwrap()):t instanceof ga?it(t._def.innerType):[],zo=class $n extends Z{_parse(e){let{ctx:a}=this._processInputParams(e);if(a.parsedType!==T.object)return C(a,{code:y.invalid_type,expected:T.object,received:a.parsedType}),N;let r=this.discriminator,s=a.data[r],n=this.optionsMap.get(s);return n?a.common.async?n._parseAsync({data:a.data,path:a.path,parent:a}):n._parseSync({data:a.data,path:a.path,parent:a}):(C(a,{code:y.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),N)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,a,r){let s=new Map;for(let n of a){let o=it(n.shape[e]);if(!o.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let i of o){if(s.has(i))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(i)}`);s.set(i,n)}}return new $n({typeName:x.ZodDiscriminatedUnion,discriminator:e,options:a,optionsMap:s,...j(r)})}};function Ja(t,e){let a=st(t),r=st(e);if(t===e)return{valid:!0,data:t};if(a===T.object&&r===T.object){let s=U.objectKeys(e),n=U.objectKeys(t).filter(i=>s.indexOf(i)!==-1),o={...t,...e};for(let i of n){let l=Ja(t[i],e[i]);if(!l.valid)return{valid:!1};o[i]=l.data}return{valid:!0,data:o}}else if(a===T.array&&r===T.array){if(t.length!==e.length)return{valid:!1};let s=[];for(let n=0;n<t.length;n++){let o=t[n],i=e[n],l=Ja(o,i);if(!l.valid)return{valid:!1};s.push(l.data)}return{valid:!0,data:s}}else return a===T.date&&r===T.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var ua=class extends Z{_parse(t){let{status:e,ctx:a}=this._processInputParams(t),r=(s,n)=>{if(ps(s)||ps(n))return N;let o=Ja(s.value,n.value);return o.valid?((ms(s)||ms(n))&&e.dirty(),{status:e.value,value:o.data}):(C(a,{code:y.invalid_intersection_types}),N)};return a.common.async?Promise.all([this._def.left._parseAsync({data:a.data,path:a.path,parent:a}),this._def.right._parseAsync({data:a.data,path:a.path,parent:a})]).then(([s,n])=>r(s,n)):r(this._def.left._parseSync({data:a.data,path:a.path,parent:a}),this._def.right._parseSync({data:a.data,path:a.path,parent:a}))}};ua.create=(t,e,a)=>new ua({left:t,right:e,typeName:x.ZodIntersection,...j(a)});var pt=class Ln extends Z{_parse(e){let{status:a,ctx:r}=this._processInputParams(e);if(r.parsedType!==T.array)return C(r,{code:y.invalid_type,expected:T.array,received:r.parsedType}),N;if(r.data.length<this._def.items.length)return C(r,{code:y.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),N;!this._def.rest&&r.data.length>this._def.items.length&&(C(r,{code:y.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),a.dirty());let s=[...r.data].map((n,o)=>{let i=this._def.items[o]||this._def.rest;return i?i._parse(new De(r,n,r.path,o)):null}).filter(n=>!!n);return r.common.async?Promise.all(s).then(n=>be.mergeArray(a,n)):be.mergeArray(a,s)}get items(){return this._def.items}rest(e){return new Ln({...this._def,rest:e})}};pt.create=(t,e)=>{if(!Array.isArray(t))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new pt({items:t,typeName:x.ZodTuple,rest:null,...j(e)})};var Uo=class Rr extends Z{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:a,ctx:r}=this._processInputParams(e);if(r.parsedType!==T.object)return C(r,{code:y.invalid_type,expected:T.object,received:r.parsedType}),N;let s=[],n=this._def.keyType,o=this._def.valueType;for(let i in r.data)s.push({key:n._parse(new De(r,i,r.path,i)),value:o._parse(new De(r,r.data[i],r.path,i)),alwaysSet:i in r.data});return r.common.async?be.mergeObjectAsync(a,s):be.mergeObjectSync(a,s)}get element(){return this._def.valueType}static create(e,a,r){return a instanceof Z?new Rr({keyType:e,valueType:a,typeName:x.ZodRecord,...j(r)}):new Rr({keyType:ia.create(),valueType:e,typeName:x.ZodRecord,...j(a)})}},Ya=class extends Z{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){let{status:e,ctx:a}=this._processInputParams(t);if(a.parsedType!==T.map)return C(a,{code:y.invalid_type,expected:T.map,received:a.parsedType}),N;let r=this._def.keyType,s=this._def.valueType,n=[...a.data.entries()].map(([o,i],l)=>({key:r._parse(new De(a,o,a.path,[l,"key"])),value:s._parse(new De(a,i,a.path,[l,"value"]))}));if(a.common.async){let o=new Map;return Promise.resolve().then(async()=>{for(let i of n){let l=await i.key,d=await i.value;if(l.status==="aborted"||d.status==="aborted")return N;(l.status==="dirty"||d.status==="dirty")&&e.dirty(),o.set(l.value,d.value)}return{status:e.value,value:o}})}else{let o=new Map;for(let i of n){let l=i.key,d=i.value;if(l.status==="aborted"||d.status==="aborted")return N;(l.status==="dirty"||d.status==="dirty")&&e.dirty(),o.set(l.value,d.value)}return{status:e.value,value:o}}}};Ya.create=(t,e,a)=>new Ya({valueType:e,keyType:t,typeName:x.ZodMap,...j(a)});var Ha=class Mr extends Z{_parse(e){let{status:a,ctx:r}=this._processInputParams(e);if(r.parsedType!==T.set)return C(r,{code:y.invalid_type,expected:T.set,received:r.parsedType}),N;let s=this._def;s.minSize!==null&&r.data.size<s.minSize.value&&(C(r,{code:y.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),a.dirty()),s.maxSize!==null&&r.data.size>s.maxSize.value&&(C(r,{code:y.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),a.dirty());let n=this._def.valueType;function o(l){let d=new Set;for(let u of l){if(u.status==="aborted")return N;u.status==="dirty"&&a.dirty(),d.add(u.value)}return{status:a.value,value:d}}let i=[...r.data.values()].map((l,d)=>n._parse(new De(r,l,r.path,d)));return r.common.async?Promise.all(i).then(l=>o(l)):o(i)}min(e,a){return new Mr({...this._def,minSize:{value:e,message:E.toString(a)}})}max(e,a){return new Mr({...this._def,maxSize:{value:e,message:E.toString(a)}})}size(e,a){return this.min(e,a).max(e,a)}nonempty(e){return this.min(1,e)}};Ha.create=(t,e)=>new Ha({valueType:t,minSize:null,maxSize:null,typeName:x.ZodSet,...j(e)});var Vo=class Na extends Z{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:a}=this._processInputParams(e);if(a.parsedType!==T.function)return C(a,{code:y.invalid_type,expected:T.function,received:a.parsedType}),N;function r(i,l){return Da({data:i,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,La(),Zt].filter(d=>!!d),issueData:{code:y.invalid_arguments,argumentsError:l}})}function s(i,l){return Da({data:i,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,La(),Zt].filter(d=>!!d),issueData:{code:y.invalid_return_type,returnTypeError:l}})}let n={errorMap:a.common.contextualErrorMap},o=a.data;if(this._def.returns instanceof $t){let i=this;return ye(async function(...l){let d=new Le([]),u=await i._def.args.parseAsync(l,n).catch(g=>{throw d.addIssue(r(l,g)),d}),p=await Reflect.apply(o,this,u);return await i._def.returns._def.type.parseAsync(p,n).catch(g=>{throw d.addIssue(s(p,g)),d})})}else{let i=this;return ye(function(...l){let d=i._def.args.safeParse(l,n);if(!d.success)throw new Le([r(l,d.error)]);let u=Reflect.apply(o,this,d.data),p=i._def.returns.safeParse(u,n);if(!p.success)throw new Le([s(u,p.error)]);return p.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new Na({...this._def,args:pt.create(e).rest(Ct.create())})}returns(e){return new Na({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,a,r){return new Na({args:e||pt.create([]).rest(Ct.create()),returns:a||Ct.create(),typeName:x.ZodFunction,...j(r)})}},ca=class extends Z{get schema(){return this._def.getter()}_parse(t){let{ctx:e}=this._processInputParams(t);return this._def.getter()._parse({data:e.data,path:e.path,parent:e})}};ca.create=(t,e)=>new ca({getter:t,typeName:x.ZodLazy,...j(e)});var pa=class extends Z{_parse(t){if(t.data!==this._def.value){let e=this._getOrReturnCtx(t);return C(e,{received:e.data,code:y.invalid_literal,expected:this._def.value}),N}return{status:"valid",value:t.data}}get value(){return this._def.value}};pa.create=(t,e)=>new pa({value:t,typeName:x.ZodLiteral,...j(e)});function vs(t,e){return new ma({values:t,typeName:x.ZodEnum,...j(e)})}var ma=class jr extends Z{_parse(e){if(typeof e.data!="string"){let a=this._getOrReturnCtx(e),r=this._def.values;return C(a,{expected:U.joinValues(r),received:a.parsedType,code:y.invalid_type}),N}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let a=this._getOrReturnCtx(e),r=this._def.values;return C(a,{received:a.data,code:y.invalid_enum_value,options:r}),N}return ye(e.data)}get options(){return this._def.values}get enum(){let e={};for(let a of this._def.values)e[a]=a;return e}get Values(){let e={};for(let a of this._def.values)e[a]=a;return e}get Enum(){let e={};for(let a of this._def.values)e[a]=a;return e}extract(e,a=this._def){return jr.create(e,{...this._def,...a})}exclude(e,a=this._def){return jr.create(this.options.filter(r=>!e.includes(r)),{...this._def,...a})}};ma.create=vs;var ha=class extends Z{_parse(t){let e=U.getValidEnumValues(this._def.values),a=this._getOrReturnCtx(t);if(a.parsedType!==T.string&&a.parsedType!==T.number){let r=U.objectValues(e);return C(a,{expected:U.joinValues(r),received:a.parsedType,code:y.invalid_type}),N}if(this._cache||(this._cache=new Set(U.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){let r=U.objectValues(e);return C(a,{received:a.data,code:y.invalid_enum_value,options:r}),N}return ye(t.data)}get enum(){return this._def.values}};ha.create=(t,e)=>new ha({values:t,typeName:x.ZodNativeEnum,...j(e)});var $t=class extends Z{unwrap(){return this._def.type}_parse(t){let{ctx:e}=this._processInputParams(t);return e.parsedType!==T.promise&&e.common.async===!1?(C(e,{code:y.invalid_type,expected:T.promise,received:e.parsedType}),N):ye((e.parsedType===T.promise?e.data:Promise.resolve(e.data)).then(a=>this._def.type.parseAsync(a,{path:e.path,errorMap:e.common.contextualErrorMap})))}};$t.create=(t,e)=>new $t({type:t,typeName:x.ZodPromise,...j(e)});var Ke=class extends Z{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===x.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){let{status:e,ctx:a}=this._processInputParams(t),r=this._def.effect||null,s={addIssue:n=>{C(a,n),n.fatal?e.abort():e.dirty()},get path(){return a.path}};if(s.addIssue=s.addIssue.bind(s),r.type==="preprocess"){let n=r.transform(a.data,s);if(a.common.async)return Promise.resolve(n).then(async o=>{if(e.value==="aborted")return N;let i=await this._def.schema._parseAsync({data:o,path:a.path,parent:a});return i.status==="aborted"?N:i.status==="dirty"||e.value==="dirty"?Fa(i.value):i});{if(e.value==="aborted")return N;let o=this._def.schema._parseSync({data:n,path:a.path,parent:a});return o.status==="aborted"?N:o.status==="dirty"||e.value==="dirty"?Fa(o.value):o}}if(r.type==="refinement"){let n=o=>{let i=r.refinement(o,s);if(a.common.async)return Promise.resolve(i);if(i instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(a.common.async===!1){let o=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});return o.status==="aborted"?N:(o.status==="dirty"&&e.dirty(),n(o.value),{status:e.value,value:o.value})}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(o=>o.status==="aborted"?N:(o.status==="dirty"&&e.dirty(),n(o.value).then(()=>({status:e.value,value:o.value}))))}if(r.type==="transform")if(a.common.async===!1){let n=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});if(!kt(n))return N;let o=r.transform(n.value,s);if(o instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:e.value,value:o}}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(n=>kt(n)?Promise.resolve(r.transform(n.value,s)).then(o=>({status:e.value,value:o})):N);U.assertNever(r)}};Ke.create=(t,e,a)=>new Ke({schema:t,typeName:x.ZodEffects,effect:e,...j(a)}),Ke.createWithPreprocess=(t,e,a)=>new Ke({schema:e,effect:{type:"preprocess",transform:t},typeName:x.ZodEffects,...j(a)});var Je=class extends Z{_parse(t){return this._getType(t)===T.undefined?ye(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};Je.create=(t,e)=>new Je({innerType:t,typeName:x.ZodOptional,...j(e)});var mt=class extends Z{_parse(t){return this._getType(t)===T.null?ye(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};mt.create=(t,e)=>new mt({innerType:t,typeName:x.ZodNullable,...j(e)});var fa=class extends Z{_parse(t){let{ctx:e}=this._processInputParams(t),a=e.data;return e.parsedType===T.undefined&&(a=this._def.defaultValue()),this._def.innerType._parse({data:a,path:e.path,parent:e})}removeDefault(){return this._def.innerType}};fa.create=(t,e)=>new fa({innerType:t,typeName:x.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...j(e)});var ga=class extends Z{_parse(t){let{ctx:e}=this._processInputParams(t),a={...e,common:{...e.common,issues:[]}},r=this._def.innerType._parse({data:a.data,path:a.path,parent:{...a}});return na(r)?r.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Le(a.common.issues)},input:a.data})})):{status:"valid",value:r.status==="valid"?r.value:this._def.catchValue({get error(){return new Le(a.common.issues)},input:a.data})}}removeCatch(){return this._def.innerType}};ga.create=(t,e)=>new ga({innerType:t,typeName:x.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...j(e)});var Ga=class extends Z{_parse(t){if(this._getType(t)!==T.nan){let e=this._getOrReturnCtx(t);return C(e,{code:y.invalid_type,expected:T.nan,received:e.parsedType}),N}return{status:"valid",value:t.data}}};Ga.create=t=>new Ga({typeName:x.ZodNaN,...j(t)});var _s=class extends Z{_parse(t){let{ctx:e}=this._processInputParams(t),a=e.data;return this._def.type._parse({data:a,path:e.path,parent:e})}unwrap(){return this._def.type}},bs=class Dn extends Z{_parse(e){let{status:a,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let s=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?N:s.status==="dirty"?(a.dirty(),Fa(s.value)):this._def.out._parseAsync({data:s.value,path:r.path,parent:r})})();{let s=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?N:s.status==="dirty"?(a.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:r.path,parent:r})}}static create(e,a){return new Dn({in:e,out:a,typeName:x.ZodPipeline})}},ya=class extends Z{_parse(t){let e=this._def.innerType._parse(t),a=r=>(kt(r)&&(r.value=Object.freeze(r.value)),r);return na(e)?e.then(r=>a(r)):a(e)}unwrap(){return this._def.innerType}};ya.create=(t,e)=>new ya({innerType:t,typeName:x.ZodReadonly,...j(e)}),Ae.lazycreate;var x;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(x||(x={})),ia.create,za.create,Ga.create,Ua.create,Va.create,Ba.create,Wa.create,oa.create,la.create,qa.create,Ct.create,nt.create,Ka.create,Tt.create,Ae.create,Ae.strictCreate,da.create,zo.create,ua.create,pt.create,Uo.create,Ya.create,Ha.create,Vo.create,ca.create,pa.create,ma.create,ha.create,$t.create,Ke.create,Je.create,mt.create,Ke.createWithPreprocess,bs.create;var Lt=({prefix:t,size:e=16,alphabet:a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{let s=()=>{let n=a.length,o=Array(e);for(let i=0;i<e;i++)o[i]=a[Math.random()*n|0];return o.join("")};if(t==null)return s;if(a.includes(r))throw new uo({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${a}".`});return()=>`${t}${r}${s()}`},Bo=Lt(),Wo=/"__proto__"\s*:/,qo=/"constructor"\s*:/;function Ko(t){let e=JSON.parse(t);return typeof e!="object"||!e||Wo.test(t)===!1&&qo.test(t)===!1?e:Jo(e)}function Jo(t){let e=[t];for(;e.length;){let a=e;e=[];for(let r of a){if(Object.prototype.hasOwnProperty.call(r,"__proto__")||Object.prototype.hasOwnProperty.call(r,"constructor")&&Object.prototype.hasOwnProperty.call(r.constructor,"prototype"))throw SyntaxError("Object contains forbidden prototype property");for(let s in r){let n=r[s];n&&typeof n=="object"&&e.push(n)}}}return t}function Yo(t){let{stackTraceLimit:e}=Error;Error.stackTraceLimit=0;try{return Ko(t)}finally{Error.stackTraceLimit=e}}var va=Symbol.for("vercel.ai.validator");function Ho(t){return{[va]:!0,validate:t}}function Go(t){return typeof t=="object"&&!!t&&va in t&&t[va]===!0&&"validate"in t}function Qo(t){return Go(t)?t:Xo(t)}function Xo(t){return Ho(async e=>{let a=await t["~standard"].validate(e);return a.issues==null?{success:!0,value:a.value}:{success:!1,error:new sa({value:e,cause:a.issues})}})}async function xs({value:t,schema:e}){let a=await Qa({value:t,schema:e});if(!a.success)throw sa.wrap({value:t,cause:a.error});return a.value}async function Qa({value:t,schema:e}){let a=Qo(e);try{if(a.validate==null)return{success:!0,value:t,rawValue:t};let r=await a.validate(t);return r.success?{success:!0,value:r.value,rawValue:t}:{success:!1,error:sa.wrap({value:t,cause:r.error}),rawValue:t}}catch(r){return{success:!1,error:sa.wrap({value:t,cause:r}),rawValue:t}}}async function _a({text:t,schema:e}){try{let a=Yo(t);return e==null?{success:!0,value:a,rawValue:a}:await Qa({value:a,schema:e})}catch(a){return{success:!1,error:os.isInstance(a)?a:new os({text:t,cause:a}),rawValue:void 0}}}function ws({stream:t,schema:e}){return t.pipeThrough(new TextDecoderStream).pipeThrough(new go).pipeThrough(new TransformStream({async transform({data:a},r){a!=="[DONE]"&&r.enqueue(await _a({text:a,schema:e}))}}))}async function Et(t){return typeof t=="function"&&(t=t()),Promise.resolve(t)}var el=(t,e)=>{let a=0;for(;a<t.length&&a<e.length&&t[a]===e[a];a++);return[(t.length-a).toString(),...e.slice(a)].join("/")},tl=Symbol("Let zodToJsonSchema decide on which parser to use"),ks={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",strictUnions:!1,definitions:{},errorMessages:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},al=t=>typeof t=="string"?{...ks,name:t}:{...ks,...t};function xe(){return{}}function rl(t,e){var r,s,n;let a={type:"array"};return(r=t.type)!=null&&r._def&&((n=(s=t.type)==null?void 0:s._def)==null?void 0:n.typeName)!==x.ZodAny&&(a.items=q(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&(a.minItems=t.minLength.value),t.maxLength&&(a.maxItems=t.maxLength.value),t.exactLength&&(a.minItems=t.exactLength.value,a.maxItems=t.exactLength.value),a}function sl(t){let e={type:"integer",format:"int64"};if(!t.checks)return e;for(let a of t.checks)switch(a.kind){case"min":a.inclusive?e.minimum=a.value:e.exclusiveMinimum=a.value;break;case"max":a.inclusive?e.maximum=a.value:e.exclusiveMaximum=a.value;break;case"multipleOf":e.multipleOf=a.value;break}return e}function nl(){return{type:"boolean"}}function Cs(t,e){return q(t.type._def,e)}var il=(t,e)=>q(t.innerType._def,e);function Ts(t,e,a){let r=a??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((s,n)=>Ts(t,e,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return ol(t)}}var ol=t=>{let e={type:"integer",format:"unix-time"};for(let a of t.checks)switch(a.kind){case"min":e.minimum=a.value;break;case"max":e.maximum=a.value;break}return e};function ll(t,e){return{...q(t.innerType._def,e),default:t.defaultValue()}}function dl(t,e){return e.effectStrategy==="input"?q(t.schema._def,e):xe()}function ul(t){return{type:"string",enum:Array.from(t.values)}}var cl=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function pl(t,e){let a=[q(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),q(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(s=>!!s),r=[];return a.forEach(s=>{if(cl(s))r.push(...s.allOf);else{let n=s;if("additionalProperties"in s&&s.additionalProperties===!1){let{additionalProperties:o,...i}=s;n=i}r.push(n)}}),r.length?{allOf:r}:void 0}function ml(t){let e=typeof t.value;return e!=="bigint"&&e!=="number"&&e!=="boolean"&&e!=="string"?{type:Array.isArray(t.value)?"array":"object"}:{type:e==="bigint"?"integer":e,const:t.value}}var Xa=void 0,Oe={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Xa===void 0&&(Xa=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Xa),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function Is(t,e){let a={type:"string"};if(t.checks)for(let r of t.checks)switch(r.kind){case"min":a.minLength=typeof a.minLength=="number"?Math.max(a.minLength,r.value):r.value;break;case"max":a.maxLength=typeof a.maxLength=="number"?Math.min(a.maxLength,r.value):r.value;break;case"email":switch(e.emailStrategy){case"format:email":Ne(a,"email",r.message,e);break;case"format:idn-email":Ne(a,"idn-email",r.message,e);break;case"pattern:zod":he(a,Oe.email,r.message,e);break}break;case"url":Ne(a,"uri",r.message,e);break;case"uuid":Ne(a,"uuid",r.message,e);break;case"regex":he(a,r.regex,r.message,e);break;case"cuid":he(a,Oe.cuid,r.message,e);break;case"cuid2":he(a,Oe.cuid2,r.message,e);break;case"startsWith":he(a,RegExp(`^${er(r.value,e)}`),r.message,e);break;case"endsWith":he(a,RegExp(`${er(r.value,e)}$`),r.message,e);break;case"datetime":Ne(a,"date-time",r.message,e);break;case"date":Ne(a,"date",r.message,e);break;case"time":Ne(a,"time",r.message,e);break;case"duration":Ne(a,"duration",r.message,e);break;case"length":a.minLength=typeof a.minLength=="number"?Math.max(a.minLength,r.value):r.value,a.maxLength=typeof a.maxLength=="number"?Math.min(a.maxLength,r.value):r.value;break;case"includes":he(a,RegExp(er(r.value,e)),r.message,e);break;case"ip":r.version!=="v6"&&Ne(a,"ipv4",r.message,e),r.version!=="v4"&&Ne(a,"ipv6",r.message,e);break;case"base64url":he(a,Oe.base64url,r.message,e);break;case"jwt":he(a,Oe.jwt,r.message,e);break;case"cidr":r.version!=="v6"&&he(a,Oe.ipv4Cidr,r.message,e),r.version!=="v4"&&he(a,Oe.ipv6Cidr,r.message,e);break;case"emoji":he(a,Oe.emoji(),r.message,e);break;case"ulid":he(a,Oe.ulid,r.message,e);break;case"base64":switch(e.base64Strategy){case"format:binary":Ne(a,"binary",r.message,e);break;case"contentEncoding:base64":a.contentEncoding="base64";break;case"pattern:zod":he(a,Oe.base64,r.message,e);break}break;case"nanoid":he(a,Oe.nanoid,r.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return a}function er(t,e){return e.patternStrategy==="escape"?fl(t):t}var hl=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function fl(t){let e="";for(let a=0;a<t.length;a++)hl.has(t[a])||(e+="\\"),e+=t[a];return e}function Ne(t,e,a,r){var s;t.format||(s=t.anyOf)!=null&&s.some(n=>n.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format}),delete t.format),t.anyOf.push({format:e,...a&&r.errorMessages&&{errorMessage:{format:a}}})):t.format=e}function he(t,e,a,r){var s;t.pattern||(s=t.allOf)!=null&&s.some(n=>n.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern}),delete t.pattern),t.allOf.push({pattern:Es(e,r),...a&&r.errorMessages&&{errorMessage:{pattern:a}}})):t.pattern=Es(e,r)}function Es(t,e){var l;if(!e.applyRegexFlags||!t.flags)return t.source;let a={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},r=a.i?t.source.toLowerCase():t.source,s="",n=!1,o=!1,i=!1;for(let d=0;d<r.length;d++){if(n){s+=r[d],n=!1;continue}if(a.i){if(o){if(r[d].match(/[a-z]/)){i?(s+=r[d],s+=`${r[d-2]}-${r[d]}`.toUpperCase(),i=!1):r[d+1]==="-"&&((l=r[d+2])!=null&&l.match(/[a-z]/))?(s+=r[d],i=!0):s+=`${r[d]}${r[d].toUpperCase()}`;continue}}else if(r[d].match(/[a-z]/)){s+=`[${r[d]}${r[d].toUpperCase()}]`;continue}}if(a.m){if(r[d]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(r[d]==="$"){s+=`($|(?=[\r
]))`;continue}}if(a.s&&r[d]==="."){s+=o?`${r[d]}\r
`:`[${r[d]}\r
]`;continue}s+=r[d],r[d]==="\\"?n=!0:o&&r[d]==="]"?o=!1:!o&&r[d]==="["&&(o=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return s}function Ss(t,e){var r,s,n,o,i;let a={type:"object",additionalProperties:q(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(((r=t.keyType)==null?void 0:r._def.typeName)===x.ZodString&&((s=t.keyType._def.checks)!=null&&s.length)){let{type:l,...d}=Is(t.keyType._def,e);return{...a,propertyNames:d}}else{if(((n=t.keyType)==null?void 0:n._def.typeName)===x.ZodEnum)return{...a,propertyNames:{enum:t.keyType._def.values}};if(((o=t.keyType)==null?void 0:o._def.typeName)===x.ZodBranded&&t.keyType._def.type._def.typeName===x.ZodString&&((i=t.keyType._def.type._def.checks)!=null&&i.length)){let{type:l,...d}=Cs(t.keyType._def,e);return{...a,propertyNames:d}}}return a}function gl(t,e){return e.mapStrategy==="record"?Ss(t,e):{type:"array",maxItems:125,items:{type:"array",items:[q(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||xe(),q(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||xe()],minItems:2,maxItems:2}}}function yl(t){let e=t.values,a=Object.keys(t.values).filter(s=>typeof e[e[s]]!="number").map(s=>e[s]),r=Array.from(new Set(a.map(s=>typeof s)));return{type:r.length===1?r[0]==="string"?"string":"number":["string","number"],enum:a}}function vl(){return{not:xe()}}function _l(){return{type:"null"}}var tr={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function bl(t,e){let a=t.options instanceof Map?Array.from(t.options.values()):t.options;if(a.every(r=>r._def.typeName in tr&&(!r._def.checks||!r._def.checks.length))){let r=a.reduce((s,n)=>{let o=tr[n._def.typeName];return o&&!s.includes(o)?[...s,o]:s},[]);return{type:r.length>1?r:r[0]}}else if(a.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){let r=a.reduce((s,n)=>{let o=typeof n._def.value;switch(o){case"string":case"number":case"boolean":return[...s,o];case"bigint":return[...s,"integer"];case"object":if(n._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(r.length===a.length){let s=r.filter((n,o,i)=>i.indexOf(n)===o);return{type:s.length>1?s:s[0],enum:a.reduce((n,o)=>n.includes(o._def.value)?n:[...n,o._def.value],[])}}}else if(a.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:a.reduce((r,s)=>[...r,...s._def.values.filter(n=>!r.includes(n))],[])};return xl(t,e)}var xl=(t,e)=>{let a=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((r,s)=>q(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return a.length?{anyOf:a}:void 0};function wl(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return{type:[tr[t.innerType._def.typeName],"null"]};let a=q(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return a&&{anyOf:[a,{type:"null"}]}}function kl(t){let e={type:"number"};if(!t.checks)return e;for(let a of t.checks)switch(a.kind){case"int":e.type="integer";break;case"min":a.inclusive?e.minimum=a.value:e.exclusiveMinimum=a.value;break;case"max":a.inclusive?e.maximum=a.value:e.exclusiveMaximum=a.value;break;case"multipleOf":e.multipleOf=a.value;break}return e}function Cl(t,e){let a={type:"object",properties:{}},r=[],s=t.shape();for(let o in s){let i=s[o];if(i===void 0||i._def===void 0)continue;let l=Il(i),d=q(i._def,{...e,currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]});d!==void 0&&(a.properties[o]=d,l||r.push(o))}r.length&&(a.required=r);let n=Tl(t,e);return n!==void 0&&(a.additionalProperties=n),a}function Tl(t,e){if(t.catchall._def.typeName!=="ZodNever")return q(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(t.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function Il(t){try{return t.isOptional()}catch{return!0}}var El=(t,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return q(t.innerType._def,e);let a=q(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return a?{anyOf:[{not:xe()},a]}:xe()},Sl=(t,e)=>{if(e.pipeStrategy==="input")return q(t.in._def,e);if(e.pipeStrategy==="output")return q(t.out._def,e);let a=q(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]});return{allOf:[a,q(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",a?"1":"0"]})].filter(r=>r!==void 0)}};function Al(t,e){return q(t.type._def,e)}function Ol(t,e){let a={type:"array",uniqueItems:!0,items:q(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&(a.minItems=t.minSize.value),t.maxSize&&(a.maxItems=t.maxSize.value),a}function Nl(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((a,r)=>q(a._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((a,r)=>r===void 0?a:[...a,r],[]),additionalItems:q(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((a,r)=>q(a._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((a,r)=>r===void 0?a:[...a,r],[])}}function Rl(){return{not:xe()}}function Ml(){return xe()}var jl=(t,e)=>q(t.innerType._def,e),Pl=(t,e,a)=>{switch(e){case x.ZodString:return Is(t,a);case x.ZodNumber:return kl(t);case x.ZodObject:return Cl(t,a);case x.ZodBigInt:return sl(t);case x.ZodBoolean:return nl();case x.ZodDate:return Ts(t,a);case x.ZodUndefined:return Rl();case x.ZodNull:return _l();case x.ZodArray:return rl(t,a);case x.ZodUnion:case x.ZodDiscriminatedUnion:return bl(t,a);case x.ZodIntersection:return pl(t,a);case x.ZodTuple:return Nl(t,a);case x.ZodRecord:return Ss(t,a);case x.ZodLiteral:return ml(t);case x.ZodEnum:return ul(t);case x.ZodNativeEnum:return yl(t);case x.ZodNullable:return wl(t,a);case x.ZodOptional:return El(t,a);case x.ZodMap:return gl(t,a);case x.ZodSet:return Ol(t,a);case x.ZodLazy:return()=>t.getter()._def;case x.ZodPromise:return Al(t,a);case x.ZodNaN:case x.ZodNever:return vl();case x.ZodEffects:return dl(t,a);case x.ZodAny:return xe();case x.ZodUnknown:return Ml();case x.ZodDefault:return ll(t,a);case x.ZodBranded:return Cs(t,a);case x.ZodReadonly:return jl(t,a);case x.ZodCatch:return il(t,a);case x.ZodPipeline:return Sl(t,a);case x.ZodFunction:case x.ZodVoid:case x.ZodSymbol:return;default:return(r=>{})(e)}};function q(t,e,a=!1){var i;let r=e.seen.get(t);if(e.override){let l=(i=e.override)==null?void 0:i.call(e,t,e,r,a);if(l!==tl)return l}if(r&&!a){let l=Zl(r,e);if(l!==void 0)return l}let s={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,s);let n=Pl(t,t.typeName,e),o=typeof n=="function"?q(n(),e):n;if(o&&$l(t,e,o),e.postProcess){let l=e.postProcess(o,t,e);return s.jsonSchema=o,l}return s.jsonSchema=o,o}var Zl=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"relative":return{$ref:el(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((a,r)=>e.currentPath[r]===a)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),xe()):e.$refStrategy==="seen"?xe():void 0}},$l=(t,e,a)=>(t.description&&(a.description=t.description),a),Ll=t=>{let e=al(t),a=e.name===void 0?e.basePath:[...e.basePath,e.definitionPath,e.name];return{...e,currentPath:a,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}},Dl=(t,e)=>{let a=Ll(e),r=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((l,[d,u])=>({...l,[d]:q(u._def,{...a,currentPath:[...a.basePath,a.definitionPath,d]},!0)??xe()}),{}):void 0,s=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,n=q(t._def,s===void 0?a:{...a,currentPath:[...a.basePath,a.definitionPath,s]},!1)??xe(),o=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;o!==void 0&&(n.title=o);let i=s===void 0?r?{...n,[a.definitionPath]:r}:n:{$ref:[...a.$refStrategy==="relative"?[]:a.basePath,a.definitionPath,s].join("/"),[a.definitionPath]:{...r,[s]:n}};return i.$schema="http://json-schema.org/draft-07/schema#",i};function Fl(t,e){return rr(Dl(t,{$refStrategy:(e==null?void 0:e.useReferences)??!1?"root":"none"}),{validate:async a=>{let r=await t.safeParseAsync(a);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}}})}function zl(t,e){return rr(zr(t,{target:"draft-7",io:"output",reused:(e==null?void 0:e.useReferences)??!1?"ref":"inline"}),{validate:async a=>{let r=await pi(t,a);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}}})}function Ul(t){return"_zod"in t}function Vl(t,e){return Ul(t)?zl(t,e):Fl(t,e)}var ar=Symbol.for("vercel.ai.schema");function rr(t,{validate:e}={}){return{[ar]:!0,_type:void 0,[va]:!0,jsonSchema:t,validate:e}}function Bl(t){return typeof t=="object"&&!!t&&ar in t&&t[ar]===!0&&"jsonSchema"in t&&"validate"in t}function Wl(t){return t==null?rr({properties:{},additionalProperties:!1}):Bl(t)?t:Vl(t)}var{btoa:dp,atob:up}=globalThis,ql=Object.defineProperty,Kl=(t,e)=>{for(var a in e)ql(t,a,{get:e[a],enumerable:!0})},As="AI_NoObjectGeneratedError",Os=`vercel.ai.error.${As}`,Jl=Symbol.for(Os),Ns,Rs=class extends rt{constructor({message:t="No object generated.",cause:e,text:a,response:r,usage:s,finishReason:n}){super({name:As,message:t,cause:e}),this[Ns]=!0,this.text=a,this.response=r,this.usage=s,this.finishReason=n}static isInstance(t){return rt.hasMarker(t,Os)}};Ns=Jl;var Ms=de([m(),ea(Uint8Array),ea(ArrayBuffer),ui(t=>{var e;return((e=globalThis.Buffer)==null?void 0:e.isBuffer(t))??!1},{message:"Must be a Buffer"})]),Dt=mi(()=>de([ci(),m(),_t(),ae(),Rt(m(),Dt),Ce(Dt)])),F=Rt(m(),Rt(m(),Dt)),js=I({type:k("text"),text:m(),providerOptions:F.optional()}),Yl=I({type:k("image"),image:de([Ms,ea(URL)]),mediaType:m().optional(),providerOptions:F.optional()}),Ps=I({type:k("file"),data:de([Ms,ea(URL)]),filename:m().optional(),mediaType:m(),providerOptions:F.optional()}),Hl=I({type:k("reasoning"),text:m(),providerOptions:F.optional()}),Gl=I({type:k("tool-call"),toolCallId:m(),toolName:m(),input:re(),providerOptions:F.optional(),providerExecuted:ae().optional()}),Ql=Ma("type",[I({type:k("text"),value:m()}),I({type:k("json"),value:Dt}),I({type:k("error-text"),value:m()}),I({type:k("error-json"),value:Dt}),I({type:k("content"),value:Ce(de([I({type:k("text"),text:m()}),I({type:k("media"),data:m(),mediaType:m()})]))})]),Zs=I({type:k("tool-result"),toolCallId:m(),toolName:m(),output:Ql,providerOptions:F.optional()});de([I({role:k("system"),content:m(),providerOptions:F.optional()}),I({role:k("user"),content:de([m(),Ce(de([js,Yl,Ps]))]),providerOptions:F.optional()}),I({role:k("assistant"),content:de([m(),Ce(de([js,Ps,Hl,Gl,Zs]))]),providerOptions:F.optional()}),I({role:k("tool"),content:Ce(Zs),providerOptions:F.optional()})]),Lt({prefix:"aitxt",size:24});var $s=de([H({type:k("text-start"),id:m(),providerMetadata:F.optional()}),H({type:k("text-delta"),id:m(),delta:m(),providerMetadata:F.optional()}),H({type:k("text-end"),id:m(),providerMetadata:F.optional()}),H({type:k("error"),errorText:m()}),H({type:k("tool-input-start"),toolCallId:m(),toolName:m(),providerExecuted:ae().optional(),dynamic:ae().optional()}),H({type:k("tool-input-delta"),toolCallId:m(),inputTextDelta:m()}),H({type:k("tool-input-available"),toolCallId:m(),toolName:m(),input:re(),providerExecuted:ae().optional(),providerMetadata:F.optional(),dynamic:ae().optional()}),H({type:k("tool-input-error"),toolCallId:m(),toolName:m(),input:re(),providerExecuted:ae().optional(),providerMetadata:F.optional(),dynamic:ae().optional(),errorText:m()}),H({type:k("tool-output-available"),toolCallId:m(),output:re(),providerExecuted:ae().optional(),dynamic:ae().optional(),preliminary:ae().optional()}),H({type:k("tool-output-error"),toolCallId:m(),errorText:m(),providerExecuted:ae().optional(),dynamic:ae().optional()}),H({type:k("reasoning"),text:m(),providerMetadata:F.optional()}),H({type:k("reasoning-start"),id:m(),providerMetadata:F.optional()}),H({type:k("reasoning-delta"),id:m(),delta:m(),providerMetadata:F.optional()}),H({type:k("reasoning-end"),id:m(),providerMetadata:F.optional()}),H({type:k("reasoning-part-finish")}),H({type:k("source-url"),sourceId:m(),url:m(),title:m().optional(),providerMetadata:F.optional()}),H({type:k("source-document"),sourceId:m(),mediaType:m(),title:m(),filename:m().optional(),providerMetadata:F.optional()}),H({type:k("file"),url:m(),mediaType:m(),providerMetadata:F.optional()}),H({type:m().startsWith("data-"),id:m().optional(),data:re(),transient:ae().optional()}),H({type:k("start-step")}),H({type:k("finish-step")}),H({type:k("start"),messageId:m().optional(),messageMetadata:re().optional()}),H({type:k("finish"),messageMetadata:re().optional()}),H({type:k("abort")}),H({type:k("message-metadata"),messageMetadata:re()})]);function Xl(t){return t.type.startsWith("data-")}function Ls(t,e){if(t===void 0&&e===void 0)return;if(t===void 0)return e;if(e===void 0)return t;let a={...t};for(let r in e)if(Object.prototype.hasOwnProperty.call(e,r)){let s=e[r];if(s===void 0)continue;let n=r in t?t[r]:void 0,o=typeof s=="object"&&!!s&&!Array.isArray(s)&&!(s instanceof Date)&&!(s instanceof RegExp),i=typeof n=="object"&&!!n&&!Array.isArray(n)&&!(n instanceof Date)&&!(n instanceof RegExp);o&&i?a[r]=Ls(n,s):a[r]=s}return a}function ed(t){let e=["ROOT"],a=-1,r=null;function s(l,d,u){switch(l){case'"':a=d,e.pop(),e.push(u),e.push("INSIDE_STRING");break;case"f":case"t":case"n":a=d,r=d,e.pop(),e.push(u),e.push("INSIDE_LITERAL");break;case"-":e.pop(),e.push(u),e.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=d,e.pop(),e.push(u),e.push("INSIDE_NUMBER");break;case"{":a=d,e.pop(),e.push(u),e.push("INSIDE_OBJECT_START");break;case"[":a=d,e.pop(),e.push(u),e.push("INSIDE_ARRAY_START");break}}function n(l,d){switch(l){case",":e.pop(),e.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":a=d,e.pop();break}}function o(l,d){switch(l){case",":e.pop(),e.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=d,e.pop();break}}for(let l=0;l<t.length;l++){let d=t[l];switch(e[e.length-1]){case"ROOT":s(d,l,"FINISH");break;case"INSIDE_OBJECT_START":switch(d){case'"':e.pop(),e.push("INSIDE_OBJECT_KEY");break;case"}":a=l,e.pop();break}break;case"INSIDE_OBJECT_AFTER_COMMA":switch(d){case'"':e.pop(),e.push("INSIDE_OBJECT_KEY");break}break;case"INSIDE_OBJECT_KEY":switch(d){case'"':e.pop(),e.push("INSIDE_OBJECT_AFTER_KEY");break}break;case"INSIDE_OBJECT_AFTER_KEY":switch(d){case":":e.pop(),e.push("INSIDE_OBJECT_BEFORE_VALUE");break}break;case"INSIDE_OBJECT_BEFORE_VALUE":s(d,l,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":n(d,l);break;case"INSIDE_STRING":switch(d){case'"':e.pop(),a=l;break;case"\\":e.push("INSIDE_STRING_ESCAPE");break;default:a=l}break;case"INSIDE_ARRAY_START":switch(d){case"]":a=l,e.pop();break;default:a=l,s(d,l,"INSIDE_ARRAY_AFTER_VALUE");break}break;case"INSIDE_ARRAY_AFTER_VALUE":switch(d){case",":e.pop(),e.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=l,e.pop();break;default:a=l;break}break;case"INSIDE_ARRAY_AFTER_COMMA":s(d,l,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":e.pop(),a=l;break;case"INSIDE_NUMBER":switch(d){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=l;break;case"e":case"E":case"-":case".":break;case",":e.pop(),e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&o(d,l),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&n(d,l);break;case"}":e.pop(),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&n(d,l);break;case"]":e.pop(),e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&o(d,l);break;default:e.pop();break}break;case"INSIDE_LITERAL":{let u=t.substring(r,l+1);!"false".startsWith(u)&&!"true".startsWith(u)&&!"null".startsWith(u)?(e.pop(),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?n(d,l):e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&o(d,l)):a=l;break}}}let i=t.slice(0,a+1);for(let l=e.length-1;l>=0;l--)switch(e[l]){case"INSIDE_STRING":i+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":i+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":i+="]";break;case"INSIDE_LITERAL":{let d=t.substring(r,t.length);"true".startsWith(d)?i+="true".slice(d.length):"false".startsWith(d)?i+="false".slice(d.length):"null".startsWith(d)&&(i+="null".slice(d.length))}}return i}async function Ds(t){if(t===void 0)return{value:void 0,state:"undefined-input"};let e=await _a({text:t});return e.success?{value:e.value,state:"successful-parse"}:(e=await _a({text:ed(t)}),e.success?{value:e.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}function ba(t){return t.type.startsWith("tool-")}function td(t){return t.type==="dynamic-tool"}function Fs(t){return ba(t)||td(t)}function zs(t){return t.type.split("-").slice(1).join("-")}function ad({lastMessage:t,messageId:e}){return{message:(t==null?void 0:t.role)==="assistant"?t:{id:e,metadata:void 0,role:"assistant",parts:[]},activeTextParts:{},activeReasoningParts:{},partialToolCalls:{}}}function rd({stream:t,messageMetadataSchema:e,dataPartSchemas:a,runUpdateMessageJob:r,onError:s,onToolCall:n,onData:o}){return t.pipeThrough(new TransformStream({async transform(i,l){await r(async({state:d,write:u})=>{function p(c){let h=d.message.parts.filter(ba).find(_=>_.toolCallId===c);if(h==null)throw Error("tool-output-error must be preceded by a tool-input-available");return h}function g(c){let h=d.message.parts.filter(_=>_.type==="dynamic-tool").find(_=>_.toolCallId===c);if(h==null)throw Error("tool-output-error must be preceded by a tool-input-available");return h}function v(c){let h=d.message.parts.find(A=>ba(A)&&A.toolCallId===c.toolCallId),_=c,w=h;h==null?d.message.parts.push({type:`tool-${c.toolName}`,toolCallId:c.toolCallId,state:c.state,input:_.input,output:_.output,rawInput:_.rawInput,errorText:_.errorText,providerExecuted:_.providerExecuted,preliminary:_.preliminary,..._.providerMetadata==null?{}:{callProviderMetadata:_.providerMetadata}}):(h.state=c.state,w.input=_.input,w.output=_.output,w.errorText=_.errorText,w.rawInput=_.rawInput,w.preliminary=_.preliminary,w.providerExecuted=_.providerExecuted??h.providerExecuted,_.providerMetadata!=null&&h.state==="input-available"&&(h.callProviderMetadata=_.providerMetadata))}function b(c){let h=d.message.parts.find(A=>A.type==="dynamic-tool"&&A.toolCallId===c.toolCallId),_=c,w=h;h==null?d.message.parts.push({type:"dynamic-tool",toolName:c.toolName,toolCallId:c.toolCallId,state:c.state,input:_.input,output:_.output,errorText:_.errorText,preliminary:_.preliminary,..._.providerMetadata==null?{}:{callProviderMetadata:_.providerMetadata}}):(h.state=c.state,w.toolName=c.toolName,w.input=_.input,w.output=_.output,w.errorText=_.errorText,w.rawInput=_.rawInput??w.rawInput,w.preliminary=_.preliminary,_.providerMetadata!=null&&h.state==="input-available"&&(h.callProviderMetadata=_.providerMetadata))}async function f(c){if(c!=null){let h=d.message.metadata==null?c:Ls(d.message.metadata,c);e!=null&&await xs({value:h,schema:e}),d.message.metadata=h}}switch(i.type){case"text-start":{let c={type:"text",text:"",providerMetadata:i.providerMetadata,state:"streaming"};d.activeTextParts[i.id]=c,d.message.parts.push(c),u();break}case"text-delta":{let c=d.activeTextParts[i.id];c.text+=i.delta,c.providerMetadata=i.providerMetadata??c.providerMetadata,u();break}case"text-end":{let c=d.activeTextParts[i.id];c.state="done",c.providerMetadata=i.providerMetadata??c.providerMetadata,delete d.activeTextParts[i.id],u();break}case"reasoning-start":{let c={type:"reasoning",text:"",providerMetadata:i.providerMetadata,state:"streaming"};d.activeReasoningParts[i.id]=c,d.message.parts.push(c),u();break}case"reasoning-delta":{let c=d.activeReasoningParts[i.id];c.text+=i.delta,c.providerMetadata=i.providerMetadata??c.providerMetadata,u();break}case"reasoning-end":{let c=d.activeReasoningParts[i.id];c.providerMetadata=i.providerMetadata??c.providerMetadata,c.state="done",delete d.activeReasoningParts[i.id],u();break}case"file":d.message.parts.push({type:"file",mediaType:i.mediaType,url:i.url}),u();break;case"source-url":d.message.parts.push({type:"source-url",sourceId:i.sourceId,url:i.url,title:i.title,providerMetadata:i.providerMetadata}),u();break;case"source-document":d.message.parts.push({type:"source-document",sourceId:i.sourceId,mediaType:i.mediaType,title:i.title,filename:i.filename,providerMetadata:i.providerMetadata}),u();break;case"tool-input-start":{let c=d.message.parts.filter(ba);d.partialToolCalls[i.toolCallId]={text:"",toolName:i.toolName,index:c.length,dynamic:i.dynamic},i.dynamic?b({toolCallId:i.toolCallId,toolName:i.toolName,state:"input-streaming",input:void 0}):v({toolCallId:i.toolCallId,toolName:i.toolName,state:"input-streaming",input:void 0,providerExecuted:i.providerExecuted}),u();break}case"tool-input-delta":{let c=d.partialToolCalls[i.toolCallId];c.text+=i.inputTextDelta;let{value:h}=await Ds(c.text);c.dynamic?b({toolCallId:i.toolCallId,toolName:c.toolName,state:"input-streaming",input:h}):v({toolCallId:i.toolCallId,toolName:c.toolName,state:"input-streaming",input:h}),u();break}case"tool-input-available":i.dynamic?b({toolCallId:i.toolCallId,toolName:i.toolName,state:"input-available",input:i.input,providerMetadata:i.providerMetadata}):v({toolCallId:i.toolCallId,toolName:i.toolName,state:"input-available",input:i.input,providerExecuted:i.providerExecuted,providerMetadata:i.providerMetadata}),u(),n&&!i.providerExecuted&&await n({toolCall:i});break;case"tool-input-error":i.dynamic?b({toolCallId:i.toolCallId,toolName:i.toolName,state:"output-error",input:i.input,errorText:i.errorText,providerMetadata:i.providerMetadata}):v({toolCallId:i.toolCallId,toolName:i.toolName,state:"output-error",input:void 0,rawInput:i.input,errorText:i.errorText,providerExecuted:i.providerExecuted,providerMetadata:i.providerMetadata}),u();break;case"tool-output-available":if(i.dynamic){let c=g(i.toolCallId);b({toolCallId:i.toolCallId,toolName:c.toolName,state:"output-available",input:c.input,output:i.output,preliminary:i.preliminary})}else{let c=p(i.toolCallId);v({toolCallId:i.toolCallId,toolName:zs(c),state:"output-available",input:c.input,output:i.output,providerExecuted:i.providerExecuted,preliminary:i.preliminary})}u();break;case"tool-output-error":if(i.dynamic){let c=g(i.toolCallId);b({toolCallId:i.toolCallId,toolName:c.toolName,state:"output-error",input:c.input,errorText:i.errorText})}else{let c=p(i.toolCallId);v({toolCallId:i.toolCallId,toolName:zs(c),state:"output-error",input:c.input,rawInput:c.rawInput,errorText:i.errorText})}u();break;case"start-step":d.message.parts.push({type:"step-start"});break;case"finish-step":d.activeTextParts={},d.activeReasoningParts={};break;case"start":i.messageId!=null&&(d.message.id=i.messageId),await f(i.messageMetadata),(i.messageId!=null||i.messageMetadata!=null)&&u();break;case"finish":await f(i.messageMetadata),i.messageMetadata!=null&&u();break;case"message-metadata":await f(i.messageMetadata),i.messageMetadata!=null&&u();break;case"error":s==null||s(Error(i.errorText));break;default:if(Xl(i)){(a==null?void 0:a[i.type])!=null&&await xs({value:i.data,schema:a[i.type]});let c=i;if(c.transient){o==null||o(c);break}let h=c.id==null?void 0:d.message.parts.find(_=>c.type===_.type&&c.id===_.id);h==null?d.message.parts.push(c):h.data=c.data,o==null||o(c),u()}}l.enqueue(i)})}}))}async function Us({stream:t,onError:e}){let a=t.getReader();try{for(;;){let{done:r}=await a.read();if(r)break}}catch(r){e==null||e(r)}finally{a.releaseLock()}}Lt({prefix:"aitxt",size:24}),Lt({prefix:"aiobj",size:24});var sd=class{constructor(){this.queue=[],this.isProcessing=!1}async processQueue(){if(!this.isProcessing){for(this.isProcessing=!0;this.queue.length>0;)await this.queue[0](),this.queue.shift();this.isProcessing=!1}}async run(t){return new Promise((e,a)=>{this.queue.push(async()=>{try{await t(),e()}catch(r){a(r)}}),this.processQueue()})}};Lt({prefix:"aiobj",size:24}),Kl({},{object:()=>id,text:()=>nd});var nd=()=>({type:"text",responseFormat:{type:"text"},async parsePartial({text:t}){return{partial:t}},async parseOutput({text:t}){return t}}),id=({schema:t})=>{let e=Wl(t);return{type:"object",responseFormat:{type:"json",schema:e.jsonSchema},async parsePartial({text:a}){let r=await Ds(a);switch(r.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:r.value};default:{let s=r.state;throw Error(`Unsupported parse state: ${s}`)}}},async parseOutput({text:a},r){let s=await _a({text:a});if(!s.success)throw new Rs({message:"No object generated: could not parse the response.",cause:s.error,text:a,response:r.response,usage:r.usage,finishReason:r.finishReason});let n=await Qa({value:s.value,schema:e});if(!n.success)throw new Rs({message:"No object generated: response did not match schema.",cause:n.error,text:a,response:r.response,usage:r.usage,finishReason:r.finishReason});return n.value}}},od=bt({name:m(),version:m()}),sr=bt({_meta:le(I({}).loose())}),Ft=sr,ld=I({method:m(),params:le(sr)}),dd=bt({experimental:le(I({}).loose()),logging:le(I({}).loose()),prompts:le(bt({listChanged:le(ae())})),resources:le(bt({subscribe:le(ae()),listChanged:le(ae())})),tools:le(bt({listChanged:le(ae())}))});Ft.extend({protocolVersion:m(),capabilities:dd,serverInfo:od,instructions:le(m())});var ud=Ft.extend({nextCursor:le(m())}),cd=I({name:m(),description:le(m()),inputSchema:I({type:k("object"),properties:le(I({}).loose())}).loose()}).loose();ud.extend({tools:Ce(cd)});var pd=I({type:k("text"),text:m()}).loose(),md=I({type:k("image"),data:Ur(),mimeType:m()}).loose(),Vs=I({uri:m(),mimeType:le(m())}).loose(),hd=Vs.extend({text:m()}),fd=Vs.extend({blob:Ur()}),gd=I({type:k("resource"),resource:de([hd,fd])}).loose();Ft.extend({content:Ce(de([pd,md,gd])),isError:ae().default(!1).optional()}).or(Ft.extend({toolResult:re()}));var xa="2.0",yd=I({jsonrpc:k(xa),id:de([m(),_t().int()])}).merge(ld).strict(),vd=I({jsonrpc:k(xa),id:de([m(),_t().int()]),result:Ft}).strict(),_d=I({jsonrpc:k(xa),id:de([m(),_t().int()]),error:I({code:_t().int(),message:m(),data:le(re())})}).strict();de([yd,I({jsonrpc:k(xa)}).merge(I({method:m(),params:le(sr)})).strict(),vd,_d]);async function bd({stream:t,onTextPart:e}){let a=t.pipeThrough(new TextDecoderStream).getReader();for(;;){let{done:r,value:s}=await a.read();if(r)break;await e(s)}}var xd=()=>fetch;async function wd({api:t,prompt:e,credentials:a,headers:r,body:s,streamProtocol:n="data",setCompletion:o,setLoading:i,setError:l,setAbortController:d,onFinish:u,onError:p,fetch:g=xd()}){try{i(!0),l(void 0);let v=new AbortController;d(v),o("");let b=await g(t,{method:"POST",body:JSON.stringify({prompt:e,...s}),credentials:a,headers:{"Content-Type":"application/json",...r},signal:v.signal}).catch(c=>{throw c});if(!b.ok)throw Error(await b.text()??"Failed to fetch the chat response.");if(!b.body)throw Error("The response body is empty.");let f="";switch(n){case"text":await bd({stream:b.body,onTextPart:c=>{f+=c,o(f)}});break;case"data":await Us({stream:ws({stream:b.body,schema:$s}).pipeThrough(new TransformStream({async transform(c){if(!c.success)throw c.error;let h=c.value;if(h.type==="text-delta")f+=h.delta,o(f);else if(h.type==="error")throw Error(h.errorText)}})),onError:c=>{throw c}});break;default:throw Error(`Unknown stream protocol: ${n}`)}return u&&u(e,f),d(null),f}catch(v){if(v.name==="AbortError")return d(null),null;v instanceof Error&&p&&p(v),l(v)}finally{i(!1)}}async function kd(t){if(t==null)return[];if(!globalThis.FileList||!(t instanceof globalThis.FileList))throw Error("FileList is not supported in the current environment");return Promise.all(Array.from(t).map(async e=>{let{name:a,type:r}=e;return{type:"file",mediaType:r,filename:a,url:await new Promise((s,n)=>{let o=new FileReader;o.onload=i=>{var l;s((l=i.target)==null?void 0:l.result)},o.onerror=i=>n(i),o.readAsDataURL(e)})}}))}var Cd=class{constructor({api:t="/api/chat",credentials:e,headers:a,body:r,fetch:s,prepareSendMessagesRequest:n,prepareReconnectToStreamRequest:o}){this.api=t,this.credentials=e,this.headers=a,this.body=r,this.fetch=s,this.prepareSendMessagesRequest=n,this.prepareReconnectToStreamRequest=o}async sendMessages({abortSignal:t,...e}){var p;let a=await Et(this.body),r=await Et(this.headers),s=await Et(this.credentials),n=await((p=this.prepareSendMessagesRequest)==null?void 0:p.call(this,{api:this.api,id:e.chatId,messages:e.messages,body:{...a,...e.body},headers:{...r,...e.headers},credentials:s,requestMetadata:e.metadata,trigger:e.trigger,messageId:e.messageId})),o=(n==null?void 0:n.api)??this.api,i=(n==null?void 0:n.headers)===void 0?{...r,...e.headers}:n.headers,l=(n==null?void 0:n.body)===void 0?{...a,...e.body,id:e.chatId,messages:e.messages,trigger:e.trigger,messageId:e.messageId}:n.body,d=(n==null?void 0:n.credentials)??s,u=await(this.fetch??globalThis.fetch)(o,{method:"POST",headers:{"Content-Type":"application/json",...i},body:JSON.stringify(l),credentials:d,signal:t});if(!u.ok)throw Error(await u.text()??"Failed to fetch the chat response.");if(!u.body)throw Error("The response body is empty.");return this.processResponseStream(u.body)}async reconnectToStream(t){var d;let e=await Et(this.body),a=await Et(this.headers),r=await Et(this.credentials),s=await((d=this.prepareReconnectToStreamRequest)==null?void 0:d.call(this,{api:this.api,id:t.chatId,body:{...e,...t.body},headers:{...a,...t.headers},credentials:r,requestMetadata:t.metadata})),n=(s==null?void 0:s.api)??`${this.api}/${t.chatId}/stream`,o=(s==null?void 0:s.headers)===void 0?{...a,...t.headers}:s.headers,i=(s==null?void 0:s.credentials)??r,l=await(this.fetch??globalThis.fetch)(n,{method:"GET",headers:o,credentials:i});if(l.status===204)return null;if(!l.ok)throw Error(await l.text()??"Failed to fetch the chat response.");if(!l.body)throw Error("The response body is empty.");return this.processResponseStream(l.body)}},nr=class extends Cd{constructor(t={}){super(t)}processResponseStream(t){return ws({stream:t,schema:$s}).pipeThrough(new TransformStream({async transform(e,a){if(!e.success)throw e.error;a.enqueue(e.value)}}))}},Td=class{constructor({generateId:t=Bo,id:e=t(),transport:a=new nr,messageMetadataSchema:r,dataPartSchemas:s,state:n,onError:o,onToolCall:i,onFinish:l,onData:d,sendAutomaticallyWhen:u}){this.activeResponse=void 0,this.jobExecutor=new sd,this.sendMessage=async(p,g)=>{var b;if(p==null){await this.makeRequest({trigger:"submit-message",messageId:(b=this.lastMessage)==null?void 0:b.id,...g});return}let v;if(v="text"in p||"files"in p?{parts:[...Array.isArray(p.files)?p.files:await kd(p.files),..."text"in p&&p.text!=null?[{type:"text",text:p.text}]:[]]}:p,p.messageId!=null){let f=this.state.messages.findIndex(c=>c.id===p.messageId);if(f===-1)throw Error(`message with id ${p.messageId} not found`);if(this.state.messages[f].role!=="user")throw Error(`message with id ${p.messageId} is not a user message`);this.state.messages=this.state.messages.slice(0,f+1),this.state.replaceMessage(f,{...v,id:p.messageId,role:v.role??"user",metadata:p.metadata})}else this.state.pushMessage({...v,id:v.id??this.generateId(),role:v.role??"user",metadata:p.metadata});await this.makeRequest({trigger:"submit-message",messageId:p.messageId,...g})},this.regenerate=async({messageId:p,...g}={})=>{let v=p==null?this.state.messages.length-1:this.state.messages.findIndex(b=>b.id===p);if(v===-1)throw Error(`message ${p} not found`);this.state.messages=this.state.messages.slice(0,this.messages[v].role==="assistant"?v:v+1),await this.makeRequest({trigger:"regenerate-message",messageId:p,...g})},this.resumeStream=async(p={})=>{await this.makeRequest({trigger:"resume-stream",...p})},this.clearError=()=>{this.status==="error"&&(this.state.error=void 0,this.setStatus({status:"ready"}))},this.addToolResult=async({tool:p,toolCallId:g,output:v})=>this.jobExecutor.run(async()=>{var c,h;let b=this.state.messages,f=b[b.length-1];this.state.replaceMessage(b.length-1,{...f,parts:f.parts.map(_=>Fs(_)&&_.toolCallId===g?{..._,state:"output-available",output:v}:_)}),this.activeResponse&&(this.activeResponse.state.message.parts=this.activeResponse.state.message.parts.map(_=>Fs(_)&&_.toolCallId===g?{..._,state:"output-available",output:v,errorText:void 0}:_)),this.status!=="streaming"&&this.status!=="submitted"&&((c=this.sendAutomaticallyWhen)!=null&&c.call(this,{messages:this.state.messages}))&&this.makeRequest({trigger:"submit-message",messageId:(h=this.lastMessage)==null?void 0:h.id})}),this.stop=async()=>{var p;this.status!=="streaming"&&this.status!=="submitted"||(p=this.activeResponse)!=null&&p.abortController&&this.activeResponse.abortController.abort()},this.id=e,this.transport=a,this.generateId=t,this.messageMetadataSchema=r,this.dataPartSchemas=s,this.state=n,this.onError=o,this.onToolCall=i,this.onFinish=l,this.onData=d,this.sendAutomaticallyWhen=u}get status(){return this.state.status}setStatus({status:t,error:e}){this.status!==t&&(this.state.status=t,this.state.error=e)}get error(){return this.state.error}get messages(){return this.state.messages}get lastMessage(){return this.state.messages[this.state.messages.length-1]}set messages(t){this.state.messages=t}async makeRequest({trigger:t,metadata:e,headers:a,body:r,messageId:s}){var u,p;var n;this.setStatus({status:"submitted",error:void 0});let o=this.lastMessage,i=!1,l=!1,d=!1;try{let g={state:ad({lastMessage:this.state.snapshot(o),messageId:this.generateId()}),abortController:new AbortController};g.abortController.signal.addEventListener("abort",()=>{i=!0}),this.activeResponse=g;let v;if(t==="resume-stream"){let b=await this.transport.reconnectToStream({chatId:this.id,metadata:e,headers:a,body:r});if(b==null){this.setStatus({status:"ready"});return}v=b}else v=await this.transport.sendMessages({chatId:this.id,messages:this.state.messages,abortSignal:g.abortController.signal,metadata:e,headers:a,body:r,trigger:t,messageId:s});await Us({stream:rd({stream:v,onToolCall:this.onToolCall,onData:this.onData,messageMetadataSchema:this.messageMetadataSchema,dataPartSchemas:this.dataPartSchemas,runUpdateMessageJob:b=>this.jobExecutor.run(()=>b({state:g.state,write:()=>{var f;this.setStatus({status:"streaming"}),g.state.message.id===((f=this.lastMessage)==null?void 0:f.id)?this.state.replaceMessage(this.state.messages.length-1,g.state.message):this.state.pushMessage(g.state.message)}})),onError:b=>{throw b}}),onError:b=>{throw b}}),this.setStatus({status:"ready"})}catch(g){if(i||g.name==="AbortError")return i=!0,this.setStatus({status:"ready"}),null;d=!0,g instanceof TypeError&&(g.message.toLowerCase().includes("fetch")||g.message.toLowerCase().includes("network"))&&(l=!0),this.onError&&g instanceof Error&&this.onError(g),this.setStatus({status:"error",error:g})}finally{try{(n=this.onFinish)==null||n.call(this,{message:this.activeResponse.state.message,messages:this.state.messages,isAbort:i,isDisconnect:l,isError:d})}catch(g){console.error(g)}this.activeResponse=void 0}(u=this.sendAutomaticallyWhen)!=null&&u.call(this,{messages:this.state.messages})&&await this.makeRequest({trigger:"submit-message",messageId:(p=this.lastMessage)==null?void 0:p.id,metadata:e,headers:a,body:r})}},Id=I({type:k("text"),text:m(),state:Xt(["streaming","done"]).optional(),providerMetadata:F.optional()}),Ed=I({type:k("reasoning"),text:m(),state:Xt(["streaming","done"]).optional(),providerMetadata:F.optional()}),Sd=I({type:k("source-url"),sourceId:m(),url:m(),title:m().optional(),providerMetadata:F.optional()}),Ad=I({type:k("source-document"),sourceId:m(),mediaType:m(),title:m(),filename:m().optional(),providerMetadata:F.optional()}),Od=I({type:k("file"),mediaType:m(),filename:m().optional(),url:m(),providerMetadata:F.optional()}),Nd=I({type:k("step-start")}),Rd=I({type:m().startsWith("data-"),id:m().optional(),data:re()}),Md=[I({type:k("dynamic-tool"),toolName:m(),toolCallId:m(),state:k("input-streaming"),input:re().optional(),output:ke().optional(),errorText:ke().optional()}),I({type:k("dynamic-tool"),toolName:m(),toolCallId:m(),state:k("input-available"),input:re(),output:ke().optional(),errorText:ke().optional(),callProviderMetadata:F.optional()}),I({type:k("dynamic-tool"),toolName:m(),toolCallId:m(),state:k("output-available"),input:re(),output:re(),errorText:ke().optional(),callProviderMetadata:F.optional(),preliminary:ae().optional()}),I({type:k("dynamic-tool"),toolName:m(),toolCallId:m(),state:k("output-error"),input:re(),output:ke().optional(),errorText:m(),callProviderMetadata:F.optional()})],jd=[I({type:m().startsWith("tool-"),toolCallId:m(),state:k("input-streaming"),input:re().optional(),output:ke().optional(),errorText:ke().optional()}),I({type:m().startsWith("tool-"),toolCallId:m(),state:k("input-available"),input:re(),output:ke().optional(),errorText:ke().optional(),callProviderMetadata:F.optional()}),I({type:m().startsWith("tool-"),toolCallId:m(),state:k("output-available"),input:re(),output:re(),errorText:ke().optional(),callProviderMetadata:F.optional(),preliminary:ae().optional()}),I({type:m().startsWith("tool-"),toolCallId:m(),state:k("output-error"),input:re(),output:ke().optional(),errorText:m(),callProviderMetadata:F.optional()})];I({id:m(),role:Xt(["system","user","assistant"]),metadata:re().optional(),parts:Ce(de([Id,Ed,Sd,Ad,Od,Nd,Rd,...Md,...jd]))});var Pd=Vn(((t,e)=>{function a(r,s){if(typeof r!="function")throw TypeError(`Expected the first argument to be a \`function\`, got \`${typeof r}\`.`);let n,o=0;return function(...i){clearTimeout(n);let l=Date.now(),d=s-(l-o);d<=0?(o=l,r.apply(this,i)):n=setTimeout(()=>{o=Date.now(),r.apply(this,i)},d)}}e.exports=a})),Bs=Object.prototype.hasOwnProperty;function ir(t,e){var a,r;if(t===e)return!0;if(t&&e&&(a=t.constructor)===e.constructor){if(a===Date)return t.getTime()===e.getTime();if(a===RegExp)return t.toString()===e.toString();if(a===Array){if((r=t.length)===e.length)for(;r--&&ir(t[r],e[r]););return r===-1}if(!a||typeof t=="object"){for(a in r=0,t)if(Bs.call(t,a)&&++r&&!Bs.call(e,a)||!(a in e)||!ir(t[a],e[a]))return!1;return Object.keys(e).length===r}}return t!==t&&e!==e}var R=ct(Kn(),1),Ye=new WeakMap,ht=()=>{},me=void 0,wa=Object,z=t=>t===me,Re=t=>typeof t=="function",He=(t,e)=>({...t,...e}),Ws=t=>Re(t.then),or={},ka={},lr="undefined",zt=typeof window!=lr,dr=typeof document!=lr,Zd=zt&&"Deno"in window,$d=()=>zt&&typeof window.requestAnimationFrame!=lr,qs=(t,e)=>{let a=Ye.get(t);return[()=>!z(e)&&t.get(e)||or,r=>{if(!z(e)){let s=t.get(e);e in ka||(ka[e]=s),a[5](e,He(s,r),s||or)}},a[6],()=>!z(e)&&e in ka?ka[e]:!z(e)&&t.get(e)||or]},ur=!0,Ld=()=>ur,[cr,pr]=zt&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[ht,ht],Dd=()=>{let t=dr&&document.visibilityState;return z(t)||t!=="hidden"},Fd=t=>(dr&&document.addEventListener("visibilitychange",t),cr("focus",t),()=>{dr&&document.removeEventListener("visibilitychange",t),pr("focus",t)}),zd=t=>{let e=()=>{ur=!0,t()},a=()=>{ur=!1};return cr("online",e),cr("offline",a),()=>{pr("online",e),pr("offline",a)}},Ud={isOnline:Ld,isVisible:Dd},Vd={initFocus:Fd,initReconnect:zd},Ks=!R.useId,Ut=!zt||Zd,Bd=t=>$d()?window.requestAnimationFrame(t):setTimeout(t,1),Ca=Ut?R.useEffect:R.useLayoutEffect,mr=typeof navigator<"u"&&navigator.connection,Js=!Ut&&mr&&(["slow-2g","2g"].includes(mr.effectiveType)||mr.saveData),Ta=new WeakMap,Wd=t=>wa.prototype.toString.call(t),hr=(t,e)=>t===`[object ${e}]`,qd=0,fr=t=>{let e=typeof t,a=Wd(t),r=hr(a,"Date"),s=hr(a,"RegExp"),n=hr(a,"Object"),o,i;if(wa(t)===t&&!r&&!s){if(o=Ta.get(t),o)return o;if(o=++qd+"~",Ta.set(t,o),Array.isArray(t)){for(o="@",i=0;i<t.length;i++)o+=fr(t[i])+",";Ta.set(t,o)}if(n){o="#";let l=wa.keys(t).sort();for(;!z(i=l.pop());)z(t[i])||(o+=i+":"+fr(t[i])+",");Ta.set(t,o)}}else o=r?t.toJSON():e=="symbol"?t.toString():e=="string"?JSON.stringify(t):""+t;return o},gr=t=>{if(Re(t))try{t=t()}catch{t=""}let e=t;return t=typeof t=="string"?t:(Array.isArray(t)?t.length:t)?fr(t):"",[t,e]},Kd=0,yr=()=>++Kd;async function Ys(...t){let[e,a,r,s]=t,n=He({populateCache:!0,throwOnError:!0},typeof s=="boolean"?{revalidate:s}:s||{}),o=n.populateCache,i=n.rollbackOnError,l=n.optimisticData,d=g=>typeof i=="function"?i(g):i!==!1,u=n.throwOnError;if(Re(a)){let g=a,v=[],b=e.keys();for(let f of b)!/^\$(inf|sub)\$/.test(f)&&g(e.get(f)._k)&&v.push(f);return Promise.all(v.map(p))}return p(a);async function p(g){let[v]=gr(g);if(!v)return;let[b,f]=qs(e,v),[c,h,_,w]=Ye.get(e),A=()=>{let Q=c[v];return(Re(n.revalidate)?n.revalidate(b().data,g):n.revalidate!==!1)&&(delete _[v],delete w[v],Q&&Q[0])?Q[0](2).then(()=>b().data):b().data};if(t.length<3)return A();let O=r,L,D=!1,M=yr();h[v]=[M,0];let Y=!z(l),$=b(),K=$.data,ee=$._c,se=z(ee)?K:ee;if(Y&&(l=Re(l)?l(se,K):l,f({data:l,_c:se})),Re(O))try{O=O(se)}catch(Q){L=Q,D=!0}if(O&&Ws(O))if(O=await O.catch(Q=>{L=Q,D=!0}),M!==h[v][0]){if(D)throw L;return O}else D&&Y&&d(L)&&(o=!0,f({data:se,_c:me}));if(o&&(D||(Re(o)?f({data:o(O,se),error:me,_c:me}):f({data:O,error:me,_c:me}))),h[v][1]=yr(),Promise.resolve(A()).then(()=>{f({_c:me})}),D){if(u)throw L;return}return O}}var Hs=(t,e)=>{for(let a in t)t[a][0]&&t[a][0](e)},Gs=(t,e)=>{if(!Ye.has(t)){let a=He(Vd,e),r=Object.create(null),s=Ys.bind(me,t),n=ht,o=Object.create(null),i=(u,p)=>{let g=o[u]||[];return o[u]=g,g.push(p),()=>g.splice(g.indexOf(p),1)},l=(u,p,g)=>{t.set(u,p);let v=o[u];if(v)for(let b of v)b(p,g)},d=()=>{if(!Ye.has(t)&&(Ye.set(t,[r,Object.create(null),Object.create(null),Object.create(null),s,l,i]),!Ut)){let u=a.initFocus(setTimeout.bind(me,Hs.bind(me,r,0))),p=a.initReconnect(setTimeout.bind(me,Hs.bind(me,r,1)));n=()=>{u&&u(),p&&p(),Ye.delete(t)}}};return d(),[t,s,d,n]}return[t,Ye.get(t)[4]]},Jd=(t,e,a,r,s)=>{let n=a.errorRetryCount,o=s.retryCount,i=~~((Math.random()+.5)*(1<<(o<8?o:8)))*a.errorRetryInterval;!z(n)&&o>n||setTimeout(r,i,s)},Yd=ir,[vr,Hd]=Gs(new Map),Qs=He({onLoadingSlow:ht,onSuccess:ht,onError:ht,onErrorRetry:Jd,onDiscarded:ht,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:Js?1e4:5e3,focusThrottleInterval:5*1e3,dedupingInterval:2*1e3,loadingTimeout:Js?5e3:3e3,compare:Yd,isPaused:()=>!1,cache:vr,mutate:Hd,fallback:{}},Ud),Xs=(t,e)=>{let a=He(t,e);if(e){let{use:r,fallback:s}=t,{use:n,fallback:o}=e;r&&n&&(a.use=r.concat(n)),s&&o&&(a.fallback=He(s,o))}return a},_r=(0,R.createContext)({}),Gd=t=>{let{value:e}=t,a=(0,R.useContext)(_r),r=Re(e),s=(0,R.useMemo)(()=>r?e(a):e,[r,a,e]),n=(0,R.useMemo)(()=>r?s:Xs(a,s),[r,a,s]),o=s&&s.provider,i=(0,R.useRef)(me);o&&!i.current&&(i.current=Gs(o(n.cache||vr),s));let l=i.current;return l&&(n.cache=l[0],n.mutate=l[1]),Ca(()=>{if(l)return l[2]&&l[2](),l[3]},[]),(0,R.createElement)(_r.Provider,He(t,{value:n}))},en=zt&&window.__SWR_DEVTOOLS_USE__,Qd=en?window.__SWR_DEVTOOLS_USE__:[],Xd=()=>{en&&(window.__SWR_DEVTOOLS_REACT__=R.default)},eu=t=>Re(t[1])?[t[0],t[1],t[2]||{}]:[t[0],null,(t[1]===null?t[2]:t[1])||{}],tu=()=>He(Qs,(0,R.useContext)(_r)),au=Qd.concat(t=>(e,a,r)=>t(e,a&&((...s)=>{let[n]=gr(e),[,,,o]=Ye.get(vr);if(n.startsWith("$inf$"))return a(...s);let i=o[n];return z(i)?a(...s):(delete o[n],i)}),r)),ru=t=>function(...e){let a=tu(),[r,s,n]=eu(e),o=Xs(a,n),i=t,{use:l}=o,d=(l||[]).concat(au);for(let u=d.length;u--;)i=d[u](i);return i(r,s||o.fetcher||null,o)},su=(t,e,a)=>{let r=e[t]||(e[t]=[]);return r.push(a),()=>{let s=r.indexOf(a);s>=0&&(r[s]=r[r.length-1],r.pop())}};Xd();var nu=ct(Ji(),1),br=R.use||(t=>{switch(t.status){case"pending":throw t;case"fulfilled":return t.value;case"rejected":throw t.reason;default:throw t.status="pending",t.then(e=>{t.status="fulfilled",t.value=e},e=>{t.status="rejected",t.reason=e}),t}}),xr={dedupe:!0},iu=(t,e,a)=>{let{cache:r,compare:s,suspense:n,fallbackData:o,revalidateOnMount:i,revalidateIfStale:l,refreshInterval:d,refreshWhenHidden:u,refreshWhenOffline:p,keepPreviousData:g}=a,[v,b,f,c]=Ye.get(r),[h,_]=gr(t),w=(0,R.useRef)(!1),A=(0,R.useRef)(!1),O=(0,R.useRef)(h),L=(0,R.useRef)(e),D=(0,R.useRef)(a),M=()=>D.current,Y=()=>M().isVisible()&&M().isOnline(),[$,K,ee,se]=qs(r,h),Q=(0,R.useRef)({}).current,J=z(o)?z(a.fallback)?me:a.fallback[h]:o,X=(W,V)=>{for(let ne in Q){let B=ne;if(B==="data"){if(!s(W[B],V[B])&&(!z(W[B])||!s(Ee,V[B])))return!1}else if(V[B]!==W[B])return!1}return!0},ce=(0,R.useMemo)(()=>{let W=!h||!e?!1:z(i)?M().isPaused()||n?!1:l!==!1:i,V=ie=>{let ve=He(ie);return delete ve._k,W?{isValidating:!0,isLoading:!0,...ve}:ve},ne=$(),B=se(),we=V(ne),ge=ne===B?we:V(B),oe=we;return[()=>{let ie=V($());return X(ie,oe)?(oe.data=ie.data,oe.isLoading=ie.isLoading,oe.isValidating=ie.isValidating,oe.error=ie.error,oe):(oe=ie,ie)},()=>ge]},[r,h]),te=(0,nu.useSyncExternalStore)((0,R.useCallback)(W=>ee(h,(V,ne)=>{X(ne,V)||W()}),[r,h]),ce[0],ce[1]),dt=!w.current,je=v[h]&&v[h].length>0,Ie=te.data,fe=z(Ie)?J&&Ws(J)?br(J):J:Ie,ze=te.error,Qe=(0,R.useRef)(fe),Ee=g?z(Ie)?z(Qe.current)?fe:Qe.current:Ie:fe,Ue=je&&!z(ze)?!1:dt&&!z(i)?i:M().isPaused()?!1:n?z(fe)?!1:l:z(fe)||l,Ve=!!(h&&e&&dt&&Ue),gt=z(te.isValidating)?Ve:te.isValidating,Nt=z(te.isLoading)?Ve:te.isLoading,Pe=(0,R.useCallback)(async W=>{let V=L.current;if(!h||!V||A.current||M().isPaused())return!1;let ne,B,we=!0,ge=W||{},oe=!f[h]||!ge.dedupe,ie=()=>Ks?!A.current&&h===O.current&&w.current:h===O.current,ve={isValidating:!1,isLoading:!1},We=()=>{K(ve)},ut=()=>{let pe=f[h];pe&&pe[1]===B&&delete f[h]},qe={isValidating:!0};z($().data)&&(qe.isLoading=!0);try{if(oe&&(K(qe),a.loadingTimeout&&z($().data)&&setTimeout(()=>{we&&ie()&&M().onLoadingSlow(h,a)},a.loadingTimeout),f[h]=[V(_),yr()]),[ne,B]=f[h],ne=await ne,oe&&setTimeout(ut,a.dedupingInterval),!f[h]||f[h][1]!==B)return oe&&ie()&&M().onDiscarded(h),!1;ve.error=me;let pe=b[h];if(!z(pe)&&(B<=pe[0]||B<=pe[1]||pe[1]===0))return We(),oe&&ie()&&M().onDiscarded(h),!1;let _e=$().data;ve.data=s(_e,ne)?_e:ne,oe&&ie()&&M().onSuccess(ne,h,a)}catch(pe){ut();let _e=M(),{shouldRetryOnError:Xe}=_e;_e.isPaused()||(ve.error=pe,oe&&ie()&&(_e.onError(pe,h,_e),(Xe===!0||Re(Xe)&&Xe(pe))&&(!M().revalidateOnFocus||!M().revalidateOnReconnect||Y())&&_e.onErrorRetry(pe,h,_e,et=>{let Ze=v[h];Ze&&Ze[0]&&Ze[0](3,et)},{retryCount:(ge.retryCount||0)+1,dedupe:!0})))}return we=!1,We(),!0},[h,r]),Be=(0,R.useCallback)((...W)=>Ys(r,O.current,...W),[]);if(Ca(()=>{L.current=e,D.current=a,z(Ie)||(Qe.current=Ie)}),Ca(()=>{if(!h)return;let W=Pe.bind(me,xr),V=0;M().revalidateOnFocus&&(V=Date.now()+M().focusThrottleInterval);let ne=su(h,v,(B,we={})=>{if(B==0){let ge=Date.now();M().revalidateOnFocus&&ge>V&&Y()&&(V=ge+M().focusThrottleInterval,W())}else if(B==1)M().revalidateOnReconnect&&Y()&&W();else{if(B==2)return Pe();if(B==3)return Pe(we)}});return A.current=!1,O.current=h,w.current=!0,K({_k:_}),Ue&&(f[h]||(z(fe)||Ut?W():Bd(W))),()=>{A.current=!0,ne()}},[h]),Ca(()=>{let W;function V(){let B=Re(d)?d($().data):d;B&&W!==-1&&(W=setTimeout(ne,B))}function ne(){!$().error&&(u||M().isVisible())&&(p||M().isOnline())?Pe(xr).then(V):V()}return V(),()=>{W&&(W=(clearTimeout(W),-1))}},[d,u,p,h]),(0,R.useDebugValue)(Ee),n&&z(fe)&&h){if(!Ks&&Ut)throw Error("Fallback data is required when using Suspense in SSR.");L.current=e,D.current=a,A.current=!1;let W=c[h];if(z(W)||br(Be(W)),z(ze)){let V=Pe(xr);z(Ee)||(V.status="fulfilled",V.value=!0),br(V)}else throw ze}return{mutate:Be,get data(){return Q.data=!0,Ee},get error(){return Q.error=!0,ze},get isValidating(){return Q.isValidating=!0,gt},get isLoading(){return Q.isLoading=!0,Nt}}};wa.defineProperty(Gd,"defaultValue",{value:Qs});var tn=ru(iu),ou=ct(Pd(),1),an=(t,e,a)=>{if(!e.has(t))throw TypeError("Cannot "+a)},G=(t,e,a)=>(an(t,e,"read from private field"),a?a.call(t):e.get(t)),Fe=(t,e,a)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,a)},ot=(t,e,a,r)=>(an(t,e,"write to private field"),r?r.call(t,a):e.set(t,a),a);function rn(t,e){return e==null?t:(0,ou.default)(t,e)}var Te,Ia,Ea,Vt,Bt,Wt,St,wr,kr,lu=class{constructor(t=[]){Fe(this,Te,void 0),Fe(this,Ia,"ready"),Fe(this,Ea,void 0),Fe(this,Vt,new Set),Fe(this,Bt,new Set),Fe(this,Wt,new Set),this.pushMessage=e=>{ot(this,Te,G(this,Te).concat(e)),G(this,St).call(this)},this.popMessage=()=>{ot(this,Te,G(this,Te).slice(0,-1)),G(this,St).call(this)},this.replaceMessage=(e,a)=>{ot(this,Te,[...G(this,Te).slice(0,e),this.snapshot(a),...G(this,Te).slice(e+1)]),G(this,St).call(this)},this.snapshot=e=>structuredClone(e),this["~registerMessagesCallback"]=(e,a)=>{let r=a?rn(e,a):e;return G(this,Vt).add(r),()=>{G(this,Vt).delete(r)}},this["~registerStatusCallback"]=e=>(G(this,Bt).add(e),()=>{G(this,Bt).delete(e)}),this["~registerErrorCallback"]=e=>(G(this,Wt).add(e),()=>{G(this,Wt).delete(e)}),Fe(this,St,()=>{G(this,Vt).forEach(e=>e())}),Fe(this,wr,()=>{G(this,Bt).forEach(e=>e())}),Fe(this,kr,()=>{G(this,Wt).forEach(e=>e())}),ot(this,Te,t)}get status(){return G(this,Ia)}set status(t){ot(this,Ia,t),G(this,wr).call(this)}get error(){return G(this,Ea)}set error(t){ot(this,Ea,t),G(this,kr).call(this)}get messages(){return G(this,Te)}set messages(t){ot(this,Te,[...t]),G(this,St).call(this)}};Te=new WeakMap,Ia=new WeakMap,Ea=new WeakMap,Vt=new WeakMap,Bt=new WeakMap,Wt=new WeakMap,St=new WeakMap,wr=new WeakMap,kr=new WeakMap;var At,sn=class extends Td{constructor({messages:t,...e}){let a=new lu(t);super({...e,state:a}),Fe(this,At,void 0),this["~registerMessagesCallback"]=(r,s)=>G(this,At)["~registerMessagesCallback"](r,s),this["~registerStatusCallback"]=r=>G(this,At)["~registerStatusCallback"](r),this["~registerErrorCallback"]=r=>G(this,At)["~registerErrorCallback"](r),ot(this,At,a)}};At=new WeakMap;function nn({experimental_throttle:t,resume:e=!1,...a}={}){let r=(0,R.useRef)("chat"in a?a.chat:new sn(a));("chat"in a&&a.chat!==r.current||"id"in a&&r.current.id!==a.id)&&(r.current="chat"in a?a.chat:new sn(a));let s=(0,R.useSyncExternalStore)((0,R.useCallback)(l=>r.current["~registerMessagesCallback"](l,t),[t,"id"in a?a.id:null]),()=>r.current.messages,()=>r.current.messages),n=(0,R.useSyncExternalStore)(r.current["~registerStatusCallback"],()=>r.current.status,()=>r.current.status),o=(0,R.useSyncExternalStore)(r.current["~registerErrorCallback"],()=>r.current.error,()=>r.current.error),i=(0,R.useCallback)(l=>{typeof l=="function"&&(l=l(r.current.messages)),r.current.messages=l},[r]);return(0,R.useEffect)(()=>{e&&r.current.resumeStream()},[e,r]),{id:r.current.id,messages:s,setMessages:i,sendMessage:r.current.sendMessage,regenerate:r.current.regenerate,clearError:r.current.clearError,stop:r.current.stop,error:o,resumeStream:r.current.resumeStream,status:n,addToolResult:r.current.addToolResult}}function du({api:t="/api/completion",id:e,initialCompletion:a="",initialInput:r="",credentials:s,headers:n,body:o,streamProtocol:i="data",fetch:l,onFinish:d,onError:u,experimental_throttle:p}={}){let g=(0,R.useId)(),v=e||g,{data:b,mutate:f}=tn([t,v],null,{fallbackData:a}),{data:c=!1,mutate:h}=tn([v,"loading"],null),[_,w]=(0,R.useState)(void 0),A=b,[O,L]=(0,R.useState)(null),D=(0,R.useRef)({credentials:s,headers:n,body:o});(0,R.useEffect)(()=>{D.current={credentials:s,headers:n,body:o}},[s,n,o]);let M=(0,R.useCallback)(async(J,X)=>wd({api:t,prompt:J,credentials:D.current.credentials,headers:{...D.current.headers,...X==null?void 0:X.headers},body:{...D.current.body,...X==null?void 0:X.body},streamProtocol:i,fetch:l,setCompletion:rn(ce=>f(ce,!1),p),setLoading:h,setError:w,setAbortController:L,onFinish:d,onError:u}),[f,h,t,D,L,d,u,w,i,l,p]),Y=(0,R.useCallback)(()=>{O&&(O.abort(),L(null))},[O]),$=(0,R.useCallback)(J=>{f(J,!1)},[f]),K=(0,R.useCallback)(async(J,X)=>M(J,X),[M]),[ee,se]=(0,R.useState)(r),Q=(0,R.useCallback)(J=>{var X;return(X=J==null?void 0:J.preventDefault)==null||X.call(J),ee?K(ee):void 0},[ee,K]);return{completion:A,complete:K,error:_,setCompletion:$,stop:Y,input:ee,setInput:se,handleInputChange:(0,R.useCallback)(J=>{se(J.target.value)},[se]),handleSubmit:Q,isLoading:c}}var Ot=class extends Error{constructor(t,e="TOOL_ERROR",a=!1,r,s){super(t),this.name="ToolExecutionError",this.code=e,this.isRetryable=a,this.suggestedFix=r,this.meta=s}toStructuredString(){let t=JSON.stringify({message:this.message,code:this.code,is_retryable:this.isRetryable,...this.suggestedFix&&{suggested_fix:this.suggestedFix},...this.meta&&{meta:this.meta}});return`Error invoking tool ${this.name}: ${t}`}};const on=I({status:Xt(["success","error","warning"]).optional(),auth_required:ae().optional(),next_steps:Ce(m()).optional(),action_url:m().optional(),message:m().optional(),meta:Rt(m(),re()).optional()});function uu(t,e){return t?!!(["image/","video/","audio/","application/pdf"].some(a=>t.startsWith(a))||["svg","vega"].some(a=>t.includes(a))||t==="text/html"&&["<img","<video","<audio","<iframe","<canvas","<svg","<marimo-ui-element"].some(a=>e.includes(a))):!1}var cu=class extends jt{constructor(e){super();P(this,"title","Cell Outputs");P(this,"mentionPrefix","@");P(this,"contextType","cell-output");this.store=e}getItems(){let e=this.store.get(at),a=[];for(let r of e.cellIds.inOrderIds){let s=dn(r,e),n=s.cellOutput;if(!n)continue;let o=n.output.mimetype||"unknown";a.push({uri:this.asURI(r),name:s.cellName,type:this.contextType,description:`Cell output (${o})`,data:{...s,cellOutput:n}})}return a}formatCompletion(e){let{cellOutput:a,cellName:r,cellCode:s}=e.data;return{label:`@${r}`,displayLabel:r,detail:`${a.outputType} output`,boost:a.outputType==="media"?wt.HIGH:wt.MEDIUM,type:this.contextType,section:xt.CELL_OUTPUT,apply:`@${r}`,info:()=>{let n=document.createElement("div");n.classList.add("mo-cm-tooltip","docs-documentation","min-w-[300px]","max-w-[500px]","flex","flex-col","gap-2");let o=document.createElement("div");o.classList.add("flex","flex-col","gap-1");let i=document.createElement("div");i.classList.add("font-bold","text-base"),i.textContent=r,o.append(i);let l=document.createElement("div");if(l.classList.add("text-sm","text-muted-foreground"),o.append(l),n.append(o),s){let d=document.createElement("div");d.classList.add("text-xs","font-medium","text-muted-foreground"),d.textContent="Code:",n.append(d);let u=document.createElement("div");u.classList.add("text-xs","font-mono","bg-muted","p-2","rounded","max-h-20","overflow-y-auto"),u.textContent=s.slice(0,200)+(s.length>200?"...":""),n.append(u)}if(a.processedContent){let d=document.createElement("div");d.classList.add("text-xs","font-medium","text-muted-foreground","mt-2"),d.textContent="Output Preview:",n.append(d);let u=document.createElement("div");u.classList.add("text-xs","bg-muted","p-2","rounded","max-h-24","overflow-y-auto","mb-2"),u.textContent=a.processedContent.slice(0,300)+(a.processedContent.length>300?"...":""),n.append(u)}if(a.outputType==="media"){let d=document.createElement("div");d.classList.add("text-xs","text-muted-foreground","italic","mb-2"),d.textContent="A screenshot of the output will be attached",n.append(d)}return n}}}formatContext(e){let{cellOutput:a,cellName:r,cellId:s,cellCode:n}=e.data,o={name:r,cellId:s,outputType:a.outputType,mimetype:a.output.mimetype},i=`Cell Code:
${n}

`;return a.outputType==="text"&&a.processedContent?i+=`Output:
${a.processedContent}`:a.outputType==="media"&&(i+=`Media Output: Contains ${a.output.mimetype} content`,a.imageUrl&&(i+=`
Image URL: ${a.imageUrl}`)),Mt({type:this.contextType,data:o,details:i})}async getAttachments(e){let a=e[0].data.cellId,r=e[0].data.cellName;return pu(e.map(s=>s.data.cellOutput),a,r)}};async function pu(t,e,a){let r=t.filter(n=>n.shouldDownloadImage&&n.outputType==="media");if(r.length===0)return[];let s=r.flatMap(n=>{let o=document.getElementById(Xn.create(e));return o?{cellId:e,cellName:a,mimetype:n.output.mimetype,element:o}:(ue.warn(`Output element not found for cell ${e}`),[])});try{return await Promise.all(s.map(async n=>({type:"file",filename:`${a}-output-screenshot`,mediaType:"image/png",url:await Zi(n.element)})))}catch(n){return ue.error("Error downloading cell output images:",n),[]}}function ln(t){if(Jr(t))return null;let e=t.mimetype,a=uu(e,String(t.data))?"media":"text",r=Wi(t),s,n=!1;return a==="media"&&(typeof t.data=="string"&&t.data.startsWith("data:")||typeof t.data=="string"&&t.data.startsWith("http")?s=t.data:n=!0),{processedContent:r,imageUrl:s,shouldDownloadImage:n,outputType:a,output:t}}function dn(t,e,a){let{includeConsoleOutput:r=!1}=a||{},s=e.cellRuntime[t],n=e.cellData[t],o=e.cellIds.inOrderIds.indexOf(t),i=oi(n.name,o),l;r&&(l=s.consoleOutputs.map(p=>ln(p)).filter(p=>p!==null));let d,u=s.output;return u&&!Jr(u)&&(d=ln(u)??void 0),{cellId:t,cellName:i,cellCode:n.code,cellOutput:d,consoleOutputs:l}}function mu(t){return t.type==="setup-refs"?"The setup cell cannot have references":t.type==="cycle"?"This cell is in a cycle":t.type==="multiple-defs"?`The variable '${t.name}' was defined by another cell`:t.type==="import-star"||t.type==="ancestor-stopped"||t.type==="ancestor-prevented"||t.type==="exception"||t.type==="strict-exception"?t.msg:t.type==="interruption"?"This cell was interrupted and needs to be re-run":t.type==="syntax"||t.type==="unknown"||t.type==="sql-error"?t.msg:t.type==="internal"?t.msg||"An internal error occurred":(Ri(t),"Unknown error")}var un=new ti("error","errors"),hu=class extends jt{constructor(e){super();P(this,"title","Errors");P(this,"mentionPrefix","@");P(this,"contextType","error");this.store=e}getItems(){let e=this.store.get(si);return e.length===0?[]:[{uri:this.asURI("all"),name:"Errors",type:this.contextType,data:{type:"all-errors",errors:e.map(a=>({cellId:a.cellId,cellName:a.cellName,errorData:a.output.data}))},description:"All errors in the notebook"}]}formatCompletion(e){return e.data.type==="all-errors"?{label:"@Errors",displayLabel:"Errors",detail:`${e.data.errors.length} ${un.pluralize(e.data.errors.length)}`,type:"error",apply:"@Errors",section:xt.ERROR,info:()=>{let a=document.createElement("div");a.classList.add("mo-cm-tooltip","docs-documentation","min-w-[200px]","flex","flex-col","gap-1","p-2");let r=document.createElement("div");r.classList.add("flex","flex-col","gap-1");let s=document.createElement("div");s.classList.add("font-bold","text-base"),s.textContent="Errors",r.append(s);let n=document.createElement("div");return n.classList.add("text-sm","text-muted-foreground"),n.textContent=`${e.data.errors.length} ${un.pluralize(e.data.errors.length)}`,r.append(n),a.append(r),a}}:{label:"Error",displayLabel:"Error",section:xt.ERROR}}formatContext(e){let{data:a}=e;return a.errors.map(r=>Mt({type:this.contextType,data:{name:r.cellName||`Cell ${r.cellId}`,description:r.errorData.map(s=>mu(s)).join(`
`)}})).join(`

`)}};const cn=ri();var fu={maxDepth:3,maxResults:20,defaultResultsLimit:5,includeDirectories:!1},gu=class extends jt{constructor(e,a=fu){super();P(this,"title","Files");P(this,"mentionPrefix","#");P(this,"contextType","file");P(this,"searchFiles",async(e,a={})=>{let{maxDepth:r,maxResults:s,includeDirectories:n}={...this.config,...a};return(await this.apiRequests.sendSearchFiles({query:e,includeFiles:!0,includeDirectories:n,depth:r,limit:s})).files});this.apiRequests=e,this.config=a}createCompletionSource(){return async e=>{let a=e.matchBefore(/#[^\s#]*/);if(!a)return null;let r=a.text;if(!r.startsWith("#"))return null;let s=r.slice(1);if(s.length===0)return this.getDefaultCompletions(a);try{let n=(await this.searchFiles(s)||[]).map(o=>{let i={uri:this.asURI(o.path),name:o.name,type:this.contextType,description:o.isDirectory?"Directory":"File",data:{path:o.path,isDirectory:o.isDirectory}};return this.formatCompletion(i)});return{from:a.from,options:n}}catch(n){return ue.error("Failed to search files:",n),null}}}async getDefaultCompletions(e){try{for(let a of["py","md","csv"])try{let r=await this.searchFiles(a,{maxDepth:1,maxResults:5});if(r&&r.length>0){let s=r.map(n=>{let o={uri:this.asURI(n.path),name:n.name,type:this.contextType,description:n.isDirectory?"Directory":"File",data:{path:n.path,isDirectory:n.isDirectory}};return this.formatCompletion(o)});return{from:e.from,options:s}}}catch(r){ue.error("Failed to get default file completions:",r)}return{from:e.from,options:[]}}catch(a){return ue.error("Failed to get default file completions:",a),null}}getItems(){return[]}formatCompletion(e){let{data:a,name:r}=e,s=a.isDirectory?"\u{1F4C1}":"\u{1F4C4}";return{...this.createBasicCompletion(e),type:"file",section:xt.FILE,boost:a.isDirectory?wt.MEDIUM:wt.LOW,detail:a.path,displayLabel:`${s} ${r}`,apply:async(n,o,i,l)=>{var v;let d=(v=n.state.facet(cn))==null?void 0:v.addAttachment;if(!d){ue.warn("No addAttachment callback provided");return}let u=await this.apiRequests.sendFileDetails({path:a.path}).catch(b=>(Yr({title:"Failed to get file details",description:b.message}),null));if(!u)return;let p=u.mimeType||"text/plain",g;if(p.startsWith("text/")||p.includes("json")||p.includes("xml"))g=new Blob([u.contents||""],{type:p});else if(u.contents)try{g=await eo(wi(u.contents,p))}catch{g=new Blob([u.contents],{type:p})}else g=new Blob([""],{type:p});d(new File([g],r,{type:p})),n.dispatch({changes:{from:i,to:l,insert:""}}),Ai(n)},info:()=>{let n=document.createElement("div");n.classList.add("flex","flex-col","gap-1","p-2");let o=document.createElement("div");o.classList.add("font-bold"),o.textContent=r,n.append(o);let i=document.createElement("div");return i.classList.add("text-xs","text-muted-foreground"),i.textContent=a.path,n.append(i),n}}}formatContext(e){let{data:a,name:r}=e;return Mt({type:this.contextType,data:{name:r,path:a.path,isDirectory:a.isDirectory},details:a.isDirectory?"Directory containing files and subdirectories":"File"})}},yu=class extends jt{constructor(e){super();P(this,"title","Tables");P(this,"mentionPrefix","@");P(this,"contextType","data");this.tablesMap=e}getItems(){return[...this.tablesMap.entries()].map(([e,a])=>({uri:this.asURI(e),name:e,type:this.contextType,description:a.source==="memory"?"in-memory":a.source,data:a}))}formatContext(e){let{data:a}=e,{columns:r,source:s,num_rows:n,num_columns:o,name:i,variable_name:l}=a,d=[n==null?void 0:`${n} rows`,o==null?void 0:`${o} columns`].filter(Boolean).join(", "),u="";if(d&&(u+=`Shape: ${d}
`),l&&(u+=`Variable: ${l}
`),r&&r.length>0){u+=`Columns:
`;for(let p of r){let g=`  ${p.name} (${p.type})`;if(p.sample_values&&p.sample_values.length>0){let v=p.sample_values.slice(0,3).map(b=>b===null?"null":String(b)).join(", ");g+=` - samples: [${v}]`}u+=`${g}
`}}return Mt({type:this.contextType,data:{name:i,source:s??"unknown"},details:u.trim()})}formatCompletion(e){let a=e.data.name,r=e.data;return{label:`@${a}`,displayLabel:a,detail:r.source==="memory"?"in-memory":r.source,boost:r.source_type==="local"?wt.LOCAL_TABLE:wt.REMOTE_TABLE,type:Lr(r),apply:`@${a}`,section:{name:Lr(r)==="dataframe"?"Dataframe":"Table",rank:xt.TABLE.rank},info:()=>this.createTableInfoElement(a,r)}}createTableInfoElement(e,a){let r=document.createElement("div");r.classList.add("mo-cm-tooltip","docs-documentation","min-w-[200px]","flex","flex-col","gap-1","p-2");let s=document.createElement("div");s.classList.add("flex","flex-col","gap-1");let n=document.createElement("div");if(n.classList.add("font-bold","text-base"),n.textContent=e,s.append(n),a.source){let i=document.createElement("div");i.classList.add("text-xs","text-muted-foreground"),i.textContent=`Source: ${a.source}`,s.append(i)}r.append(s);let o=[a.num_rows==null?void 0:`${a.num_rows} rows`,a.num_columns==null?void 0:`${a.num_columns} columns`].filter(Boolean).join(", ");if(o){let i=document.createElement("div");i.classList.add("text-xs","bg-muted","px-2","py-1","rounded"),i.textContent=o,r.append(i)}if(a.columns&&a.columns.length>0){let i=document.createElement("div");i.classList.add("overflow-auto","max-h-60");let l=document.createElement("table");l.classList.add("w-full","text-xs","border-collapse");let d=l.insertRow();d.classList.add("bg-muted");let u=d.insertCell();u.classList.add("p-2","font-medium","text-left"),u.textContent="Column";let p=d.insertCell();p.classList.add("p-2","font-medium","text-left"),p.textContent="Type";let g=a.columns.some(b=>this.getItemMetadata(a,b)!==void 0),v;g&&(v=d.insertCell(),v.classList.add("p-2","font-medium","text-left"),v.textContent="Metadata"),a.columns.forEach((b,f)=>{let c=l.insertRow();c.classList.add(f%2==0?"bg-background":"bg-muted/30");let h=c.insertCell();h.classList.add("p-2","font-mono"),h.textContent=b.name;let _=c.insertCell();if(_.classList.add("p-2","text-muted-foreground"),_.textContent=b.type,g){let w=c.insertCell();w.classList.add("p-2");let A=this.getItemMetadata(a,b);A&&w.append(A)}}),i.append(l),r.append(i)}return r}getItemMetadata(e,a){var n,o;let r=(n=e.primary_keys)==null?void 0:n.includes(a.name),s=(o=e.indexes)==null?void 0:o.includes(a.name);if(r||s){let i=document.createElement("span");i.textContent=r?"PK":"IDX";let l=r?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-200";return i.classList.add("text-xs","px-1.5","py-0.5","rounded-full","font-medium",...l.split(" ")),i}}},vu=class extends jt{constructor(e,a){super();P(this,"title","Variables");P(this,"mentionPrefix","@");P(this,"contextType","variable");this.variables=e,this.tablesMap=a}getItems(){let e=new Set(this.tablesMap.keys());return Object.entries(this.variables).flatMap(([a,r])=>e.has(a)?[]:[{uri:this.asURI(a),name:a,type:this.contextType,description:r.dataType??"",dataType:r.dataType,data:{variable:r}}])}formatCompletion(e){let{data:a}=e,{variable:r}=a;return{label:`@${r.name}`,displayLabel:r.name,detail:r.dataType??"",type:this.contextType,section:xt.VARIABLE,info:()=>li(r)}}formatContext(e){let{data:a}=e,{variable:r}=a;return Mt({type:this.contextType,data:{name:r.name,dataType:r.dataType},details:r.value==null?void 0:JSON.stringify(r.value)})}};function ft(t){let e=t.get(Qn),a=t.get(Yn),r=t.get(ei);return new Ui().register(new yu(a)).register(new vu(r,a)).register(new hu(t)).register(new cu(t)).register(new Vi(e.connectionsMap,a))}function _u(){return new gu(Ii())}const bu="@";function xu({input:t}){let e="";return t.includes("@")&&(e=ku(t),ue.debug("Included context",e)),{includeOtherCode:Dr(""),context:{plainText:e,schema:[],variables:[]}}}async function wu({input:t}){let e="",a=[];if(t.includes("@")){let r=ft(Pr),s=r.parseAllContextIds(t);e=r.formatContextForAI(s);try{a=await r.getAttachmentsForContext(s),ue.debug("Included attachments",a.length)}catch(n){ue.error("Error getting attachments:",n)}}return{body:{includeOtherCode:Dr(""),context:{plainText:e,schema:[],variables:[]}},attachments:a}}function ku(t){let e=ft(Pr),a=e.parseAllContextIds(t);return e.formatContextForAI(a)}function Cu(t,e=[]){return a=>{let r=t.map(s=>a.matchBefore(s)).find(Boolean);return!r||r&&r.from===r.to&&!a.explicit?null:{from:r==null?void 0:r.from,options:[...e]}}}function Tu(t){var e;if((e=t.current)!=null&&e.view){let a=t.current.view.state.selection.main.from;t.current.view.dispatch({changes:{from:a,to:a,insert:"@"},selection:{anchor:a+1,head:a+1}}),t.current.view.focus(),Ei(t.current.view)}}function Iu(t){if(t.trim().length===0)return[];if(!t.includes("```"))return[{language:"python",code:t}];let e=[],a=0,r=t.indexOf("```",a);for(;r!==-1;){let s=t.indexOf(`
`,r);if(s===-1){let d=t.slice(r+3),u=d.indexOf(" "),p=u===-1?d:d.slice(0,u),g=p==="markdown"?"markdown":p==="sql"?"sql":"python",v=u===-1?"":d.slice(u+1);v.trim()&&e.push({language:g,code:v.trim()});break}let n=t.slice(r+3,s).trim()||"";n=n==="markdown"?"markdown":n==="sql"?"sql":"python";let o=s+1,i=t.indexOf("```",o);if(i===-1){let d=t.slice(o).replace(/\n+$/,"");d.trim()&&e.push({language:n,code:d});break}let l=t.slice(o,i).replace(/\n+$/,"");l.trim()&&e.push({language:n,code:l}),a=i+3,r=t.indexOf("```",a)}return e.length===0&&e.push({language:"python",code:t}),e}var Eu=ct(ja(),1),pn=()=>new Map,{valueAtom:qt,useActions:mn,createActions:cp,reducer:pp}=Ci(pn,{addStagedCell:(t,e)=>{let{cellId:a,edit:r}=e;return new Map([...t,[a,r]])},removeStagedCell:(t,e)=>{let a=new Map(t);return a.delete(e),a},clearStagedCells:()=>pn()});function hn(t){let e=(0,Eu.c)(26),{addStagedCell:a,removeStagedCell:r,clearStagedCells:s}=mn(),{createNewCell:n}=Fr(),o=to(),i=(0,R.useRef)(null),l;e[0]!==a||e[1]!==n?(l=w=>{let A=$r.create();return a({cellId:A,edit:{type:"add_cell"}}),n({cellId:"__end__",code:w,before:!1,newCellId:A}),A},e[0]=a,e[1]=n,e[2]=l):l=e[2];let d=l,u;e[3]===t?u=e[4]:(u=w=>{let{cellId:A,code:O}=w;if(!t.get(qt).has(A)){ue.error("Staged cell not found",{cellId:A});return}let L=ai(A);if(!L){ue.error("Editor for this cell not found",{cellId:A});return}Ra(L,O)},e[3]=t,e[4]=u);let p=u,g;e[5]!==o||e[6]!==r?(g=w=>{r(w),o({cellId:w})},e[5]=o,e[6]=r,e[7]=g):g=e[7];let v=g,b;e[8]!==s||e[9]!==o||e[10]!==t?(b=()=>{let w=t.get(qt);for(let A of w.keys())o({cellId:A});s()},e[8]=s,e[9]=o,e[10]=t,e[11]=b):b=e[11];let f=b,c;e[12]!==a||e[13]!==n||e[14]!==d||e[15]!==p?(c=w=>{e:switch(w.type){case"text-start":i.current=new Su(d,p,a,n);break e;case"text-delta":if(!i.current){ue.error("Cell creation stream not found");return}i.current.stream(w);break e;case"text-end":case"finish":if(!i.current){ue.error("Cell creation stream not found");return}i.current.stop();break e;default:ue.error("Unknown chunk type",{chunk:w})}},e[12]=a,e[13]=n,e[14]=d,e[15]=p,e[16]=c):c=e[16];let h=c,_;return e[17]!==a||e[18]!==s||e[19]!==d||e[20]!==f||e[21]!==v||e[22]!==h||e[23]!==r||e[24]!==p?(_={createStagedCell:d,updateStagedCell:p,addStagedCell:a,removeStagedCell:r,clearStagedCells:s,deleteStagedCell:v,deleteAllStagedCells:f,onStream:h},e[17]=a,e[18]=s,e[19]=d,e[20]=f,e[21]=v,e[22]=h,e[23]=r,e[24]=p,e[25]=_):_=e[25],_}var Su=class{constructor(t,e,a,r){P(this,"createdCells",[]);P(this,"buffer","");P(this,"hasMarimoImport",!1);this.onCreateCell=t,this.onUpdateCell=e,this.addStagedCell=a,this.createNewCell=r}stream(t){let e=t.delta;this.buffer+=e;let a=Iu(this.buffer);for(let[r,s]of a.entries())if(r<this.createdCells.length){this.addMarimoImport(s.language);let n=this.createdCells[r];this.createdCells[r]={...n,cell:s},this.onUpdateCell({cellId:n.cellId,code:s.code,language:s.language})}else{let n=this.onCreateCell(s.code);this.createdCells.push({cellId:n,cell:s})}}addMarimoImport(t){var a;if(this.hasMarimoImport||t==="python")return;let e=ao({autoInstantiate:!1,createNewCell:this.createNewCell,fromCellId:(a=this.createdCells[0])==null?void 0:a.cellId,before:!0});e&&this.addStagedCell({cellId:e,edit:{type:"add_cell"}}),this.hasMarimoImport=!0}stop(){this.buffer=""}},Au={baseDescription:"Perform editing operations on the current notebook. You should prefer to create new cells unless you need to edit existing cells. Call this tool multiple times to perform multiple edits. Separate code into logical individual cells to take advantage of the notebook's reactive execution model.",prerequisites:["If you are updating existing cells, you need the cellIds. If they are not known, call the lightweight_cell_map_tool to find out."],additionalInfo:`
  Args:
    edit (object): The editing operation to perform. Must be one of:
    - update_cell: Update the code of an existing cell, pass cellId and the new code.
    - add_cell: Add a new cell to the notebook. The position is specified by the position object with a "type" field:
        { type: "notebook_end" } - Add at the end of the notebook
        { type: "relative", cellId: "...", before: true } - Add before the specified cell (before: false for after)
        { type: "column_end", columnIndex: 0 } - Add at the end of a specific column (0-based index)
    - delete_cell: Delete an existing cell, pass cellId. For deleting cells, the user needs to accept the deletion to actually delete the cell, so you may still see the cell in the notebook on subsequent edits which is fine.

    For adding code, use the following guidelines:
    - Markdown cells: use mo.md(f"""{content}""") function to insert content.
    - SQL cells: use mo.sql(f"""{content}""") function to insert content. If a database engine is specified, use mo.sql(f"""{content}""", engine=engine) instead.

    Returns:
    - A result object containing standard tool metadata.`},Ou=I({edit:Ma("type",[I({type:k("update_cell"),cellId:m(),code:m()}),I({type:k("add_cell"),position:Ma("type",[I({type:k("relative"),cellId:m(),before:ae()}),I({type:k("column_end"),columnIndex:_t()}),I({type:k("notebook_end")})]),code:m()}),I({type:k("delete_cell"),cellId:m()})])}),Nu=class{constructor(){P(this,"name","edit_notebook_tool");P(this,"description",Au);P(this,"schema",Ou);P(this,"outputSchema",on);P(this,"mode",["agent"]);P(this,"handler",async({edit:t},e)=>{let{addStagedCell:a,createNewCell:r,store:s}=e;switch(t.type){case"update_cell":{let{cellId:n,code:o}=t,i=s.get(at);this.validateCellIdExists(n,i);let l=this.getCellEditorView(n,i);Za(n);let d=s.get(qt).get(n);if((d==null?void 0:d.type)==="add_cell"){Ra(l,o);break}let u=l.state.doc.toString();a({cellId:n,edit:{type:"update_cell",previousCode:(d==null?void 0:d.previousCode)??u}}),Ra(l,o);break}case"add_cell":{let{position:n,code:o}=t,i="__end__",l=!1,d=$r.create(),u=s.get(at);switch(n.type){case"relative":this.validateCellIdExists(n.cellId,u),i=n.cellId,l=n.before;break;case"column_end":i={type:"__end__",columnId:this.getColumnId(n.columnIndex,u)};break;case"notebook_end":break}r({cellId:i,before:l,code:o,newCellId:d}),a({cellId:d,edit:{type:"add_cell"}}),Za(d);break}case"delete_cell":{let{cellId:n}=t,o=s.get(at);this.validateCellIdExists(n,o),a({cellId:n,edit:{type:"delete_cell",previousCode:this.getCellEditorView(n,o).state.doc.toString()}}),Za(n);break}}return{status:"success",next_steps:["If you need to perform more edits, call this tool again.","You should use the lint notebook tool to check for errors and lint issues. Fix them by editing the notebook.","You should use the run stale cells tool to run the cells that have been edited or newly added. This allows you to see the output of the cells and fix any errors."]}})}validateCellIdExists(t,e){if(!e.cellIds.getColumns().some(a=>a.idSet.has(t)))throw new Ot("Cell not found","CELL_NOT_FOUND",!1,"Check which cells exist in the notebook")}getColumnId(t,e){let a=e.cellIds.getColumns();if(t<0||t>=a.length)throw new Ot("Column index is out of range","COLUMN_INDEX_OUT_OF_RANGE",!0,"Choose a column index between 0 and the number of columns in the notebook (0-based)");return a[t].id}getCellEditorView(t,e){let a=e.cellHandles[t].current;if(!(a!=null&&a.editorView))throw new Ot("Cell editor not found","CELL_EDITOR_NOT_FOUND",!1,"Internal error, ask the user to report this error");return a.editorView}},Ru=200,Mu=3e4,ju={baseDescription:"Run cells in the current notebook that are stale. Stale cells are cells that have been edited or newly added. You can run this tool after editing the notebook or when requested. The output of the ran cells will be returned alongside metadata."},fn=I({type:k("file"),url:m(),mediaType:m()}),Pu=class{constructor(t){P(this,"name","run_stale_cells_tool");P(this,"description",ju);P(this,"schema",I({}));P(this,"outputSchema",on.extend({cellsToOutput:Rt(m(),I({consoleOutput:m().optional(),cellOutput:m().optional(),consoleAttachments:Ce(fn).optional(),cellAttachments:Ce(fn).optional()}).nullable()).optional()}));P(this,"mode",["agent"]);P(this,"handler",async(t,e)=>{let{prepareForRun:a,sendRun:r,store:s}=e,n=s.get(at),o=ii(n);if(o.length===0)return{status:"success",message:"No stale cells found."};if(await Gi({cellIds:o,sendRun:r,prepareForRun:a,notebook:n}),!await this.waitForCellsToFinish(s,o,Mu,this.postExecutionDelay))return{status:"success",message:"No output was returned because some cells have not finished executing"};let i=s.get(at),l=new Map,d="",u=!1;for(let g of o){let v=dn(g,i,{includeConsoleOutput:!0}),b,f,c=v.cellOutput,h=v.consoleOutputs,_=h&&h.length>0;if(!c&&!_){l.set(g,null);continue}c&&(b=this.formatOutputString(c),this.outputHasErrors(c)&&(u=!0)),_&&(f=h.map(w=>this.formatOutputString(w)).join(`
`),d+="Console output represents the stdout or stderr of the cell (eg. print statements).",h.some(w=>this.outputHasErrors(w))&&(u=!0)),l.set(g,{cellOutput:b,consoleOutput:f})}if(l.size===0)return{status:"success",message:"Stale cells have been run. No output was returned."};let p=["Review the output of the cells. The CellId is the key of the result object.",u?"There are errors in the cells. Please fix them by using the edit notebook tool and the given CellIds.":"You may edit the notebook further with the given CellIds."];return{status:"success",cellsToOutput:Object.fromEntries(l),message:d===""?void 0:d,next_steps:p}});this.postExecutionDelay=(t==null?void 0:t.postExecutionDelay)??Ru}outputHasErrors(t){let{output:e}=t;return e.mimetype==="application/vnd.marimo+error"||e.mimetype==="application/vnd.marimo+traceback"}formatOutputString(t){let e="",{outputType:a,processedContent:r,imageUrl:s,output:n}=t;return a==="text"?(e+=`Output:
`,r?e+=r:typeof n.data=="string"?e+=n.data:e+=JSON.stringify(n.data)):a==="media"&&(e+=`Media Output: Contains ${n.mimetype} content`,s&&(e+=`
Image URL: ${s}`)),e}async waitForCellsToFinish(t,e,a,r){let s=o=>e.every(i=>{let l=o.cellRuntime[i];return(l==null?void 0:l.status)!=="running"&&(l==null?void 0:l.status)!=="queued"}),n=async()=>(r>0&&await new Promise(o=>setTimeout(o,r)),!0);if(s(t.get(at)))return await n();try{return await Promise.race([Wn(at,s),new Promise((o,i)=>setTimeout(()=>i(Error("timeout")),a))]),await n()}catch{return!1}}};function Zu(t){let e=t.baseDescription;return t.whenToUse&&(e+=`

## When to use:
- ${t.whenToUse.join(`
- `)}`),t.avoidIf&&(e+=`

## Avoid if:
- ${t.avoidIf.join(`
- `)}`),t.prerequisites&&(e+=`

## Prerequisites:
- ${t.prerequisites.join(`
- `)}`),t.sideEffects&&(e+=`

## Side effects:
- ${t.sideEffects.join(`
- `)}`),t.additionalInfo&&(e+=`

## Additional info:
- ${t.additionalInfo}`),e}var gn,Kt;function $u(t,e,a,r,s){var n={};return Object.keys(r).forEach(function(o){n[o]=r[o]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=a.slice().reverse().reduce(function(o,i){return i(t,e,o)||o},n),s&&n.initializer!==void 0&&(n.value=n.initializer?n.initializer.call(s):void 0,n.initializer=void 0),n.initializer===void 0?(Object.defineProperty(t,e,n),null):n}const Cr=new(gn=Gn(),Kt=class{constructor(t=[]){P(this,"tools",new Map);this.tools=new Map(t.map(e=>[e.name,e]))}has(t){return this.tools.has(t)}getToolOrThrow(t){let e=this.tools.get(t);if(!e)throw Error(`Tool ${t} not found`);return e}async invoke(t,e,a){var i;let r=this.getToolOrThrow(t),s=r.handler,n=r.schema,o=r.outputSchema;try{let l=await n.safeParseAsync(e);if(l.error)throw new Ot(`Tool ${t} returned invalid input: ${Vr(l.error)}`,"INVALID_ARGUMENTS",!0,"Please check the arguments and try again.");let d=l.data,u=await s(d,a),p=await o.safeParseAsync(u);if(p.error){let g=Vr(p.error);throw Error(`Tool ${t} returned invalid output: ${g}`)}return{tool_name:t,result:p.data,error:null}}catch(l){return l instanceof Ot?{tool_name:t,result:null,error:l.toStructuredString()}:{tool_name:t,result:null,error:new Ot(l instanceof Error?l.message:String(l),"TOOL_ERROR",!1,"Check the error message and try again with valid arguments.",{args:e,errorType:((i=l==null?void 0:l.constructor)==null?void 0:i.name)??typeof l}).toStructuredString()}}}getToolSchemas(){return[...this.tools.values()].map(t=>({name:t.name,description:Zu(t.description),parameters:zr(t.schema),source:"frontend",mode:t.mode}))}},$u(Kt.prototype,"getToolSchemas",[gn],Object.getOwnPropertyDescriptor(Kt.prototype,"getToolSchemas"),Kt.prototype),Kt)([new Nu,new Pu]);function Tr(t,e){return new Promise(a=>{let r=new FileReader;r.readAsDataURL(t),r.onload=s=>{var n;if((n=s.target)!=null&&n.result){let o=s.target.result;a(e==="base64"?o.slice(o.indexOf(",")+1):o)}}})}function Lu(t){return Promise.all(t.map(e=>Tr(e,"base64").then(a=>[e.name,a])))}function Du(t){return t.length>50?`${t.slice(0,50)}...`:t}async function Fu(t){return await Promise.all(t.map(async e=>({type:"file",mediaType:e.type,filename:e.name,url:await Tr(e,"dataUrl")})))}function zu(t){if(t.length===0)return!1;let e=t.at(-1);if(!e||e.role!=="assistant"||!e.parts)return!1;let a=e.parts;return a.length===0?!1:a[a.length-1].type==="reasoning"}function yn(t){return t.map(e=>e.type==="text"?e.text:"").join(`
`)}async function vn(t){let e=await wu({input:yn(t.flatMap(r=>r.parts))});function a(r,s){let n=[...r.parts];return s&&n.push(...e.attachments),{role:r.role,content:yn(r.parts),parts:n}}return{...e.body,messages:t.map((r,s)=>a(r,s===t.length-1))}}async function _n({invokeAiTool:t,addToolResult:e,toolCall:a,toolContext:r}){try{if(Cr.has(a.toolName)){let s=await Cr.invoke(a.toolName,a.input,r);e({tool:a.toolName,toolCallId:a.toolCallId,output:s.result||s.error})}else{let s=await t({toolName:a.toolName,arguments:a.input});e({tool:a.toolName,toolCallId:a.toolCallId,output:s.result||s.error})}}catch(s){ue.error("Tool call failed:",s),e({tool:a.toolName,toolCallId:a.toolCallId,output:`Error: ${s instanceof Error?s.message:String(s)}`})}}function Uu(t){var i;if(t.length===0)return!1;let e=t[t.length-1],a=e.parts;if(a.length===0||e.role!=="assistant")return!1;let r=a.filter(l=>l.type.startsWith("tool-"));if(r.length===0)return!1;let s=r.every(l=>l.state==="output-available"),n=a[a.length-1],o=n.type==="text"&&((i=n.text)==null?void 0:i.trim().length)>0;return ue.warn("All tool calls completed: %s",s),s&&!o}function Vu(t){return xi.define({combine:e=>e[0]??t})}var bn=Vu({}),Ir=ta.define(),Sa=ta.define(),Bu=50,Er=aa.define({create(){return{prompts:[],navigationIndex:-1,originalText:""}},update(t,e){var r,s;let a={...t};e.docChanged&&t.navigationIndex!==-1&&(e.effects.some(n=>n.is(Sa)||n.is(Ir))||(a.navigationIndex=-1,a.originalText=""));for(let n of e.effects)if(n.is(Ir)){let o=n.value.trim();o&&(a.prompts=[o,...t.prompts.filter(i=>i!==o)].slice(0,Bu),(s=(r=e.state.facet(bn)).save)==null||s.call(r,a.prompts)),a.navigationIndex=-1,a.originalText=""}else n.is(Sa)&&(a.navigationIndex=n.value.index,a.originalText=n.value.originalText);return a}}),Wu=t=>{let e=t.state.field(Er),a=t.state.doc;if(e.prompts.length===0)return!1;let r,s=e.originalText;if(e.navigationIndex===-1){if(a.length>0)return!1;r=0,s=a.toString()}else if(r=Math.min(e.navigationIndex+1,e.prompts.length-1),r===e.navigationIndex)return!1;let n=e.prompts[r];return t.dispatch({changes:{from:0,to:t.state.doc.length,insert:n},effects:Sa.of({index:r,originalText:s})}),!0},qu=t=>{let e=t.state.field(Er);if(e.navigationIndex===-1)return!1;let a,r;return e.navigationIndex===0?(a=e.originalText,r=-1):(r=e.navigationIndex-1,a=e.prompts[r]??""),t.dispatch({changes:{from:0,to:t.state.doc.length,insert:a},effects:Sa.of({index:r,originalText:e.originalText})}),!0};const xn=t=>{let e=t.state.doc.toString();return e.trim()?(t.dispatch({effects:Ir.of(e)}),!0):!1};function Ku(t={}){let{storage:e,defaultKeymap:a=!0}=t,r=[Er.init(()=>{var s;return{prompts:((s=e==null?void 0:e.load)==null?void 0:s.call(e))??[],navigationIndex:-1,originalText:""}}),bn.of(e??{})];return a&&r.push(ra.of([{key:"ArrowUp",run:Wu},{key:"ArrowDown",run:qu}])),r}const Sr=ta.define(),Ge=aa.define({create(){return new Map},update(t,e){let a=!1,r=t;for(let s of e.effects)if(s.is(Sr)){a||(a=(r=new Map(t),!0));for(let[n,o]of s.value)r.set(n,o)}return r}}),Ju=aa.define({create(){return{onResourceClick:void 0,onResourceMouseOver:void 0,onResourceMouseOut:void 0,onPromptSubmit:void 0}},update(t){return t}}),Yu=ta.define();aa.define({create(){return new Map},update(t,e){let a=!1,r=t;for(let s of e.effects)if(s.is(Yu)){a||(a=(r=new Map(t),!0));for(let[n,o]of s.value)r.set(n,o)}return r}});const Hu=(t,e)=>async a=>{let r=a.matchBefore(/@(\w+)?/);if(!r||r.from===r.to&&!a.explicit)return null;let s=await t();if(s.length===0)return null;let n=Sr.of(new Map(s.map(i=>[i.uri,i])));a.view&&a.view.dispatch({effects:n});let o=s.map(i=>({label:`@${i.name}`,displayLabel:i.name,detail:i.uri,info:i.description||void 0,type:i.mimeType?"constant":"variable",boost:i.description?100:0,...e==null?void 0:e(i),apply:(l,d,u,p)=>{l.dispatch({changes:{from:u,to:p,insert:`@${i.uri} `}})}}));return{from:r.from,options:o}},Gu=/@[\w-]+:\/\/(?!\/)[^\s]+/;function lt(t){return t.matchAll(new RegExp(Gu.source,"g"))}var Qu=class extends Kr{constructor(e,a){super();P(this,"resource");P(this,"view");this.resource=e,this.view=a}eq(e){return e.resource.uri===this.resource.uri}toDOM(){let e=document.createElement("span");e.className="cm-resource-widget",e.textContent=`@${this.resource.name}`;let a=this.view.state.field(Ju,!1),r=a==null?void 0:a.onResourceClick,s=a==null?void 0:a.onResourceMouseOver,n=a==null?void 0:a.onResourceMouseOut;return r&&(e.style.cursor="pointer",e.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation(),r(this.resource)})),s&&e.addEventListener("mouseover",o=>{o.preventDefault(),o.stopPropagation(),s(this.resource)}),n&&e.addEventListener("mouseout",o=>{o.preventDefault(),o.stopPropagation(),n(this.resource)}),e}},Xu=class extends Kr{constructor(e,a){super();P(this,"uri");P(this,"view");this.uri=e,this.view=a}eq(e){return e.uri===this.uri}toDOM(){let e=document.createElement("span");return e.className="cm-not-found-resource-widget",e.textContent=`@${this.uri.split("://")[1]??this.uri}`,e}};function wn(t){let e=t.state.field(Ge),a=[];for(let{from:r,to:s}of t.visibleRanges){let n=t.state.doc.sliceString(r,s);for(let o of lt(n)){let i=r+o.index,l=o[0].slice(1),d=e.get(l);d?a.push(Pa.replace({widget:new Qu(d,t)}).range(i,i+o[0].length)):a.push(Pa.replace({widget:new Xu(l,t)}).range(i,i+o[0].length))}}return Pa.set(a)}const ec=_i.fromClass(class{constructor(t){P(this,"decorations");this.decorations=wn(t)}update(t){(t.docChanged||t.viewportChanged||t.transactions.some(e=>e.effects.some(a=>a.is(Sr))))&&(this.decorations=wn(t.view))}},{decorations:t=>t.decorations});function tc(t){let e=document.createElement("div");e.className="cm-tooltip-cursor";let a=document.createElement("div");if(a.className="cm-tooltip-cursor-title",a.textContent=`${t.name} (${t.uri})`,e.appendChild(a),t.description){let r=document.createElement("div");r.className="cm-tooltip-cursor-description",r.textContent=t.description,e.appendChild(r)}if(t.mimeType){let r=document.createElement("div");r.className="cm-tooltip-cursor-mimetype",r.textContent=t.mimeType,e.appendChild(r)}return{dom:e}}function ac(t,e,a,r=0){for(let s of lt(t)){let n=r+s.index,o=n+s[0].length;if(e>=n&&e<=o){let i=s[0].slice(1),l=a.get(i);if(l)return{resource:l,start:n,end:o}}}return null}function rc(t){return bi((e,a)=>{let{from:r,text:s}=e.state.doc.lineAt(a),n=ac(s,a,e.state.field(Ge),r);return n?{pos:n.start,end:n.end,above:!0,create(){return(t.createTooltip??tc)(n.resource)}}:null})}function sc(t,e){let a=t.field(Ge),r=t.doc,s=r.lineAt(e),n=r.sliceString(s.from,s.to),o=Array.from(lt(n));if(o.length===0)return null;for(let i of o){let l=s.from+i.index,d=l+i[0].length,u=i[0].slice(1);if(e===d&&a.has(u))return{from:l,to:d,uri:u}}return null}function nc(t,e){let a=t.field(Ge),r=t.doc,s=r.lineAt(e).to,n=r.sliceString(e,s),o=Array.from(lt(n));if(o.length===0)return null;let i=o[0];if(!i||i.index!==0)return null;let l=e,d=e+i[0].length,u=i[0].slice(1);return a.has(u)?{from:l,to:d,uri:u}:null}function kn(t,e){let a=t.field(Ge),r=t.doc,s=r.lineAt(e),n=r.sliceString(s.from,s.to),o=Array.from(lt(n));for(let i of o){let l=s.from+i.index,d=l+i[0].length,u=i[0].slice(1);if(e>l&&e<d&&a.has(u))return{from:l,to:d,uri:u}}return null}function ic(t,e){let a=t.field(Ge),r=t.doc,s=r.lineAt(e),n=r.sliceString(s.from,e),o=Array.from(lt(n)),i=null;for(let l of o){let d=s.from+l.index,u=d+l[0].length,p=l[0].slice(1);a.has(p)&&u<=e&&(e>u?i=u:e===u&&(i=d))}return i}function oc(t,e){let a=t.field(Ge),r=t.doc,s=r.lineAt(e),n=r.sliceString(s.from,s.to),o=Array.from(lt(n));for(let i of o){let l=s.from+i.index,d=l+i[0].length,u=i[0].slice(1);if(a.has(u)&&l>=e){if(e<l)return l;if(e===l)return d}}return null}const lc=vi.transactionFilter.of(t=>{var r;let e=t.annotation(yi.userEvent);if(!e)return t;let a=t.startState.selection.main;if(!a.empty)return t;if(e==="input.type"||e.startsWith("input")){if(t.changes.empty)return t;let s=t.startState.field(Ge),n=t.startState.doc,o=!1,i=0,l=[];if(t.changes.iterChanges((d,u,p,g,v)=>{let b=v.toString(),f=d;if(/^\s+$/.test(b)){l.push({from:d,to:u,insert:b});return}let c=n.lineAt(f),h=n.sliceString(c.from,c.to),_=Array.from(lt(h)),w=!1,A=!1;for(let L of _){let D=c.from+L.index,M=D+L[0].length,Y=L[0].slice(1);if(s.has(Y)){if(f===D){let $=f>0?n.sliceString(f-1,f):"";$!==""&&$!==" "&&$!==`
`&&$!=="	"&&(w=!0)}if(f===M){let $=f<n.length?n.sliceString(f,f+1):"";($===""||$!==" "&&$!==`
`&&$!=="	")&&(A=!0)}}}let O=b;w&&(O=` ${O}`,i+=1),A&&(O=` ${O}`,i+=1),O!==b&&(o=!0),l.push({from:d,to:u,insert:O})}),o)return[{changes:l,selection:t.selection?{anchor:t.selection.main.anchor+i,head:t.selection.main.head+i}:void 0,scrollIntoView:t.scrollIntoView}]}if(e==="delete.backward"||e==="delete.forward"){let s=null;return e==="delete.backward"?s=sc(t.startState,a.head):e==="delete.forward"&&(s=nc(t.startState,a.head)),s?[{changes:{from:s.from,to:s.to,insert:""},selection:{anchor:s.from},scrollIntoView:!0}]:t}if((r=t.selection)!=null&&r.main.empty&&a.empty&&!e.startsWith("input")&&e!=="input.type"){let s=a.head,n=t.selection.main.head,o=null;if(n<s){let i=kn(t.startState,s);o=i&&s>i.from?i.from:ic(t.startState,s)}else if(n>s){let i=kn(t.startState,s);o=i&&s<i.to?i.to:oc(t.startState,s)}if(o!==null&&o!==n)return[{selection:{anchor:o},scrollIntoView:!0}]}return t}),dc=qr.baseTheme({".cm-resource-widget":{background:"light-dark(rgba(86,156,214,0.08),rgba(86,156,214,0.18))",borderRadius:"4px",padding:"2px 4px",color:"light-dark(#2367a2,#7ecbff)",fontWeight:"500"},".cm-resource-widget:hover":{background:"light-dark(rgba(86,156,214,0.18),rgba(86,156,214,0.28))"},".cm-not-found-resource-widget":{background:"light-dark(rgba(151,151,151,0.08),rgba(151,151,151,0.18))",borderRadius:"4px",padding:"2px 4px",color:"light-dark(#b00020,#ff8080)",fontWeight:"500"}});var Cn="_none_",uc=[{uri:"",name:"No resources",type:Cn,data:{}}],cc={info:"Variables, dataframes, and tables will appear here.",apply:()=>{}};function pc(t){let{language:e,store:a,onAddFiles:r}=t;return[e.data.of({autocomplete:Hu(async()=>{let s=ft(a).getAllItems();return s.length===0?uc:s},s=>{var n;return s.type===Cn?cc:((n=ft(a).getProvider(s.type))==null?void 0:n.formatCompletion(s))||{}})}),Wr.high(ra.of([{key:"Tab",run:s=>Si(s)}])),cn.of({addAttachment:s=>r==null?void 0:r([s])}),...r?[e.data.of({autocomplete:_u().createCompletionSource()})]:[],ec,lc,Ge.init(()=>{let s=ft(a).getAllItems();return new Map(s.map(n=>[n.uri,n]))}),dc,rc({createTooltip:s=>{let n=ft(a).getProvider(s.type);if(!n)return ue.warn("No provider found for resource",s),Jt(s.description||s.name);let o=n.formatCompletion(s),i=s.description||s.name;if(!(o!=null&&o.info))return Jt(i);if(typeof o.info=="string")return Jt(o.info);let l=o.info(o);return l?"dom"in l?{dom:l.dom}:"then"in l?(ue.warn("info is a promise. This is not supported",l),Jt(i)):{dom:l}:Jt(i)}})]}function Jt(t){let e=document.createElement("div");return e.innerHTML=t,{dom:e}}var Aa=ct(ja(),1),S=ct(gi(),1);const Tn=t=>{let{handleAcceptCompletion:e,handleDeclineCompletion:a,isLoading:r,hasCompletion:s}=t;return n=>{let o=hi()?n.metaKey:n.ctrlKey;o&&n.key==="Enter"&&!r&&s&&e(),(n.key==="Delete"||n.key==="Backspace")&&o&&n.shiftKey&&(a(),n.preventDefault(),n.stopPropagation())}},In=t=>{let e=(0,Aa.c)(22),{isLoading:a,onAccept:r,onDecline:s,size:n,acceptShortcut:o,declineShortcut:i,multipleCompletions:l}=t,d=n===void 0?"sm":n,u=o===void 0?"Mod-\u21B5":o,p=i===void 0?"Shift-Mod-Delete":i,g=l===void 0?!1:l,v=g&&" all",b;e[0]===u?b=e[1]:(b=(0,S.jsx)(Pt,{className:"ml-1 inline",shortcut:u}),e[0]=u,e[1]=b);let f;e[2]!==v||e[3]!==b?(f=(0,S.jsxs)("span",{className:"text-(--grass-11) opacity-100",children:["Accept",v," ",b]}),e[2]=v,e[3]=b,e[4]=f):f=e[4];let c;e[5]!==a||e[6]!==r||e[7]!==d||e[8]!==f?(c=(0,S.jsx)($e,{"data-testid":"accept-completion-button",variant:"text",size:d,className:"mb-0",disabled:a,onClick:r,children:f}),e[5]=a,e[6]=r,e[7]=d,e[8]=f,e[9]=c):c=e[9];let h=g&&" all",_;e[10]===p?_=e[11]:(_=(0,S.jsx)(Pt,{className:"ml-1 inline",shortcut:p}),e[10]=p,e[11]=_);let w;e[12]!==_||e[13]!==h?(w=(0,S.jsxs)("span",{className:"text-(--red-10)",children:["Reject",h," ",_]}),e[12]=_,e[13]=h,e[14]=w):w=e[14];let A;e[15]!==s||e[16]!==d||e[17]!==w?(A=(0,S.jsx)($e,{"data-testid":"decline-completion-button",variant:"text",size:d,className:"mb-0 pl-1 pr-0",onClick:s,children:w}),e[15]=s,e[16]=d,e[17]=w,e[18]=A):A=e[18];let O;return e[19]!==A||e[20]!==c?(O=(0,S.jsxs)(S.Fragment,{children:[c,A]}),e[19]=A,e[20]=c,e[21]=O):O=e[21],O},mc=t=>{let e=(0,Aa.c)(9),{isLoading:a,onAccept:r,onDecline:s,runCell:n}=t,o;e[0]!==a||e[1]!==r||e[2]!==n?(o=(0,S.jsx)(En,{isLoading:a,onAccept:r,size:"xs",runCell:n}),e[0]=a,e[1]=r,e[2]=n,e[3]=o):o=e[3];let i;e[4]===s?i=e[5]:(i=(0,S.jsx)(Sn,{onDecline:s,size:"xs"}),e[4]=s,e[5]=i);let l;return e[6]!==o||e[7]!==i?(l=(0,S.jsxs)(S.Fragment,{children:[o,i]}),e[6]=o,e[7]=i,e[8]=l):l=e[8],l},En=t=>{let e=(0,Aa.c)(33),{isLoading:a,onAccept:r,multipleCompletions:s,size:n,buttonStyles:o,acceptShortcut:i,runCell:l,playButtonStyles:d}=t,u=s===void 0?!1:s,p=n===void 0?"sm":n,g;e[0]!==r||e[1]!==l?(g=()=>{r(),l&&l()},e[0]=r,e[1]=l,e[2]=g):g=e[2];let v=g,b=u?"Accept all":"Accept";if(l){let _=`h-6 text-(--grass-11) bg-(--grass-3)/60
    hover:bg-(--grass-3) dark:bg-(--grass-4)/80 dark:hover:bg-(--grass-3) font-semibold
    active:bg-(--grass-5) dark:active:bg-(--grass-4)
    border-(--green-6) border hover:shadow-xs rounded-r-none ${o}`,w;e[3]===i?w=e[4]:(w=i&&(0,S.jsx)(Pt,{className:"ml-1 inline",shortcut:i}),e[3]=i,e[4]=w);let A;e[5]!==a||e[6]!==r||e[7]!==p||e[8]!==_||e[9]!==w||e[10]!==b?(A=(0,S.jsxs)($e,{variant:"text",size:p,disabled:a,onClick:r,className:_,children:[b,w]}),e[5]=a,e[6]=r,e[7]=p,e[8]=_,e[9]=w,e[10]=b,e[11]=A):A=e[11];let O=u?"Accept and run all cells":"Accept and run cell",L=`h-6 text-(--grass-11) bg-(--grass-3)/60
    hover:bg-(--grass-3) dark:bg-(--grass-4)/80 dark:hover:bg-(--grass-3) font-semibold
    active:bg-(--grass-5) dark:active:bg-(--grass-4)
    border-(--green-6) border hover:shadow-xs rounded-l-none px-1.5 ${d}`,D;e[12]===Symbol.for("react.memo_cache_sentinel")?(D=(0,S.jsx)(Bi,{className:"h-2.5 w-2.5"}),e[12]=D):D=e[12];let M;e[13]!==v||e[14]!==a||e[15]!==p||e[16]!==L?(M=(0,S.jsx)($e,{variant:"text",size:p,disabled:a,onClick:v,className:L,children:D}),e[13]=v,e[14]=a,e[15]=p,e[16]=L,e[17]=M):M=e[17];let Y;e[18]!==M||e[19]!==O?(Y=(0,S.jsx)(Ki,{content:O,children:M}),e[18]=M,e[19]=O,e[20]=Y):Y=e[20];let $;return e[21]!==Y||e[22]!==A?($=(0,S.jsxs)("div",{className:"flex",children:[A,Y]}),e[21]=Y,e[22]=A,e[23]=$):$=e[23],$}let f=`h-6 text-(--grass-11) bg-(--grass-3)/60
    hover:bg-(--grass-3) dark:bg-(--grass-4)/80 dark:hover:bg-(--grass-3) font-semibold
    active:bg-(--grass-5) dark:active:bg-(--grass-4)
    border-(--green-6) border hover:shadow-xs rounded px-3 ${o}`,c;e[24]===i?c=e[25]:(c=i&&(0,S.jsx)(Pt,{className:"ml-1 inline",shortcut:i}),e[24]=i,e[25]=c);let h;return e[26]!==a||e[27]!==r||e[28]!==p||e[29]!==f||e[30]!==c||e[31]!==b?(h=(0,S.jsxs)($e,{variant:"text",size:p,disabled:a,onClick:r,className:f,children:[b,c]}),e[26]=a,e[27]=r,e[28]=p,e[29]=f,e[30]=c,e[31]=b,e[32]=h):h=e[32],h},Sn=t=>{let e=(0,Aa.c)(8),{onDecline:a,multipleCompletions:r,size:s,className:n,declineShortcut:o}=t,i=r===void 0?!1:r,l=s===void 0?"sm":s,d=`h-6 text-(--red-10) bg-(--red-3)/60 hover:bg-(--red-3)
    dark:bg-(--red-4)/80 dark:hover:bg-(--red-3) rounded px-3 font-semibold
    active:bg-(--red-5) dark:active:bg-(--red-4)
    border-(--red-6) border hover:shadow-xs ${n}`,u=i&&" all",p;e[0]===o?p=e[1]:(p=o&&(0,S.jsx)(Pt,{className:"ml-1 inline",shortcut:o}),e[0]=o,e[1]=p);let g;return e[2]!==a||e[3]!==l||e[4]!==d||e[5]!==u||e[6]!==p?(g=(0,S.jsxs)($e,{variant:"text",size:l,onClick:a,className:d,children:["Reject",u,p]}),e[2]=a,e[3]=l,e[4]=d,e[5]=u,e[6]=p,e[7]=g):g=e[7],g};var hc=class extends nr{constructor(t,e){super(t),this.onChunkReceived=e}processResponseStream(t){let e=this.onChunkReceived;return super.processResponseStream(t).pipeThrough(new TransformStream({async transform(a,r){e(a),r.enqueue(a)}}))}},An=ct(ja(),1),fc=ni("marimo:ai-language","python",di),On="marimo:ai-prompt-history",Nn=new Hn(Ce(m()),()=>[]);const gc=t=>{let e=(0,An.c)(89),{onClose:a}=t,r=Zr(),[s,n]=(0,R.useState)(""),{deleteAllStagedCells:o,clearStagedCells:i,onStream:l,addStagedCell:d}=hn(r),[u,p]=qn(fc),g=fi(),{invokeAiTool:v,sendRun:b}=Ti(),f=Bn(qt),c=(0,R.useRef)(null),{createNewCell:h,prepareForRun:_}=Fr(),w;e[0]!==d||e[1]!==h||e[2]!==_||e[3]!==b||e[4]!==r?(w={store:r,addStagedCell:d,createNewCell:h,prepareForRun:_,sendRun:b},e[0]=d,e[1]=h,e[2]=_,e[3]=b,e[4]=r,e[5]=w):w=e[5];let A=w,O;if(e[6]!==u||e[7]!==l||e[8]!==g){let Se;e[10]===u?Se=e[11]:(Se=async Qt=>{let Fn=await vn(Qt.messages);return{body:{...Qt,...Fn,code:"",prompt:"",language:u}}},e[10]=u,e[11]=Se);let tt;e[12]===l?tt=e[13]:(tt=Qt=>{l(Qt)},e[12]=l,e[13]=tt),O=new hc({api:g.getAiURL("completion").toString(),headers:g.headers(),prepareSendMessagesRequest:Se},tt),e[6]=u,e[7]=l,e[8]=g,e[9]=O}else O=e[9];let{sendMessage:L,stop:D,status:M,addToolResult:Y}=nn({experimental_throttle:100,transport:O,onToolCall:async Se=>{let{toolCall:tt}=Se;await _n({invokeAiTool:v,addToolResult:$,toolCall:{toolName:tt.toolName,toolCallId:tt.toolCallId,input:tt.input},toolContext:A})},onError:yc}),$=Y,K=M==="streaming"||M==="submitted",ee=f.size>0,se=f.size>1,Q;e[14]!==o||e[15]!==s||e[16]!==K||e[17]!==L?(Q=()=>{var Se;K||((Se=c.current)!=null&&Se.view&&xn(c.current.view),o(),L({text:s}))},e[14]=o,e[15]=s,e[16]=K,e[17]=L,e[18]=Q):Q=e[18];let J=Q,X;e[19]===Symbol.for("react.memo_cache_sentinel")?(X=(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(ro,{className:"size-4 mr-2"}),"Python"]}),e[19]=X):X=e[19];let ce=X,te;e[20]===Symbol.for("react.memo_cache_sentinel")?(te=(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(Jn,{className:"size-4 mr-2"}),"SQL"]}),e[20]=te):te=e[20];let dt=te,je=u==="python"?ce:dt,Ie;e[21]===Symbol.for("react.memo_cache_sentinel")?(Ie=(0,S.jsx)(ki,{className:"ml-1 h-3.5 w-3.5 text-muted-foreground/70"}),e[21]=Ie):Ie=e[21];let fe;e[22]===je?fe=e[23]:(fe=(0,S.jsx)(Li,{asChild:!0,children:(0,S.jsxs)($e,{variant:"text",className:"ml-2",size:"xs","data-testid":"language-button",children:[je,Ie]})}),e[22]=je,e[23]=fe);let ze,Qe;e[24]===Symbol.for("react.memo_cache_sentinel")?(ze=(0,S.jsx)("div",{className:"px-2 py-1 font-semibold",children:"Select language"}),Qe=(0,S.jsx)($i,{}),e[24]=ze,e[25]=Qe):(ze=e[24],Qe=e[25]);let Ee;e[26]===p?Ee=e[27]:(Ee=(0,S.jsx)(Gr,{onClick:()=>p("python"),children:ce}),e[26]=p,e[27]=Ee);let Ue;e[28]===p?Ue=e[29]:(Ue=(0,S.jsx)(Gr,{onClick:()=>p("sql"),children:dt}),e[28]=p,e[29]=Ue);let Ve;e[30]!==Ee||e[31]!==Ue?(Ve=(0,S.jsxs)(Di,{align:"center",children:[ze,Qe,Ee,Ue]}),e[30]=Ee,e[31]=Ue,e[32]=Ve):Ve=e[32];let gt;e[33]!==fe||e[34]!==Ve?(gt=(0,S.jsxs)(Fi,{modal:!1,children:[fe,Ve]}),e[33]=fe,e[34]=Ve,e[35]=gt):gt=e[35];let Nt=gt,Pe;e[36]!==i||e[37]!==a?(Pe=()=>{i(),a()},e[36]=i,e[37]=a,e[38]=Pe):Pe=e[38];let Be=Pe,W;e[39]===o?W=e[40]:(W=()=>{o()},e[39]=o,e[40]=W);let V=W,ne;e[41]===Symbol.for("react.memo_cache_sentinel")?(ne=(0,S.jsx)(qi,{className:"size-4 text-(--blue-11) mr-2"}),e[41]=ne):ne=e[41];let B;e[42]!==o||e[43]!==a?(B=()=>{o(),a()},e[42]=o,e[43]=a,e[44]=B):B=e[44];let we;e[45]===Symbol.for("react.memo_cache_sentinel")?(we=Se=>{n(Se)},e[45]=we):we=e[45];let ge;e[46]!==Be||e[47]!==V||e[48]!==ee||e[49]!==K?(ge=Tn({handleAcceptCompletion:Be,handleDeclineCompletion:V,isLoading:K,hasCompletion:ee}),e[46]=Be,e[47]=V,e[48]=ee,e[49]=K,e[50]=ge):ge=e[50];let oe;e[51]!==s||e[52]!==J||e[53]!==B||e[54]!==ge?(oe=(0,S.jsx)(Rn,{inputRef:c,onClose:B,value:s,onChange:we,onSubmit:J,onKeyDown:ge}),e[51]=s,e[52]=J,e[53]=B,e[54]=ge,e[55]=oe):oe=e[55];let ie;e[56]!==K||e[57]!==D?(ie=K&&(0,S.jsxs)($e,{"data-testid":"stop-completion-button",variant:"text",size:"sm",className:"mb-0",onClick:D,children:[(0,S.jsx)(zi,{className:"animate-spin mr-1",size:14}),"Stop"]}),e[56]=K,e[57]=D,e[58]=ie):ie=e[58];let ve;e[59]===Symbol.for("react.memo_cache_sentinel")?(ve=(0,S.jsx)(no,{className:"size-4"}),e[59]=ve):ve=e[59];let We;e[60]===J?We=e[61]:(We=(0,S.jsx)($e,{variant:"text",size:"sm",onClick:J,title:"Submit",children:ve}),e[60]=J,e[61]=We);let ut;e[62]===Symbol.for("react.memo_cache_sentinel")?(ut=(0,S.jsx)(Pi,{className:"size-4"}),e[62]=ut):ut=e[62];let qe;e[63]===a?qe=e[64]:(qe=(0,S.jsx)($e,{variant:"text",size:"sm",className:"mb-0 px-1",onClick:a,children:ut}),e[63]=a,e[64]=qe);let pe;e[65]!==oe||e[66]!==ie||e[67]!==We||e[68]!==qe?(pe=(0,S.jsxs)("div",{className:"flex items-center px-3",children:[ne,oe,ie,We,qe]}),e[65]=oe,e[66]=ie,e[67]=We,e[68]=qe,e[69]=pe):pe=e[69];let _e=pe,Xe;e[70]===Symbol.for("react.memo_cache_sentinel")?(Xe=Br("flex flex-col w-full gap-2 py-2"),e[70]=Xe):Xe=e[70];let et;e[71]===ee?et=e[72]:(et=!ee&&(0,S.jsxs)("span",{className:"text-xs text-muted-foreground px-3 flex flex-col gap-1",children:[(0,S.jsxs)("span",{children:["You can mention"," ",(0,S.jsx)("span",{className:"text-(--cyan-11)",children:"@dataframe"})," or"," ",(0,S.jsx)("span",{className:"text-(--cyan-11)",children:"@sql_table"})," to pull additional context such as column names."]}),(0,S.jsx)("span",{children:"Code from other cells is automatically included."})]}),e[71]=ee,e[72]=et);let Ze;e[73]!==Be||e[74]!==V||e[75]!==ee||e[76]!==K||e[77]!==se?(Ze=ee&&(0,S.jsx)(In,{isLoading:K,onAccept:Be,onDecline:V,size:"sm",multipleCompletions:se}),e[73]=Be,e[74]=V,e[75]=ee,e[76]=K,e[77]=se,e[78]=Ze):Ze=e[78];let Ht;e[79]===Symbol.for("react.memo_cache_sentinel")?(Ht=(0,S.jsx)(ji,{triggerClassName:"h-7 text-xs max-w-64",iconSize:"small",forRole:"edit"}),e[79]=Ht):Ht=e[79];let yt;e[80]===Nt?yt=e[81]:(yt=(0,S.jsxs)("div",{className:"ml-auto flex items-center gap-1",children:[Nt,Ht]}),e[80]=Nt,e[81]=yt);let vt;e[82]!==et||e[83]!==Ze||e[84]!==yt?(vt=(0,S.jsxs)("div",{className:"flex flex-row justify-between -mt-1 ml-1 mr-3",children:[et,Ze,yt]}),e[82]=et,e[83]=Ze,e[84]=yt,e[85]=vt):vt=e[85];let Gt;return e[86]!==_e||e[87]!==vt?(Gt=(0,S.jsxs)("div",{className:Xe,children:[_e,vt]}),e[86]=_e,e[87]=vt,e[88]=Gt):Gt=e[88],Gt},Rn=t=>{let e=(0,An.c)(35),{value:a,placeholder:r,inputRef:s,className:n,onChange:o,onSubmit:i,onKeyDown:l,onClose:d,onAddFiles:u,additionalCompletions:p,maxHeight:g}=t,v=i,b=d,f=Zr(),{theme:c}=Mi(),h;e[0]===p?h=e[1]:(h=ce=>p?Cu([p.triggerCompletionRegex],p.completions)(ce):null,e[0]=p,e[1]=h);let _=Yi(h),w,A,O,L;if(e[2]!==_||e[3]!==u||e[4]!==f){let ce=Ni();e[9]===Symbol.for("react.memo_cache_sentinel")?(w=Oi({}),e[9]=w):w=e[9],A=ce,O=pc({language:ce.language,store:f,onAddFiles:u}),L=ce.language.data.of({autocomplete:_}),e[2]=_,e[3]=u,e[4]=f,e[5]=w,e[6]=A,e[7]=O,e[8]=L}else w=e[5],A=e[6],O=e[7],L=e[8];let D;e[10]===Symbol.for("react.memo_cache_sentinel")?(D=Ku({storage:{load:vc,save:_c}}),e[10]=D):D=e[10];let M;e[11]===Symbol.for("react.memo_cache_sentinel")?(M=Qi(),e[11]=M):M=e[11];let Y;e[12]===v?Y=e[13]:(Y=Wr.highest(ra.of([{preventDefault:!0,stopPropagation:!0,any:(ce,te)=>{let dt=te.metaKey||te.ctrlKey||te.shiftKey;if(te.key==="Enter"&&!dt)return v(te,ce.state.doc.toString()),te.preventDefault(),te.stopPropagation(),!0;if(te.key==="Enter"&&te.shiftKey){let je=ce.state.selection.main.from;return ce.dispatch({changes:{from:je,to:je,insert:`
`},selection:{anchor:je+1,head:je+1}}),te.preventDefault(),te.stopPropagation(),!0}return!1}}])),e[12]=v,e[13]=Y);let $;e[14]===b?$=e[15]:($=ra.of([{key:"Escape",preventDefault:!0,stopPropagation:!0,run:()=>(b(),!0)}]),e[14]=b,e[15]=$);let K;e[16]!==w||e[17]!==A||e[18]!==O||e[19]!==L||e[20]!==Y||e[21]!==$?(K=[w,A,O,L,D,qr.lineWrapping,M,Y,$],e[16]=w,e[17]=A,e[18]=O,e[19]=L,e[20]=Y,e[21]=$,e[22]=K):K=e[22];let ee=K,se;e[23]===n?se=e[24]:(se=Br("flex-1 font-sans overflow-auto my-1",n),e[23]=n,e[24]=se);let Q=c==="dark"?"dark":"light",J=r||"Generate with AI, @ to include context",X;return e[25]!==ee||e[26]!==s||e[27]!==g||e[28]!==o||e[29]!==l||e[30]!==se||e[31]!==Q||e[32]!==J||e[33]!==a?(X=(0,S.jsx)(Xi,{ref:s,className:se,width:"100%",maxHeight:g,value:a,basicSetup:!1,extensions:ee,onChange:o,onKeyDown:l,theme:Q,placeholder:J}),e[25]=ee,e[26]=s,e[27]=g,e[28]=o,e[29]=l,e[30]=se,e[31]=Q,e[32]=J,e[33]=a,e[34]=X):X=e[34],X};function yc(t){Yr({title:"Generate with AI failed",description:Hi(t)})}function vc(){return Nn.get(On)}function _c(t){return Nn.set(On,t)}export{xu as C,nr as D,du as E,so as O,Tu as S,nn as T,Cr as _,mc as a,hn as b,xn as c,Du as d,_n as f,Lu as g,Tr as h,In as i,vn as l,zu as m,Rn as n,Sn as o,Uu as p,En as r,Tn as s,gc as t,Fu as u,qt as v,ft as w,bu as x,mn as y};
