import{s as p}from"./chunk-DZLz74EQ.js";import{c as x,d as _}from"./jotai-BTnrNcC1.js";import{t as j}from"./react-BcIddLXZ.js";import{_r as N,vr as u}from"./cells-A69p56PE.js";import{t as y}from"./compiler-runtime-Cr9loedd.js";import{o as R}from"./utils-DEDX0RLo.js";import{t as w}from"./jsx-runtime-mwDPpfh_.js";import{t as z}from"./mode-Bq6LjPC-.js";import{t as k}from"./usePress-BO20vkQb.js";import{t as C}from"./copy-icon-CE7wmMnS.js";import{t as A}from"./purify.es-CPMOFAIu.js";import{t as F}from"./useRunCells-BLpH_l8E.js";var H=p(y(),1),m=p(j(),1),s=p(w(),1);const M=e=>{let t=(0,H.c)(16),r,i,a;t[0]===e?(r=t[1],i=t[2],a=t[3]):({href:i,children:r,...a}=e,t[0]=e,t[1]=r,t[2]=i,t[3]=a);let o=(0,m.useRef)(null),l;t[4]===i?l=t[5]:(l=()=>{let h=new URL(globalThis.location.href);h.hash=i,globalThis.history.pushState({},"",h.toString());let S=i.slice(1),v=document.getElementById(S);v&&v.scrollIntoView({behavior:"smooth",block:"start"})},t[4]=i,t[5]=l);let n=l,c;t[6]===n?c=t[7]:(c={onPress:()=>{n()}},t[6]=n,t[7]=c);let{pressProps:g}=k(c),f;t[8]===n?f=t[9]:(f=h=>{h.preventDefault(),n()},t[8]=n,t[9]=f);let E=f,d;return t[10]!==r||t[11]!==E||t[12]!==i||t[13]!==g||t[14]!==a?(d=(0,s.jsx)("a",{ref:o,href:i,...g,onClick:E,...a,children:r}),t[10]=r,t[11]=E,t[12]=i,t[13]=g,t[14]=a,t[15]=d):d=t[15],d};var L=_(e=>{let t=e(F),r=e(R);if(t||r)return!1;let i=!0;try{i=z()==="read"}catch{return!0}return!i});function O(){return x(L)}var b="data-temp-href-target";A.addHook("beforeSanitizeAttributes",e=>{e.tagName==="A"&&(e.hasAttribute("target")||e.setAttribute("target","_self"),e.hasAttribute("target")&&e.setAttribute(b,e.getAttribute("target")||""))}),A.addHook("afterSanitizeAttributes",e=>{e.tagName==="A"&&e.hasAttribute(b)&&(e.setAttribute("target",e.getAttribute(b)||""),e.removeAttribute(b),e.getAttribute("target")==="_blank"&&e.setAttribute("rel","noopener"))});function T(e){let t={USE_PROFILES:{html:!0,svg:!0,mathMl:!0},FORCE_BODY:!0,CUSTOM_ELEMENT_HANDLING:{tagNameCheck:/^(marimo-[A-Za-z][\w-]*|iconify-icon)$/,attributeNameCheck:/^[A-Za-z][\w-]*$/},SAFE_FOR_XML:e.includes("marimo-mermaid")};return A.sanitize(e,t)}var I=p(y(),1),D=e=>{if(e instanceof u.Element&&!/^[A-Za-z][\w-]*$/.test(e.name))return m.createElement(m.Fragment)},V=(e,t)=>{if(t instanceof u.Element&&t.name==="body"){if((0,m.isValidElement)(e)&&"props"in e){let r=e.props.children;return(0,s.jsx)(s.Fragment,{children:r})}return}},W=(e,t)=>{if(t instanceof u.Element&&t.name==="html"){if((0,m.isValidElement)(e)&&"props"in e){let r=e.props.children;return(0,s.jsx)(s.Fragment,{children:r})}return}},$=e=>{if(e instanceof u.Element&&e.attribs&&e.name==="iframe"){let t=document.createElement("iframe");return Object.entries(e.attribs).forEach(([r,i])=>{r.startsWith('"')&&r.endsWith('"')&&(r=r.slice(1,-1)),t.setAttribute(r,i)}),(0,s.jsx)("div",{dangerouslySetInnerHTML:{__html:t.outerHTML}})}},P=e=>{if(e instanceof u.Element&&e.name==="script"){let t=e.attribs.src;if(!t)return;if(!document.querySelector(`script[src="${t}"]`)){let r=document.createElement("script");r.src=t,document.head.append(r)}return(0,s.jsx)(s.Fragment,{})}},U=(e,t)=>{if(t instanceof u.Element&&t.name==="a"){let r=t.attribs.href;if(r!=null&&r.startsWith("#")&&!r.startsWith("#code/")){let i=null;return(0,m.isValidElement)(e)&&"props"in e&&(i=e.props.children),(0,s.jsx)(M,{href:r,...t.attribs,children:i})}}},Z=(e,t,r)=>{var i,a;if(t instanceof u.Element&&t.name==="div"&&((a=(i=t.attribs)==null?void 0:i.class)!=null&&a.includes("codehilite")))return(0,s.jsx)(B,{children:e},r)},B=e=>{let t=(0,I.c)(3),{children:r}=e,i=(0,m.useRef)(null),a;t[0]===Symbol.for("react.memo_cache_sentinel")?(a=(0,s.jsx)("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,s.jsx)(C,{tooltip:!1,className:"p-1",value:()=>{var n;let l=(n=i.current)==null?void 0:n.firstChild;return l&&l.textContent||""}})}),t[0]=a):a=t[0];let o;return t[1]===r?o=t[2]:(o=(0,s.jsxs)("div",{className:"relative group codehilite-wrapper",ref:i,children:[r,a]}),t[1]=r,t[2]=o),o};const q=({html:e,additionalReplacements:t=[],alwaysSanitizeHtml:r=!0})=>(0,s.jsx)(G,{html:e,alwaysSanitizeHtml:r,additionalReplacements:t});var G=({html:e,additionalReplacements:t=[],alwaysSanitizeHtml:r})=>{let i=O();return X({html:(0,m.useMemo)(()=>r||i?T(e):e,[e,r,i]),additionalReplacements:t})};function X({html:e,additionalReplacements:t=[]}){let r=[D,$,P,...t],i=[Z,U,V,W];return N(e,{replace:(a,o)=>{for(let l of r){let n=l(a,o);if(n)return n}return a},transform:(a,o,l)=>{for(let n of i){let c=n(a,o,l);if(c)return c}return a}})}export{q as t};
