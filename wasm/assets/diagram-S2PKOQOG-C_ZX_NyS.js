var g;import"./_Uint8Array-D5Z9rM2X.js";import"./isSymbol-xTSywenE.js";import"./_arrayMap-DQI2GUNb.js";import"./toString-CBnct2wx.js";import"./toNumber-CTOPJrpu.js";import"./toInteger-Bor4StOs.js";import"./isArrayLikeObject-DKyJYtr8.js";import"./_getTag-CVRrQL_Q.js";import"./_baseUniq-DHpyQ0iZ.js";import"./reduce-BDKuIPQC.js";import"./_baseIsEqual-CVFfFJm2.js";import"./chunk-4KMFLZZN-ezSWKPWV.js";import"./_toKey-16owuO_q.js";import"./memoize-DhF8x4Aa.js";import"./get-BUGWIXZE.js";import"./_baseFlatten-ViL-mfkw.js";import"./_basePickBy-CSDa7ReR.js";import"./merge-Dvc5opZF.js";import"./_baseSlice-BWZ0PeaJ.js";import"./_arrayReduce-DV4IVFuG.js";import"./clone-Cq89YAb4.js";import"./_baseEach-CMG9RfnR.js";import"./hasIn-BgJKauE7.js";import"./_baseProperty-c4IQJQis.js";import"./_createAggregator-CP8XSJVt.js";import"./min-OzDpO0MS.js";import"./_baseMap-Cw6xPrGQ.js";import"./isString-Cwbr2gIw.js";import"./isEmpty-B-9PYDiJ.js";import"./_baseSet-L2qemYhz.js";import"./uniq-pTjN93Sd.js";import"./preload-helper-BnutJmlU.js";import"./main-ChjX94eX.js";import"./purify.es-CPMOFAIu.js";import"./timer-CTpu0Fa6.js";import"./src-BwH0YUPh.js";import"./math-B-uM5inP.js";import"./step-BDtirdXu.js";import{i as u}from"./chunk-S3R3BYOJ-BW8g0Zog.js";import{n as f,r as y}from"./src-BuVGraFB.js";import{B as C,C as v,U as P,_ as z,a as S,c as E,d as F,v as T,y as W,z as D}from"./chunk-ABZYJK2D-Cm5Mq_1V.js";import{t as A}from"./chunk-EXTU4WIE-DUVoiM8z.js";import"./dist-DiomJpDg.js";import"./chunk-JEIROHC2-DJ3tpwJA.js";import"./chunk-BN7GFLIU-B2OO_dsW.js";import"./chunk-T44TD3VJ-ob7Tm16D.js";import"./chunk-KMC2YHZD-aZ_clHHw.js";import"./chunk-WFWHJNB7-BdOad_I6.js";import"./chunk-WFRQ32O7-DaR0-qal.js";import"./chunk-XRWGC2XP-bK3mWGs8.js";import{t as R}from"./chunk-4BX2VUAB-CEk5Yddb.js";import{t as Y}from"./mermaid-parser.core-NXSENIcQ.js";var _=F.packet,w=(g=class{constructor(){this.packet=[],this.setAccTitle=C,this.getAccTitle=T,this.setDiagramTitle=P,this.getDiagramTitle=v,this.getAccDescription=z,this.setAccDescription=D}getConfig(){let t=u({..._,...W().packet});return t.showBits&&(t.paddingY+=10),t}getPacket(){return this.packet}pushWord(t){t.length>0&&this.packet.push(t)}clear(){S(),this.packet=[]}},f(g,"PacketDB"),g),H=1e4,L=f((r,t)=>{R(r,t);let i=-1,a=[],l=1,{bitsPerRow:p}=t.getConfig();for(let{start:e,end:s,bits:d,label:n}of r.blocks){if(e!==void 0&&s!==void 0&&s<e)throw Error(`Packet block ${e} - ${s} is invalid. End must be greater than start.`);if(e??(e=i+1),e!==i+1)throw Error(`Packet block ${e} - ${s??e} is not contiguous. It should start from ${i+1}.`);if(d===0)throw Error(`Packet block ${e} is invalid. Cannot have a zero bit field.`);for(s??(s=e+(d??1)-1),d??(d=s-e+1),i=s,y.debug(`Packet block ${e} - ${i} with label ${n}`);a.length<=p+1&&t.getPacket().length<H;){let[c,o]=M({start:e,end:s,bits:d,label:n},l,p);if(a.push(c),c.end+1===l*p&&(t.pushWord(a),a=[],l++),!o)break;({start:e,end:s,bits:d,label:n}=o)}}t.pushWord(a)},"populate"),M=f((r,t,i)=>{if(r.start===void 0)throw Error("start should have been set during first phase");if(r.end===void 0)throw Error("end should have been set during first phase");if(r.start>r.end)throw Error(`Block start ${r.start} is greater than block end ${r.end}.`);if(r.end+1<=t*i)return[r,void 0];let a=t*i-1,l=t*i;return[{start:r.start,end:a,label:r.label,bits:a-r.start},{start:l,end:r.end,label:r.label,bits:r.end-l}]},"getNextFittingBlock"),x={parser:{yy:void 0},parse:f(async r=>{var a;let t=await Y("packet",r),i=(a=x.parser)==null?void 0:a.yy;if(!(i instanceof w))throw Error("parser.parser?.yy was not a PacketDB. This is due to a bug within Mermaid, please report this issue at https://github.com/mermaid-js/mermaid/issues.");y.debug(t),L(t,i)},"parse")},j=f((r,t,i,a)=>{let l=a.db,p=l.getConfig(),{rowHeight:e,paddingY:s,bitWidth:d,bitsPerRow:n}=p,c=l.getPacket(),o=l.getDiagramTitle(),h=e+s,m=h*(c.length+1)-(o?0:e),b=d*n+2,k=A(t);k.attr("viewbox",`0 0 ${b} ${m}`),E(k,m,b,p.useMaxWidth);for(let[$,B]of c.entries())I(k,B,$,p);k.append("text").text(o).attr("x",b/2).attr("y",m-h/2).attr("dominant-baseline","middle").attr("text-anchor","middle").attr("class","packetTitle")},"draw"),I=f((r,t,i,{rowHeight:a,paddingX:l,paddingY:p,bitWidth:e,bitsPerRow:s,showBits:d})=>{let n=r.append("g"),c=i*(a+p)+p;for(let o of t){let h=o.start%s*e+1,m=(o.end-o.start+1)*e-l;if(n.append("rect").attr("x",h).attr("y",c).attr("width",m).attr("height",a).attr("class","packetBlock"),n.append("text").attr("x",h+m/2).attr("y",c+a/2).attr("class","packetLabel").attr("dominant-baseline","middle").attr("text-anchor","middle").text(o.label),!d)continue;let b=o.end===o.start,k=c-2;n.append("text").attr("x",h+(b?m/2:0)).attr("y",k).attr("class","packetByte start").attr("dominant-baseline","auto").attr("text-anchor",b?"middle":"start").text(o.start),b||n.append("text").attr("x",h+m).attr("y",k).attr("class","packetByte end").attr("dominant-baseline","auto").attr("text-anchor","end").text(o.end)}},"drawWord"),N={draw:j},U={byteFontSize:"10px",startByteColor:"black",endByteColor:"black",labelColor:"black",labelFontSize:"12px",titleColor:"black",titleFontSize:"14px",blockStrokeColor:"black",blockStrokeWidth:"1",blockFillColor:"#efefef"},X={parser:x,get db(){return new w},renderer:N,styles:f(({packet:r}={})=>{let t=u(U,r);return`
	.packetByte {
		font-size: ${t.byteFontSize};
	}
	.packetByte.start {
		fill: ${t.startByteColor};
	}
	.packetByte.end {
		fill: ${t.endByteColor};
	}
	.packetLabel {
		fill: ${t.labelColor};
		font-size: ${t.labelFontSize};
	}
	.packetTitle {
		fill: ${t.titleColor};
		font-size: ${t.titleFontSize};
	}
	.packetBlock {
		stroke: ${t.blockStrokeColor};
		stroke-width: ${t.blockStrokeWidth};
		fill: ${t.blockFillColor};
	}
	`},"styles")};export{X as diagram};
