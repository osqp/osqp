var Se=Object.defineProperty;var Pe=(t,e,r)=>e in t?Se(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var O=(t,e,r)=>Pe(t,typeof e!="symbol"?e+"":e,r);import{s as U}from"./chunk-DZLz74EQ.js";import{c as _e,d as ce,n as Oe,s as me}from"./jotai-BTnrNcC1.js";import{t as Me}from"./react-BcIddLXZ.js";import{Pt as ze,w as Re,xn as ae}from"./cells-A69p56PE.js";import"./react-dom-D6bRRS5R.js";import"./zod-U2NFpcFA.js";import{t as ie}from"./compiler-runtime-Cr9loedd.js";import"./_Uint8Array-D5Z9rM2X.js";import"./isSymbol-xTSywenE.js";import"./_arrayMap-DQI2GUNb.js";import"./toString-CBnct2wx.js";import"./toNumber-CTOPJrpu.js";import"./toInteger-Bor4StOs.js";import"./isArrayLikeObject-DKyJYtr8.js";import"./_getTag-CVRrQL_Q.js";import"./_baseIsEqual-CVFfFJm2.js";import"./merge-Dvc5opZF.js";import"./_baseSlice-BWZ0PeaJ.js";import"./upperFirst-CBQfDRod.js";import"./_hasUnicode-3DIK_jNi.js";import"./capitalize-CBqvgOfA.js";import"./_arrayReduce-DV4IVFuG.js";import"./startCase-RfubwhHM.js";import"./_baseProperty-c4IQJQis.js";import"./now-BXqTLlmI.js";import"./debounce-BUM2losY.js";import"./tooltip-BFMRXuzR.js";import"./range-ZclXTdAh.js";import{d as Ae,u as We}from"./hotkeys-ClCtr3_I.js";import{t as Ie}from"./invariant-D5a0EE05.js";import{f as Ee}from"./utils-DEDX0RLo.js";import"./constants-CEISdYm1.js";import{g as Q}from"./config-C6qInAhC.js";import"./ErrorBoundary-_uEOjNWh.js";import"./useEventListener-D1FLsfmf.js";import{t as He}from"./jsx-runtime-mwDPpfh_.js";import"./clsx-BlAkgCmw.js";import{t as re}from"./cn-ZXtYmczU.js";import{n as qe,t as V}from"./button-ZC2axIBq.js";import{bt as Be,rt as Te}from"./dist-MHIqsPCF.js";import"./dist-CbvGwhr0.js";import{R as $e,a as Ve,i as Le,o as Ue,r as Ke,s as Ye}from"./Output-DWmT-7NV.js";import"./once-C5bmD4W5.js";import"./capabilities-srilPYuF.js";import"./cjs-Ck8KMDI1.js";import"./createReducer-CeLhipaI.js";import{n as Ze,r as oe}from"./requests-BACZP_uj.js";import"./preload-helper-BnutJmlU.js";import"./dist-8_YHxBVW.js";import"./dist-C14Sk-Bd.js";import"./dist-DJV2CjUA.js";import"./dist-CPUmJw_F.js";import"./dist-DcDuMWp5.js";import"./dist-vBG1bGij.js";import"./stex-xveX5l_T.js";import"./Deferred-NfAvvkGM.js";import"./uuid-D0hUC3Qw.js";import"./key-Cx1qY8eM.js";import{t as z}from"./use-toast-midBZAtS.js";import"./main-ChjX94eX.js";import"./marked.esm-BV7g2d65.js";import"./connection-Bs4SQ_vu.js";import"./dist-Oad1venD.js";import"./useLifecycle-DogGOXPh.js";import{n as Ge}from"./useTheme-Biy2QI0v.js";import{t as L}from"./createLucideIcon-CNVopWor.js";import{t as Je}from"./arrow-left-C_-paiHG.js";import{t as Qe}from"./between-horizontal-start-CC0exyFi.js";import"./type-o43RKOcp.js";import"./table-C2gUjtJV.js";import"./check-CuBLr6Cm.js";import{_ as Xe}from"./select-5fcaZwou.js";import{n as et,t as pe}from"./download-ByFIcaoi.js";import{t as tt}from"./chevron-right-BV0VfNbL.js";import{_ as se}from"./maps-B1z3jt-a.js";import"./toDate-C3oOx2yr.js";import{a as F,c as K,p as at,r as it,t as rt}from"./dropdown-menu-uN_XMhZm.js";import{t as he}from"./copy-Dy_tLkL8.js";import{t as fe}from"./download-ptuQ0M1w.js";import{t as ot}from"./ellipsis-vertical-D4kjq0HQ.js";import{n as xe,r as st,t as nt}from"./types-Bh2kSb2q.js";import"./file-video-camera-DJUITpag.js";import{t as ue}from"./file-plus-2-SQa07cq2.js";import"./file-text-CFgIi1A4.js";import"./file-Cz8xVTWu.js";import{t as lt}from"./spinner-CuquyDWA.js";import"./MarimoErrorOutput-BATnwNYX.js";import{t as dt}from"./refresh-ccw-Dg4gNnPm.js";import{t as ct}from"./save-M3l4CifW.js";import"./input-BNb8K99m.js";import"./state-JZFfOGr9.js";import{t as mt}from"./trash-2-BPux4_UF.js";import{i as pt,n as ht,t as ft}from"./es-vLBD1nBl.js";import"./badge-Jfhpc30N.js";import"./Combination-BjaZc6gK.js";import"./dist-o-4-WxUj.js";import{t as M}from"./tooltip-BHnVWzH0.js";import"./menu-items-DwOFR2Zi.js";import"./useNonce-VIoWEX5z.js";import"./en-US-D2gH55FJ.js";import"./isValid-BJSfXqfd.js";import"./mode-Bq6LjPC-.js";import{o as xt}from"./alert-dialog-8EwWlboa.js";import"./dialog-BfhgTWm1.js";import"./usePress-BO20vkQb.js";import"./SSRProvider-B8x7qo1c.js";import"./useDateFormatter-CPDTrKqK.js";import"./context-CcLKJeA2.js";import"./useNumberFormatter-F8R3LBxf.js";import"./shim-Cc3VMan6.js";import"./numbers-CTSqyVyD.js";import{n as R}from"./useEvent-CRDKqG3C.js";import"./useDebounce-DzG_89QJ.js";import{n as ge}from"./ImperativeModal-C4fZHLKz.js";import"./strings-DHsDEFo-.js";import{i as ut,n as je}from"./error-banner-DoSAS3iD.js";import"./vega-loader.browser-D2m26-DP.js";import"./precisionRound-Qxa8hC2h.js";import"./defaultLocale-YmL2k7Vp.js";import"./defaultLocale-zQltfbSS.js";import{t as X}from"./copy-LsxoSTiV.js";import"./copy-icon-CE7wmMnS.js";import"./RenderHTML-DTLkV9Uh.js";import"./purify.es-CPMOFAIu.js";import"./useRunCells-BLpH_l8E.js";import"./multi-map-D9JaQ_m6.js";import"./emotion-is-prop-valid.esm-OoyWz_0l.js";import"./extends-dwNt6GDg.js";import"./prop-types-Dr_68tMt.js";import"./objectWithoutPropertiesLoose-COpOcp6W.js";import{n as ne,t as gt}from"./tree-CN8xDCJX.js";import"./alert-BqjCH_7t.js";import{n as ye}from"./useAsyncData-CngUoIwV.js";import"./kbd-DbVT085u.js";import{a as jt}from"./renderShortcut-DJmsjON-.js";import{t as yt}from"./LazyAnyLanguageCodeMirror-BovGLUi6.js";import"./popover-F0Sfc1dn.js";import"./cell-link-D75IV6D1.js";import"./links-CMl0qG9J.js";import"./useIframeCapabilities-DXQ78nsN.js";import"./lazy-oPCv0nK8.js";import"./tabs-l9npw3ob.js";import"./command-Dlk4i3l7.js";import"./table-DU76OrPF.js";import"./formats-BN93kMCb.js";import{n as bt}from"./blob-ISoY06EG.js";import{t as vt}from"./bundle.esm-BEDtDq85.js";import{o as wt}from"./focus-BaSDCTOl.js";import{t as kt}from"./links-uXibXl2j.js";import{t as Ft}from"./icon-32x32-YsJOs0Ms.js";import{t as ee}from"./Inputs-237ZzRAb.js";var Ct=L("copy-minus",[["line",{x1:"12",x2:"18",y1:"15",y2:"15",key:"1nscbv"}],["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),be=L("folder-plus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),ve=L("list-tree",[["path",{d:"M21 12h-8",key:"1bmf0i"}],["path",{d:"M21 6H8",key:"1pqkrb"}],["path",{d:"M21 18h-8",key:"1tm79t"}],["path",{d:"M3 6v4c0 1.1.9 2 2 2h3",key:"1ywdgy"}],["path",{d:"M3 10v6c0 1.1.9 2 2 2h3",key:"2wc746"}]]),Nt=L("pen-line",[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),Dt=L("square-play",[["rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",key:"h1oib"}],["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}]]),St=L("view",[["path",{d:"M21 17v2a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-2",key:"mrq65r"}],["path",{d:"M21 7V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v2",key:"be3xqs"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["path",{d:"M18.944 12.33a1 1 0 0 0 0-.66 7.5 7.5 0 0 0-13.888 0 1 1 0 0 0 0 .66 7.5 7.5 0 0 0 13.888 0",key:"11ak4c"}]]),Pt=U(ie(),1),S=U(Me(),1),a=U(He(),1),le=new Map;const _t=({file:t,onOpenNotebook:e})=>{let{theme:r}=Ge(),{sendFileDetails:s,sendUpdateFile:i}=oe(),l=_e(Ee),[n,u]=(0,S.useState)(""),{data:o,isPending:x,error:h,setData:f}=ye(async()=>{let j=await s({path:t.path}),v=j.contents||"";return u(le.get(t.path)||v),j},[t.path]),g=async()=>{n!==(o==null?void 0:o.contents)&&await i({path:t.path,contents:n}).then(j=>{j.success&&(f(v=>({...v,contents:n})),u(n))})},p=(0,S.useRef)(n);if(p.current=n,(0,S.useEffect)(()=>()=>{if(!(o!=null&&o.contents))return;let j=p.current;j===o.contents?le.delete(t.path):le.set(t.path,j)},[t.path,o==null?void 0:o.contents]),h)return(0,a.jsx)(je,{error:h});if(x||!o)return null;let c=o.mimeType||"text/plain",k=c in de;if(!o.contents&&!k)return(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 p-6",children:[(0,a.jsx)("div",{className:"font-bold text-muted-foreground",children:"Name"}),(0,a.jsx)("div",{children:o.file.name}),(0,a.jsx)("div",{className:"font-bold text-muted-foreground",children:"Type"}),(0,a.jsx)("div",{children:c})]});let b=(0,a.jsxs)("div",{className:"text-xs text-muted-foreground p-1 flex justify-end gap-2 border-b",children:[t.isMarimoFile&&!Q()&&(0,a.jsx)(M,{content:"Open notebook",children:(0,a.jsx)(ee,{size:"small",onClick:j=>e(j),children:(0,a.jsx)(se,{})})}),(0,a.jsx)(M,{content:"Download",children:(0,a.jsx)(ee,{size:"small",onClick:()=>{if(we(c)){et($e(o.contents,c),o.file.name);return}pe(new Blob([o.contents||n],{type:c}),o.file.name)},children:(0,a.jsx)(fe,{})})}),!we(c)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(M,{content:"Copy contents to clipboard",children:(0,a.jsx)(ee,{size:"small",onClick:async()=>{await X(n)},children:(0,a.jsx)(he,{})})}),(0,a.jsx)(M,{content:jt("global.save"),children:(0,a.jsx)(ee,{size:"small",color:n===o.contents?void 0:"green",onClick:g,disabled:n===o.contents,children:(0,a.jsx)(ct,{})})})]})]});return c.startsWith("image/")?(0,a.jsxs)(a.Fragment,{children:[b,(0,a.jsx)("div",{className:"flex-1 overflow-hidden flex flex-col",children:(0,a.jsx)(Ve,{base64:o.contents,mime:c})})]}):c==="text/csv"&&o.contents?(0,a.jsxs)(a.Fragment,{children:[b,(0,a.jsx)("div",{className:"flex-1 overflow-hidden flex flex-col",children:(0,a.jsx)(Le,{contents:o.contents})})]}):c.startsWith("audio/")?(0,a.jsxs)(a.Fragment,{children:[b,(0,a.jsx)("div",{className:"flex-1 overflow-hidden flex flex-col",children:(0,a.jsx)(Ke,{base64:o.contents,mime:c})})]}):c.startsWith("video/")?(0,a.jsxs)(a.Fragment,{children:[b,(0,a.jsx)("div",{className:"flex-1 overflow-hidden flex flex-col",children:(0,a.jsx)(Ye,{base64:o.contents,mime:c})})]}):c.startsWith("application/pdf")?(0,a.jsxs)(a.Fragment,{children:[b,(0,a.jsx)("div",{className:"flex-1 overflow-hidden flex flex-col",children:(0,a.jsx)(Ue,{base64:o.contents,mime:c})})]}):(0,a.jsxs)(a.Fragment,{children:[b,(0,a.jsx)("div",{className:"flex-1 overflow-auto",children:(0,a.jsx)(S.Suspense,{children:(0,a.jsx)(yt,{theme:r==="dark"?"dark":"light",language:de[c]||de.default,className:"border-b",extensions:[Te.lineWrapping,Be.of([{key:l.getHotkey("global.save").key,stopPropagation:!0,run:()=>n===o.contents?!1:(g(),!0)}])],value:n,onChange:u})})})]})};var we=t=>t?t.startsWith("image/")||t.startsWith("audio/")||t.startsWith("video/")||t.startsWith("application/pdf"):!1,de={"application/javascript":"javascript","text/markdown":"markdown","text/html":"html","text/css":"css","text/x-python":"python","application/json":"json","application/xml":"xml","text/x-yaml":"yaml","text/csv":"markdown","text/plain":"markdown",default:"markdown"},Ot=class{constructor(t){O(this,"delegate",new ne([]));O(this,"rootPath","");O(this,"onChange",Ae.NOOP);O(this,"path",new ae("/"));O(this,"initialize",async t=>{if(this.onChange=t,this.delegate.data.length===0)try{let e=await this.callbacks.listFiles({path:this.rootPath});this.delegate=new ne(e.files),this.rootPath=e.root,this.path=ae.guessDeliminator(e.root)}catch(e){z({title:"Failed",description:ut(e)})}this.onChange(this.delegate.data)});O(this,"refreshAll",async t=>{let e=[this.rootPath,...t.map(s=>{var i;return(i=this.delegate.find(s))==null?void 0:i.data.path})].filter(Boolean),r=await Promise.all(e.map(s=>this.callbacks.listFiles({path:s}).catch(()=>({files:[]}))));for(let[s,i]of e.entries()){let l=r[s];i===this.rootPath?this.delegate=new ne(l.files):this.delegate.update({id:i,changes:{children:l.files}})}this.onChange(this.delegate.data)});O(this,"relativeFromRoot",t=>{let e=this.rootPath.endsWith(this.path.deliminator)?this.rootPath:`${this.rootPath}${this.path.deliminator}`;return t.startsWith(e)?t.slice(e.length):t});O(this,"handleResponse",t=>t.success?t:(z({title:"Failed",description:t.message}),null));this.callbacks=t}async expand(t){let e=this.delegate.find(t);if(!e||!e.data.isDirectory)return!1;if(e.children&&e.children.length>0)return!0;let r=await this.callbacks.listFiles({path:e.data.path});return this.delegate.update({id:t,changes:{children:r.files}}),this.onChange(this.delegate.data),!0}async rename(t,e){let r=this.delegate.find(t);if(!r)return;let s=r.data.path,i=this.path.join(this.path.dirname(s),e);await this.callbacks.renameFileOrFolder({path:s,newPath:i}).then(this.handleResponse),this.delegate.update({id:t,changes:{name:e,path:i}}),this.onChange(this.delegate.data),await this.refreshAll([i])}async move(t,e){var s;let r=e?((s=this.delegate.find(e))==null?void 0:s.data.path)??e:this.rootPath;await Promise.all(t.map(i=>{this.delegate.move({id:i,parentId:e,index:0});let l=this.delegate.find(i);if(!l)return Promise.resolve();let n=this.path.join(r,this.path.basename(l.data.path));return this.delegate.update({id:i,changes:{path:n}}),this.callbacks.renameFileOrFolder({path:l.data.path,newPath:n}).then(this.handleResponse)})),this.onChange(this.delegate.data),await this.refreshAll([r])}async createFile(t,e){var i;let r=e?((i=this.delegate.find(e))==null?void 0:i.data.path)??e:this.rootPath,s=await this.callbacks.createFileOrFolder({path:r,type:"file",name:t}).then(this.handleResponse);s!=null&&s.info&&(this.delegate.create({parentId:e,index:0,data:s.info}),this.onChange(this.delegate.data),await this.refreshAll([r]))}async createFolder(t,e){var i;let r=e?((i=this.delegate.find(e))==null?void 0:i.data.path)??e:this.rootPath,s=await this.callbacks.createFileOrFolder({path:r,type:"directory",name:t}).then(this.handleResponse);s!=null&&s.info&&(this.delegate.create({parentId:e,index:0,data:s.info}),this.onChange(this.delegate.data),await this.refreshAll([r]))}async delete(t){let e=this.delegate.find(t);e&&(await this.callbacks.deleteFileOrFolder({path:e.data.path}).then(this.handleResponse),this.delegate.drop({id:t}),this.onChange(this.delegate.data))}};const ke=ce(t=>{let e=t(Ze);return Ie(e,"no requestClientAtom set"),new Ot({listFiles:e.sendListFiles,createFileOrFolder:e.sendCreateFileOrFolder,deleteFileOrFolder:e.sendDeleteFileOrFolder,renameFileOrFolder:e.sendRenameFileOrFolder})}),Mt=ce({});async function zt(){await Oe.get(ke).refreshAll([])}var Rt=1024*1024*100;function Fe(t){let e=(0,Pt.c)(7),r;e[0]===t?r=e[1]:(r=t===void 0?{}:t,e[0]=t,e[1]=r);let s=r,{sendCreateFileOrFolder:i}=oe(),l;e[2]===i?l=e[3]:(l=async u=>{for(let o of u){let x=qt(Ht(o)),h="";x&&(h=ae.guessDeliminator(x).dirname(x));let f=(await bt(o)).split(",")[1];await i({path:h,type:"file",name:o.name,contents:f})}await zt()},e[2]=i,e[3]=l);let n;return e[4]!==s||e[5]!==l?(n={multiple:!0,maxSize:Rt,onError:Et,onDropRejected:At,onDrop:l,...s},e[4]=s,e[5]=l,e[6]=n):n=e[6],ft(n)}function At(t){z({title:"File upload failed",description:(0,a.jsx)("div",{className:"flex flex-col gap-1",children:t.map(Wt)}),variant:"danger"})}function Wt(t){return(0,a.jsxs)("div",{children:[t.file.name," (",t.errors.map(It).join(", "),")"]},t.file.name)}function It(t){return t.message}function Et(t){We.error(t),z({title:"File upload failed",description:t.message,variant:"danger"})}function Ht(t){if(t.webkitRelativePath)return t.webkitRelativePath;if("path"in t&&typeof t.path=="string")return t.path;if("relativePath"in t&&typeof t.relativePath=="string")return t.relativePath}function qt(t){if(t)return t.replace(/^\/+/,"")}var Y=U(ie(),1),Ce=S.createContext(null);const Bt=t=>{let e=(0,Y.c)(60),{height:r}=t,s=(0,S.useRef)(null),[i]=me(ke),l;e[0]===Symbol.for("react.memo_cache_sentinel")?(l=[],e[0]=l):l=e[0];let[n,u]=(0,S.useState)(l),[o,x]=(0,S.useState)(null),{openPrompt:h}=ge(),[f,g]=me(Mt),p;e[1]===i?p=e[2]:(p=()=>i.initialize(u),e[1]=i,e[2]=p);let c;e[3]===Symbol.for("react.memo_cache_sentinel")?(c=[],e[3]=c):c=e[3];let{isPending:k,error:b}=ye(p,c),j;e[4]!==f||e[5]!==i?(j=()=>{i.refreshAll(Object.keys(f).filter(m=>f[m]))},e[4]=f,e[5]=i,e[6]=j):j=e[6];let v=R(j),P;e[7]!==h||e[8]!==i?(P=async()=>{h({title:"Folder name",onConfirm:async m=>{i.createFolder(m,null)}})},e[7]=h,e[8]=i,e[9]=P):P=e[9];let d=R(P),y;e[10]!==h||e[11]!==i?(y=async()=>{h({title:"File name",onConfirm:async m=>{i.createFile(m,null)}})},e[10]=h,e[11]=i,e[12]=y):y=e[12];let C=R(y),N;e[13]===g?N=e[14]:(N=()=>{var m;(m=s.current)==null||m.closeAll(),g({})},e[13]=g,e[14]=N);let A=R(N);if(k){let m;return e[15]===Symbol.for("react.memo_cache_sentinel")?(m=(0,a.jsx)(lt,{size:"medium",centered:!0}),e[15]=m):m=e[15],m}if(b){let m;return e[16]===b?m=e[17]:(m=(0,a.jsx)(je,{error:b}),e[16]=b,e[17]=m),m}if(o){let m;e[18]===Symbol.for("react.memo_cache_sentinel")?(m=()=>x(null),e[18]=m):m=e[18];let w;e[19]===Symbol.for("react.memo_cache_sentinel")?(w=(0,a.jsx)(V,{onClick:m,"data-testid":"file-explorer-back-button",variant:"text",size:"xs",className:"mb-0",children:(0,a.jsx)(Je,{size:16})}),e[19]=w):w=e[19];let D;e[20]===o.name?D=e[21]:(D=(0,a.jsxs)("div",{className:"flex items-center pl-1 pr-3 shrink-0 border-b justify-between",children:[w,(0,a.jsx)("span",{className:"font-bold",children:o.name})]}),e[20]=o.name,e[21]=D);let T;e[22]!==o.path||e[23]!==i?(T=De=>Ne(De,i.relativeFromRoot(o.path)),e[22]=o.path,e[23]=i,e[24]=T):T=e[24];let $;e[25]!==o||e[26]!==T?($=(0,a.jsx)(S.Suspense,{children:(0,a.jsx)(_t,{onOpenNotebook:T,file:o})}),e[25]=o,e[26]=T,e[27]=$):$=e[27];let J;return e[28]!==D||e[29]!==$?(J=(0,a.jsxs)(a.Fragment,{children:[D,$]}),e[28]=D,e[29]=$,e[30]=J):J=e[30],J}let _;e[31]!==A||e[32]!==C||e[33]!==d||e[34]!==v||e[35]!==i?(_=(0,a.jsx)($t,{onRefresh:v,onCreateFile:C,onCreateFolder:d,onCollapseAll:A,tree:i}),e[31]=A,e[32]=C,e[33]=d,e[34]=v,e[35]=i,e[36]=_):_=e[36];let te=r-33,W,I,E;e[37]===i?(W=e[38],I=e[39],E=e[40]):(W=async m=>{let{ids:w}=m;for(let D of w)await i.delete(D)},I=async m=>{let{id:w,name:D}=m;await i.rename(w,D)},E=async m=>{let{dragIds:w,parentId:D}=m;await i.move(w,D)},e[37]=i,e[38]=W,e[39]=I,e[40]=E);let Z;e[41]===Symbol.for("react.memo_cache_sentinel")?(Z=m=>{let w=m[0];w&&(w.data.isDirectory||x(w.data))},e[41]=Z):Z=e[41];let H;e[42]!==f||e[43]!==g||e[44]!==i?(H=async m=>{if(await i.expand(m)){let w=f[m]??!1;g({...f,[m]:!w})}},e[42]=f,e[43]=g,e[44]=i,e[45]=H):H=e[45];let q;e[46]!==n||e[47]!==f||e[48]!==W||e[49]!==I||e[50]!==E||e[51]!==H||e[52]!==te?(q=(0,a.jsx)(gt,{width:"100%",ref:s,height:te,className:"h-full",data:n,initialOpenState:f,openByDefault:!1,renderCursor:Yt,disableDrop:Zt,onDelete:W,onRename:I,onMove:E,onSelect:Z,onToggle:H,padding:15,rowHeight:30,indent:Tt,overscanCount:1e3,disableMultiSelection:!0,children:Ut}),e[46]=n,e[47]=f,e[48]=W,e[49]=I,e[50]=E,e[51]=H,e[52]=te,e[53]=q):q=e[53];let B;e[54]!==q||e[55]!==i?(B=(0,a.jsx)(Ce,{value:i,children:q}),e[54]=q,e[55]=i,e[56]=B):B=e[56];let G;return e[57]!==B||e[58]!==_?(G=(0,a.jsxs)(a.Fragment,{children:[_,B]}),e[57]=B,e[58]=_,e[59]=G):G=e[59],G};var Tt=15,$t=t=>{let e=(0,Y.c)(30),{onRefresh:r,onCreateFile:s,onCreateFolder:i,onCollapseAll:l}=t,n;e[0]===Symbol.for("react.memo_cache_sentinel")?(n={noDrag:!0,noDragEventsBubbling:!0},e[0]=n):n=e[0];let{getRootProps:u,getInputProps:o}=Fe(n),x;e[1]===Symbol.for("react.memo_cache_sentinel")?(x=(0,a.jsx)(ue,{size:16}),e[1]=x):x=e[1];let h;e[2]===s?h=e[3]:(h=(0,a.jsx)(M,{content:"Add file",children:(0,a.jsx)(V,{"data-testid":"file-explorer-add-file-button",onClick:s,variant:"text",size:"xs",children:x})}),e[2]=s,e[3]=h);let f;e[4]===Symbol.for("react.memo_cache_sentinel")?(f=(0,a.jsx)(be,{size:16}),e[4]=f):f=e[4];let g;e[5]===i?g=e[6]:(g=(0,a.jsx)(M,{content:"Add folder",children:(0,a.jsx)(V,{"data-testid":"file-explorer-add-folder-button",onClick:i,variant:"text",size:"xs",children:f})}),e[5]=i,e[6]=g);let p;e[7]===u?p=e[8]:(p=u({}),e[7]=u,e[8]=p);let c,k;e[9]===Symbol.for("react.memo_cache_sentinel")?(c=qe({variant:"text",size:"xs"}),k=(0,a.jsx)(pt,{size:16}),e[9]=c,e[10]=k):(c=e[9],k=e[10]);let b;e[11]===p?b=e[12]:(b=(0,a.jsx)(M,{content:"Upload file",children:(0,a.jsx)("button",{"data-testid":"file-explorer-upload-button",...p,className:c,children:k})}),e[11]=p,e[12]=b);let j;e[13]===o?j=e[14]:(j=o({}),e[13]=o,e[14]=j);let v;e[15]===j?v=e[16]:(v=(0,a.jsx)("input",{...j,type:"file"}),e[15]=j,e[16]=v);let P;e[17]===Symbol.for("react.memo_cache_sentinel")?(P=(0,a.jsx)(dt,{size:16}),e[17]=P):P=e[17];let d;e[18]===r?d=e[19]:(d=(0,a.jsx)(M,{content:"Refresh",children:(0,a.jsx)(V,{"data-testid":"file-explorer-refresh-button",onClick:r,variant:"text",size:"xs",children:P})}),e[18]=r,e[19]=d);let y;e[20]===Symbol.for("react.memo_cache_sentinel")?(y=(0,a.jsx)(Ct,{size:16}),e[20]=y):y=e[20];let C;e[21]===l?C=e[22]:(C=(0,a.jsx)(M,{content:"Collapse all folders",children:(0,a.jsx)(V,{"data-testid":"file-explorer-collapse-button",onClick:l,variant:"text",size:"xs",children:y})}),e[21]=l,e[22]=C);let N;return e[23]!==v||e[24]!==d||e[25]!==C||e[26]!==h||e[27]!==g||e[28]!==b?(N=(0,a.jsxs)("div",{className:"flex items-center justify-end px-2 shrink-0 border-b",children:[h,g,b,v,d,C]}),e[23]=v,e[24]=d,e[25]=C,e[26]=h,e[27]=g,e[28]=b,e[29]=N):N=e[29],N},Vt=t=>{let e=(0,Y.c)(9),{node:r,onOpenMarimoFile:s}=t,i;e[0]===r?i=e[1]:(i=u=>{r.data.isDirectory||(u.stopPropagation(),r.select())},e[0]=r,e[1]=i);let l;e[2]!==r.data.isMarimoFile||e[3]!==s?(l=r.data.isMarimoFile&&!Q()&&(0,a.jsxs)("span",{className:"shrink-0 ml-2 text-sm hidden group-hover:inline hover:underline",onClick:s,children:["open ",(0,a.jsx)(se,{className:"inline ml-1",size:12})]}),e[2]=r.data.isMarimoFile,e[3]=s,e[4]=l):l=e[4];let n;return e[5]!==r.data.name||e[6]!==i||e[7]!==l?(n=(0,a.jsxs)("span",{className:"flex-1 overflow-hidden text-ellipsis",onClick:i,children:[r.data.name,l]}),e[5]=r.data.name,e[6]=i,e[7]=l,e[8]=n):n=e[8],n},Lt=t=>{let e=(0,Y.c)(10),{node:r}=t,s=(0,S.useRef)(null),i,l;e[0]===r.data.name?(i=e[1],l=e[2]):(i=()=>{var x,h;(x=s.current)==null||x.focus(),(h=s.current)==null||h.setSelectionRange(0,r.data.name.lastIndexOf("."))},l=[r.data.name],e[0]=r.data.name,e[1]=i,e[2]=l),(0,S.useEffect)(i,l);let n,u;e[3]===r?(n=e[4],u=e[5]):(n=()=>r.reset(),u=x=>{x.key==="Escape"&&r.reset(),x.key==="Enter"&&r.submit(x.currentTarget.value)},e[3]=r,e[4]=n,e[5]=u);let o;return e[6]!==r.data.name||e[7]!==n||e[8]!==u?(o=(0,a.jsx)("input",{ref:s,className:"flex-1 bg-transparent border border-border text-muted-foreground",defaultValue:r.data.name,onClick:Gt,onBlur:n,onKeyDown:u}),e[6]=r.data.name,e[7]=n,e[8]=u,e[9]=o):o=e[9],o},Ut=({node:t,style:e,dragHandle:r})=>{let{openFile:s,sendCreateFileOrFolder:i,sendFileDetails:l}=oe(),n=t.data.isDirectory?"directory":st(t.data.name),u=nt[n],{openConfirm:o,openPrompt:x}=ge(),{createNewCell:h}=Re(),f=wt(),g=d=>{h({code:d,before:!1,cellId:f??"__end__"})},p=(0,S.use)(Ce),c=async d=>{Ne(d,p?p.relativeFromRoot(t.data.path):t.data.path)},k=async d=>{d.stopPropagation(),d.preventDefault(),o({title:"Delete file",description:`Are you sure you want to delete ${t.data.name}?`,confirmAction:(0,a.jsx)(xt,{onClick:async()=>{await t.tree.delete(t.id)},"aria-label":"Confirm",children:"Delete"})})},b=R(async()=>{t.open(),x({title:"Folder name",onConfirm:async d=>{p==null||p.createFolder(d,t.id)}})}),j=R(async()=>{t.open(),x({title:"File name",onConfirm:async d=>{p==null||p.createFile(d,t.id)}})}),v=R(async()=>{var N;if(!p||t.data.isDirectory)return;let[d,y]=ht(t.data.name),C=`${d}_copy${y}`;try{let A=await l({path:t.data.path}),_=((N=t.parent)==null?void 0:N.data.path)||"";await i({path:_,type:"file",name:C,contents:A.contents?btoa(A.contents):void 0}),await p.refreshAll([_])}catch{z({title:"Failed to duplicate file",description:"Unable to create a duplicate of the file",variant:"danger"})}}),P=()=>{let d={size:14,strokeWidth:1.5,className:"mr-2"};return(0,a.jsxs)(it,{align:"end",className:"no-print w-[220px]",onClick:y=>y.stopPropagation(),onCloseAutoFocus:y=>y.preventDefault(),children:[!t.data.isDirectory&&(0,a.jsxs)(F,{onSelect:()=>t.select(),children:[(0,a.jsx)(St,{...d}),"Open file"]}),!t.data.isDirectory&&!Q()&&(0,a.jsxs)(F,{onSelect:()=>{s({path:t.data.path})},children:[(0,a.jsx)(se,{...d}),"Open file in external editor"]}),t.data.isDirectory&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(F,{onSelect:()=>j(),children:[(0,a.jsx)(ue,{...d}),"Create file"]}),(0,a.jsxs)(F,{onSelect:()=>b(),children:[(0,a.jsx)(be,{...d}),"Create folder"]}),(0,a.jsx)(K,{})]}),(0,a.jsxs)(F,{onSelect:()=>t.edit(),children:[(0,a.jsx)(Nt,{...d}),"Rename"]}),!t.data.isDirectory&&(0,a.jsxs)(F,{onSelect:v,children:[(0,a.jsx)(he,{...d}),"Duplicate"]}),(0,a.jsxs)(F,{onSelect:async()=>{await X(t.data.path),z({title:"Copied to clipboard"})},children:[(0,a.jsx)(ve,{...d}),"Copy path"]}),p&&(0,a.jsxs)(F,{onSelect:async()=>{await X(p.relativeFromRoot(t.data.path)),z({title:"Copied to clipboard"})},children:[(0,a.jsx)(ve,{...d}),"Copy relative path"]}),(0,a.jsx)(K,{}),(0,a.jsxs)(F,{onSelect:()=>{let{path:y}=t.data;g(xe[n](y))},children:[(0,a.jsx)(Qe,{...d}),"Insert snippet for reading file"]}),(0,a.jsxs)(F,{onSelect:async()=>{z({title:"Copied to clipboard",description:"Code to open the file has been copied to your clipboard. You can also drag and drop this file into the editor"});let{path:y}=t.data;await X(xe[n](y))},children:[(0,a.jsx)(ze,{...d}),"Copy snippet for reading file"]}),t.data.isMarimoFile&&!Q()&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(K,{}),(0,a.jsxs)(F,{onSelect:c,children:[(0,a.jsx)(Dt,{...d}),"Open notebook"]})]}),(0,a.jsx)(K,{}),!t.data.isDirectory&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(F,{onSelect:async()=>{let y=(await l({path:t.data.path})).contents||"";pe(new Blob([y]),t.data.name)},children:[(0,a.jsx)(fe,{...d}),"Download"]}),(0,a.jsx)(K,{})]}),(0,a.jsxs)(F,{onSelect:k,variant:"danger",children:[(0,a.jsx)(mt,{...d}),"Delete"]})]})};return(0,a.jsxs)("div",{style:e,ref:r,className:re("flex items-center cursor-pointer ml-1 text-muted-foreground whitespace-nowrap group"),draggable:!0,onClick:d=>{d.stopPropagation(),t.data.isDirectory&&t.toggle()},children:[(0,a.jsx)(Kt,{node:t}),(0,a.jsxs)("span",{className:re("flex items-center pl-1 py-1 cursor-pointer hover:bg-accent/50 hover:text-accent-foreground rounded-l flex-1 overflow-hidden group",t.willReceiveDrop&&t.data.isDirectory&&"bg-accent/80 hover:bg-accent/80 text-accent-foreground"),children:[t.data.isMarimoFile?(0,a.jsx)("img",{src:Ft,className:"w-5 h-5 shrink-0 mr-2 filter grayscale",alt:"Marimo"}):(0,a.jsx)(u,{className:"w-5 h-5 shrink-0 mr-2",strokeWidth:1.5}),t.isEditing?(0,a.jsx)(Lt,{node:t}):(0,a.jsx)(Vt,{node:t,onOpenMarimoFile:c}),(0,a.jsxs)(rt,{modal:!1,children:[(0,a.jsx)(at,{asChild:!0,tabIndex:-1,onClick:d=>d.stopPropagation(),children:(0,a.jsx)(V,{"data-testid":"file-explorer-more-button",variant:"text",tabIndex:-1,size:"xs",className:"mb-0","aria-label":"More options",children:(0,a.jsx)(ot,{strokeWidth:2,className:"w-5 h-5 hidden group-hover:block"})})}),P()]})]})]})},Kt=t=>{let e=(0,Y.c)(3),{node:r}=t;if(!r.data.isDirectory){let i;return e[0]===Symbol.for("react.memo_cache_sentinel")?(i=(0,a.jsx)("span",{className:"w-5 h-5 shrink-0"}),e[0]=i):i=e[0],i}let s;return e[1]===r.isOpen?s=e[2]:(s=r.isOpen?(0,a.jsx)(Xe,{className:"w-5 h-5 shrink-0"}):(0,a.jsx)(tt,{className:"w-5 h-5 shrink-0"}),e[1]=r.isOpen,e[2]=s),s};function Ne(t,e){t.stopPropagation(),t.preventDefault(),kt(e)}function Yt(){return null}function Zt(t){let{parentNode:e}=t;return!e.data.isDirectory}function Gt(t){return t.stopPropagation()}var Jt=U(ie(),1),Qt=()=>{let t=(0,Jt.c)(20),{ref:e,height:r}=vt(),s=r===void 0?1:r,i;t[0]===Symbol.for("react.memo_cache_sentinel")?(i={noClick:!0,noKeyboard:!0},t[0]=i):i=t[0];let{getRootProps:l,getInputProps:n,isDragActive:u}=Fe(i),o;t[1]===l?o=t[2]:(o=l(),t[1]=l,t[2]=o);let x;t[3]===Symbol.for("react.memo_cache_sentinel")?(x=re("flex flex-col flex-1 overflow-hidden relative"),t[3]=x):x=t[3];let h;t[4]===n?h=t[5]:(h=n(),t[4]=n,t[5]=h);let f;t[6]===h?f=t[7]:(f=(0,a.jsx)("input",{...h}),t[6]=h,t[7]=f);let g;t[8]===u?g=t[9]:(g=u&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center uppercase justify-center text-xl font-bold text-primary/90 bg-accent/85 z-10 border-2 border-dashed border-primary/90 rounded-lg pointer-events-none",children:"Drop files here"}),t[8]=u,t[9]=g);let p;t[10]===s?p=t[11]:(p=(0,a.jsx)(Bt,{height:s}),t[10]=s,t[11]=p);let c;t[12]!==e||t[13]!==p?(c=(0,a.jsx)("div",{ref:e,className:"flex flex-col flex-1 overflow-hidden",children:p}),t[12]=e,t[13]=p,t[14]=c):c=t[14];let k;return t[15]!==o||t[16]!==f||t[17]!==g||t[18]!==c?(k=(0,a.jsxs)("div",{...o,className:x,children:[f,g,c]}),t[15]=o,t[16]=f,t[17]=g,t[18]=c,t[19]=k):k=t[19],k};export{Qt as default};
