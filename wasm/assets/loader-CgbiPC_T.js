var ne=Object.defineProperty;var se=(t,e,r)=>e in t?ne(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var T=(t,e,r)=>se(t,typeof e!="symbol"?e+"":e,r);var it,ut,lt,ct,ot;import{C as ae,w as ie}from"./_Uint8Array-CPNtPV0k.js";import{t as ue}from"./Logger-BkkOJyg0.js";import{a as le}from"./hotkeys-CBY41Jr2.js";import{a as ce,c as oe,o as de}from"./vega-loader.browser.module-BkWiTok0.js";var fe="[object Number]";function he(t){return typeof t=="number"||ae(t)&&ie(t)==fe}var ye=he;const yt=Uint8Array.of(65,82,82,79,87,49),z={V1:0,V2:1,V3:2,V4:3,V5:4},D={NONE:0,Schema:1,DictionaryBatch:2,RecordBatch:3,Tensor:4,SparseTensor:5},i={Dictionary:-1,NONE:0,Null:1,Int:2,Float:3,Binary:4,Utf8:5,Bool:6,Decimal:7,Date:8,Time:9,Timestamp:10,Interval:11,List:12,Struct:13,Union:14,FixedSizeBinary:15,FixedSizeList:16,Map:17,Duration:18,LargeBinary:19,LargeUtf8:20,LargeList:21,RunEndEncoded:22,BinaryView:23,Utf8View:24,ListView:25,LargeListView:26},pt={HALF:0,SINGLE:1,DOUBLE:2},_={DAY:0,MILLISECOND:1},v={SECOND:0,MILLISECOND:1,MICROSECOND:2,NANOSECOND:3},C={YEAR_MONTH:0,DAY_TIME:1,MONTH_DAY_NANO:2},W={Sparse:0,Dense:1},vt=Uint8Array,mt=Uint16Array,gt=Uint32Array,bt=BigUint64Array,It=Int8Array,pe=Int16Array,b=Int32Array,x=BigInt64Array,ve=Float32Array,$=Float64Array;function me(t,e){let r=Math.log2(t)-3;return(e?[It,pe,b,x]:[vt,mt,gt,bt])[r]}Object.getPrototypeOf(Int8Array);function J(t,e){let r=0,n=t.length;if(n<=2147483648)do{let s=r+n>>>1;t[s]<=e?r=s+1:n=s}while(r<n);else do{let s=Math.trunc((r+n)/2);t[s]<=e?r=s+1:n=s}while(r<n);return r}function G(t,e,r){if(e(t))return t;throw Error(r(t))}function I(t,e,r){return e=Array.isArray(e)?e:Object.values(e),G(t,n=>e.includes(n),r??(()=>`${t} must be one of ${e}`))}function wt(t,e){for(let[r,n]of Object.entries(t))if(n===e)return r;return"<Unknown>"}const Z=t=>`Unsupported data type: "${wt(i,t)}" (id ${t})`,Lt=(t,e,r=!0,n=null)=>({name:t,type:e,nullable:r,metadata:n});function xt(t){return Object.hasOwn(t,"name")&&Nt(t.type)}function Nt(t){return typeof(t==null?void 0:t.typeId)=="number"}function S(t,e="",r=!0){return xt(t)?t:Lt(e,G(t,Nt,()=>"Data type expected."),r)}const ge=(t,e,r=!1,n=-1)=>({typeId:i.Dictionary,id:n,dictionary:t,indices:e||Et(),ordered:r}),At=(t=32,e=!0)=>({typeId:i.Int,bitWidth:I(t,[8,16,32,64]),signed:e,values:me(t,e)}),Et=()=>At(32),be=(t=2)=>({typeId:i.Float,precision:I(t,pt),values:[mt,ve,$][t]}),Ie=()=>({typeId:i.Binary,offsets:b}),we=()=>({typeId:i.Utf8,offsets:b}),Le=(t,e,r=128)=>({typeId:i.Decimal,precision:t,scale:e,bitWidth:I(r,[128,256]),values:bt}),xe=t=>({typeId:i.Date,unit:I(t,_),values:t===_.DAY?b:x}),Ne=(t=v.MILLISECOND,e=32)=>({typeId:i.Time,unit:I(t,v),bitWidth:I(e,[32,64]),values:e===32?b:x}),Ae=(t=v.MILLISECOND,e=null)=>({typeId:i.Timestamp,unit:I(t,v),timezone:e,values:x}),Ee=(t=C.MONTH_DAY_NANO)=>({typeId:i.Interval,unit:I(t,C),values:t===C.MONTH_DAY_NANO?void 0:b}),De=t=>({typeId:i.List,children:[S(t)],offsets:b}),Se=t=>({typeId:i.Struct,children:Array.isArray(t)&&xt(t[0])?t:Object.entries(t).map(([e,r])=>Lt(e,r))}),Be=(t,e,r,n)=>(r??(r=e.map((s,a)=>a)),{typeId:i.Union,mode:I(t,W),typeIds:r,typeMap:r.reduce((s,a,u)=>(s[a]=u,s),{}),children:e.map((s,a)=>S(s,`_${a}`)),typeIdForValue:n,offsets:b}),Oe=t=>({typeId:i.FixedSizeBinary,stride:t}),Me=(t,e)=>({typeId:i.FixedSizeList,stride:e,children:[S(t)]}),Te=(t,e)=>({typeId:i.Map,keysSorted:t,children:[e],offsets:b}),Ce=(t=v.MILLISECOND)=>({typeId:i.Duration,unit:I(t,v),values:x}),Ue=()=>({typeId:i.LargeBinary,offsets:x}),Ve=()=>({typeId:i.LargeUtf8,offsets:x}),Fe=t=>({typeId:i.LargeList,children:[S(t)],offsets:x}),Re=(t,e)=>({typeId:i.RunEndEncoded,children:[G(S(t,"run_ends"),r=>r.type.typeId===i.Int,()=>"Run-ends must have an integer type."),S(e,"values")]}),ze=t=>({typeId:i.ListView,children:[S(t,"value")],offsets:b}),_e=t=>({typeId:i.LargeListView,children:[S(t,"value")],offsets:x});var j=new $(2).buffer;new x(j),new gt(j),new b(j),new vt(j);function B(t){if(t>2**53-1||t<-(2**53-1))throw Error(`BigInt exceeds integer number representation: ${t}`);return Number(t)}function q(t,e){return Number(t/e)+Number(t%e)/Number(e)}var U=t=>BigInt.asUintN(64,t);function $e(t,e){let r=e<<1,n;return BigInt.asIntN(64,t[r+1])<0?(n=U(~t[r])|U(~t[r+1])<<64n,n=-(n+1n)):n=t[r]|t[r+1]<<64n,n}function je(t,e){let r=e<<2,n;return BigInt.asIntN(64,t[r+3])<0?(n=U(~t[r])|U(~t[r+1])<<64n|U(~t[r+2])<<128n|U(~t[r+3])<<192n,n=-(n+1n)):n=t[r]|t[r+1]<<64n|t[r+2]<<128n|t[r+3]<<192n,n}var Ye=new TextDecoder("utf-8");new TextEncoder;function Y(t){return Ye.decode(t)}function Dt(t,e){return(t[e>>3]&1<<e%8)!=0}function N(t,e){let r=e+f(t,e),n=r-f(t,r),s=m(t,n);return(a,u,l=null)=>{if(a<s){let c=m(t,n+a);if(c)return u(t,r+c)}return l}}function M(t,e){return e}function F(t,e){return!!ke(t,e)}function ke(t,e){return K(t,e)<<24>>24}function K(t,e){return t[e]}function m(t,e){return Pe(t,e)<<16>>16}function Pe(t,e){return t[e]|t[e+1]<<8}function f(t,e){return t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24}function St(t,e){return f(t,e)>>>0}function g(t,e){return B(BigInt.asIntN(64,BigInt(St(t,e))+(BigInt(St(t,e+4))<<32n)))}function k(t,e){let r=e+f(t,e),n=f(t,r);return r+=4,Y(t.subarray(r,r+n))}function O(t,e,r,n){if(!e)return[];let s=e+f(t,e);return Array.from({length:f(t,s)},(a,u)=>n(t,s+4+u*r))}const Q=Symbol("rowIndex");function X(t,e){class r{constructor(a){this[Q]=a}toJSON(){return Ot(t,e,this[Q])}}let n=r.prototype;for(let s=0;s<t.length;++s){if(Object.hasOwn(n,t[s]))continue;let a=e[s];Object.defineProperty(n,t[s],{get(){return a.at(this[Q])},enumerable:!0})}return s=>new r(s)}function Bt(t,e){return r=>Ot(t,e,r)}function Ot(t,e,r){let n={};for(let s=0;s<t.length;++s)n[t[s]]=e[s].at(r);return n}function He(t){return t instanceof H}var P=(it=class{constructor({length:t,nullCount:e,type:r,validity:n,values:s,offsets:a,sizes:u,children:l}){this.length=t,this.nullCount=e,this.type=r,this.validity=n,this.values=s,this.offsets=a,this.sizes=u,this.children=l,(!e||!this.validity)&&(this.at=c=>this.value(c))}get[Symbol.toStringTag](){return"Batch"}at(t){return this.isValid(t)?this.value(t):null}isValid(t){return Dt(this.validity,t)}value(t){return this.values[t]}slice(t,e){let r=e-t,n=Array(r);for(let s=0;s<r;++s)n[s]=this.at(t+s);return n}*[Symbol.iterator](){for(let t=0;t<this.length;++t)yield this.at(t)}},T(it,"ArrayType",null),it),H=class extends P{constructor(t){super(t);let{length:e,values:r}=this;this.values=r.subarray(0,e)}slice(t,e){return this.nullCount?super.slice(t,e):this.values.subarray(t,e)}[Symbol.iterator](){return this.nullCount?super[Symbol.iterator]():this.values[Symbol.iterator]()}},tt=(ut=class extends P{},T(ut,"ArrayType",$),ut),h=(lt=class extends P{},T(lt,"ArrayType",Array),lt),We=class extends h{value(t){return null}},V=class extends tt{value(t){return B(this.values[t])}},Je=class extends tt{value(t){let e=this.values[t],r=(e&31744)>>10,n=(e&1023)/1024,s=(-1)**((e&32768)>>15);switch(r){case 31:return s*(n?NaN:1/0);case 0:return s*(n?6103515625e-14*n:0)}return s*2**(r-15)*(1+n)}},Ge=class extends h{value(t){return Dt(this.values,t)}},Mt=class extends P{constructor(t){super(t);let{bitWidth:e,scale:r}=this.type;this.decimal=e===128?$e:je,this.scale=10n**BigInt(r)}},Ze=(ct=class extends Mt{value(t){return q(this.decimal(this.values,t),this.scale)}},T(ct,"ArrayType",$),ct),qe=(ot=class extends Mt{value(t){return this.decimal(this.values,t)}},T(ot,"ArrayType",Array),ot),Tt=class extends h{constructor(t){super(t),this.source=t}value(t){return new Date(this.source.value(t))}},Ke=class extends tt{value(t){return 864e5*this.values[t]}};const Qe=V;var Xe=class extends V{value(t){return super.value(t)*1e3}};const tr=V;var er=class extends V{value(t){return q(this.values[t],1000n)}},rr=class extends V{value(t){return q(this.values[t],1000000n)}},nr=class extends h{value(t){return this.values.subarray(t<<1,t+1<<1)}},sr=class extends h{value(t){let e=this.values,r=t<<4;return Float64Array.of(f(e,r),f(e,r+4),g(e,r+8))}},Ct=({values:t,offsets:e},r)=>t.subarray(e[r],e[r+1]),Ut=({values:t,offsets:e},r)=>t.subarray(B(e[r]),B(e[r+1])),ar=class extends h{value(t){return Ct(this,t)}},ir=class extends h{value(t){return Ut(this,t)}},ur=class extends h{value(t){return Y(Ct(this,t))}},lr=class extends h{value(t){return Y(Ut(this,t))}},cr=class extends h{value(t){let e=this.offsets;return this.children[0].slice(e[t],e[t+1])}},or=class extends h{value(t){let e=this.offsets;return this.children[0].slice(B(e[t]),B(e[t+1]))}},dr=class extends h{value(t){let e=this.offsets[t],r=e+this.sizes[t];return this.children[0].slice(e,r)}},fr=class extends h{value(t){let e=this.offsets[t],r=e+this.sizes[t];return this.children[0].slice(B(e),B(r))}},Vt=class extends h{constructor(t){super(t),this.stride=this.type.stride}},hr=class extends Vt{value(t){let{stride:e,values:r}=this;return r.subarray(t*e,(t+1)*e)}},yr=class extends Vt{value(t){let{children:e,stride:r}=this;return e[0].slice(t*r,(t+1)*r)}};function Ft({children:t,offsets:e},r){let[n,s]=t[0].children,a=e[r],u=e[r+1],l=[];for(let c=a;c<u;++c)l.push([n.at(c),s.at(c)]);return l}var pr=class extends h{value(t){return Ft(this,t)}},vr=class extends h{value(t){return new Map(Ft(this,t))}},Rt=class extends h{constructor({typeIds:t,...e}){super(e),this.typeIds=t,this.typeMap=this.type.typeMap}value(t,e=t){let{typeIds:r,children:n,typeMap:s}=this;return n[s[r[t]]].at(e)}},mr=class extends Rt{value(t){return super.value(t,this.offsets[t])}},zt=class extends h{constructor(t,e=Bt){super(t),this.names=this.type.children.map(r=>r.name),this.factory=e(this.names,this.children)}value(t){return this.factory(t)}},gr=class extends zt{constructor(t){super(t,X)}},br=class extends h{value(t){let[{values:e},r]=this.children;return r.at(J(e,t))}},Ir=class extends h{setDictionary(t){return this.dictionary=t,this.cache=t.cache(),this}value(t){return this.cache[this.key(t)]}key(t){return this.values[t]}},_t=class extends h{constructor({data:t,...e}){super(e),this.data=t}view(t){let{values:e,data:r}=this,n=t<<4,s=n+4,a=e,u=f(a,n);return u>12&&(s=f(a,n+12),a=r[f(a,n+8)]),a.subarray(s,s+u)}},wr=class extends _t{value(t){return this.view(t)}},Lr=class extends _t{value(t){return Y(this.view(t))}};function $t(t){let e=[];return{add(r){return e.push(r),this},clear:()=>e=[],done:()=>new xr(e,t)}}var xr=class{constructor(t,e=(r=>(r=t[0])==null?void 0:r.type)()){this.type=e,this.length=t.reduce((a,u)=>a+u.length,0),this.nullCount=t.reduce((a,u)=>a+u.nullCount,0),this.data=t;let n=t.length,s=new Int32Array(n+1);if(n===1){let[a]=t;s[1]=a.length,this.at=u=>a.at(u)}else for(let a=0,u=0;a<n;++a)s[a+1]=u+=t[a].length;this.offsets=s}get[Symbol.toStringTag](){return"Column"}[Symbol.iterator](){let t=this.data;return t.length===1?t[0][Symbol.iterator]():Nr(t)}at(t){var s;let{data:e,offsets:r}=this,n=J(r,t)-1;return(s=e[n])==null?void 0:s.at(t-r[n])}get(t){return this.at(t)}toArray(){let{length:t,nullCount:e,data:r}=this,n=!e&&He(r[0]),s=r.length;if(n&&s===1)return r[0].values;let a=new(!s||e>0?Array:r[0].constructor.ArrayType??r[0].values.constructor)(t);return n?Ar(a,r):Er(a,r)}cache(){return this._cache??(this._cache=this.toArray())}};function*Nr(t){for(let e=0;e<t.length;++e){let r=t[e][Symbol.iterator]();for(let n=r.next();!n.done;n=r.next())yield n.value}}function Ar(t,e){for(let r=0,n=0;r<e.length;++r){let{values:s}=e[r];t.set(s,n),n+=s.length}return t}function Er(t,e){let r=-1;for(let n=0;n<e.length;++n){let s=e[n];for(let a=0;a<s.length;++a)t[++r]=s.at(a)}return t}var Dr=class ee{constructor(e,r,n=!1){let s=e.fields.map(u=>u.name);this.schema=e,this.names=s,this.children=r,this.factory=n?X:Bt;let a=[];this.getFactory=u=>a[u]??(a[u]=this.factory(s,r.map(l=>l.data[u])))}get[Symbol.toStringTag](){return"Table"}get numCols(){return this.names.length}get numRows(){var e;return((e=this.children[0])==null?void 0:e.length)??0}getChildAt(e){return this.children[e]}getChild(e){let r=this.names.findIndex(n=>n===e);return r>-1?this.children[r]:void 0}selectAt(e,r=[]){let{children:n,factory:s,schema:a}=this,{fields:u}=a;return new ee({...a,fields:e.map((l,c)=>Sr(u[l],r[c]))},e.map(l=>n[l]),s===X)}select(e,r){let n=this.names,s=e.map(a=>n.indexOf(a));return this.selectAt(s,r)}toColumns(){let{children:e,names:r}=this,n={};return r.forEach((s,a)=>{var u;return n[s]=((u=e[a])==null?void 0:u.toArray())??[]}),n}toArray(){var u;let{children:e,getFactory:r,numRows:n}=this,s=((u=e[0])==null?void 0:u.data)??[],a=Array(n);for(let l=0,c=-1;l<s.length;++l){let o=r(l);for(let d=0;d<s[l].length;++d)a[++c]=o(d)}return a}*[Symbol.iterator](){var s;let{children:e,getFactory:r}=this,n=((s=e[0])==null?void 0:s.data)??[];for(let a=0;a<n.length;++a){let u=r(a);for(let l=0;l<n[a].length;++l)yield u(l)}}at(e){let{children:r,getFactory:n,numRows:s}=this;if(e<0||e>=s)return null;let[{offsets:a}]=r,u=J(a,e)-1;return n(u)(e-a[u])}get(e){return this.at(e)}};function Sr(t,e){return e!=null&&e!==t.name?{...t,name:e}:t}function Br(t,e={}){let{typeId:r,bitWidth:n,precision:s,unit:a}=t,{useBigInt:u,useDate:l,useDecimalBigInt:c,useMap:o,useProxy:d}=e;switch(r){case i.Null:return We;case i.Bool:return Ge;case i.Int:case i.Time:case i.Duration:return u||n<64?H:V;case i.Float:return s?H:Je;case i.Date:return jt(a===_.DAY?Ke:Qe,l&&Tt);case i.Timestamp:return jt(a===v.SECOND?Xe:a===v.MILLISECOND?tr:a===v.MICROSECOND?er:rr,l&&Tt);case i.Decimal:return c?qe:Ze;case i.Interval:return a===C.DAY_TIME?nr:a===C.YEAR_MONTH?H:sr;case i.FixedSizeBinary:return hr;case i.Utf8:return ur;case i.LargeUtf8:return lr;case i.Binary:return ar;case i.LargeBinary:return ir;case i.BinaryView:return wr;case i.Utf8View:return Lr;case i.List:return cr;case i.LargeList:return or;case i.Map:return o?vr:pr;case i.ListView:return dr;case i.LargeListView:return fr;case i.FixedSizeList:return yr;case i.Struct:return d?gr:zt;case i.RunEndEncoded:return br;case i.Dictionary:return Ir;case i.Union:return t.mode?mr:Rt}throw Error(Z(r))}function jt(t,e){return e?class extends e{constructor(r){super(new t(r))}}:t}function Or(t,e){return{offset:g(t,e),metadataLength:f(t,e+8),bodyLength:g(t,e+16)}}function Yt(t,e){return O(t,e,24,Or)}function kt(t,e,r){let n=N(t,e);if(n(10,M,0))throw Error("Record batch compression not implemented");let s=r<z.V4?8:0;return{length:n(4,g,0),nodes:O(t,n(6,M),16,(a,u)=>({length:g(a,u),nullCount:g(a,u+8)})),regions:O(t,n(8,M),16+s,(a,u)=>({offset:g(a,u+s),length:g(a,u+s+8)})),variadic:O(t,n(12,M),8,g)}}function Mr(t,e,r){let n=N(t,e);return{id:n(4,g,0),data:n(6,(s,a)=>kt(s,a,r)),isDelta:n(8,F,!1)}}function Pt(t,e,r,n){I(r,i,Z);let s=N(t,e);switch(r){case i.Binary:return Ie();case i.Utf8:return we();case i.LargeBinary:return Ue();case i.LargeUtf8:return Ve();case i.List:return De(n[0]);case i.ListView:return ze(n[0]);case i.LargeList:return Fe(n[0]);case i.LargeListView:return _e(n[0]);case i.Struct:return Se(n);case i.RunEndEncoded:return Re(n[0],n[1]);case i.Int:return At(s(4,f,0),s(6,F,!1));case i.Float:return be(s(4,m,pt.HALF));case i.Decimal:return Le(s(4,f,0),s(6,f,0),s(8,f,128));case i.Date:return xe(s(4,m,_.MILLISECOND));case i.Time:return Ne(s(4,m,v.MILLISECOND),s(6,f,32));case i.Timestamp:return Ae(s(4,m,v.SECOND),s(6,k));case i.Interval:return Ee(s(4,m,C.YEAR_MONTH));case i.Duration:return Ce(s(4,m,v.MILLISECOND));case i.FixedSizeBinary:return Oe(s(4,f,0));case i.FixedSizeList:return Me(n[0],s(4,f,0));case i.Map:return Te(s(4,F,!1),n[0]);case i.Union:return Be(s(4,m,W.Sparse),n,O(t,s(6,M),4,f))}return{typeId:r}}function et(t,e){let r=O(t,e,4,(n,s)=>{let a=N(n,s);return[a(4,k),a(6,k)]});return r.length?new Map(r):null}function Ht(t,e,r){let n=N(t,e);return{version:r,endianness:n(4,m,0),fields:n(6,Tr,[]),metadata:n(8,et)}}function Tr(t,e){return O(t,e,4,Wt)}function Wt(t,e){let r=N(t,e),n=r(8,K,i.NONE),s=r(10,M,0),a=r(12,Ur),u=r(14,(c,o)=>Cr(c,o)),l=Pt(t,s,n,u);return a&&(a.dictionary=l,l=a),{name:r(4,k),type:l,nullable:r(6,F,!1),metadata:r(16,et)}}function Cr(t,e){let r=O(t,e,4,Wt);return r.length?r:null}function Ur(t,e){if(!e)return null;let r=N(t,e);return ge(null,r(6,Vr,Et()),r(8,F,!1),r(4,g,0))}function Vr(t,e){return Pt(t,e,i.Int)}var Fr=(t,e)=>`Expected to read ${t} metadata bytes, but only read ${e}.`,Rr=(t,e)=>`Expected to read ${t} bytes for message body, but only read ${e}.`,zr=t=>`Unsupported message type: ${t} (${wt(D,t)})`;function rt(t,e){let r=f(t,e)||0;if(e+=4,r===-1&&(r=f(t,e)||0,e+=4),r===0)return null;let n=t.subarray(e,e+=r);if(n.byteLength<r)throw Error(Fr(r,n.byteLength));let s=N(n,0),a=s(4,m,z.V1),u=s(6,K,D.NONE),l=s(8,M,0),c=s(10,g,0),o;if(l){let d=u===D.Schema?Ht:u===D.DictionaryBatch?Mr:u===D.RecordBatch?kt:null;if(!d)throw Error(zr(u));if(o=d(n,l,a),c>0){let L=t.subarray(e,e+=c);if(L.byteLength<c)throw Error(Rr(c,L.byteLength));o.body=L}}return{version:a,type:u,index:e,content:o}}function _r(t){let e=t instanceof ArrayBuffer?new Uint8Array(t):t;return e instanceof Uint8Array&&$r(e)?Yr(e):jr(e)}function $r(t){if(!t||t.length<4)return!1;for(let e=0;e<6;++e)if(yt[e]!==t[e])return!1;return!0}function jr(t){let e=[t].flat(),r,n=[],s=[];for(let a of e){if(!(a instanceof Uint8Array))throw Error("IPC data batch was not a Uint8Array.");let u=0;for(;;){let l=rt(a,u);if(l===null)break;if(u=l.index,l.content)switch(l.type){case D.Schema:r||(r=l.content);break;case D.RecordBatch:n.push(l.content);break;case D.DictionaryBatch:s.push(l.content);break}}}return{schema:r,dictionaries:s,records:n,metadata:null}}function Yr(t){let e=t.byteLength-(yt.length+4),r=f(t,e),n=N(t,e-r),s=n(4,m,z.V1),a=n(8,Yt,[]),u=n(10,Yt,[]);return{schema:n(6,(l,c)=>Ht(l,c,s)),dictionaries:a.map(({offset:l})=>rt(t,l).content),records:u.map(({offset:l})=>rt(t,l).content),metadata:n(12,et)}}function nt(t,e){return kr(_r(t),e)}function kr(t,e={}){let{schema:r={fields:[]},dictionaries:n,records:s}=t,{version:a,fields:u}=r,l=new Map,c=Hr(e,a,l),o=new Map;Pr(r,p=>{let y=p.type;y.typeId===i.Dictionary&&o.set(y.id,y.dictionary)});let d=new Map;for(let p of n){let{id:y,data:A,isDelta:E,body:re}=p,dt=o.get(y),ft=st(dt,c({...A,body:re}));if(d.has(y)){let ht=d.get(y);E||ht.clear(),ht.add(ft)}else{if(E)throw Error("Delta update can not be first dictionary batch.");d.set(y,$t(dt).add(ft))}}d.forEach((p,y)=>l.set(y,p.done()));let L=u.map(p=>$t(p.type));for(let p of s){let y=c(p);u.forEach((A,E)=>L[E].add(st(A.type,y)))}return new Dr(r,L.map(p=>p.done()),e.useProxy)}function Pr(t,e){t.fields.forEach(function r(n){var s,a,u;e(n),(a=(s=n.type.dictionary)==null?void 0:s.children)==null||a.forEach(r),(u=n.type.children)==null||u.forEach(r)})}function Hr(t,e,r){let n={version:e,options:t,dictionary:s=>r.get(s)};return s=>{let{length:a,nodes:u,regions:l,variadic:c,body:o}=s,d=-1,L=-1,p=-1;return{...n,length:a,node:()=>u[++d],buffer:y=>{let{length:A,offset:E}=l[++L];return y?new y(o.buffer,o.byteOffset+E,A/y.BYTES_PER_ELEMENT):o.subarray(E,E+A)},variadic:()=>c[++p],visit(y){return y.map(A=>st(A.type,this))}}}}function st(t,e){let{typeId:r}=t,{length:n,options:s,node:a,buffer:u,variadic:l,version:c}=e,o=Br(t,s);if(r===i.Null)return new o({length:n,nullCount:n,type:t});let d={...a(),type:t};switch(r){case i.Bool:case i.Int:case i.Time:case i.Duration:case i.Float:case i.Decimal:case i.Date:case i.Timestamp:case i.Interval:case i.FixedSizeBinary:return new o({...d,validity:u(),values:u(t.values)});case i.Utf8:case i.LargeUtf8:case i.Binary:case i.LargeBinary:return new o({...d,validity:u(),offsets:u(t.offsets),values:u()});case i.BinaryView:case i.Utf8View:return new o({...d,validity:u(),values:u(),data:Array.from({length:l()},()=>u())});case i.List:case i.LargeList:case i.Map:return new o({...d,validity:u(),offsets:u(t.offsets),children:e.visit(t.children)});case i.ListView:case i.LargeListView:return new o({...d,validity:u(),offsets:u(t.offsets),sizes:u(t.offsets),children:e.visit(t.children)});case i.FixedSizeList:case i.Struct:return new o({...d,validity:u(),children:e.visit(t.children)});case i.RunEndEncoded:return new o({...d,children:e.visit(t.children)});case i.Dictionary:{let{id:L,indices:p}=t;return new o({...d,validity:u(),values:u(p.values)}).setDictionary(e.dictionary(L))}case i.Union:return c<z.V5&&u(),new o({...d,typeIds:u(It),offsets:t.mode===W.Sparse?null:u(t.offsets),children:e.visit(t.children)});default:throw Error(Z(r))}}new Uint16Array(new Uint8Array([1,0]).buffer)[0];function R(t,e){let r=new Map;return(...n)=>{let s=e(...n);if(r.has(s))return r.get(s);let a=t(...n).finally(()=>{r.delete(s)});return r.set(s,a),a}}function at(t,e){return de(t,e)}function Wr(){return ce()}const w=oe;function Jt(){let t=Jr(Wr()),e=r=>JSON.stringify(r);return{load:R(t.load.bind(t),e),sanitize:R(t.sanitize.bind(t),e),http:R(t.http.bind(t),e),file:R(t.file.bind(t),e)}}function Jr(t){return{...t,async load(e,r){if(e.endsWith(".arrow")){let n=await Gt(e);return nt(n,{useProxy:!1}).toArray()}return t.load(e,r)}}}const Gt=R(t=>fetch(t).then(e=>e.arrayBuffer()),t=>t);var Zt=w.integer,qt=w.number,Gr=w.date,Zr=w.boolean,Kt=()=>(w.integer=t=>{if(t==="")return"";if(t==="-inf"||t==="inf")return t;function e(n){let s=Zt(n);return Number.isNaN(s)?n:s}let r=Number.parseInt(t,10);if(ye(r)){if(!(Math.abs(r)>2**53-1))return e(t);try{return BigInt(t)}catch{return e(t)}}else return""},w.number=t=>{if(t==="-inf"||t==="inf")return t;let e=qt(t);return Number.isNaN(e)?t:e},()=>{w.integer=Zt,w.number=qt}),Qt=()=>(w.date=t=>{if(t==="")return"";if(t==null)return null;if(!/^\d{4}-\d{2}-\d{2}(T[\d.:]+(Z|[+-]\d{2}:?\d{2})?)?$/.test(t))return t;try{let e=new Date(t);return Number.isNaN(e.getTime())?t:e}catch{return ue.warn(`Failed to parse date: ${t}`),t}},()=>{w.date=Gr});w.boolean=t=>t==="True"?!0:t==="False"?!1:Zr(t);const Xt=Jt();async function qr(t,e,r={}){let{handleBigIntAndNumberLike:n=!1,replacePeriod:s=!1}=r;if(t.endsWith(".arrow")||(e==null?void 0:e.type)==="arrow"){let l=await Gt(t);return nt(l,{useProxy:!0,useDate:!0,useBigInt:n}).toArray()}let a=[Qt];n&&a.push(Kt);let u=[];try{let l=await Xt.load(t);if(!e){if(typeof l=="string")try{JSON.parse(l),e={type:"json"}}catch{e={type:"csv",parse:"auto"}}typeof l=="object"&&(e={type:"json"})}let c=(e==null?void 0:e.type)==="csv";c&&typeof l=="string"&&(l=Qr(l)),c&&typeof l=="string"&&s&&(l=Xr(l));let o=(e==null?void 0:e.parse)||"auto";return typeof o=="object"&&(o=le.mapValues(o,d=>d==="time"?"string":d==="datetime"?"date":d)),u=a.map(d=>d()),c?at(l,{...e,parse:o}):at(l,e)}finally{u.forEach(l=>l())}}function Kr(t,e=!0){let r=[Qt];e&&r.push(Kt);let n=r.map(a=>a()),s=at(t,{type:"csv",parse:"auto"});return n.forEach(a=>a()),s}function Qr(t){return t!=null&&t.includes(",")?te(t,e=>{let r=new Set;return e.map(n=>{let s=en(n,r);return r.add(s),s})}):t}function Xr(t){return t!=null&&t.includes(".")?te(t,e=>e.map(r=>r.replaceAll(".","\u2024"))):t}function te(t,e){let r=t.split(`
`),n=r[0].split(",");return r[0]=e(n).join(","),r.join(`
`)}var tn="\u200B";function en(t,e){let r=t,n=1;for(;e.has(r);)r=`${t}${tn.repeat(n)}`,n++;return r}export{nt as a,Jt as i,qr as n,Xt as r,Kr as t};
